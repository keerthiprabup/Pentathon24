Current version: gitlab-ce=16.0.0-ce.0

Cleaning stale PIDs & sockets
cat: /var/opt/gitlab/gitlab-rails/VERSION: No such file or directory
Installing gitlab.rb config...
Generating ssh_host_rsa_key...
Generating public/private rsa key pair.
Your identification has been saved in /etc/gitlab/id_rsa
Your public key has been saved in /home/bob/.ssh/id_rsa.pub
The key fingerprint is:
SHA256:mA9ZvQvPEKwgCra+d2j+479oVVZ3F236uJ4KGMGxwSE root@4957012b6a55
The key's randomart image is:
+---[RSA 3072]----+
|      E.+.     .o|
|       +.= . . .+|
|... .   B o . .o.|
|o... . * = .  .  |
|..    * S .    o |
|.      + B .  . .|
| .  . . o =    . |
|  .+ +.    .  .. |
| .+.=+oo.   .oo  |
+----[SHA256]-----+
Preparing services...
Starting services...
Configuring GitLab...
/opt/gitlab/embedded/bin/runsvdir-start: line 24: ulimit: pending signals: cannot modify limit: Operation not permitted
/opt/gitlab/embedded/bin/runsvdir-start: line 37: /proc/sys/fs/file-max: Read-only file system
[2024-03-06T19:59:13+00:00] INFO: Started Cinc Zero at chefzero://localhost:1 with repository at /opt/gitlab/embedded (One version per cookbook)
Cinc Client, version 17.10.0
Patents: https://www.chef.io/patents
Infra Phase starting
[2024-03-06T19:59:13+00:00] INFO: *** Cinc Client 17.10.0 ***
[2024-03-06T19:59:13+00:00] INFO: Platform: x86_64-linux
[2024-03-06T19:59:13+00:00] INFO: Cinc-client pid: 34
[2024-03-06T19:59:13+00:00] INFO: Setting the run_list to ["recipe[gitlab]"] from CLI options
[2024-03-06T19:59:13+00:00] INFO: Run List is [recipe[gitlab]]
[2024-03-06T19:59:13+00:00] INFO: Run List expands to [gitlab]
[2024-03-06T19:59:13+00:00] INFO: Starting Cinc Client Run for 4957012b6a55
[2024-03-06T19:59:13+00:00] INFO: Running start handlers
[2024-03-06T19:59:13+00:00] INFO: Start handlers complete.
Resolving cookbooks for run list: ["gitlab"]
[2024-03-06T19:59:14+00:00] INFO: Loading cookbooks [gitlab@0.0.1, package@0.1.0, logrotate@0.1.0, postgresql@0.1.0, redis@0.1.0, monitoring@0.1.0, registry@0.1.0, mattermost@0.1.0, consul@0.1.0, gitaly@0.1.0, praefect@0.1.0, gitlab-kas@0.1.0, gitlab-pages@0.1.0, letsencrypt@0.1.0, nginx@0.1.0, runit@5.1.7, acme@4.1.6, crond@0.1.0]
Synchronizing cookbooks:
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/gitlab_rails.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/gitlab_sshd_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/account_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/bash_hide_env.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/helpers/base_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/helpers/base_pg_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/gitlab_mattermost.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/gitlab_shell.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/helpers/gitlab_rails_env_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/helpers/grafana_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/helpers/pg_status_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/helpers/geo_pg_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/helpers/gitlab_rails.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/helpers/pg_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/gitlab_workhorse.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/helpers/gitlab_workhorse_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/helpers/authorizer_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/gitlab_exporter.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/logfiles_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/logging.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/mailroom_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/nginx.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/patroni.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/pg_version.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/postgresql.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/puma.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/rails_migration_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/redis.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/redis_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/redis_uri.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/registry.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/sidekiq.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/smtp_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/storage_check.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/recipes/add_trusted_certs.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/recipes/bootstrap.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/recipes/bootstrap_disable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/recipes/config.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/recipes/database_migrations.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/recipes/database_reindexing_disable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/recipes/database_reindexing_enable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/recipes/default.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/recipes/gitlab-healthcheck.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/recipes/gitlab-rails.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/recipes/gitlab-shell.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/recipes/gitlab-workhorse.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/recipes/gitlab-workhorse_disable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/recipes/letsencrypt_renew.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/recipes/mailroom.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/recipes/mailroom_disable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/recipes/nginx.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/recipes/nginx_disable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/recipes/puma.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/recipes/puma_disable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/recipes/rails_pages_shared_path.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/recipes/remote-syslog.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/recipes/remote-syslog_disable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/recipes/remove_accounts.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/recipes/selinux.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/recipes/show_config.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/recipes/sidekiq.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/recipes/sidekiq_disable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/recipes/storage-check.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/recipes/storage-check_disable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/recipes/users.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/recipes/web-server.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/resources/database_objects.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/resources/puma_config.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/resources/rails_migration.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/resources/sidekiq_service.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/cable.yml.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/database.yml.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/gitconfig-system.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/gitconfig.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/gitlab-healthcheck-rc.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/gitlab-rails-error.html.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/gitlab-rails-rc.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/gitlab-shell-config.yml.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/gitlab.yml.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/make_metrics_rundir.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/mount_point_check.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/nginx-gitlab-health.conf.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/nginx-gitlab-http.conf.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/nginx-gitlab-kas-http.conf.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/nginx-gitlab-mattermost-http.conf.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/nginx-gitlab-pages-http.conf.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/nginx-gitlab-registry-http.conf.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/nginx-status.conf.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/nginx.conf.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/puma.rb.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/redis.yml.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/remote_syslog.yml.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/resque.yml.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/secret_token.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/secrets.yml.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/smtp_settings.rb.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/sv-gitlab-sshd-log-config.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/sv-gitlab-sshd-log-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/sv-gitlab-sshd-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/sv-gitlab-workhorse-log-config.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/sv-gitlab-workhorse-log-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/sv-gitlab-workhorse-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/sv-mailroom-finish.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/sv-mailroom-log-config.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/sv-mailroom-log-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/sv-mailroom-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/sv-puma-h.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/sv-puma-log-config.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/sv-puma-log-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/sv-puma-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/sv-puma-t.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/sv-remote-syslog-log-config.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/sv-remote-syslog-log-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/sv-remote-syslog-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/sv-sidekiq-log-config.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/sv-sidekiq-log-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/sv-sidekiq-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/sv-storage-check-log-config.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/sv-storage-check-log-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/sv-storage-check-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/templates/default/workhorse-config.toml.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/README.md in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/metadata.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/attributes/default.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/files/default/gitlab-runsvdir.conf in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/certificate_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/config/gitlab.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/config/roles/application.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/config/roles/consul.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/config/roles/default.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/config/roles/geo_primary.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/config/roles/geo_secondary.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/config/roles/monitoring.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/config/roles/pages.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/config/roles/patroni.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/config/roles/pgbouncer.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/config/roles/postgres.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/config/roles/redis_master.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/config/roles/redis_sentinel.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/config/roles/sidekiq.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/config/roles/spamcheck.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/config/services.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/config_mash.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/deprecations.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/formatters/gitlab.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/gitlab_cluster.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/handlers/gitlab.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/helpers/logging_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/helpers/node_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/helpers/output_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/helpers/roles_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/helpers/secrets_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/helpers/selinux_distro_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/helpers/selinux_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/helpers/services_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/helpers/shell_out_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/helpers/systemd_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/helpers/version_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/object_proxy.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/omnibus_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/package.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/settings_dsl.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/libraries/storage_directory_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/recipes/runit.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/recipes/runit_systemd.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/recipes/runit_sysvinit.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/recipes/runit_upstart.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/recipes/sysctl.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/resources/account.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/resources/env_dir.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/resources/gitlab_sysctl.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/resources/storage_directory.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/resources/templatesymlink.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/resources/version_file.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/templates/default/gitlab-runsvdir.service.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/metadata.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/package/attributes/default.rb in the cache.
  - package (0.1.0)
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/logrotate/recipes/disable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/logrotate/recipes/enable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/logrotate/recipes/folders_and_configs.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/logrotate/templates/default/logrotate-service.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/logrotate/templates/default/logrotate.conf.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/logrotate/templates/default/sv-logrotate-log-config.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/logrotate/templates/default/sv-logrotate-log-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/logrotate/templates/default/sv-logrotate-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/logrotate/templates/default/sv-logrotate-t.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/logrotate/metadata.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/logrotate/attributes/default.rb in the cache.
  - logrotate (0.1.0)
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/postgresql/recipes/bin.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/postgresql/recipes/directory_locations.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/postgresql/recipes/disable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/postgresql/recipes/enable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/postgresql/recipes/standalone.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/postgresql/recipes/sysctl.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/postgresql/recipes/user.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/postgresql/resources/config.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/postgresql/resources/database.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/postgresql/resources/extension.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/postgresql/resources/query.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/postgresql/resources/schema.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/postgresql/resources/user.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/postgresql/templates/default/gitlab-psql-rc.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/postgresql/templates/default/pg_hba.conf.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/postgresql/templates/default/pg_ident.conf.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/postgresql/templates/default/postgresql-runtime.conf.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/postgresql/templates/default/postgresql.conf.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/postgresql/templates/default/sv-postgresql-log-config.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/postgresql/templates/default/sv-postgresql-log-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/postgresql/templates/default/sv-postgresql-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/postgresql/templates/default/sv-postgresql-t.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/postgresql/README.md in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/postgresql/metadata.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/postgresql/attributes/default.rb in the cache.
  - postgresql (0.1.0)
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/redis/recipes/disable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/redis/recipes/enable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/redis/resources/service.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/redis/templates/default/gitlab-redis-cli-rc.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/redis/templates/default/redis.conf.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/redis/templates/default/sv-redis-log-config.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/redis/templates/default/sv-redis-log-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/redis/templates/default/sv-redis-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/redis/metadata.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/redis/attributes/attributes.rb in the cache.
  - redis (0.1.0)
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/libraries/grafana.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/libraries/prometheus.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/libraries/prometheus_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/recipes/alertmanager.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/recipes/alertmanager_disable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/recipes/default.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/recipes/gitlab-exporter.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/recipes/gitlab-exporter_disable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/recipes/grafana.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/recipes/grafana_disable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/recipes/node-exporter.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/recipes/node-exporter_disable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/recipes/pgbouncer-exporter.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/recipes/pgbouncer-exporter_disable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/recipes/postgres-exporter.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/recipes/postgres-exporter_disable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/recipes/prometheus.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/recipes/prometheus_disable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/recipes/redis-exporter.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/recipes/redis-exporter_disable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/recipes/user.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/templates/gitlab-exporter.yml.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/templates/grafana_ini.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/templates/mount_point_check.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/templates/postgres-queries.yaml.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/templates/rules/gitlab.rules in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/templates/rules/node.rules in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/templates/sv-alertmanager-log-config.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/templates/sv-alertmanager-log-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/templates/sv-alertmanager-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/templates/sv-gitlab-exporter-log-config.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/templates/sv-gitlab-exporter-log-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/templates/sv-gitlab-exporter-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/templates/sv-grafana-log-config.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/templates/sv-grafana-log-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/templates/sv-grafana-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/templates/sv-node-exporter-log-config.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/templates/sv-node-exporter-log-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/templates/sv-node-exporter-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/templates/sv-pgbouncer-exporter-log-config.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/templates/sv-pgbouncer-exporter-log-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/templates/sv-pgbouncer-exporter-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/templates/sv-postgres-exporter-log-config.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/templates/sv-postgres-exporter-log-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/templates/sv-postgres-exporter-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/templates/sv-prometheus-log-config.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/templates/sv-prometheus-log-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/templates/sv-prometheus-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/templates/sv-redis-exporter-log-config.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/templates/sv-redis-exporter-log-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/templates/sv-redis-exporter-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/metadata.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/monitoring/attributes/default.rb in the cache.
  - monitoring (0.1.0)
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/registry/recipes/disable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/registry/recipes/enable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/registry/templates/default/registry-config.yml.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/registry/templates/default/sv-registry-log-config.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/registry/templates/default/sv-registry-log-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/registry/templates/default/sv-registry-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/registry/metadata.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/registry/attributes/default.rb in the cache.
  - registry (0.1.0)
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/mattermost/libraries/mattermost_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/mattermost/recipes/disable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/mattermost/recipes/enable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/mattermost/templates/default/sv-mattermost-log-config.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/mattermost/templates/default/sv-mattermost-log-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/mattermost/templates/default/sv-mattermost-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/mattermost/metadata.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/mattermost/attributes/default.rb in the cache.
  - mattermost (0.1.0)
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/consul/libraries/consul.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/consul/libraries/consul_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/consul/libraries/failover_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/consul/libraries/watch_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/consul/recipes/configure_services.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/consul/recipes/disable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/consul/recipes/disable_daemon.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/consul/recipes/disable_service_postgresql.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/consul/recipes/enable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/consul/recipes/enable_daemon.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/consul/recipes/enable_service_postgresql.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/consul/recipes/watchers.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/consul/resources/consul_service.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/consul/templates/default/sv-consul-log-config.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/consul/templates/default/sv-consul-log-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/consul/templates/default/sv-consul-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/consul/templates/default/watcher_scripts/failover_pgbouncer.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/consul/metadata.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/consul/attributes/default.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/consul/attributes/services.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/consul/attributes/watchers.rb in the cache.
  - consul (0.1.0)
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitaly/libraries/gitaly.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitaly/recipes/disable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitaly/recipes/enable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitaly/templates/default/gitaly-config.toml.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitaly/templates/default/sv-gitaly-log-config.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitaly/templates/default/sv-gitaly-log-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitaly/templates/default/sv-gitaly-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitaly/metadata.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitaly/attributes/default.rb in the cache.
  - gitaly (0.1.0)
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/praefect/recipes/database_migrations.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/praefect/recipes/disable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/praefect/recipes/enable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/praefect/templates/default/praefect-config.toml.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/praefect/templates/default/sv-praefect-log-config.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/praefect/templates/default/sv-praefect-log-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/praefect/templates/default/sv-praefect-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/praefect/metadata.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/praefect/attributes/default.rb in the cache.
  - praefect (0.1.0)
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab-kas/libraries/gitlab_kas.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab-kas/recipes/disable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab-kas/recipes/enable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab-kas/templates/default/gitlab-kas-config.yml.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab-kas/templates/default/sv-gitlab-kas-log-config.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab-kas/templates/default/sv-gitlab-kas-log-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab-kas/templates/default/sv-gitlab-kas-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab-kas/metadata.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab-kas/attributes/default.rb in the cache.
  - gitlab-kas (0.1.0)
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab-pages/libraries/gitlab_pages.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab-pages/recipes/disable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab-pages/recipes/enable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab-pages/templates/default/gitlab-pages-config.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab-pages/templates/default/mount_point_check.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab-pages/templates/default/secret_token.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab-pages/templates/default/sv-gitlab-pages-log-config.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab-pages/templates/default/sv-gitlab-pages-log-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab-pages/templates/default/sv-gitlab-pages-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab-pages/metadata.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab-pages/attributes/default.rb in the cache.
  - gitlab-pages (0.1.0)
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/letsencrypt/libraries/helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/letsencrypt/libraries/lets_encrypt.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/letsencrypt/recipes/disable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/letsencrypt/recipes/enable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/letsencrypt/recipes/http_authorization.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/letsencrypt/resources/certificate.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/letsencrypt/README.md in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/letsencrypt/metadata.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/letsencrypt/attributes/default.rb in the cache.
  - letsencrypt (0.1.0)
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/nginx/recipes/enable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/nginx/templates/default/sv-nginx-log-config.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/nginx/templates/default/sv-nginx-log-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/nginx/templates/default/sv-nginx-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/nginx/metadata.rb in the cache.
  - nginx (0.1.0)
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/runit/libraries/helpers.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/runit/libraries/provider_runit_service.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/runit/libraries/resource_runit_service.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/runit/LICENSE in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/runit/README.md in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/runit/metadata.rb in the cache.
  - runit (5.1.7)
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/acme/libraries/acme.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/acme/chefignore in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/acme/kitchen.digitalocean.yml in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/acme/LICENSE in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/acme/recipes/default.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/acme/kitchen.dokken.yml in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/acme/resources/certificate.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/acme/resources/selfsigned.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/acme/resources/ssl_key.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/acme/.rubocop.yml in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/acme/templates/acme-challange.nginx.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/acme/README.md in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/acme/Berksfile in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/acme/kitchen.yml in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/acme/metadata.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/acme/attributes/default.rb in the cache.
  - acme (4.1.6)
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/crond/recipes/disable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/crond/recipes/enable.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/crond/resources/job.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/crond/templates/default/sv-crond-log-config.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/crond/templates/default/sv-crond-log-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/crond/templates/default/sv-crond-run.erb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/crond/metadata.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/crond/attributes/default.rb in the cache.
  - crond (0.1.0)
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/helpers/metrics_exporter_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/helpers/web_server_helper.rb in the cache.
[2024-03-06T19:59:14+00:00] INFO: Storing updated cookbooks/gitlab/libraries/incoming_email.rb in the cache.
  - gitlab (0.0.1)
Installing cookbook gem dependencies:
Compiling cookbooks...
Top level ::CompositeIO is deprecated, require 'multipart/post' and use `Multipart::Post::CompositeReadIO` instead!
Top level ::Parts is deprecated, require 'multipart/post' and use `Multipart::Post::Parts` instead!
Loading Cinc Auditor profile files:
Loading Cinc Auditor input files:
Loading Cinc Auditor waiver files:
Recipe: gitlab::default
  * directory[/etc/gitlab] action create[2024-03-06T19:59:17+00:00] INFO: directory[/etc/gitlab] mode changed to 775

    - change mode from '0755' to '0775'
[2024-03-06T19:59:17+00:00] WARN: gitlab-rails does not have a log_group or default logdir mode defined. Setting to 0700.
[2024-03-06T19:59:17+00:00] INFO: Skipped selecting an init system because it was explicitly disabled
[2024-03-06T19:59:17+00:00] WARN: gitlab-shell does not have a log_group or default logdir mode defined. Setting to 0700.
[2024-03-06T19:59:17+00:00] WARN: gitlab-sshd does not have a log_group or default logdir mode defined. Setting to 0700.
[2024-03-06T19:59:17+00:00] WARN: logrotate does not have a log_group or default logdir mode defined. Setting to 0700.
[2024-03-06T19:59:17+00:00] WARN: logrotate does not have a log_group or default logdir mode defined. Setting to 0700.
[2024-03-06T19:59:17+00:00] WARN: puma does not have a log_group or default logdir mode defined. Setting to 0700.
[2024-03-06T19:59:17+00:00] WARN: gitlab-rails does not have a log_group or default logdir mode defined. Setting to 0700.
[2024-03-06T19:59:17+00:00] WARN: gitlab-shell does not have a log_group or default logdir mode defined. Setting to 0700.
[2024-03-06T19:59:17+00:00] WARN: gitlab-workhorse does not have a log_group or default logdir mode defined. Setting to 0700.
[2024-03-06T19:59:17+00:00] WARN: gitlab-pages does not have a log_group or default logdir mode defined. Setting to 0700.
[2024-03-06T19:59:17+00:00] WARN: gitlab-kas does not have a log_group or default logdir mode defined. Setting to 0700.
[2024-03-06T19:59:17+00:00] WARN: gitaly does not have a log_group or default logdir mode defined. Setting to 0700.
[2024-03-06T19:59:17+00:00] WARN: mailroom does not have a log_group or default logdir mode defined. Setting to 0700.
[2024-03-06T19:59:17+00:00] WARN: gitaly does not have a log_group or default logdir mode defined. Setting to 0700.
[2024-03-06T19:59:18+00:00] WARN: postgresql does not have a log_group or default logdir mode defined. Setting to 0700.
[2024-03-06T19:59:18+00:00] WARN: postgresql does not have a log_group or default logdir mode defined. Setting to 0700.
[2024-03-06T19:59:18+00:00] INFO: /opt/gitlab/init/postgresql status does not exist.
[2024-03-06T19:59:18+00:00] WARN: gitlab-kas does not have a log_group or default logdir mode defined. Setting to 0700.
[2024-03-06T19:59:18+00:00] WARN: puma does not have a log_group or default logdir mode defined. Setting to 0700.
[2024-03-06T19:59:18+00:00] WARN: sidekiq does not have a log_group or default logdir mode defined. Setting to 0700.
[2024-03-06T19:59:18+00:00] WARN: gitlab-workhorse does not have a log_group or default logdir mode defined. Setting to 0700.
[2024-03-06T19:59:18+00:00] WARN: gitlab-exporter does not have a log_group or default logdir mode defined. Setting to 0700.
[2024-03-06T19:59:18+00:00] WARN: redis-exporter does not have a log_group or default logdir mode defined. Setting to 0700.
[2024-03-06T19:59:18+00:00] WARN: prometheus does not have a log_group or default logdir mode defined. Setting to 0700.
[2024-03-06T19:59:18+00:00] WARN: alertmanager does not have a log_group or default logdir mode defined. Setting to 0700.
[2024-03-06T19:59:18+00:00] WARN: postgres-exporter does not have a log_group or default logdir mode defined. Setting to 0700.
/opt/gitlab/embedded/lib/ruby/gems/3.0.0/gems/ohai-17.9.0/lib/ohai/plugins/rpm.rb:25: warning: already initialized constant MACROS_MARKER
/opt/gitlab/embedded/lib/ruby/gems/3.0.0/gems/ohai-17.9.0/lib/ohai/plugins/rpm.rb:25: warning: previous definition of MACROS_MARKER was here
/opt/gitlab/embedded/lib/ruby/gems/3.0.0/gems/ohai-17.9.0/lib/ohai/plugins/rpm.rb:27: warning: already initialized constant DO_NOT_SPLIT
/opt/gitlab/embedded/lib/ruby/gems/3.0.0/gems/ohai-17.9.0/lib/ohai/plugins/rpm.rb:27: warning: previous definition of DO_NOT_SPLIT was here
  Converging 273 resources
  * directory[/etc/gitlab] action create (up to date)
  * directory[Create /var/opt/gitlab] action create[2024-03-06T19:59:18+00:00] INFO: directory[Create /var/opt/gitlab] owner changed to 0
[2024-03-06T19:59:18+00:00] INFO: directory[Create /var/opt/gitlab] group changed to 0
[2024-03-06T19:59:18+00:00] INFO: directory[Create /var/opt/gitlab] mode changed to 755

    - change mode from '0750' to '0755'
    - change owner from 'git' to 'root'
    - change group from 'git' to 'root'
  * directory[Create /var/log/gitlab] action create (up to date)
  * directory[/opt/gitlab/embedded/etc] action create[2024-03-06T19:59:18+00:00] INFO: directory[/opt/gitlab/embedded/etc] created directory /opt/gitlab/embedded/etc

    - create new directory /opt/gitlab/embedded/etc[2024-03-06T19:59:18+00:00] INFO: directory[/opt/gitlab/embedded/etc] owner changed to 0
[2024-03-06T19:59:18+00:00] INFO: directory[/opt/gitlab/embedded/etc] group changed to 0
[2024-03-06T19:59:18+00:00] INFO: directory[/opt/gitlab/embedded/etc] mode changed to 755

    - change mode from '' to '0755'
    - change owner from '' to 'root'
    - change group from '' to 'root'
  * template[/opt/gitlab/embedded/etc/gitconfig] action create[2024-03-06T19:59:18+00:00] INFO: template[/opt/gitlab/embedded/etc/gitconfig] created file /opt/gitlab/embedded/etc/gitconfig

    - create new file /opt/gitlab/embedded/etc/gitconfig[2024-03-06T19:59:18+00:00] INFO: template[/opt/gitlab/embedded/etc/gitconfig] updated file contents /opt/gitlab/embedded/etc/gitconfig

    - update content in file /opt/gitlab/embedded/etc/gitconfig from none to e3b0c4
    (no diff)[2024-03-06T19:59:18+00:00] INFO: template[/opt/gitlab/embedded/etc/gitconfig] mode changed to 755

    - change mode from '' to '0755'
Recipe: gitlab::web-server
  * account[Webserver user and group] action create (up to date)
Recipe: gitlab::users
  * directory[/var/opt/gitlab] action create (up to date)
  * account[GitLab user and group] action create (up to date)
  * template[/var/opt/gitlab/.gitconfig] action create[2024-03-06T19:59:18+00:00] INFO: template[/var/opt/gitlab/.gitconfig] created file /var/opt/gitlab/.gitconfig

    - create new file /var/opt/gitlab/.gitconfig[2024-03-06T19:59:18+00:00] INFO: template[/var/opt/gitlab/.gitconfig] updated file contents /var/opt/gitlab/.gitconfig

    - update content in file /var/opt/gitlab/.gitconfig from none to dd0068
    --- /var/opt/gitlab/.gitconfig      2024-03-06 19:59:18.521895439 +0000
    +++ /var/opt/gitlab/.chef-.gitconfig20240306-34-pb7hvb.gitconfig    2024-03-06 19:59:18.521895439 +0000
    @@ -1,12 +1,24 @@
    +# This file is managed by gitlab-ctl. Manual changes will be
    +# erased! To change the contents below, edit /etc/gitlab/gitlab.rb
    +# and run `sudo gitlab-ctl reconfigure`.
    +
    +[user]
    +        name = GitLab
    +        email = gitlab@4957012b6a55
    +[core]
    +        autocrlf = input
    +        
    +[gc]
    +        auto = 0[2024-03-06T19:59:18+00:00] INFO: template[/var/opt/gitlab/.gitconfig] owner changed to 998
[2024-03-06T19:59:18+00:00] INFO: template[/var/opt/gitlab/.gitconfig] group changed to 998
[2024-03-06T19:59:18+00:00] INFO: template[/var/opt/gitlab/.gitconfig] mode changed to 644

    - change mode from '' to '0644'
    - change owner from '' to 'git'
    - change group from '' to 'git'
  * directory[/var/opt/gitlab/.bundle] action create[2024-03-06T19:59:18+00:00] INFO: directory[/var/opt/gitlab/.bundle] created directory /var/opt/gitlab/.bundle

    - create new directory /var/opt/gitlab/.bundle[2024-03-06T19:59:18+00:00] INFO: directory[/var/opt/gitlab/.bundle] owner changed to 998
[2024-03-06T19:59:18+00:00] INFO: directory[/var/opt/gitlab/.bundle] group changed to 998

    - change owner from '' to 'git'
    - change group from '' to 'git'
Recipe: gitlab::gitlab-rails
  * storage_directory[/var/opt/gitlab/git-data] action create
    * ruby_block[directory resource: /var/opt/gitlab/git-data] action run[2024-03-06T19:59:18+00:00] INFO: ruby_block[directory resource: /var/opt/gitlab/git-data] called

      - execute the ruby block directory resource: /var/opt/gitlab/git-data
  
  * storage_directory[/var/opt/gitlab/git-data/repositories] action create
    * ruby_block[directory resource: /var/opt/gitlab/git-data/repositories] action run[2024-03-06T19:59:18+00:00] INFO: ruby_block[directory resource: /var/opt/gitlab/git-data/repositories] called

      - execute the ruby block directory resource: /var/opt/gitlab/git-data/repositories
  
Recipe: gitlab::rails_pages_shared_path
  * storage_directory[/var/opt/gitlab/gitlab-rails/shared] action create
    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared] action run[2024-03-06T19:59:19+00:00] INFO: ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared] called

      - execute the ruby block directory resource: /var/opt/gitlab/gitlab-rails/shared
  
  * storage_directory[/var/opt/gitlab/gitlab-rails/shared/pages] action create
    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/pages] action run[2024-03-06T19:59:19+00:00] INFO: ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/pages] called

      - execute the ruby block directory resource: /var/opt/gitlab/gitlab-rails/shared/pages
  
Recipe: gitlab::gitlab-rails
  * storage_directory[/var/opt/gitlab/gitlab-rails/shared/artifacts] action create
    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/artifacts] action run[2024-03-06T19:59:19+00:00] INFO: ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/artifacts] called

      - execute the ruby block directory resource: /var/opt/gitlab/gitlab-rails/shared/artifacts
  
  * storage_directory[/var/opt/gitlab/gitlab-rails/shared/external-diffs] action create
    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/external-diffs] action run[2024-03-06T19:59:19+00:00] INFO: ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/external-diffs] called

      - execute the ruby block directory resource: /var/opt/gitlab/gitlab-rails/shared/external-diffs
  
  * storage_directory[/var/opt/gitlab/gitlab-rails/shared/lfs-objects] action create
    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/lfs-objects] action run[2024-03-06T19:59:19+00:00] INFO: ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/lfs-objects] called

      - execute the ruby block directory resource: /var/opt/gitlab/gitlab-rails/shared/lfs-objects
  
  * storage_directory[/var/opt/gitlab/gitlab-rails/shared/packages] action create
    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/packages] action run[2024-03-06T19:59:20+00:00] INFO: ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/packages] called

      - execute the ruby block directory resource: /var/opt/gitlab/gitlab-rails/shared/packages
  
  * storage_directory[/var/opt/gitlab/gitlab-rails/shared/dependency_proxy] action create
    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/dependency_proxy] action run[2024-03-06T19:59:20+00:00] INFO: ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/dependency_proxy] called

      - execute the ruby block directory resource: /var/opt/gitlab/gitlab-rails/shared/dependency_proxy
  
  * storage_directory[/var/opt/gitlab/gitlab-rails/shared/terraform_state] action create
    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/terraform_state] action run[2024-03-06T19:59:20+00:00] INFO: ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/terraform_state] called

      - execute the ruby block directory resource: /var/opt/gitlab/gitlab-rails/shared/terraform_state
  
  * storage_directory[/var/opt/gitlab/gitlab-rails/shared/ci_secure_files] action create
    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/ci_secure_files] action run[2024-03-06T19:59:20+00:00] INFO: ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/ci_secure_files] called

      - execute the ruby block directory resource: /var/opt/gitlab/gitlab-rails/shared/ci_secure_files
  
  * storage_directory[/var/opt/gitlab/gitlab-rails/shared/encrypted_settings] action create
    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/encrypted_settings] action run[2024-03-06T19:59:20+00:00] INFO: ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/encrypted_settings] called

      - execute the ruby block directory resource: /var/opt/gitlab/gitlab-rails/shared/encrypted_settings
  
  * storage_directory[/var/opt/gitlab/gitlab-rails/uploads] action create
    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/uploads] action run[2024-03-06T19:59:21+00:00] INFO: ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/uploads] called

      - execute the ruby block directory resource: /var/opt/gitlab/gitlab-rails/uploads
  
  * storage_directory[/var/opt/gitlab/gitlab-ci/builds] action create
    * ruby_block[directory resource: /var/opt/gitlab/gitlab-ci/builds] action run[2024-03-06T19:59:21+00:00] INFO: ruby_block[directory resource: /var/opt/gitlab/gitlab-ci/builds] called

      - execute the ruby block directory resource: /var/opt/gitlab/gitlab-ci/builds
  
  * storage_directory[/var/opt/gitlab/gitlab-rails/shared/cache] action create
    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/cache] action run[2024-03-06T19:59:21+00:00] INFO: ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/cache] called

      - execute the ruby block directory resource: /var/opt/gitlab/gitlab-rails/shared/cache
  
  * storage_directory[/var/opt/gitlab/gitlab-rails/shared/tmp] action create
    * ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/tmp] action run[2024-03-06T19:59:21+00:00] INFO: ruby_block[directory resource: /var/opt/gitlab/gitlab-rails/shared/tmp] called

      - execute the ruby block directory resource: /var/opt/gitlab/gitlab-rails/shared/tmp
  
  * storage_directory[/opt/gitlab/embedded/service/gitlab-rails/public] action create (skipped due to only_if)
  * directory[create /var/opt/gitlab/gitlab-rails/etc] action create[2024-03-06T19:59:21+00:00] INFO: directory[create /var/opt/gitlab/gitlab-rails/etc] created directory /var/opt/gitlab/gitlab-rails/etc

    - create new directory /var/opt/gitlab/gitlab-rails/etc[2024-03-06T19:59:21+00:00] INFO: directory[create /var/opt/gitlab/gitlab-rails/etc] owner changed to 998
[2024-03-06T19:59:21+00:00] INFO: directory[create /var/opt/gitlab/gitlab-rails/etc] mode changed to 700

    - change mode from '' to '0700'
    - change owner from '' to 'git'
  * directory[create /opt/gitlab/etc/gitlab-rails] action create[2024-03-06T19:59:21+00:00] INFO: directory[create /opt/gitlab/etc/gitlab-rails] created directory /opt/gitlab/etc/gitlab-rails

    - create new directory /opt/gitlab/etc/gitlab-rails[2024-03-06T19:59:21+00:00] INFO: directory[create /opt/gitlab/etc/gitlab-rails] owner changed to 998
[2024-03-06T19:59:21+00:00] INFO: directory[create /opt/gitlab/etc/gitlab-rails] mode changed to 700

    - change mode from '' to '0700'
    - change owner from '' to 'git'
  * directory[create /var/opt/gitlab/gitlab-rails/working] action create[2024-03-06T19:59:21+00:00] INFO: directory[create /var/opt/gitlab/gitlab-rails/working] created directory /var/opt/gitlab/gitlab-rails/working

    - create new directory /var/opt/gitlab/gitlab-rails/working[2024-03-06T19:59:21+00:00] INFO: directory[create /var/opt/gitlab/gitlab-rails/working] owner changed to 998
[2024-03-06T19:59:21+00:00] INFO: directory[create /var/opt/gitlab/gitlab-rails/working] mode changed to 700

    - change mode from '' to '0700'
    - change owner from '' to 'git'
  * directory[create /var/opt/gitlab/gitlab-rails/tmp] action create[2024-03-06T19:59:21+00:00] INFO: directory[create /var/opt/gitlab/gitlab-rails/tmp] created directory /var/opt/gitlab/gitlab-rails/tmp

    - create new directory /var/opt/gitlab/gitlab-rails/tmp[2024-03-06T19:59:21+00:00] INFO: directory[create /var/opt/gitlab/gitlab-rails/tmp] owner changed to 998
[2024-03-06T19:59:21+00:00] INFO: directory[create /var/opt/gitlab/gitlab-rails/tmp] mode changed to 700

    - change mode from '' to '0700'
    - change owner from '' to 'git'
  * directory[create /var/opt/gitlab/gitlab-rails/upgrade-status] action create[2024-03-06T19:59:21+00:00] INFO: directory[create /var/opt/gitlab/gitlab-rails/upgrade-status] created directory /var/opt/gitlab/gitlab-rails/upgrade-status

    - create new directory /var/opt/gitlab/gitlab-rails/upgrade-status[2024-03-06T19:59:21+00:00] INFO: directory[create /var/opt/gitlab/gitlab-rails/upgrade-status] owner changed to 998
[2024-03-06T19:59:21+00:00] INFO: directory[create /var/opt/gitlab/gitlab-rails/upgrade-status] mode changed to 700

    - change mode from '' to '0700'
    - change owner from '' to 'git'
  * directory[/var/log/gitlab/gitlab-rails] action create[2024-03-06T19:59:21+00:00] INFO: directory[/var/log/gitlab/gitlab-rails] created directory /var/log/gitlab/gitlab-rails

    - create new directory /var/log/gitlab/gitlab-rails[2024-03-06T19:59:21+00:00] INFO: directory[/var/log/gitlab/gitlab-rails] owner changed to 998
[2024-03-06T19:59:21+00:00] INFO: directory[/var/log/gitlab/gitlab-rails] mode changed to 700

    - change mode from '' to '0700'
    - change owner from '' to 'git'
  * storage_directory[/var/opt/gitlab/backups] action create
    * ruby_block[directory resource: /var/opt/gitlab/backups] action run[2024-03-06T19:59:21+00:00] INFO: ruby_block[directory resource: /var/opt/gitlab/backups] called

      - execute the ruby block directory resource: /var/opt/gitlab/backups
  
  * directory[/var/opt/gitlab/gitlab-rails] action create[2024-03-06T19:59:21+00:00] INFO: directory[/var/opt/gitlab/gitlab-rails] owner changed to 998

    - change owner from 'root' to 'git'
  * directory[/var/opt/gitlab/gitlab-ci] action create[2024-03-06T19:59:21+00:00] INFO: directory[/var/opt/gitlab/gitlab-ci] owner changed to 998

    - change owner from 'root' to 'git'
  * file[/var/opt/gitlab/gitlab-rails/etc/gitlab-registry.key] action create (skipped due to only_if)
  * template[/opt/gitlab/etc/gitlab-rails-rc] action create[2024-03-06T19:59:21+00:00] INFO: template[/opt/gitlab/etc/gitlab-rails-rc] created file /opt/gitlab/etc/gitlab-rails-rc

    - create new file /opt/gitlab/etc/gitlab-rails-rc[2024-03-06T19:59:21+00:00] INFO: template[/opt/gitlab/etc/gitlab-rails-rc] updated file contents /opt/gitlab/etc/gitlab-rails-rc

    - update content in file /opt/gitlab/etc/gitlab-rails-rc from none to 7b16c8
    --- /opt/gitlab/etc/gitlab-rails-rc 2024-03-06 19:59:21.936187438 +0000
    +++ /opt/gitlab/etc/.chef-gitlab-rails-rc20240306-34-nlf9m  2024-03-06 19:59:21.936187438 +0000
    @@ -1,5 +1,10 @@
    +gitlab_user='git'
    +gitlab_group='git'
    +registry_dir=''
    +registry_user='registry'
    +registry_group='registry'[2024-03-06T19:59:21+00:00] INFO: template[/opt/gitlab/etc/gitlab-rails-rc] owner changed to 0
[2024-03-06T19:59:21+00:00] INFO: template[/opt/gitlab/etc/gitlab-rails-rc] group changed to 0
[2024-03-06T19:59:21+00:00] INFO: template[/opt/gitlab/etc/gitlab-rails-rc] mode changed to 644

    - change mode from '' to '0644'
    - change owner from '' to 'root'
    - change group from '' to 'root'
  * file[/opt/gitlab/embedded/service/gitlab-rails/.secret] action delete (up to date)
  * file[/var/opt/gitlab/gitlab-rails/etc/secret] action delete (up to date)
  * templatesymlink[Create a database.yml and create a symlink to Rails root] action create
    * template[/var/opt/gitlab/gitlab-rails/etc/database.yml] action create[2024-03-06T19:59:21+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/database.yml] created file /var/opt/gitlab/gitlab-rails/etc/database.yml

      - create new file /var/opt/gitlab/gitlab-rails/etc/database.yml[2024-03-06T19:59:21+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/database.yml] updated file contents /var/opt/gitlab/gitlab-rails/etc/database.yml

      - update content in file /var/opt/gitlab/gitlab-rails/etc/database.yml from none to 9c495c
      - suppressed sensitive resource[2024-03-06T19:59:21+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/database.yml] owner changed to 0
[2024-03-06T19:59:21+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/database.yml] group changed to 998
[2024-03-06T19:59:21+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/database.yml] mode changed to 640

      - change mode from '' to '0640'
      - change owner from '' to 'root'
      - change group from '' to 'git'
    * link[Link /opt/gitlab/embedded/service/gitlab-rails/config/database.yml to /var/opt/gitlab/gitlab-rails/etc/database.yml] action create[2024-03-06T19:59:21+00:00] INFO: link[Link /opt/gitlab/embedded/service/gitlab-rails/config/database.yml to /var/opt/gitlab/gitlab-rails/etc/database.yml] created

      - create symlink at /opt/gitlab/embedded/service/gitlab-rails/config/database.yml to /var/opt/gitlab/gitlab-rails/etc/database.yml
  
  * templatesymlink[Create a secrets.yml and create a symlink to Rails root] action create
    * template[/var/opt/gitlab/gitlab-rails/etc/secrets.yml] action create[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/secrets.yml] created file /var/opt/gitlab/gitlab-rails/etc/secrets.yml

      - create new file /var/opt/gitlab/gitlab-rails/etc/secrets.yml[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/secrets.yml] updated file contents /var/opt/gitlab/gitlab-rails/etc/secrets.yml

      - update content in file /var/opt/gitlab/gitlab-rails/etc/secrets.yml from none to 13fca6
      - suppressed sensitive resource[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/secrets.yml] owner changed to 0
[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/secrets.yml] group changed to 0
[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/secrets.yml] mode changed to 644

      - change mode from '' to '0644'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * link[Link /opt/gitlab/embedded/service/gitlab-rails/config/secrets.yml to /var/opt/gitlab/gitlab-rails/etc/secrets.yml] action create[2024-03-06T19:59:22+00:00] INFO: link[Link /opt/gitlab/embedded/service/gitlab-rails/config/secrets.yml to /var/opt/gitlab/gitlab-rails/etc/secrets.yml] created

      - create symlink at /opt/gitlab/embedded/service/gitlab-rails/config/secrets.yml to /var/opt/gitlab/gitlab-rails/etc/secrets.yml
  
  * templatesymlink[Create a resque.yml and create a symlink to Rails root] action create
    * template[/var/opt/gitlab/gitlab-rails/etc/resque.yml] action create[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/resque.yml] created file /var/opt/gitlab/gitlab-rails/etc/resque.yml

      - create new file /var/opt/gitlab/gitlab-rails/etc/resque.yml[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/resque.yml] updated file contents /var/opt/gitlab/gitlab-rails/etc/resque.yml

      - update content in file /var/opt/gitlab/gitlab-rails/etc/resque.yml from none to ec4232
      - suppressed sensitive resource[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/resque.yml] owner changed to 0
[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/resque.yml] group changed to 0
[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/resque.yml] mode changed to 644

      - change mode from '' to '0644'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * link[Link /opt/gitlab/embedded/service/gitlab-rails/config/resque.yml to /var/opt/gitlab/gitlab-rails/etc/resque.yml] action create[2024-03-06T19:59:22+00:00] INFO: link[Link /opt/gitlab/embedded/service/gitlab-rails/config/resque.yml to /var/opt/gitlab/gitlab-rails/etc/resque.yml] created

      - create symlink at /opt/gitlab/embedded/service/gitlab-rails/config/resque.yml to /var/opt/gitlab/gitlab-rails/etc/resque.yml
  
  * templatesymlink[Create an override redis.yml and create a symlink to Rails root] action create
    * template[/var/opt/gitlab/gitlab-rails/etc/redis.yml] action create[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/redis.yml] created file /var/opt/gitlab/gitlab-rails/etc/redis.yml

      - create new file /var/opt/gitlab/gitlab-rails/etc/redis.yml[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/redis.yml] updated file contents /var/opt/gitlab/gitlab-rails/etc/redis.yml

      - update content in file /var/opt/gitlab/gitlab-rails/etc/redis.yml from none to e3b0c4
      - suppressed sensitive resource[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/redis.yml] owner changed to 0
[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/redis.yml] group changed to 0
[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/redis.yml] mode changed to 644

      - change mode from '' to '0644'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * link[Link /opt/gitlab/embedded/service/gitlab-rails/config/redis.yml to /var/opt/gitlab/gitlab-rails/etc/redis.yml] action create[2024-03-06T19:59:22+00:00] INFO: link[Link /opt/gitlab/embedded/service/gitlab-rails/config/redis.yml to /var/opt/gitlab/gitlab-rails/etc/redis.yml] created

      - create symlink at /opt/gitlab/embedded/service/gitlab-rails/config/redis.yml to /var/opt/gitlab/gitlab-rails/etc/redis.yml
  
  * templatesymlink[Create a cable.yml and create a symlink to Rails root] action create
    * template[/var/opt/gitlab/gitlab-rails/etc/cable.yml] action create[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/cable.yml] created file /var/opt/gitlab/gitlab-rails/etc/cable.yml

      - create new file /var/opt/gitlab/gitlab-rails/etc/cable.yml[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/cable.yml] updated file contents /var/opt/gitlab/gitlab-rails/etc/cable.yml

      - update content in file /var/opt/gitlab/gitlab-rails/etc/cable.yml from none to 551667
      - suppressed sensitive resource[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/cable.yml] owner changed to 0
[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/cable.yml] group changed to 0
[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/cable.yml] mode changed to 644

      - change mode from '' to '0644'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * link[Link /opt/gitlab/embedded/service/gitlab-rails/config/cable.yml to /var/opt/gitlab/gitlab-rails/etc/cable.yml] action create[2024-03-06T19:59:22+00:00] INFO: link[Link /opt/gitlab/embedded/service/gitlab-rails/config/cable.yml to /var/opt/gitlab/gitlab-rails/etc/cable.yml] created

      - create symlink at /opt/gitlab/embedded/service/gitlab-rails/config/cable.yml to /var/opt/gitlab/gitlab-rails/etc/cable.yml
  
  * templatesymlink[Create a redis.cache.yml and create a symlink to Rails root] action delete
    * file[/var/opt/gitlab/gitlab-rails/etc/redis.cache.yml] action delete (up to date)
    * link[/opt/gitlab/embedded/service/gitlab-rails/config/redis.cache.yml] action delete (up to date)
     (up to date)
  * templatesymlink[Create a redis.queues.yml and create a symlink to Rails root] action delete
    * file[/var/opt/gitlab/gitlab-rails/etc/redis.queues.yml] action delete (up to date)
    * link[/opt/gitlab/embedded/service/gitlab-rails/config/redis.queues.yml] action delete (up to date)
     (up to date)
  * templatesymlink[Create a redis.shared_state.yml and create a symlink to Rails root] action delete
    * file[/var/opt/gitlab/gitlab-rails/etc/redis.shared_state.yml] action delete (up to date)
    * link[/opt/gitlab/embedded/service/gitlab-rails/config/redis.shared_state.yml] action delete (up to date)
     (up to date)
  * templatesymlink[Create a redis.trace_chunks.yml and create a symlink to Rails root] action delete
    * file[/var/opt/gitlab/gitlab-rails/etc/redis.trace_chunks.yml] action delete (up to date)
    * link[/opt/gitlab/embedded/service/gitlab-rails/config/redis.trace_chunks.yml] action delete (up to date)
     (up to date)
  * templatesymlink[Create a redis.rate_limiting.yml and create a symlink to Rails root] action delete
    * file[/var/opt/gitlab/gitlab-rails/etc/redis.rate_limiting.yml] action delete (up to date)
    * link[/opt/gitlab/embedded/service/gitlab-rails/config/redis.rate_limiting.yml] action delete (up to date)
     (up to date)
  * templatesymlink[Create a redis.sessions.yml and create a symlink to Rails root] action delete
    * file[/var/opt/gitlab/gitlab-rails/etc/redis.sessions.yml] action delete (up to date)
    * link[/opt/gitlab/embedded/service/gitlab-rails/config/redis.sessions.yml] action delete (up to date)
     (up to date)
  * templatesymlink[Create a redis.repository_cache.yml and create a symlink to Rails root] action delete
    * file[/var/opt/gitlab/gitlab-rails/etc/redis.repository_cache.yml] action delete (up to date)
    * link[/opt/gitlab/embedded/service/gitlab-rails/config/redis.repository_cache.yml] action delete (up to date)
     (up to date)
  * templatesymlink[Create a redis.cluster_rate_limiting.yml and create a symlink to Rails root] action delete
    * file[/var/opt/gitlab/gitlab-rails/etc/redis.cluster_rate_limiting.yml] action delete (up to date)
    * link[/opt/gitlab/embedded/service/gitlab-rails/config/redis.cluster_rate_limiting.yml] action delete (up to date)
     (up to date)
  * templatesymlink[Create a smtp_settings.rb and create a symlink to Rails root] action delete
    * file[/var/opt/gitlab/gitlab-rails/etc/smtp_settings.rb] action delete (up to date)
    * link[/opt/gitlab/embedded/service/gitlab-rails/config/initializers/smtp_settings.rb] action delete (up to date)
     (up to date)
  * templatesymlink[Create a gitlab.yml and create a symlink to Rails root] action create
    * template[/var/opt/gitlab/gitlab-rails/etc/gitlab.yml] action create[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab.yml] created file /var/opt/gitlab/gitlab-rails/etc/gitlab.yml

      - create new file /var/opt/gitlab/gitlab-rails/etc/gitlab.yml[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab.yml] updated file contents /var/opt/gitlab/gitlab-rails/etc/gitlab.yml

      - update content in file /var/opt/gitlab/gitlab-rails/etc/gitlab.yml from none to 9edaac
      - suppressed sensitive resource[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab.yml] owner changed to 0
[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab.yml] group changed to 998
[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab.yml] mode changed to 640

      - change mode from '' to '0640'
      - change owner from '' to 'root'
      - change group from '' to 'git'
    * link[Link /opt/gitlab/embedded/service/gitlab-rails/config/gitlab.yml to /var/opt/gitlab/gitlab-rails/etc/gitlab.yml] action create[2024-03-06T19:59:22+00:00] INFO: link[Link /opt/gitlab/embedded/service/gitlab-rails/config/gitlab.yml to /var/opt/gitlab/gitlab-rails/etc/gitlab.yml] created

      - create symlink at /opt/gitlab/embedded/service/gitlab-rails/config/gitlab.yml to /var/opt/gitlab/gitlab-rails/etc/gitlab.yml
  
  * templatesymlink[Create a gitlab_workhorse_secret and create a symlink to Rails root] action create
    * template[/var/opt/gitlab/gitlab-rails/etc/gitlab_workhorse_secret] action create[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab_workhorse_secret] created file /var/opt/gitlab/gitlab-rails/etc/gitlab_workhorse_secret

      - create new file /var/opt/gitlab/gitlab-rails/etc/gitlab_workhorse_secret[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab_workhorse_secret] updated file contents /var/opt/gitlab/gitlab-rails/etc/gitlab_workhorse_secret

      - update content in file /var/opt/gitlab/gitlab-rails/etc/gitlab_workhorse_secret from none to 7e674e
      - suppressed sensitive resource[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab_workhorse_secret] owner changed to 0
[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab_workhorse_secret] group changed to 0
[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab_workhorse_secret] mode changed to 644

      - change mode from '' to '0644'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * link[Link /opt/gitlab/embedded/service/gitlab-rails/.gitlab_workhorse_secret to /var/opt/gitlab/gitlab-rails/etc/gitlab_workhorse_secret] action create[2024-03-06T19:59:22+00:00] INFO: link[Link /opt/gitlab/embedded/service/gitlab-rails/.gitlab_workhorse_secret to /var/opt/gitlab/gitlab-rails/etc/gitlab_workhorse_secret] created

      - create symlink at /opt/gitlab/embedded/service/gitlab-rails/.gitlab_workhorse_secret to /var/opt/gitlab/gitlab-rails/etc/gitlab_workhorse_secret
  
  * templatesymlink[Create a gitlab_shell_secret and create a symlink to Rails root] action create
    * template[/var/opt/gitlab/gitlab-rails/etc/gitlab_shell_secret] action create[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab_shell_secret] created file /var/opt/gitlab/gitlab-rails/etc/gitlab_shell_secret

      - create new file /var/opt/gitlab/gitlab-rails/etc/gitlab_shell_secret[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab_shell_secret] updated file contents /var/opt/gitlab/gitlab-rails/etc/gitlab_shell_secret

      - update content in file /var/opt/gitlab/gitlab-rails/etc/gitlab_shell_secret from none to a54e2c
      - suppressed sensitive resource[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab_shell_secret] owner changed to 0
[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab_shell_secret] group changed to 0
[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab_shell_secret] mode changed to 644

      - change mode from '' to '0644'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * link[Link /opt/gitlab/embedded/service/gitlab-rails/.gitlab_shell_secret to /var/opt/gitlab/gitlab-rails/etc/gitlab_shell_secret] action create[2024-03-06T19:59:22+00:00] INFO: link[Link /opt/gitlab/embedded/service/gitlab-rails/.gitlab_shell_secret to /var/opt/gitlab/gitlab-rails/etc/gitlab_shell_secret] created

      - create symlink at /opt/gitlab/embedded/service/gitlab-rails/.gitlab_shell_secret to /var/opt/gitlab/gitlab-rails/etc/gitlab_shell_secret
  
  * templatesymlink[Create a gitlab_incoming_email_secret and create a symlink to Rails root] action create (skipped due to only_if)
  * templatesymlink[Create a gitlab_service_desk_email_secret and create a symlink to Rails root] action create (skipped due to only_if)
  * templatesymlink[Create a gitlab_pages_secret and create a symlink to Rails root] action create[2024-03-06T19:59:22+00:00] WARN: only_if block for templatesymlink[Create a gitlab_pages_secret and create a symlink to Rails root] returned a string, did you mean to run a command?

    * template[/var/opt/gitlab/gitlab-rails/etc/gitlab_pages_secret] action create[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab_pages_secret] created file /var/opt/gitlab/gitlab-rails/etc/gitlab_pages_secret

      - create new file /var/opt/gitlab/gitlab-rails/etc/gitlab_pages_secret[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab_pages_secret] updated file contents /var/opt/gitlab/gitlab-rails/etc/gitlab_pages_secret

      - update content in file /var/opt/gitlab/gitlab-rails/etc/gitlab_pages_secret from none to 325ee7
      - suppressed sensitive resource[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab_pages_secret] owner changed to 0
[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab_pages_secret] group changed to 0
[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab_pages_secret] mode changed to 644

      - change mode from '' to '0644'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * link[Link /opt/gitlab/embedded/service/gitlab-rails/.gitlab_pages_secret to /var/opt/gitlab/gitlab-rails/etc/gitlab_pages_secret] action create[2024-03-06T19:59:22+00:00] INFO: link[Link /opt/gitlab/embedded/service/gitlab-rails/.gitlab_pages_secret to /var/opt/gitlab/gitlab-rails/etc/gitlab_pages_secret] created

      - create symlink at /opt/gitlab/embedded/service/gitlab-rails/.gitlab_pages_secret to /var/opt/gitlab/gitlab-rails/etc/gitlab_pages_secret
  
  * templatesymlink[Create a gitlab_kas_secret and create a symlink to Rails root] action create[2024-03-06T19:59:22+00:00] WARN: only_if block for templatesymlink[Create a gitlab_kas_secret and create a symlink to Rails root] returned a string, did you mean to run a command?

    * template[/var/opt/gitlab/gitlab-rails/etc/gitlab_kas_secret] action create[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab_kas_secret] created file /var/opt/gitlab/gitlab-rails/etc/gitlab_kas_secret

      - create new file /var/opt/gitlab/gitlab-rails/etc/gitlab_kas_secret[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab_kas_secret] updated file contents /var/opt/gitlab/gitlab-rails/etc/gitlab_kas_secret

      - update content in file /var/opt/gitlab/gitlab-rails/etc/gitlab_kas_secret from none to 689033
      - suppressed sensitive resource[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab_kas_secret] owner changed to 0
[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab_kas_secret] group changed to 0
[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/gitlab_kas_secret] mode changed to 644

      - change mode from '' to '0644'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * link[Link /opt/gitlab/embedded/service/gitlab-rails/.gitlab_kas_secret to /var/opt/gitlab/gitlab-rails/etc/gitlab_kas_secret] action create[2024-03-06T19:59:22+00:00] INFO: link[Link /opt/gitlab/embedded/service/gitlab-rails/.gitlab_kas_secret to /var/opt/gitlab/gitlab-rails/etc/gitlab_kas_secret] created

      - create symlink at /opt/gitlab/embedded/service/gitlab-rails/.gitlab_kas_secret to /var/opt/gitlab/gitlab-rails/etc/gitlab_kas_secret
  
  * link[/opt/gitlab/embedded/service/gitlab-rails/config/initializers/relative_url.rb] action delete (up to date)
  * file[/var/opt/gitlab/gitlab-rails/etc/relative_url.rb] action delete (up to date)
  * env_dir[/opt/gitlab/etc/gitlab-rails/env] action create
    * directory[/opt/gitlab/etc/gitlab-rails/env] action create[2024-03-06T19:59:22+00:00] INFO: directory[/opt/gitlab/etc/gitlab-rails/env] created directory /opt/gitlab/etc/gitlab-rails/env

      - create new directory /opt/gitlab/etc/gitlab-rails/env
    * file[/opt/gitlab/etc/gitlab-rails/env/HOME] action create[2024-03-06T19:59:22+00:00] INFO: file[/opt/gitlab/etc/gitlab-rails/env/HOME] created file /opt/gitlab/etc/gitlab-rails/env/HOME

      - create new file /opt/gitlab/etc/gitlab-rails/env/HOME[2024-03-06T19:59:22+00:00] INFO: file[/opt/gitlab/etc/gitlab-rails/env/HOME] updated file contents /opt/gitlab/etc/gitlab-rails/env/HOME

      - update content in file /opt/gitlab/etc/gitlab-rails/env/HOME from none to 205bb9
      - suppressed sensitive resource
    * file[/opt/gitlab/etc/gitlab-rails/env/RAILS_ENV] action create[2024-03-06T19:59:22+00:00] INFO: file[/opt/gitlab/etc/gitlab-rails/env/RAILS_ENV] created file /opt/gitlab/etc/gitlab-rails/env/RAILS_ENV

      - create new file /opt/gitlab/etc/gitlab-rails/env/RAILS_ENV[2024-03-06T19:59:22+00:00] INFO: file[/opt/gitlab/etc/gitlab-rails/env/RAILS_ENV] updated file contents /opt/gitlab/etc/gitlab-rails/env/RAILS_ENV

      - update content in file /opt/gitlab/etc/gitlab-rails/env/RAILS_ENV from none to ab8e18
      - suppressed sensitive resource
    * file[/opt/gitlab/etc/gitlab-rails/env/BUNDLE_GEMFILE] action create[2024-03-06T19:59:22+00:00] INFO: file[/opt/gitlab/etc/gitlab-rails/env/BUNDLE_GEMFILE] created file /opt/gitlab/etc/gitlab-rails/env/BUNDLE_GEMFILE

      - create new file /opt/gitlab/etc/gitlab-rails/env/BUNDLE_GEMFILE[2024-03-06T19:59:22+00:00] INFO: file[/opt/gitlab/etc/gitlab-rails/env/BUNDLE_GEMFILE] updated file contents /opt/gitlab/etc/gitlab-rails/env/BUNDLE_GEMFILE

      - update content in file /opt/gitlab/etc/gitlab-rails/env/BUNDLE_GEMFILE from none to 28d586
      - suppressed sensitive resource
    * file[/opt/gitlab/etc/gitlab-rails/env/PUMA_WORKER_MAX_MEMORY] action create[2024-03-06T19:59:22+00:00] INFO: file[/opt/gitlab/etc/gitlab-rails/env/PUMA_WORKER_MAX_MEMORY] created file /opt/gitlab/etc/gitlab-rails/env/PUMA_WORKER_MAX_MEMORY

      - create new file /opt/gitlab/etc/gitlab-rails/env/PUMA_WORKER_MAX_MEMORY[2024-03-06T19:59:22+00:00] INFO: file[/opt/gitlab/etc/gitlab-rails/env/PUMA_WORKER_MAX_MEMORY] updated file contents /opt/gitlab/etc/gitlab-rails/env/PUMA_WORKER_MAX_MEMORY

      - update content in file /opt/gitlab/etc/gitlab-rails/env/PUMA_WORKER_MAX_MEMORY from none to e3b0c4
      - suppressed sensitive resource
    * file[/opt/gitlab/etc/gitlab-rails/env/SIDEKIQ_MEMORY_KILLER_MAX_RSS] action create[2024-03-06T19:59:22+00:00] INFO: file[/opt/gitlab/etc/gitlab-rails/env/SIDEKIQ_MEMORY_KILLER_MAX_RSS] created file /opt/gitlab/etc/gitlab-rails/env/SIDEKIQ_MEMORY_KILLER_MAX_RSS

      - create new file /opt/gitlab/etc/gitlab-rails/env/SIDEKIQ_MEMORY_KILLER_MAX_RSS[2024-03-06T19:59:22+00:00] INFO: file[/opt/gitlab/etc/gitlab-rails/env/SIDEKIQ_MEMORY_KILLER_MAX_RSS] updated file contents /opt/gitlab/etc/gitlab-rails/env/SIDEKIQ_MEMORY_KILLER_MAX_RSS

      - update content in file /opt/gitlab/etc/gitlab-rails/env/SIDEKIQ_MEMORY_KILLER_MAX_RSS from none to dd80d7
      - suppressed sensitive resource
    * file[/opt/gitlab/etc/gitlab-rails/env/PATH] action create[2024-03-06T19:59:22+00:00] INFO: file[/opt/gitlab/etc/gitlab-rails/env/PATH] created file /opt/gitlab/etc/gitlab-rails/env/PATH

      - create new file /opt/gitlab/etc/gitlab-rails/env/PATH[2024-03-06T19:59:22+00:00] INFO: file[/opt/gitlab/etc/gitlab-rails/env/PATH] updated file contents /opt/gitlab/etc/gitlab-rails/env/PATH

      - update content in file /opt/gitlab/etc/gitlab-rails/env/PATH from none to d5dc07
      - suppressed sensitive resource
    * file[/opt/gitlab/etc/gitlab-rails/env/ICU_DATA] action create[2024-03-06T19:59:22+00:00] INFO: file[/opt/gitlab/etc/gitlab-rails/env/ICU_DATA] created file /opt/gitlab/etc/gitlab-rails/env/ICU_DATA

      - create new file /opt/gitlab/etc/gitlab-rails/env/ICU_DATA[2024-03-06T19:59:22+00:00] INFO: file[/opt/gitlab/etc/gitlab-rails/env/ICU_DATA] updated file contents /opt/gitlab/etc/gitlab-rails/env/ICU_DATA

      - update content in file /opt/gitlab/etc/gitlab-rails/env/ICU_DATA from none to a04260
      - suppressed sensitive resource
    * file[/opt/gitlab/etc/gitlab-rails/env/PYTHONPATH] action create[2024-03-06T19:59:22+00:00] INFO: file[/opt/gitlab/etc/gitlab-rails/env/PYTHONPATH] created file /opt/gitlab/etc/gitlab-rails/env/PYTHONPATH

      - create new file /opt/gitlab/etc/gitlab-rails/env/PYTHONPATH[2024-03-06T19:59:22+00:00] INFO: file[/opt/gitlab/etc/gitlab-rails/env/PYTHONPATH] updated file contents /opt/gitlab/etc/gitlab-rails/env/PYTHONPATH

      - update content in file /opt/gitlab/etc/gitlab-rails/env/PYTHONPATH from none to 98c9f4
      - suppressed sensitive resource
    * file[/opt/gitlab/etc/gitlab-rails/env/EXECJS_RUNTIME] action create[2024-03-06T19:59:22+00:00] INFO: file[/opt/gitlab/etc/gitlab-rails/env/EXECJS_RUNTIME] created file /opt/gitlab/etc/gitlab-rails/env/EXECJS_RUNTIME

      - create new file /opt/gitlab/etc/gitlab-rails/env/EXECJS_RUNTIME[2024-03-06T19:59:22+00:00] INFO: file[/opt/gitlab/etc/gitlab-rails/env/EXECJS_RUNTIME] updated file contents /opt/gitlab/etc/gitlab-rails/env/EXECJS_RUNTIME

      - update content in file /opt/gitlab/etc/gitlab-rails/env/EXECJS_RUNTIME from none to 75081b
      - suppressed sensitive resource
    * file[/opt/gitlab/etc/gitlab-rails/env/TZ] action create[2024-03-06T19:59:22+00:00] INFO: file[/opt/gitlab/etc/gitlab-rails/env/TZ] created file /opt/gitlab/etc/gitlab-rails/env/TZ

      - create new file /opt/gitlab/etc/gitlab-rails/env/TZ[2024-03-06T19:59:22+00:00] INFO: file[/opt/gitlab/etc/gitlab-rails/env/TZ] updated file contents /opt/gitlab/etc/gitlab-rails/env/TZ

      - update content in file /opt/gitlab/etc/gitlab-rails/env/TZ from none to 983a95
      - suppressed sensitive resource
    * file[/opt/gitlab/etc/gitlab-rails/env/SSL_CERT_DIR] action create[2024-03-06T19:59:22+00:00] INFO: file[/opt/gitlab/etc/gitlab-rails/env/SSL_CERT_DIR] created file /opt/gitlab/etc/gitlab-rails/env/SSL_CERT_DIR

      - create new file /opt/gitlab/etc/gitlab-rails/env/SSL_CERT_DIR[2024-03-06T19:59:22+00:00] INFO: file[/opt/gitlab/etc/gitlab-rails/env/SSL_CERT_DIR] updated file contents /opt/gitlab/etc/gitlab-rails/env/SSL_CERT_DIR

      - update content in file /opt/gitlab/etc/gitlab-rails/env/SSL_CERT_DIR from none to 4f45cf
      - suppressed sensitive resource
    * file[/opt/gitlab/etc/gitlab-rails/env/SSL_CERT_FILE] action create[2024-03-06T19:59:22+00:00] INFO: file[/opt/gitlab/etc/gitlab-rails/env/SSL_CERT_FILE] created file /opt/gitlab/etc/gitlab-rails/env/SSL_CERT_FILE

      - create new file /opt/gitlab/etc/gitlab-rails/env/SSL_CERT_FILE[2024-03-06T19:59:22+00:00] INFO: file[/opt/gitlab/etc/gitlab-rails/env/SSL_CERT_FILE] updated file contents /opt/gitlab/etc/gitlab-rails/env/SSL_CERT_FILE

      - update content in file /opt/gitlab/etc/gitlab-rails/env/SSL_CERT_FILE from none to f7ce84
      - suppressed sensitive resource
  
  * link[/opt/gitlab/embedded/service/gitlab-rails/tmp] action create[2024-03-06T19:59:22+00:00] INFO: link[/opt/gitlab/embedded/service/gitlab-rails/tmp] created

    - create symlink at /opt/gitlab/embedded/service/gitlab-rails/tmp to /var/opt/gitlab/gitlab-rails/tmp
  * link[/opt/gitlab/embedded/service/gitlab-rails/public/uploads] action create[2024-03-06T19:59:22+00:00] INFO: link[/opt/gitlab/embedded/service/gitlab-rails/public/uploads] created

    - create symlink at /opt/gitlab/embedded/service/gitlab-rails/public/uploads to /var/opt/gitlab/gitlab-rails/uploads
  * link[/opt/gitlab/embedded/service/gitlab-rails/log] action create[2024-03-06T19:59:22+00:00] INFO: link[/opt/gitlab/embedded/service/gitlab-rails/log] created

    - create symlink at /opt/gitlab/embedded/service/gitlab-rails/log to /var/log/gitlab/gitlab-rails
  * link[/var/log/gitlab/gitlab-rails/sidekiq.log] action delete (skipped due to only_if)
  * file[/opt/gitlab/embedded/service/gitlab-rails/db/structure.sql] action create[2024-03-06T19:59:22+00:00] INFO: file[/opt/gitlab/embedded/service/gitlab-rails/db/structure.sql] owner changed to 998

    - change owner from 'root' to 'git'
  * remote_file[/var/opt/gitlab/gitlab-rails/VERSION] action create[2024-03-06T19:59:22+00:00] INFO: remote_file[/var/opt/gitlab/gitlab-rails/VERSION] created file /var/opt/gitlab/gitlab-rails/VERSION

    - create new file /var/opt/gitlab/gitlab-rails/VERSION[2024-03-06T19:59:22+00:00] INFO: remote_file[/var/opt/gitlab/gitlab-rails/VERSION] updated file contents /var/opt/gitlab/gitlab-rails/VERSION

    - update content in file /var/opt/gitlab/gitlab-rails/VERSION from none to d4f432
    --- /var/opt/gitlab/gitlab-rails/VERSION    2024-03-06 19:59:22.439935437 +0000
    +++ /var/opt/gitlab/gitlab-rails/.chef-VERSION20240306-34-4gseqp    2024-03-06 19:59:22.439935437 +0000
    @@ -1 +1,2 @@
    +16.0.0
  * remote_file[/var/opt/gitlab/gitlab-rails/REVISION] action create[2024-03-06T19:59:22+00:00] INFO: remote_file[/var/opt/gitlab/gitlab-rails/REVISION] created file /var/opt/gitlab/gitlab-rails/REVISION

    - create new file /var/opt/gitlab/gitlab-rails/REVISION[2024-03-06T19:59:22+00:00] INFO: remote_file[/var/opt/gitlab/gitlab-rails/REVISION] updated file contents /var/opt/gitlab/gitlab-rails/REVISION

    - update content in file /var/opt/gitlab/gitlab-rails/REVISION from none to 62fdab
    --- /var/opt/gitlab/gitlab-rails/REVISION   2024-03-06 19:59:22.447931437 +0000
    +++ /var/opt/gitlab/gitlab-rails/.chef-REVISION20240306-34-yhh1be   2024-03-06 19:59:22.447931437 +0000
    @@ -1 +1,2 @@
    +917d3f7ad12
  * version_file[Create version file for Rails] action create
    * file[/var/opt/gitlab/gitlab-rails/RUBY_VERSION] action create[2024-03-06T19:59:22+00:00] INFO: file[/var/opt/gitlab/gitlab-rails/RUBY_VERSION] created file /var/opt/gitlab/gitlab-rails/RUBY_VERSION

      - create new file /var/opt/gitlab/gitlab-rails/RUBY_VERSION[2024-03-06T19:59:22+00:00] INFO: file[/var/opt/gitlab/gitlab-rails/RUBY_VERSION] updated file contents /var/opt/gitlab/gitlab-rails/RUBY_VERSION

      - update content in file /var/opt/gitlab/gitlab-rails/RUBY_VERSION from none to b4a021
      --- /var/opt/gitlab/gitlab-rails/RUBY_VERSION     2024-03-06 19:59:22.495907437 +0000
      +++ /var/opt/gitlab/gitlab-rails/.chef-RUBY_VERSION20240306-34-cy5y39     2024-03-06 19:59:22.495907437 +0000
      @@ -1 +1,2 @@
      +ruby 3.0.6p216 (2023-03-30 revision 23a532679b) [x86_64-linux]
  
  * execute[clear the gitlab-rails cache] action nothing (skipped due to action :nothing)
  * file[/var/opt/gitlab/gitlab-rails/config.ru] action delete (up to date)
Recipe: gitlab::selinux
  * bash[Set proper security context on ssh files for selinux] action nothing (skipped due to action :nothing)
Recipe: gitlab::add_trusted_certs
  * directory[/etc/gitlab/trusted-certs] action create[2024-03-06T19:59:22+00:00] INFO: directory[/etc/gitlab/trusted-certs] created directory /etc/gitlab/trusted-certs

    - create new directory /etc/gitlab/trusted-certs[2024-03-06T19:59:22+00:00] INFO: directory[/etc/gitlab/trusted-certs] mode changed to 755

    - change mode from '' to '0755'
  * directory[/opt/gitlab/embedded/ssl/certs] action create (up to date)
  * file[/opt/gitlab/embedded/ssl/certs/README] action create[2024-03-06T19:59:22+00:00] INFO: file[/opt/gitlab/embedded/ssl/certs/README] created file /opt/gitlab/embedded/ssl/certs/README

    - create new file /opt/gitlab/embedded/ssl/certs/README[2024-03-06T19:59:22+00:00] INFO: file[/opt/gitlab/embedded/ssl/certs/README] updated file contents /opt/gitlab/embedded/ssl/certs/README

    - update content in file /opt/gitlab/embedded/ssl/certs/README from none to 623059
    --- /opt/gitlab/embedded/ssl/certs/README   2024-03-06 19:59:22.519895436 +0000
    +++ /opt/gitlab/embedded/ssl/certs/.chef-README20240306-34-iden52   2024-03-06 19:59:22.519895436 +0000
    @@ -1,3 +1,6 @@
    +This directory is managed by omnibus-gitlab.
    + Any file placed in this directory will be ignored
    +. Place certificates in /etc/gitlab/trusted-certs.[2024-03-06T19:59:22+00:00] INFO: file[/opt/gitlab/embedded/ssl/certs/README] mode changed to 644

    - change mode from '' to '0644'
  * ruby_block[Move existing certs and link to /opt/gitlab/embedded/ssl/certs] action run

  * Moving existing certificates found in /opt/gitlab/embedded/ssl/certs

  * Symlinking existing certificates found in /etc/gitlab/trusted-certs
[2024-03-06T19:59:22+00:00] INFO: ruby_block[Move existing certs and link to /opt/gitlab/embedded/ssl/certs] called

    - execute the ruby block Move existing certs and link to /opt/gitlab/embedded/ssl/certs
Recipe: gitlab::default
  * service[create a temporary puma service] action nothing (skipped due to action :nothing)
  * service[create a temporary sidekiq service] action nothing (skipped due to action :nothing)
  * service[create a temporary mailroom service] action nothing (skipped due to action :nothing)
Recipe: gitlab::gitlab-shell
  * storage_directory[/var/opt/gitlab/.ssh] action create
    * ruby_block[directory resource: /var/opt/gitlab/.ssh] action run[2024-03-06T19:59:22+00:00] INFO: ruby_block[directory resource: /var/opt/gitlab/.ssh] called

      - execute the ruby block directory resource: /var/opt/gitlab/.ssh
  
  * directory[/var/opt/gitlab/gitlab-shell] action create[2024-03-06T19:59:22+00:00] INFO: directory[/var/opt/gitlab/gitlab-shell] created directory /var/opt/gitlab/gitlab-shell

    - create new directory /var/opt/gitlab/gitlab-shell[2024-03-06T19:59:22+00:00] INFO: directory[/var/opt/gitlab/gitlab-shell] owner changed to 998
[2024-03-06T19:59:22+00:00] INFO: directory[/var/opt/gitlab/gitlab-shell] mode changed to 700

    - change mode from '' to '0700'
    - change owner from '' to 'git'
  * directory[/var/log/gitlab/gitlab-shell] action create[2024-03-06T19:59:22+00:00] INFO: directory[/var/log/gitlab/gitlab-shell] created directory /var/log/gitlab/gitlab-shell

    - create new directory /var/log/gitlab/gitlab-shell[2024-03-06T19:59:22+00:00] INFO: directory[/var/log/gitlab/gitlab-shell] owner changed to 998
[2024-03-06T19:59:22+00:00] INFO: directory[/var/log/gitlab/gitlab-shell] mode changed to 700

    - change mode from '' to '0700'
    - change owner from '' to 'git'
  * bash[generate gitlab-sshd host keys] action run (skipped due to only_if)
  * templatesymlink[Create a config.yml and create a symlink to Rails root] action create
    * template[/var/opt/gitlab/gitlab-shell/config.yml] action create[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-shell/config.yml] created file /var/opt/gitlab/gitlab-shell/config.yml

      - create new file /var/opt/gitlab/gitlab-shell/config.yml[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-shell/config.yml] updated file contents /var/opt/gitlab/gitlab-shell/config.yml

      - update content in file /var/opt/gitlab/gitlab-shell/config.yml from none to a5b7b3
      - suppressed sensitive resource[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-shell/config.yml] owner changed to 0
[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-shell/config.yml] group changed to 998
[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/gitlab-shell/config.yml] mode changed to 640

      - change mode from '' to '0640'
      - change owner from '' to 'root'
      - change group from '' to 'git'
    * link[Link /opt/gitlab/embedded/service/gitlab-shell/config.yml to /var/opt/gitlab/gitlab-shell/config.yml] action create[2024-03-06T19:59:22+00:00] INFO: link[Link /opt/gitlab/embedded/service/gitlab-shell/config.yml to /var/opt/gitlab/gitlab-shell/config.yml] created

      - create symlink at /opt/gitlab/embedded/service/gitlab-shell/config.yml to /var/opt/gitlab/gitlab-shell/config.yml
  
  * link[/opt/gitlab/embedded/service/gitlab-shell/.gitlab_shell_secret] action create[2024-03-06T19:59:22+00:00] INFO: link[/opt/gitlab/embedded/service/gitlab-shell/.gitlab_shell_secret] created

    - create symlink at /opt/gitlab/embedded/service/gitlab-shell/.gitlab_shell_secret to /opt/gitlab/embedded/service/gitlab-rails/.gitlab_shell_secret
  * file[/var/opt/gitlab/.ssh/authorized_keys] action create_if_missing[2024-03-06T19:59:22+00:00] INFO: file[/var/opt/gitlab/.ssh/authorized_keys] created file /var/opt/gitlab/.ssh/authorized_keys

    - create new file /var/opt/gitlab/.ssh/authorized_keys[2024-03-06T19:59:22+00:00] INFO: file[/var/opt/gitlab/.ssh/authorized_keys] owner changed to 998
[2024-03-06T19:59:22+00:00] INFO: file[/var/opt/gitlab/.ssh/authorized_keys] group changed to 998
[2024-03-06T19:59:22+00:00] INFO: file[/var/opt/gitlab/.ssh/authorized_keys] mode changed to 600

    - change mode from '' to '0600'
    - change owner from '' to 'git'
    - change group from '' to 'git'
  * env_dir[/opt/gitlab/etc/gitlab-sshd/env] action nothing (skipped due to action :nothing)
  * service[gitlab-sshd] action nothing (skipped due to action :nothing)
  * runit_service[gitlab-sshd] action disable
    * ruby_block[disable gitlab-sshd] action run (skipped due to only_if)
     (up to date)
Recipe: package::sysctl
  * execute[reload all sysctl conf] action nothing (skipped due to action :nothing)
Recipe: logrotate::folders_and_configs
  * directory[/var/opt/gitlab/logrotate] action create[2024-03-06T19:59:22+00:00] INFO: directory[/var/opt/gitlab/logrotate] created directory /var/opt/gitlab/logrotate

    - create new directory /var/opt/gitlab/logrotate[2024-03-06T19:59:22+00:00] INFO: directory[/var/opt/gitlab/logrotate] mode changed to 700

    - change mode from '' to '0700'
  * directory[/var/opt/gitlab/logrotate/logrotate.d] action create[2024-03-06T19:59:22+00:00] INFO: directory[/var/opt/gitlab/logrotate/logrotate.d] created directory /var/opt/gitlab/logrotate/logrotate.d

    - create new directory /var/opt/gitlab/logrotate/logrotate.d[2024-03-06T19:59:22+00:00] INFO: directory[/var/opt/gitlab/logrotate/logrotate.d] mode changed to 700

    - change mode from '' to '0700'
  * directory[/var/log/gitlab/logrotate] action create[2024-03-06T19:59:22+00:00] INFO: directory[/var/log/gitlab/logrotate] created directory /var/log/gitlab/logrotate

    - create new directory /var/log/gitlab/logrotate[2024-03-06T19:59:22+00:00] INFO: directory[/var/log/gitlab/logrotate] owner changed to 0
[2024-03-06T19:59:22+00:00] INFO: directory[/var/log/gitlab/logrotate] mode changed to 700

    - change mode from '' to '0700'
    - change owner from '' to 'root'
  * template[/var/opt/gitlab/logrotate/logrotate.conf] action create[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/logrotate/logrotate.conf] created file /var/opt/gitlab/logrotate/logrotate.conf

    - create new file /var/opt/gitlab/logrotate/logrotate.conf[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/logrotate/logrotate.conf] updated file contents /var/opt/gitlab/logrotate/logrotate.conf

    - update content in file /var/opt/gitlab/logrotate/logrotate.conf from none to c1c320
    --- /var/opt/gitlab/logrotate/logrotate.conf        2024-03-06 19:59:22.799755436 +0000
    +++ /var/opt/gitlab/logrotate/.chef-logrotate20240306-34-vwv6c6.conf        2024-03-06 19:59:22.799755436 +0000
    @@ -1,12 +1,24 @@
    +# Generated by 'gitlab-ctl reconfigure'.
    +# Modifications will be overwritten!
    +
    +include /var/opt/gitlab/logrotate/logrotate.d/nginx
    +include /var/opt/gitlab/logrotate/logrotate.d/puma
    +include /var/opt/gitlab/logrotate/logrotate.d/gitlab-rails
    +include /var/opt/gitlab/logrotate/logrotate.d/gitlab-shell
    +include /var/opt/gitlab/logrotate/logrotate.d/gitlab-workhorse
    +include /var/opt/gitlab/logrotate/logrotate.d/gitlab-pages
    +include /var/opt/gitlab/logrotate/logrotate.d/gitlab-kas
    +include /var/opt/gitlab/logrotate/logrotate.d/gitaly
    +include /var/opt/gitlab/logrotate/logrotate.d/mailroom[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/logrotate/logrotate.conf] mode changed to 644

    - change mode from '' to '0644'
  * template[/var/opt/gitlab/logrotate/logrotate.d/nginx] action create[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/logrotate/logrotate.d/nginx] created file /var/opt/gitlab/logrotate/logrotate.d/nginx

    - create new file /var/opt/gitlab/logrotate/logrotate.d/nginx[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/logrotate/logrotate.d/nginx] updated file contents /var/opt/gitlab/logrotate/logrotate.d/nginx

    - update content in file /var/opt/gitlab/logrotate/logrotate.d/nginx from none to e17e19
    --- /var/opt/gitlab/logrotate/logrotate.d/nginx     2024-03-06 19:59:22.819745436 +0000
    +++ /var/opt/gitlab/logrotate/logrotate.d/.chef-nginx20240306-34-2yvyu9     2024-03-06 19:59:22.815747437 +0000
    @@ -1,17 +1,34 @@
    +# Generated by gitlab-ctl reconfigure
    +# Modifications will be overwritten!
    +
    +/var/log/gitlab/nginx/*.log {
    +  su root root
    +  daily
    +  
    +  
    +  rotate 30
    +  compress
    +  copytruncate
    +  missingok
    +  notifempty
    +  postrotate
    +    
    +  endscript
    +}
  * template[/var/opt/gitlab/logrotate/logrotate.d/puma] action create[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/logrotate/logrotate.d/puma] created file /var/opt/gitlab/logrotate/logrotate.d/puma

    - create new file /var/opt/gitlab/logrotate/logrotate.d/puma[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/logrotate/logrotate.d/puma] updated file contents /var/opt/gitlab/logrotate/logrotate.d/puma

    - update content in file /var/opt/gitlab/logrotate/logrotate.d/puma from none to 44ad27
    --- /var/opt/gitlab/logrotate/logrotate.d/puma      2024-03-06 19:59:22.835737436 +0000
    +++ /var/opt/gitlab/logrotate/logrotate.d/.chef-puma20240306-34-e7a3qs      2024-03-06 19:59:22.835737436 +0000
    @@ -1,17 +1,34 @@
    +# Generated by gitlab-ctl reconfigure
    +# Modifications will be overwritten!
    +
    +/var/log/gitlab/puma/*.log {
    +  su git git
    +  daily
    +  
    +  
    +  rotate 30
    +  compress
    +  copytruncate
    +  missingok
    +  notifempty
    +  postrotate
    +    
    +  endscript
    +}
  * template[/var/opt/gitlab/logrotate/logrotate.d/gitlab-rails] action create[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/logrotate/logrotate.d/gitlab-rails] created file /var/opt/gitlab/logrotate/logrotate.d/gitlab-rails

    - create new file /var/opt/gitlab/logrotate/logrotate.d/gitlab-rails[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/logrotate/logrotate.d/gitlab-rails] updated file contents /var/opt/gitlab/logrotate/logrotate.d/gitlab-rails

    - update content in file /var/opt/gitlab/logrotate/logrotate.d/gitlab-rails from none to 26254a
    --- /var/opt/gitlab/logrotate/logrotate.d/gitlab-rails      2024-03-06 19:59:22.847731436 +0000
    +++ /var/opt/gitlab/logrotate/logrotate.d/.chef-gitlab-rails20240306-34-8ynpww      2024-03-06 19:59:22.847731436 +0000
    @@ -1,17 +1,34 @@
    +# Generated by gitlab-ctl reconfigure
    +# Modifications will be overwritten!
    +
    +/var/log/gitlab/gitlab-rails/*.log {
    +  su git git
    +  daily
    +  
    +  
    +  rotate 30
    +  compress
    +  copytruncate
    +  missingok
    +  notifempty
    +  postrotate
    +    
    +  endscript
    +}
  * template[/var/opt/gitlab/logrotate/logrotate.d/gitlab-shell] action create[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/logrotate/logrotate.d/gitlab-shell] created file /var/opt/gitlab/logrotate/logrotate.d/gitlab-shell

    - create new file /var/opt/gitlab/logrotate/logrotate.d/gitlab-shell[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/logrotate/logrotate.d/gitlab-shell] updated file contents /var/opt/gitlab/logrotate/logrotate.d/gitlab-shell

    - update content in file /var/opt/gitlab/logrotate/logrotate.d/gitlab-shell from none to 859f56
    --- /var/opt/gitlab/logrotate/logrotate.d/gitlab-shell      2024-03-06 19:59:22.859725436 +0000
    +++ /var/opt/gitlab/logrotate/logrotate.d/.chef-gitlab-shell20240306-34-u18wo4      2024-03-06 19:59:22.859725436 +0000
    @@ -1,17 +1,34 @@
    +# Generated by gitlab-ctl reconfigure
    +# Modifications will be overwritten!
    +
    +/var/log/gitlab/gitlab-shell/*.log {
    +  su git git
    +  daily
    +  
    +  
    +  rotate 30
    +  compress
    +  copytruncate
    +  missingok
    +  notifempty
    +  postrotate
    +    
    +  endscript
    +}
  * template[/var/opt/gitlab/logrotate/logrotate.d/gitlab-workhorse] action create[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/logrotate/logrotate.d/gitlab-workhorse] created file /var/opt/gitlab/logrotate/logrotate.d/gitlab-workhorse

    - create new file /var/opt/gitlab/logrotate/logrotate.d/gitlab-workhorse[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/logrotate/logrotate.d/gitlab-workhorse] updated file contents /var/opt/gitlab/logrotate/logrotate.d/gitlab-workhorse

    - update content in file /var/opt/gitlab/logrotate/logrotate.d/gitlab-workhorse from none to 3453f6
    --- /var/opt/gitlab/logrotate/logrotate.d/gitlab-workhorse  2024-03-06 19:59:22.871719436 +0000
    +++ /var/opt/gitlab/logrotate/logrotate.d/.chef-gitlab-workhorse20240306-34-g36e2b  2024-03-06 19:59:22.871719436 +0000
    @@ -1,17 +1,34 @@
    +# Generated by gitlab-ctl reconfigure
    +# Modifications will be overwritten!
    +
    +/var/log/gitlab/gitlab-workhorse/*.log {
    +  su git git
    +  daily
    +  
    +  
    +  rotate 30
    +  compress
    +  copytruncate
    +  missingok
    +  notifempty
    +  postrotate
    +    
    +  endscript
    +}
  * template[/var/opt/gitlab/logrotate/logrotate.d/gitlab-pages] action create[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/logrotate/logrotate.d/gitlab-pages] created file /var/opt/gitlab/logrotate/logrotate.d/gitlab-pages

    - create new file /var/opt/gitlab/logrotate/logrotate.d/gitlab-pages[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/logrotate/logrotate.d/gitlab-pages] updated file contents /var/opt/gitlab/logrotate/logrotate.d/gitlab-pages

    - update content in file /var/opt/gitlab/logrotate/logrotate.d/gitlab-pages from none to 3c118a
    --- /var/opt/gitlab/logrotate/logrotate.d/gitlab-pages      2024-03-06 19:59:22.887711436 +0000
    +++ /var/opt/gitlab/logrotate/logrotate.d/.chef-gitlab-pages20240306-34-lqierp      2024-03-06 19:59:22.887711436 +0000
    @@ -1,17 +1,34 @@
    +# Generated by gitlab-ctl reconfigure
    +# Modifications will be overwritten!
    +
    +/var/log/gitlab/gitlab-pages/*.log {
    +  su git git
    +  daily
    +  
    +  
    +  rotate 30
    +  compress
    +  copytruncate
    +  missingok
    +  notifempty
    +  postrotate
    +    
    +  endscript
    +}
  * template[/var/opt/gitlab/logrotate/logrotate.d/gitlab-kas] action create[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/logrotate/logrotate.d/gitlab-kas] created file /var/opt/gitlab/logrotate/logrotate.d/gitlab-kas

    - create new file /var/opt/gitlab/logrotate/logrotate.d/gitlab-kas[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/logrotate/logrotate.d/gitlab-kas] updated file contents /var/opt/gitlab/logrotate/logrotate.d/gitlab-kas

    - update content in file /var/opt/gitlab/logrotate/logrotate.d/gitlab-kas from none to 0ba4f0
    --- /var/opt/gitlab/logrotate/logrotate.d/gitlab-kas        2024-03-06 19:59:22.899705436 +0000
    +++ /var/opt/gitlab/logrotate/logrotate.d/.chef-gitlab-kas20240306-34-9t8fog        2024-03-06 19:59:22.895707437 +0000
    @@ -1,17 +1,34 @@
    +# Generated by gitlab-ctl reconfigure
    +# Modifications will be overwritten!
    +
    +/var/log/gitlab/gitlab-kas/*.log {
    +  su git git
    +  daily
    +  
    +  
    +  rotate 30
    +  compress
    +  copytruncate
    +  missingok
    +  notifempty
    +  postrotate
    +    
    +  endscript
    +}
  * template[/var/opt/gitlab/logrotate/logrotate.d/gitaly] action create[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/logrotate/logrotate.d/gitaly] created file /var/opt/gitlab/logrotate/logrotate.d/gitaly

    - create new file /var/opt/gitlab/logrotate/logrotate.d/gitaly[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/logrotate/logrotate.d/gitaly] updated file contents /var/opt/gitlab/logrotate/logrotate.d/gitaly

    - update content in file /var/opt/gitlab/logrotate/logrotate.d/gitaly from none to 02bda7
    --- /var/opt/gitlab/logrotate/logrotate.d/gitaly    2024-03-06 19:59:22.911699436 +0000
    +++ /var/opt/gitlab/logrotate/logrotate.d/.chef-gitaly20240306-34-zdeqk2    2024-03-06 19:59:22.911699436 +0000
    @@ -1,17 +1,34 @@
    +# Generated by gitlab-ctl reconfigure
    +# Modifications will be overwritten!
    +
    +/var/log/gitlab/gitaly/*.log {
    +  su git git
    +  daily
    +  
    +  
    +  rotate 30
    +  compress
    +  copytruncate
    +  missingok
    +  notifempty
    +  postrotate
    +    
    +  endscript
    +}
  * template[/var/opt/gitlab/logrotate/logrotate.d/mailroom] action create[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/logrotate/logrotate.d/mailroom] created file /var/opt/gitlab/logrotate/logrotate.d/mailroom

    - create new file /var/opt/gitlab/logrotate/logrotate.d/mailroom[2024-03-06T19:59:22+00:00] INFO: template[/var/opt/gitlab/logrotate/logrotate.d/mailroom] updated file contents /var/opt/gitlab/logrotate/logrotate.d/mailroom

    - update content in file /var/opt/gitlab/logrotate/logrotate.d/mailroom from none to 8fcea3
    --- /var/opt/gitlab/logrotate/logrotate.d/mailroom  2024-03-06 19:59:22.927691436 +0000
    +++ /var/opt/gitlab/logrotate/logrotate.d/.chef-mailroom20240306-34-k9oc9u  2024-03-06 19:59:22.923693437 +0000
    @@ -1,17 +1,34 @@
    +# Generated by gitlab-ctl reconfigure
    +# Modifications will be overwritten!
    +
    +/var/log/gitlab/mailroom/*.log {
    +  su git git
    +  daily
    +  
    +  
    +  rotate 30
    +  compress
    +  copytruncate
    +  missingok
    +  notifempty
    +  postrotate
    +    
    +  endscript
    +}
Recipe: logrotate::enable
  * service[logrotate] action nothing (skipped due to action :nothing)
  * runit_service[logrotate] action enable
    * ruby_block[restart_service] action nothing (skipped due to action :nothing)
    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
    * directory[/opt/gitlab/sv/logrotate] action create[2024-03-06T19:59:22+00:00] INFO: directory[/opt/gitlab/sv/logrotate] created directory /opt/gitlab/sv/logrotate

      - create new directory /opt/gitlab/sv/logrotate[2024-03-06T19:59:22+00:00] INFO: directory[/opt/gitlab/sv/logrotate] owner changed to 0
[2024-03-06T19:59:22+00:00] INFO: directory[/opt/gitlab/sv/logrotate] group changed to 0
[2024-03-06T19:59:22+00:00] INFO: directory[/opt/gitlab/sv/logrotate] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * template[/opt/gitlab/sv/logrotate/run] action create[2024-03-06T19:59:22+00:00] INFO: template[/opt/gitlab/sv/logrotate/run] created file /opt/gitlab/sv/logrotate/run

      - create new file /opt/gitlab/sv/logrotate/run[2024-03-06T19:59:22+00:00] INFO: template[/opt/gitlab/sv/logrotate/run] updated file contents /opt/gitlab/sv/logrotate/run

      - update content in file /opt/gitlab/sv/logrotate/run from none to 07f1b6
      --- /opt/gitlab/sv/logrotate/run  2024-03-06 19:59:22.947681437 +0000
      +++ /opt/gitlab/sv/logrotate/.chef-run20240306-34-9jckql  2024-03-06 19:59:22.947681437 +0000
      @@ -1,10 +1,20 @@
      +#!/bin/sh
      +exec 2>&1
      +
      +cd /var/opt/gitlab/logrotate
      +
      +exec /opt/gitlab/embedded/bin/chpst -P /usr/bin/env \
      +  dir=/var/opt/gitlab/logrotate \
      +  pre_sleep=600 \
      +  post_sleep=3000 \
      +  /opt/gitlab/embedded/bin/gitlab-logrotate-wrapper[2024-03-06T19:59:22+00:00] INFO: template[/opt/gitlab/sv/logrotate/run] owner changed to 0
[2024-03-06T19:59:22+00:00] INFO: template[/opt/gitlab/sv/logrotate/run] group changed to 0
[2024-03-06T19:59:22+00:00] INFO: template[/opt/gitlab/sv/logrotate/run] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/logrotate/log] action create[2024-03-06T19:59:22+00:00] INFO: directory[/opt/gitlab/sv/logrotate/log] created directory /opt/gitlab/sv/logrotate/log

      - create new directory /opt/gitlab/sv/logrotate/log[2024-03-06T19:59:22+00:00] INFO: directory[/opt/gitlab/sv/logrotate/log] owner changed to 0
[2024-03-06T19:59:22+00:00] INFO: directory[/opt/gitlab/sv/logrotate/log] group changed to 0
[2024-03-06T19:59:22+00:00] INFO: directory[/opt/gitlab/sv/logrotate/log] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/logrotate/log/main] action create[2024-03-06T19:59:22+00:00] INFO: directory[/opt/gitlab/sv/logrotate/log/main] created directory /opt/gitlab/sv/logrotate/log/main

      - create new directory /opt/gitlab/sv/logrotate/log/main[2024-03-06T19:59:22+00:00] INFO: directory[/opt/gitlab/sv/logrotate/log/main] owner changed to 0
[2024-03-06T19:59:22+00:00] INFO: directory[/opt/gitlab/sv/logrotate/log/main] group changed to 0
[2024-03-06T19:59:22+00:00] INFO: directory[/opt/gitlab/sv/logrotate/log/main] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * template[/opt/gitlab/sv/logrotate/log/config] action create[2024-03-06T19:59:22+00:00] INFO: template[/opt/gitlab/sv/logrotate/log/config] created file /opt/gitlab/sv/logrotate/log/config

      - create new file /opt/gitlab/sv/logrotate/log/config[2024-03-06T19:59:22+00:00] INFO: template[/opt/gitlab/sv/logrotate/log/config] updated file contents /opt/gitlab/sv/logrotate/log/config

      - update content in file /opt/gitlab/sv/logrotate/log/config from none to 623c00
      --- /opt/gitlab/sv/logrotate/log/config   2024-03-06 19:59:22.967671436 +0000
      +++ /opt/gitlab/sv/logrotate/log/.chef-config20240306-34-hw87r7   2024-03-06 19:59:22.967671436 +0000
      @@ -1,6 +1,12 @@
      +s209715200
      +n30
      +t86400
      +!gzip
      +
      +[2024-03-06T19:59:22+00:00] INFO: template[/opt/gitlab/sv/logrotate/log/config] owner changed to 0
[2024-03-06T19:59:22+00:00] INFO: template[/opt/gitlab/sv/logrotate/log/config] group changed to 0
[2024-03-06T19:59:22+00:00] INFO: template[/opt/gitlab/sv/logrotate/log/config] mode changed to 644

      - change mode from '' to '0644'
      - change owner from '' to 'root'
      - change group from '' to 'root'
[2024-03-06T19:59:22+00:00] INFO: template[/opt/gitlab/sv/logrotate/log/config] sending create action to ruby_block[verify_chown_persisted_on_logrotate] (immediate)
    * ruby_block[verify_chown_persisted_on_logrotate] action create[2024-03-06T19:59:22+00:00] INFO: ruby_block[verify_chown_persisted_on_logrotate] called

      - execute the ruby block verify_chown_persisted_on_logrotate
    * ruby_block[verify_chown_persisted_on_logrotate] action nothing (skipped due to action :nothing)
    * link[/var/log/gitlab/logrotate/config] action create[2024-03-06T19:59:22+00:00] INFO: link[/var/log/gitlab/logrotate/config] created

      - create symlink at /var/log/gitlab/logrotate/config to /opt/gitlab/sv/logrotate/log/config
    * template[/opt/gitlab/sv/logrotate/log/run] action create[2024-03-06T19:59:22+00:00] INFO: template[/opt/gitlab/sv/logrotate/log/run] created file /opt/gitlab/sv/logrotate/log/run

      - create new file /opt/gitlab/sv/logrotate/log/run[2024-03-06T19:59:22+00:00] INFO: template[/opt/gitlab/sv/logrotate/log/run] updated file contents /opt/gitlab/sv/logrotate/log/run

      - update content in file /opt/gitlab/sv/logrotate/log/run from none to 637335
      --- /opt/gitlab/sv/logrotate/log/run      2024-03-06 19:59:22.983663436 +0000
      +++ /opt/gitlab/sv/logrotate/log/.chef-run20240306-34-r09527      2024-03-06 19:59:22.983663436 +0000
      @@ -1,5 +1,10 @@
      +#!/bin/sh
      +exec chpst -P \
      +  -U root:root \
      +  -u root:root \
      +  svlogd -tt /var/log/gitlab/logrotate[2024-03-06T19:59:22+00:00] INFO: template[/opt/gitlab/sv/logrotate/log/run] owner changed to 0
[2024-03-06T19:59:22+00:00] INFO: template[/opt/gitlab/sv/logrotate/log/run] group changed to 0
[2024-03-06T19:59:22+00:00] INFO: template[/opt/gitlab/sv/logrotate/log/run] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/logrotate/env] action create[2024-03-06T19:59:22+00:00] INFO: directory[/opt/gitlab/sv/logrotate/env] created directory /opt/gitlab/sv/logrotate/env

      - create new directory /opt/gitlab/sv/logrotate/env[2024-03-06T19:59:22+00:00] INFO: directory[/opt/gitlab/sv/logrotate/env] owner changed to 0
[2024-03-06T19:59:22+00:00] INFO: directory[/opt/gitlab/sv/logrotate/env] group changed to 0
[2024-03-06T19:59:22+00:00] INFO: directory[/opt/gitlab/sv/logrotate/env] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * ruby_block[Delete unmanaged env files for logrotate service] action run (skipped due to only_if)
    * template[/opt/gitlab/sv/logrotate/check] action create (skipped due to only_if)
    * template[/opt/gitlab/sv/logrotate/finish] action create (skipped due to only_if)
    * directory[/opt/gitlab/sv/logrotate/control] action create[2024-03-06T19:59:22+00:00] INFO: directory[/opt/gitlab/sv/logrotate/control] created directory /opt/gitlab/sv/logrotate/control

      - create new directory /opt/gitlab/sv/logrotate/control[2024-03-06T19:59:22+00:00] INFO: directory[/opt/gitlab/sv/logrotate/control] owner changed to 0
[2024-03-06T19:59:22+00:00] INFO: directory[/opt/gitlab/sv/logrotate/control] group changed to 0
[2024-03-06T19:59:22+00:00] INFO: directory[/opt/gitlab/sv/logrotate/control] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * template[/opt/gitlab/sv/logrotate/control/t] action create[2024-03-06T19:59:23+00:00] INFO: template[/opt/gitlab/sv/logrotate/control/t] created file /opt/gitlab/sv/logrotate/control/t

      - create new file /opt/gitlab/sv/logrotate/control/t[2024-03-06T19:59:23+00:00] INFO: template[/opt/gitlab/sv/logrotate/control/t] updated file contents /opt/gitlab/sv/logrotate/control/t

      - update content in file /opt/gitlab/sv/logrotate/control/t from none to 8fa3fa
      --- /opt/gitlab/sv/logrotate/control/t    2024-03-06 19:59:23.003653436 +0000
      +++ /opt/gitlab/sv/logrotate/control/.chef-t20240306-34-ijvay6    2024-03-06 19:59:23.003653436 +0000
      @@ -1,3 +1,6 @@
      +#!/bin/sh
      +echo "Received TERM from runit, sending to process group (-PID)"
      +kill -- -$(cat /opt/gitlab/service/logrotate/supervise/pid)[2024-03-06T19:59:23+00:00] INFO: template[/opt/gitlab/sv/logrotate/control/t] owner changed to 0
[2024-03-06T19:59:23+00:00] INFO: template[/opt/gitlab/sv/logrotate/control/t] group changed to 0
[2024-03-06T19:59:23+00:00] INFO: template[/opt/gitlab/sv/logrotate/control/t] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * link[/opt/gitlab/init/logrotate] action create[2024-03-06T19:59:23+00:00] INFO: link[/opt/gitlab/init/logrotate] created

      - create symlink at /opt/gitlab/init/logrotate to /opt/gitlab/embedded/bin/sv
    * file[/opt/gitlab/sv/logrotate/down] action nothing (skipped due to action :nothing)
[2024-03-06T19:59:23+00:00] INFO: template[/opt/gitlab/sv/logrotate/run] sending run action to ruby_block[restart_service] (delayed)
    * ruby_block[restart_service] action run (skipped due to only_if)
[2024-03-06T19:59:23+00:00] INFO: template[/opt/gitlab/sv/logrotate/log/config] sending create action to ruby_block[reload_log_service] (delayed)
    * ruby_block[reload_log_service] action create
      * ruby_block[restart_service] action nothing (skipped due to action :nothing)
      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/sv/logrotate] action create (up to date)
      * template[/opt/gitlab/sv/logrotate/run] action create (up to date)
      * directory[/opt/gitlab/sv/logrotate/log] action create (up to date)
      * directory[/opt/gitlab/sv/logrotate/log/main] action create (up to date)
      * template[/opt/gitlab/sv/logrotate/log/config] action create (up to date)
      * ruby_block[verify_chown_persisted_on_logrotate] action nothing (skipped due to action :nothing)
      * link[/var/log/gitlab/logrotate/config] action create (up to date)
      * template[/opt/gitlab/sv/logrotate/log/run] action create (up to date)
      * directory[/opt/gitlab/sv/logrotate/env] action create (up to date)
      * ruby_block[Delete unmanaged env files for logrotate service] action run (skipped due to only_if)
      * template[/opt/gitlab/sv/logrotate/check] action create (skipped due to only_if)
      * template[/opt/gitlab/sv/logrotate/finish] action create (skipped due to only_if)
      * directory[/opt/gitlab/sv/logrotate/control] action create (up to date)
      * template[/opt/gitlab/sv/logrotate/control/t] action create (up to date)
      * link[/opt/gitlab/init/logrotate] action create (up to date)
      * file[/opt/gitlab/sv/logrotate/down] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/service] action create (up to date)
      * link[/opt/gitlab/service/logrotate] action create[2024-03-06T19:59:23+00:00] INFO: link[/opt/gitlab/service/logrotate] created

        - create symlink at /opt/gitlab/service/logrotate to /opt/gitlab/sv/logrotate
      * ruby_block[wait for logrotate service socket] action run[2024-03-06T19:59:28+00:00] INFO: ruby_block[wait for logrotate service socket] called

        - execute the ruby block wait for logrotate service socket
      * file[/var/log/gitlab/logrotate/current] action touch (skipped due to only_if)
[2024-03-06T19:59:29+00:00] INFO: ruby_block[reload_log_service] called
      - execute the ruby block reload_log_service
[2024-03-06T19:59:29+00:00] INFO: template[/opt/gitlab/sv/logrotate/log/run] sending run action to ruby_block[restart_log_service] (delayed)
    * ruby_block[restart_log_service] action run
      * ruby_block[restart_service] action nothing (skipped due to action :nothing)
      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/sv/logrotate] action create (up to date)
      * template[/opt/gitlab/sv/logrotate/run] action create (up to date)
      * directory[/opt/gitlab/sv/logrotate/log] action create (up to date)
      * directory[/opt/gitlab/sv/logrotate/log/main] action create (up to date)
      * template[/opt/gitlab/sv/logrotate/log/config] action create (up to date)
      * ruby_block[verify_chown_persisted_on_logrotate] action nothing (skipped due to action :nothing)
      * link[/var/log/gitlab/logrotate/config] action create (up to date)
      * template[/opt/gitlab/sv/logrotate/log/run] action create (up to date)
      * directory[/opt/gitlab/sv/logrotate/env] action create (up to date)
      * ruby_block[Delete unmanaged env files for logrotate service] action run (skipped due to only_if)
      * template[/opt/gitlab/sv/logrotate/check] action create (skipped due to only_if)
      * template[/opt/gitlab/sv/logrotate/finish] action create (skipped due to only_if)
      * directory[/opt/gitlab/sv/logrotate/control] action create (up to date)
      * template[/opt/gitlab/sv/logrotate/control/t] action create (up to date)
      * link[/opt/gitlab/init/logrotate] action create (up to date)
      * file[/opt/gitlab/sv/logrotate/down] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/service] action create (up to date)
      * link[/opt/gitlab/service/logrotate] action create (up to date)
      * ruby_block[wait for logrotate service socket] action run (skipped due to not_if)
      * file[/var/log/gitlab/logrotate/current] action touch (skipped due to only_if)
[2024-03-06T19:59:29+00:00] INFO: ruby_block[restart_log_service] called
      - execute the ruby block restart_log_service
    * directory[/opt/gitlab/service] action create (up to date)
    * link[/opt/gitlab/service/logrotate] action create (up to date)
    * ruby_block[wait for logrotate service socket] action run (skipped due to not_if)
    * file[/var/log/gitlab/logrotate/current] action touch (skipped due to only_if)
  
  * execute[/opt/gitlab/bin/gitlab-ctl start logrotate] action run
    [execute] ok: run: logrotate: (pid 499) 2s
[2024-03-06T19:59:29+00:00] INFO: execute[/opt/gitlab/bin/gitlab-ctl start logrotate] ran successfully
    - execute /opt/gitlab/bin/gitlab-ctl start logrotate
Recipe: redis::enable
  * redis_service[redis] action create[2024-03-06T19:59:29+00:00] WARN: redis does not have a log_group or default logdir mode defined. Setting to 0700.

    * account[user and group for redis] action create (up to date)
    * group[Socket group] action create (up to date)
    * directory[/var/opt/gitlab/redis] action create[2024-03-06T19:59:29+00:00] INFO: directory[/var/opt/gitlab/redis] group changed to 998

      - change group from 'gitlab-redis' to 'git'
    * directory[/var/log/gitlab/redis] action create[2024-03-06T19:59:29+00:00] INFO: directory[/var/log/gitlab/redis] created directory /var/log/gitlab/redis

      - create new directory /var/log/gitlab/redis[2024-03-06T19:59:29+00:00] INFO: directory[/var/log/gitlab/redis] owner changed to 997
[2024-03-06T19:59:29+00:00] INFO: directory[/var/log/gitlab/redis] mode changed to 700

      - change mode from '' to '0700'
      - change owner from '' to 'gitlab-redis'
    * template[/var/opt/gitlab/redis/redis.conf] action create[2024-03-06T19:59:29+00:00] INFO: template[/var/opt/gitlab/redis/redis.conf] created file /var/opt/gitlab/redis/redis.conf

      - create new file /var/opt/gitlab/redis/redis.conf[2024-03-06T19:59:29+00:00] INFO: template[/var/opt/gitlab/redis/redis.conf] updated file contents /var/opt/gitlab/redis/redis.conf

      - update content in file /var/opt/gitlab/redis/redis.conf from none to 905fae
      - suppressed sensitive resource[2024-03-06T19:59:29+00:00] INFO: template[/var/opt/gitlab/redis/redis.conf] owner changed to 997
[2024-03-06T19:59:29+00:00] INFO: template[/var/opt/gitlab/redis/redis.conf] mode changed to 644

      - change mode from '' to '0644'
      - change owner from '' to 'gitlab-redis'
    * service[redis] action nothing (skipped due to action :nothing)
    * runit_service[redis] action enable
      * ruby_block[restart_service] action nothing (skipped due to action :nothing)
      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/sv/redis] action create[2024-03-06T19:59:29+00:00] INFO: directory[/opt/gitlab/sv/redis] created directory /opt/gitlab/sv/redis

        - create new directory /opt/gitlab/sv/redis[2024-03-06T19:59:29+00:00] INFO: directory[/opt/gitlab/sv/redis] owner changed to 0
[2024-03-06T19:59:29+00:00] INFO: directory[/opt/gitlab/sv/redis] group changed to 0
[2024-03-06T19:59:29+00:00] INFO: directory[/opt/gitlab/sv/redis] mode changed to 755

        - change mode from '' to '0755'
        - change owner from '' to 'root'
        - change group from '' to 'root'
      * template[/opt/gitlab/sv/redis/run] action create[2024-03-06T19:59:29+00:00] INFO: template[/opt/gitlab/sv/redis/run] created file /opt/gitlab/sv/redis/run

        - create new file /opt/gitlab/sv/redis/run[2024-03-06T19:59:29+00:00] INFO: template[/opt/gitlab/sv/redis/run] updated file contents /opt/gitlab/sv/redis/run

        - update content in file /opt/gitlab/sv/redis/run from none to 577d2c
        --- /opt/gitlab/sv/redis/run    2024-03-06 19:59:29.980163431 +0000
        +++ /opt/gitlab/sv/redis/.chef-run20240306-34-suechi    2024-03-06 19:59:29.980163431 +0000
        @@ -1,10 +1,20 @@
        +#!/bin/sh
        +exec 2>&1
        +
        +sleep 0
        +umask 077
        +exec chpst -P \
        +  -U gitlab-redis:gitlab-redis \
        +  -u gitlab-redis:gitlab-redis \
        +  /opt/gitlab/embedded/bin/redis-server \
        +  /var/opt/gitlab/redis/redis.conf[2024-03-06T19:59:29+00:00] INFO: template[/opt/gitlab/sv/redis/run] owner changed to 0
[2024-03-06T19:59:29+00:00] INFO: template[/opt/gitlab/sv/redis/run] group changed to 0
[2024-03-06T19:59:29+00:00] INFO: template[/opt/gitlab/sv/redis/run] mode changed to 755

        - change mode from '' to '0755'
        - change owner from '' to 'root'
        - change group from '' to 'root'
      * directory[/opt/gitlab/sv/redis/log] action create[2024-03-06T19:59:29+00:00] INFO: directory[/opt/gitlab/sv/redis/log] created directory /opt/gitlab/sv/redis/log

        - create new directory /opt/gitlab/sv/redis/log[2024-03-06T19:59:29+00:00] INFO: directory[/opt/gitlab/sv/redis/log] owner changed to 0
[2024-03-06T19:59:29+00:00] INFO: directory[/opt/gitlab/sv/redis/log] group changed to 0
[2024-03-06T19:59:29+00:00] INFO: directory[/opt/gitlab/sv/redis/log] mode changed to 755

        - change mode from '' to '0755'
        - change owner from '' to 'root'
        - change group from '' to 'root'
      * directory[/opt/gitlab/sv/redis/log/main] action create[2024-03-06T19:59:29+00:00] INFO: directory[/opt/gitlab/sv/redis/log/main] created directory /opt/gitlab/sv/redis/log/main

        - create new directory /opt/gitlab/sv/redis/log/main[2024-03-06T19:59:29+00:00] INFO: directory[/opt/gitlab/sv/redis/log/main] owner changed to 0
[2024-03-06T19:59:29+00:00] INFO: directory[/opt/gitlab/sv/redis/log/main] group changed to 0
[2024-03-06T19:59:29+00:00] INFO: directory[/opt/gitlab/sv/redis/log/main] mode changed to 755

        - change mode from '' to '0755'
        - change owner from '' to 'root'
        - change group from '' to 'root'
      * template[/opt/gitlab/sv/redis/log/config] action create[2024-03-06T19:59:30+00:00] INFO: template[/opt/gitlab/sv/redis/log/config] created file /opt/gitlab/sv/redis/log/config

        - create new file /opt/gitlab/sv/redis/log/config[2024-03-06T19:59:30+00:00] INFO: template[/opt/gitlab/sv/redis/log/config] updated file contents /opt/gitlab/sv/redis/log/config

        - update content in file /opt/gitlab/sv/redis/log/config from none to 623c00
        --- /opt/gitlab/sv/redis/log/config     2024-03-06 19:59:30.000153432 +0000
        +++ /opt/gitlab/sv/redis/log/.chef-config20240306-34-xekh3      2024-03-06 19:59:30.000153432 +0000
        @@ -1,6 +1,12 @@
        +s209715200
        +n30
        +t86400
        +!gzip
        +
        +[2024-03-06T19:59:30+00:00] INFO: template[/opt/gitlab/sv/redis/log/config] owner changed to 0
[2024-03-06T19:59:30+00:00] INFO: template[/opt/gitlab/sv/redis/log/config] group changed to 0
[2024-03-06T19:59:30+00:00] INFO: template[/opt/gitlab/sv/redis/log/config] mode changed to 644

        - change mode from '' to '0644'
        - change owner from '' to 'root'
        - change group from '' to 'root'
[2024-03-06T19:59:30+00:00] INFO: template[/opt/gitlab/sv/redis/log/config] sending create action to ruby_block[verify_chown_persisted_on_redis] (immediate)
      * ruby_block[verify_chown_persisted_on_redis] action create[2024-03-06T19:59:30+00:00] INFO: ruby_block[verify_chown_persisted_on_redis] called

        - execute the ruby block verify_chown_persisted_on_redis
      * ruby_block[verify_chown_persisted_on_redis] action nothing (skipped due to action :nothing)
      * link[/var/log/gitlab/redis/config] action create[2024-03-06T19:59:30+00:00] INFO: link[/var/log/gitlab/redis/config] created

        - create symlink at /var/log/gitlab/redis/config to /opt/gitlab/sv/redis/log/config
      * template[/opt/gitlab/sv/redis/log/run] action create[2024-03-06T19:59:30+00:00] INFO: template[/opt/gitlab/sv/redis/log/run] created file /opt/gitlab/sv/redis/log/run

        - create new file /opt/gitlab/sv/redis/log/run[2024-03-06T19:59:30+00:00] INFO: template[/opt/gitlab/sv/redis/log/run] updated file contents /opt/gitlab/sv/redis/log/run

        - update content in file /opt/gitlab/sv/redis/log/run from none to 4890e6
        --- /opt/gitlab/sv/redis/log/run        2024-03-06 19:59:30.020143433 +0000
        +++ /opt/gitlab/sv/redis/log/.chef-run20240306-34-g8hsqt        2024-03-06 19:59:30.020143433 +0000
        @@ -1,5 +1,10 @@
        +#!/bin/sh
        +exec chpst -P \
        +  -U root:root \
        +  -u root:root \
        +  svlogd -tt /var/log/gitlab/redis[2024-03-06T19:59:30+00:00] INFO: template[/opt/gitlab/sv/redis/log/run] owner changed to 0
[2024-03-06T19:59:30+00:00] INFO: template[/opt/gitlab/sv/redis/log/run] group changed to 0
[2024-03-06T19:59:30+00:00] INFO: template[/opt/gitlab/sv/redis/log/run] mode changed to 755

        - change mode from '' to '0755'
        - change owner from '' to 'root'
        - change group from '' to 'root'
      * directory[/opt/gitlab/sv/redis/env] action create[2024-03-06T19:59:30+00:00] INFO: directory[/opt/gitlab/sv/redis/env] created directory /opt/gitlab/sv/redis/env

        - create new directory /opt/gitlab/sv/redis/env[2024-03-06T19:59:30+00:00] INFO: directory[/opt/gitlab/sv/redis/env] owner changed to 0
[2024-03-06T19:59:30+00:00] INFO: directory[/opt/gitlab/sv/redis/env] group changed to 0
[2024-03-06T19:59:30+00:00] INFO: directory[/opt/gitlab/sv/redis/env] mode changed to 755

        - change mode from '' to '0755'
        - change owner from '' to 'root'
        - change group from '' to 'root'
      * ruby_block[Delete unmanaged env files for redis service] action run (skipped due to only_if)
      * template[/opt/gitlab/sv/redis/check] action create (skipped due to only_if)
      * template[/opt/gitlab/sv/redis/finish] action create (skipped due to only_if)
      * directory[/opt/gitlab/sv/redis/control] action create[2024-03-06T19:59:30+00:00] INFO: directory[/opt/gitlab/sv/redis/control] created directory /opt/gitlab/sv/redis/control

        - create new directory /opt/gitlab/sv/redis/control[2024-03-06T19:59:30+00:00] INFO: directory[/opt/gitlab/sv/redis/control] owner changed to 0
[2024-03-06T19:59:30+00:00] INFO: directory[/opt/gitlab/sv/redis/control] group changed to 0
[2024-03-06T19:59:30+00:00] INFO: directory[/opt/gitlab/sv/redis/control] mode changed to 755

        - change mode from '' to '0755'
        - change owner from '' to 'root'
        - change group from '' to 'root'
      * link[/opt/gitlab/init/redis] action create[2024-03-06T19:59:30+00:00] INFO: link[/opt/gitlab/init/redis] created

        - create symlink at /opt/gitlab/init/redis to /opt/gitlab/embedded/bin/sv
      * file[/opt/gitlab/sv/redis/down] action nothing (skipped due to action :nothing)
[2024-03-06T19:59:30+00:00] INFO: template[/opt/gitlab/sv/redis/run] sending run action to ruby_block[restart_service] (delayed)
      * ruby_block[restart_service] action run (skipped due to only_if)
[2024-03-06T19:59:30+00:00] INFO: template[/opt/gitlab/sv/redis/log/config] sending create action to ruby_block[reload_log_service] (delayed)
      * ruby_block[reload_log_service] action create
        * ruby_block[restart_service] action nothing (skipped due to action :nothing)
        * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
        * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
        * directory[/opt/gitlab/sv/redis] action create (up to date)
        * template[/opt/gitlab/sv/redis/run] action create (up to date)
        * directory[/opt/gitlab/sv/redis/log] action create (up to date)
        * directory[/opt/gitlab/sv/redis/log/main] action create (up to date)
        * template[/opt/gitlab/sv/redis/log/config] action create (up to date)
        * ruby_block[verify_chown_persisted_on_redis] action nothing (skipped due to action :nothing)
        * link[/var/log/gitlab/redis/config] action create (up to date)
        * template[/opt/gitlab/sv/redis/log/run] action create (up to date)
        * directory[/opt/gitlab/sv/redis/env] action create (up to date)
        * ruby_block[Delete unmanaged env files for redis service] action run (skipped due to only_if)
        * template[/opt/gitlab/sv/redis/check] action create (skipped due to only_if)
        * template[/opt/gitlab/sv/redis/finish] action create (skipped due to only_if)
        * directory[/opt/gitlab/sv/redis/control] action create (up to date)
        * link[/opt/gitlab/init/redis] action create (up to date)
        * file[/opt/gitlab/sv/redis/down] action nothing (skipped due to action :nothing)
        * directory[/opt/gitlab/service] action create (up to date)
        * link[/opt/gitlab/service/redis] action create[2024-03-06T19:59:30+00:00] INFO: link[/opt/gitlab/service/redis] created

          - create symlink at /opt/gitlab/service/redis to /opt/gitlab/sv/redis
        * ruby_block[wait for redis service socket] action run[2024-03-06T19:59:34+00:00] INFO: ruby_block[wait for redis service socket] called

          - execute the ruby block wait for redis service socket
        * file[/var/log/gitlab/redis/current] action touch (skipped due to only_if)
[2024-03-06T19:59:35+00:00] INFO: ruby_block[reload_log_service] called
        - execute the ruby block reload_log_service
[2024-03-06T19:59:35+00:00] INFO: template[/opt/gitlab/sv/redis/log/run] sending run action to ruby_block[restart_log_service] (delayed)
      * ruby_block[restart_log_service] action run
        * ruby_block[restart_service] action nothing (skipped due to action :nothing)
        * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
        * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
        * directory[/opt/gitlab/sv/redis] action create (up to date)
        * template[/opt/gitlab/sv/redis/run] action create (up to date)
        * directory[/opt/gitlab/sv/redis/log] action create (up to date)
        * directory[/opt/gitlab/sv/redis/log/main] action create (up to date)
        * template[/opt/gitlab/sv/redis/log/config] action create (up to date)
        * ruby_block[verify_chown_persisted_on_redis] action nothing (skipped due to action :nothing)
        * link[/var/log/gitlab/redis/config] action create (up to date)
        * template[/opt/gitlab/sv/redis/log/run] action create (up to date)
        * directory[/opt/gitlab/sv/redis/env] action create (up to date)
        * ruby_block[Delete unmanaged env files for redis service] action run (skipped due to only_if)
        * template[/opt/gitlab/sv/redis/check] action create (skipped due to only_if)
        * template[/opt/gitlab/sv/redis/finish] action create (skipped due to only_if)
        * directory[/opt/gitlab/sv/redis/control] action create (up to date)
        * link[/opt/gitlab/init/redis] action create (up to date)
        * file[/opt/gitlab/sv/redis/down] action nothing (skipped due to action :nothing)
        * directory[/opt/gitlab/service] action create (up to date)
        * link[/opt/gitlab/service/redis] action create (up to date)
        * ruby_block[wait for redis service socket] action run (skipped due to not_if)
        * file[/var/log/gitlab/redis/current] action touch (skipped due to only_if)
[2024-03-06T19:59:35+00:00] INFO: ruby_block[restart_log_service] called
        - execute the ruby block restart_log_service
      * directory[/opt/gitlab/service] action create (up to date)
      * link[/opt/gitlab/service/redis] action create (up to date)
      * ruby_block[wait for redis service socket] action run (skipped due to not_if)
      * file[/var/log/gitlab/redis/current] action touch (skipped due to only_if)
    
    * execute[/opt/gitlab/bin/gitlab-ctl start redis] action run
      [execute] ok: run: redis: (pid 516) 2s
[2024-03-06T19:59:35+00:00] INFO: execute[/opt/gitlab/bin/gitlab-ctl start redis] ran successfully
      - execute /opt/gitlab/bin/gitlab-ctl start redis
    * ruby_block[warn pending redis restart] action run (skipped due to only_if)
  
  * template[/opt/gitlab/etc/gitlab-redis-cli-rc] action create[2024-03-06T19:59:35+00:00] INFO: template[/opt/gitlab/etc/gitlab-redis-cli-rc] created file /opt/gitlab/etc/gitlab-redis-cli-rc

    - create new file /opt/gitlab/etc/gitlab-redis-cli-rc[2024-03-06T19:59:35+00:00] INFO: template[/opt/gitlab/etc/gitlab-redis-cli-rc] updated file contents /opt/gitlab/etc/gitlab-redis-cli-rc

    - update content in file /opt/gitlab/etc/gitlab-redis-cli-rc from none to 44cac1
    --- /opt/gitlab/etc/gitlab-redis-cli-rc     2024-03-06 19:59:35.973165438 +0000
    +++ /opt/gitlab/etc/.chef-gitlab-redis-cli-rc20240306-34-g6nqe9     2024-03-06 19:59:35.973165438 +0000
    @@ -1,4 +1,8 @@
    +redis_dir='/var/opt/gitlab/redis'
    +redis_host='127.0.0.1'
    +redis_port='0'
    +redis_socket='/var/opt/gitlab/redis/redis.socket'[2024-03-06T19:59:35+00:00] INFO: template[/opt/gitlab/etc/gitlab-redis-cli-rc] owner changed to 0
[2024-03-06T19:59:35+00:00] INFO: template[/opt/gitlab/etc/gitlab-redis-cli-rc] group changed to 0

    - change owner from '' to 'root'
    - change group from '' to 'root'
Recipe: gitaly::enable
  * directory[/var/opt/gitlab/gitaly] action create[2024-03-06T19:59:35+00:00] INFO: directory[/var/opt/gitlab/gitaly] created directory /var/opt/gitlab/gitaly

    - create new directory /var/opt/gitlab/gitaly[2024-03-06T19:59:35+00:00] INFO: directory[/var/opt/gitlab/gitaly] owner changed to 998
[2024-03-06T19:59:35+00:00] INFO: directory[/var/opt/gitlab/gitaly] mode changed to 700

    - change mode from '' to '0700'
    - change owner from '' to 'git'
  * directory[/var/opt/gitlab/gitaly/run] action create[2024-03-06T19:59:35+00:00] INFO: directory[/var/opt/gitlab/gitaly/run] created directory /var/opt/gitlab/gitaly/run

    - create new directory /var/opt/gitlab/gitaly/run[2024-03-06T19:59:35+00:00] INFO: directory[/var/opt/gitlab/gitaly/run] owner changed to 998
[2024-03-06T19:59:35+00:00] INFO: directory[/var/opt/gitlab/gitaly/run] mode changed to 700

    - change mode from '' to '0700'
    - change owner from '' to 'git'
  * directory[/var/log/gitlab/gitaly] action create[2024-03-06T19:59:35+00:00] INFO: directory[/var/log/gitlab/gitaly] created directory /var/log/gitlab/gitaly

    - create new directory /var/log/gitlab/gitaly[2024-03-06T19:59:35+00:00] INFO: directory[/var/log/gitlab/gitaly] owner changed to 998
[2024-03-06T19:59:35+00:00] INFO: directory[/var/log/gitlab/gitaly] mode changed to 700

    - change mode from '' to '0700'
    - change owner from '' to 'git'
  * directory[/var/opt/gitlab/gitaly/internal_sockets] action delete (up to date)
  * env_dir[/opt/gitlab/etc/gitaly/env] action create
    * directory[/opt/gitlab/etc/gitaly/env] action create[2024-03-06T19:59:35+00:00] INFO: directory[/opt/gitlab/etc/gitaly/env] created directory /opt/gitlab/etc/gitaly/env

      - create new directory /opt/gitlab/etc/gitaly/env
    * file[/opt/gitlab/etc/gitaly/env/HOME] action create[2024-03-06T19:59:36+00:00] INFO: file[/opt/gitlab/etc/gitaly/env/HOME] created file /opt/gitlab/etc/gitaly/env/HOME

      - create new file /opt/gitlab/etc/gitaly/env/HOME[2024-03-06T19:59:36+00:00] INFO: file[/opt/gitlab/etc/gitaly/env/HOME] updated file contents /opt/gitlab/etc/gitaly/env/HOME

      - update content in file /opt/gitlab/etc/gitaly/env/HOME from none to 205bb9
      - suppressed sensitive resource
    * file[/opt/gitlab/etc/gitaly/env/PATH] action create[2024-03-06T19:59:36+00:00] INFO: file[/opt/gitlab/etc/gitaly/env/PATH] created file /opt/gitlab/etc/gitaly/env/PATH

      - create new file /opt/gitlab/etc/gitaly/env/PATH[2024-03-06T19:59:36+00:00] INFO: file[/opt/gitlab/etc/gitaly/env/PATH] updated file contents /opt/gitlab/etc/gitaly/env/PATH

      - update content in file /opt/gitlab/etc/gitaly/env/PATH from none to d5dc07
      - suppressed sensitive resource
    * file[/opt/gitlab/etc/gitaly/env/TZ] action create[2024-03-06T19:59:36+00:00] INFO: file[/opt/gitlab/etc/gitaly/env/TZ] created file /opt/gitlab/etc/gitaly/env/TZ

      - create new file /opt/gitlab/etc/gitaly/env/TZ[2024-03-06T19:59:36+00:00] INFO: file[/opt/gitlab/etc/gitaly/env/TZ] updated file contents /opt/gitlab/etc/gitaly/env/TZ

      - update content in file /opt/gitlab/etc/gitaly/env/TZ from none to 983a95
      - suppressed sensitive resource
    * file[/opt/gitlab/etc/gitaly/env/PYTHONPATH] action create[2024-03-06T19:59:36+00:00] INFO: file[/opt/gitlab/etc/gitaly/env/PYTHONPATH] created file /opt/gitlab/etc/gitaly/env/PYTHONPATH

      - create new file /opt/gitlab/etc/gitaly/env/PYTHONPATH[2024-03-06T19:59:36+00:00] INFO: file[/opt/gitlab/etc/gitaly/env/PYTHONPATH] updated file contents /opt/gitlab/etc/gitaly/env/PYTHONPATH

      - update content in file /opt/gitlab/etc/gitaly/env/PYTHONPATH from none to 98c9f4
      - suppressed sensitive resource
    * file[/opt/gitlab/etc/gitaly/env/ICU_DATA] action create[2024-03-06T19:59:36+00:00] INFO: file[/opt/gitlab/etc/gitaly/env/ICU_DATA] created file /opt/gitlab/etc/gitaly/env/ICU_DATA

      - create new file /opt/gitlab/etc/gitaly/env/ICU_DATA[2024-03-06T19:59:36+00:00] INFO: file[/opt/gitlab/etc/gitaly/env/ICU_DATA] updated file contents /opt/gitlab/etc/gitaly/env/ICU_DATA

      - update content in file /opt/gitlab/etc/gitaly/env/ICU_DATA from none to a04260
      - suppressed sensitive resource
    * file[/opt/gitlab/etc/gitaly/env/SSL_CERT_DIR] action create[2024-03-06T19:59:36+00:00] INFO: file[/opt/gitlab/etc/gitaly/env/SSL_CERT_DIR] created file /opt/gitlab/etc/gitaly/env/SSL_CERT_DIR

      - create new file /opt/gitlab/etc/gitaly/env/SSL_CERT_DIR[2024-03-06T19:59:36+00:00] INFO: file[/opt/gitlab/etc/gitaly/env/SSL_CERT_DIR] updated file contents /opt/gitlab/etc/gitaly/env/SSL_CERT_DIR

      - update content in file /opt/gitlab/etc/gitaly/env/SSL_CERT_DIR from none to 4f45cf
      - suppressed sensitive resource
    * file[/opt/gitlab/etc/gitaly/env/GITALY_PID_FILE] action create[2024-03-06T19:59:36+00:00] INFO: file[/opt/gitlab/etc/gitaly/env/GITALY_PID_FILE] created file /opt/gitlab/etc/gitaly/env/GITALY_PID_FILE

      - create new file /opt/gitlab/etc/gitaly/env/GITALY_PID_FILE[2024-03-06T19:59:36+00:00] INFO: file[/opt/gitlab/etc/gitaly/env/GITALY_PID_FILE] updated file contents /opt/gitlab/etc/gitaly/env/GITALY_PID_FILE

      - update content in file /opt/gitlab/etc/gitaly/env/GITALY_PID_FILE from none to e82748
      - suppressed sensitive resource
    * file[/opt/gitlab/etc/gitaly/env/WRAPPER_JSON_LOGGING] action create[2024-03-06T19:59:36+00:00] INFO: file[/opt/gitlab/etc/gitaly/env/WRAPPER_JSON_LOGGING] created file /opt/gitlab/etc/gitaly/env/WRAPPER_JSON_LOGGING

      - create new file /opt/gitlab/etc/gitaly/env/WRAPPER_JSON_LOGGING[2024-03-06T19:59:36+00:00] INFO: file[/opt/gitlab/etc/gitaly/env/WRAPPER_JSON_LOGGING] updated file contents /opt/gitlab/etc/gitaly/env/WRAPPER_JSON_LOGGING

      - update content in file /opt/gitlab/etc/gitaly/env/WRAPPER_JSON_LOGGING from none to b5bea4
      - suppressed sensitive resource
  
  * template[Create Gitaly config.toml] action create[2024-03-06T19:59:36+00:00] INFO: template[Create Gitaly config.toml] created file /var/opt/gitlab/gitaly/config.toml

    - create new file /var/opt/gitlab/gitaly/config.toml[2024-03-06T19:59:36+00:00] INFO: template[Create Gitaly config.toml] updated file contents /var/opt/gitlab/gitaly/config.toml

    - update content in file /var/opt/gitlab/gitaly/config.toml from none to b75c7e
    - suppressed sensitive resource[2024-03-06T19:59:36+00:00] INFO: template[Create Gitaly config.toml] owner changed to 0
[2024-03-06T19:59:36+00:00] INFO: template[Create Gitaly config.toml] group changed to 998
[2024-03-06T19:59:36+00:00] INFO: template[Create Gitaly config.toml] mode changed to 640

    - change mode from '' to '0640'
    - change owner from '' to 'root'
    - change group from '' to 'git'
  * service[gitaly] action nothing (skipped due to action :nothing)
  * runit_service[gitaly] action enable
    * ruby_block[restart_service] action nothing (skipped due to action :nothing)
    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
    * directory[/opt/gitlab/sv/gitaly] action create[2024-03-06T19:59:36+00:00] INFO: directory[/opt/gitlab/sv/gitaly] created directory /opt/gitlab/sv/gitaly

      - create new directory /opt/gitlab/sv/gitaly[2024-03-06T19:59:36+00:00] INFO: directory[/opt/gitlab/sv/gitaly] owner changed to 0
[2024-03-06T19:59:36+00:00] INFO: directory[/opt/gitlab/sv/gitaly] group changed to 0
[2024-03-06T19:59:36+00:00] INFO: directory[/opt/gitlab/sv/gitaly] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * template[/opt/gitlab/sv/gitaly/run] action create[2024-03-06T19:59:36+00:00] INFO: template[/opt/gitlab/sv/gitaly/run] created file /opt/gitlab/sv/gitaly/run

      - create new file /opt/gitlab/sv/gitaly/run[2024-03-06T19:59:36+00:00] INFO: template[/opt/gitlab/sv/gitaly/run] updated file contents /opt/gitlab/sv/gitaly/run

      - update content in file /opt/gitlab/sv/gitaly/run from none to 7fef11
      --- /opt/gitlab/sv/gitaly/run     2024-03-06 19:59:36.133085438 +0000
      +++ /opt/gitlab/sv/gitaly/.chef-run20240306-34-gf5oov     2024-03-06 19:59:36.133085438 +0000
      @@ -1,19 +1,38 @@
      +#!/bin/sh
      +
      +# Attempt to change ulimit before the set -e flag, ignore failures
      +ulimit -n 15000
      +
      +set -e # fail on errors
      +
      +# Redirect stderr -> stdout
      +exec 2>&1
      +
      +
      +
      +
      +cd /var/opt/gitlab/gitaly
      +
      +exec chpst -e /opt/gitlab/etc/gitaly/env -P \
      +  -U git:git \
      +  -u git:git \
      +  /opt/gitlab/embedded/bin/gitaly-wrapper /opt/gitlab/embedded/bin/gitaly /var/opt/gitlab/gitaly/config.toml[2024-03-06T19:59:36+00:00] INFO: template[/opt/gitlab/sv/gitaly/run] owner changed to 0
[2024-03-06T19:59:36+00:00] INFO: template[/opt/gitlab/sv/gitaly/run] group changed to 0
[2024-03-06T19:59:36+00:00] INFO: template[/opt/gitlab/sv/gitaly/run] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/gitaly/log] action create[2024-03-06T19:59:36+00:00] INFO: directory[/opt/gitlab/sv/gitaly/log] created directory /opt/gitlab/sv/gitaly/log

      - create new directory /opt/gitlab/sv/gitaly/log[2024-03-06T19:59:36+00:00] INFO: directory[/opt/gitlab/sv/gitaly/log] owner changed to 0
[2024-03-06T19:59:36+00:00] INFO: directory[/opt/gitlab/sv/gitaly/log] group changed to 0
[2024-03-06T19:59:36+00:00] INFO: directory[/opt/gitlab/sv/gitaly/log] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/gitaly/log/main] action create[2024-03-06T19:59:36+00:00] INFO: directory[/opt/gitlab/sv/gitaly/log/main] created directory /opt/gitlab/sv/gitaly/log/main

      - create new directory /opt/gitlab/sv/gitaly/log/main[2024-03-06T19:59:36+00:00] INFO: directory[/opt/gitlab/sv/gitaly/log/main] owner changed to 0
[2024-03-06T19:59:36+00:00] INFO: directory[/opt/gitlab/sv/gitaly/log/main] group changed to 0
[2024-03-06T19:59:36+00:00] INFO: directory[/opt/gitlab/sv/gitaly/log/main] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * template[/opt/gitlab/sv/gitaly/log/config] action create[2024-03-06T19:59:36+00:00] INFO: template[/opt/gitlab/sv/gitaly/log/config] created file /opt/gitlab/sv/gitaly/log/config

      - create new file /opt/gitlab/sv/gitaly/log/config[2024-03-06T19:59:36+00:00] INFO: template[/opt/gitlab/sv/gitaly/log/config] updated file contents /opt/gitlab/sv/gitaly/log/config

      - update content in file /opt/gitlab/sv/gitaly/log/config from none to 623c00
      --- /opt/gitlab/sv/gitaly/log/config      2024-03-06 19:59:36.153075438 +0000
      +++ /opt/gitlab/sv/gitaly/log/.chef-config20240306-34-helb9w      2024-03-06 19:59:36.153075438 +0000
      @@ -1,6 +1,12 @@
      +s209715200
      +n30
      +t86400
      +!gzip
      +
      +[2024-03-06T19:59:36+00:00] INFO: template[/opt/gitlab/sv/gitaly/log/config] owner changed to 0
[2024-03-06T19:59:36+00:00] INFO: template[/opt/gitlab/sv/gitaly/log/config] group changed to 0
[2024-03-06T19:59:36+00:00] INFO: template[/opt/gitlab/sv/gitaly/log/config] mode changed to 644

      - change mode from '' to '0644'
      - change owner from '' to 'root'
      - change group from '' to 'root'
[2024-03-06T19:59:36+00:00] INFO: template[/opt/gitlab/sv/gitaly/log/config] sending create action to ruby_block[verify_chown_persisted_on_gitaly] (immediate)
    * ruby_block[verify_chown_persisted_on_gitaly] action create[2024-03-06T19:59:36+00:00] INFO: ruby_block[verify_chown_persisted_on_gitaly] called

      - execute the ruby block verify_chown_persisted_on_gitaly
    * ruby_block[verify_chown_persisted_on_gitaly] action nothing (skipped due to action :nothing)
    * link[/var/log/gitlab/gitaly/config] action create[2024-03-06T19:59:36+00:00] INFO: link[/var/log/gitlab/gitaly/config] created

      - create symlink at /var/log/gitlab/gitaly/config to /opt/gitlab/sv/gitaly/log/config
    * template[/opt/gitlab/sv/gitaly/log/run] action create[2024-03-06T19:59:36+00:00] INFO: template[/opt/gitlab/sv/gitaly/log/run] created file /opt/gitlab/sv/gitaly/log/run

      - create new file /opt/gitlab/sv/gitaly/log/run[2024-03-06T19:59:36+00:00] INFO: template[/opt/gitlab/sv/gitaly/log/run] updated file contents /opt/gitlab/sv/gitaly/log/run

      - update content in file /opt/gitlab/sv/gitaly/log/run from none to 209571
      --- /opt/gitlab/sv/gitaly/log/run 2024-03-06 19:59:36.173065438 +0000
      +++ /opt/gitlab/sv/gitaly/log/.chef-run20240306-34-kl4smp 2024-03-06 19:59:36.173065438 +0000
      @@ -1,5 +1,10 @@
      +#!/bin/sh
      +exec chpst -P \
      +  -U root:root \
      +  -u root:root \
      +  svlogd /var/log/gitlab/gitaly[2024-03-06T19:59:36+00:00] INFO: template[/opt/gitlab/sv/gitaly/log/run] owner changed to 0
[2024-03-06T19:59:36+00:00] INFO: template[/opt/gitlab/sv/gitaly/log/run] group changed to 0
[2024-03-06T19:59:36+00:00] INFO: template[/opt/gitlab/sv/gitaly/log/run] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/gitaly/env] action create[2024-03-06T19:59:36+00:00] INFO: directory[/opt/gitlab/sv/gitaly/env] created directory /opt/gitlab/sv/gitaly/env

      - create new directory /opt/gitlab/sv/gitaly/env[2024-03-06T19:59:36+00:00] INFO: directory[/opt/gitlab/sv/gitaly/env] owner changed to 0
[2024-03-06T19:59:36+00:00] INFO: directory[/opt/gitlab/sv/gitaly/env] group changed to 0
[2024-03-06T19:59:36+00:00] INFO: directory[/opt/gitlab/sv/gitaly/env] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * ruby_block[Delete unmanaged env files for gitaly service] action run (skipped due to only_if)
    * template[/opt/gitlab/sv/gitaly/check] action create (skipped due to only_if)
    * template[/opt/gitlab/sv/gitaly/finish] action create (skipped due to only_if)
    * directory[/opt/gitlab/sv/gitaly/control] action create[2024-03-06T19:59:36+00:00] INFO: directory[/opt/gitlab/sv/gitaly/control] created directory /opt/gitlab/sv/gitaly/control

      - create new directory /opt/gitlab/sv/gitaly/control[2024-03-06T19:59:36+00:00] INFO: directory[/opt/gitlab/sv/gitaly/control] owner changed to 0
[2024-03-06T19:59:36+00:00] INFO: directory[/opt/gitlab/sv/gitaly/control] group changed to 0
[2024-03-06T19:59:36+00:00] INFO: directory[/opt/gitlab/sv/gitaly/control] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * link[/opt/gitlab/init/gitaly] action create[2024-03-06T19:59:36+00:00] INFO: link[/opt/gitlab/init/gitaly] created

      - create symlink at /opt/gitlab/init/gitaly to /opt/gitlab/embedded/bin/sv
    * file[/opt/gitlab/sv/gitaly/down] action nothing (skipped due to action :nothing)
[2024-03-06T19:59:36+00:00] INFO: template[/opt/gitlab/sv/gitaly/run] sending run action to ruby_block[restart_service] (delayed)
    * ruby_block[restart_service] action run (skipped due to only_if)
[2024-03-06T19:59:36+00:00] INFO: template[/opt/gitlab/sv/gitaly/log/config] sending create action to ruby_block[reload_log_service] (delayed)
    * ruby_block[reload_log_service] action create
      * ruby_block[restart_service] action nothing (skipped due to action :nothing)
      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/sv/gitaly] action create (up to date)
      * template[/opt/gitlab/sv/gitaly/run] action create (up to date)
      * directory[/opt/gitlab/sv/gitaly/log] action create (up to date)
      * directory[/opt/gitlab/sv/gitaly/log/main] action create (up to date)
      * template[/opt/gitlab/sv/gitaly/log/config] action create (up to date)
      * ruby_block[verify_chown_persisted_on_gitaly] action nothing (skipped due to action :nothing)
      * link[/var/log/gitlab/gitaly/config] action create (up to date)
      * template[/opt/gitlab/sv/gitaly/log/run] action create (up to date)
      * directory[/opt/gitlab/sv/gitaly/env] action create (up to date)
      * ruby_block[Delete unmanaged env files for gitaly service] action run (skipped due to only_if)
      * template[/opt/gitlab/sv/gitaly/check] action create (skipped due to only_if)
      * template[/opt/gitlab/sv/gitaly/finish] action create (skipped due to only_if)
      * directory[/opt/gitlab/sv/gitaly/control] action create (up to date)
      * link[/opt/gitlab/init/gitaly] action create (up to date)
      * file[/opt/gitlab/sv/gitaly/down] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/service] action create (up to date)
      * link[/opt/gitlab/service/gitaly] action create[2024-03-06T19:59:36+00:00] INFO: link[/opt/gitlab/service/gitaly] created

        - create symlink at /opt/gitlab/service/gitaly to /opt/gitlab/sv/gitaly
      * ruby_block[wait for gitaly service socket] action run[2024-03-06T19:59:40+00:00] INFO: ruby_block[wait for gitaly service socket] called

        - execute the ruby block wait for gitaly service socket
      * file[/var/log/gitlab/gitaly/current] action touch (skipped due to only_if)
[2024-03-06T19:59:41+00:00] INFO: ruby_block[reload_log_service] called
      - execute the ruby block reload_log_service
[2024-03-06T19:59:41+00:00] INFO: template[/opt/gitlab/sv/gitaly/log/run] sending run action to ruby_block[restart_log_service] (delayed)
    * ruby_block[restart_log_service] action run
      * ruby_block[restart_service] action nothing (skipped due to action :nothing)
      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/sv/gitaly] action create (up to date)
      * template[/opt/gitlab/sv/gitaly/run] action create (up to date)
      * directory[/opt/gitlab/sv/gitaly/log] action create (up to date)
      * directory[/opt/gitlab/sv/gitaly/log/main] action create (up to date)
      * template[/opt/gitlab/sv/gitaly/log/config] action create (up to date)
      * ruby_block[verify_chown_persisted_on_gitaly] action nothing (skipped due to action :nothing)
      * link[/var/log/gitlab/gitaly/config] action create (up to date)
      * template[/opt/gitlab/sv/gitaly/log/run] action create (up to date)
      * directory[/opt/gitlab/sv/gitaly/env] action create (up to date)
      * ruby_block[Delete unmanaged env files for gitaly service] action run (skipped due to only_if)
      * template[/opt/gitlab/sv/gitaly/check] action create (skipped due to only_if)
      * template[/opt/gitlab/sv/gitaly/finish] action create (skipped due to only_if)
      * directory[/opt/gitlab/sv/gitaly/control] action create (up to date)
      * link[/opt/gitlab/init/gitaly] action create (up to date)
      * file[/opt/gitlab/sv/gitaly/down] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/service] action create (up to date)
      * link[/opt/gitlab/service/gitaly] action create (up to date)
      * ruby_block[wait for gitaly service socket] action run (skipped due to not_if)
      * file[/var/log/gitlab/gitaly/current] action touch (skipped due to only_if)
[2024-03-06T19:59:41+00:00] INFO: ruby_block[restart_log_service] called
      - execute the ruby block restart_log_service
    * directory[/opt/gitlab/service] action create (up to date)
    * link[/opt/gitlab/service/gitaly] action create (up to date)
    * ruby_block[wait for gitaly service socket] action run (skipped due to not_if)
    * file[/var/log/gitlab/gitaly/current] action touch (skipped due to only_if)
  
  * execute[/opt/gitlab/bin/gitlab-ctl start gitaly] action run
    [execute] ok: run: gitaly: (pid 538) 3s
[2024-03-06T19:59:42+00:00] INFO: execute[/opt/gitlab/bin/gitlab-ctl start gitaly] ran successfully
    - execute /opt/gitlab/bin/gitlab-ctl start gitaly
  * version_file[Create version file for Gitaly] action create
    * file[/var/opt/gitlab/gitaly/VERSION] action create[2024-03-06T19:59:43+00:00] INFO: file[/var/opt/gitlab/gitaly/VERSION] created file /var/opt/gitlab/gitaly/VERSION

      - create new file /var/opt/gitlab/gitaly/VERSION[2024-03-06T19:59:43+00:00] INFO: file[/var/opt/gitlab/gitaly/VERSION] updated file contents /var/opt/gitlab/gitaly/VERSION

      - update content in file /var/opt/gitlab/gitaly/VERSION from none to a7e53d
      --- /var/opt/gitlab/gitaly/VERSION        2024-03-06 19:59:43.005647434 +0000
      +++ /var/opt/gitlab/gitaly/.chef-VERSION20240306-34-t8fisq        2024-03-06 19:59:43.005647434 +0000
      @@ -1 +1,2 @@
      +sha256:b4affe753304b87d218f8b2bf54204cd5970eabe72194a61bb9facb46f9d60d7
  
  * consul_service[gitaly] action delete
    * file[/var/opt/gitlab/consul/config.d/gitaly-service.json] action delete (up to date)
     (up to date)
Recipe: postgresql::bin
  * ruby_block[check_postgresql_version] action run (skipped due to not_if)
  * ruby_block[check_postgresql_version_is_deprecated] action run (skipped due to not_if)
  * ruby_block[Link postgresql bin files to the correct version] action run[2024-03-06T19:59:43+00:00] INFO: ruby_block[Link postgresql bin files to the correct version] called

    - execute the ruby block Link postgresql bin files to the correct version
  * template[/opt/gitlab/etc/gitlab-psql-rc] action create[2024-03-06T19:59:43+00:00] INFO: template[/opt/gitlab/etc/gitlab-psql-rc] created file /opt/gitlab/etc/gitlab-psql-rc

    - create new file /opt/gitlab/etc/gitlab-psql-rc[2024-03-06T19:59:43+00:00] INFO: template[/opt/gitlab/etc/gitlab-psql-rc] updated file contents /opt/gitlab/etc/gitlab-psql-rc

    - update content in file /opt/gitlab/etc/gitlab-psql-rc from none to b7b8fc
    - suppressed sensitive resource[2024-03-06T19:59:43+00:00] INFO: template[/opt/gitlab/etc/gitlab-psql-rc] owner changed to 0
[2024-03-06T19:59:43+00:00] INFO: template[/opt/gitlab/etc/gitlab-psql-rc] group changed to 0

    - change owner from '' to 'root'
    - change group from '' to 'root'
Recipe: postgresql::user
  * account[Postgresql user and group] action create (up to date)
  * directory[/var/opt/gitlab/postgresql] action create[2024-03-06T19:59:43+00:00] INFO: directory[/var/opt/gitlab/postgresql] mode changed to 755

    - change mode from '0750' to '0755'
  * file[/var/opt/gitlab/postgresql/.profile] action create[2024-03-06T19:59:43+00:00] INFO: file[/var/opt/gitlab/postgresql/.profile] backed up to /opt/gitlab/embedded/cookbooks/cache/backup/var/opt/gitlab/postgresql/.profile.chef-20240306195943.086837
[2024-03-06T19:59:43+00:00] INFO: file[/var/opt/gitlab/postgresql/.profile] updated file contents /var/opt/gitlab/postgresql/.profile

    - update content in file /var/opt/gitlab/postgresql/.profile from 28b4a4 to 3b0387
    --- /var/opt/gitlab/postgresql/.profile     2022-01-06 16:23:33.000000000 +0000
    +++ /var/opt/gitlab/postgresql/.chef-.profile20240306-34-oftiqq.profile     2024-03-06 19:59:43.081609434 +0000
    @@ -1,28 +1,2 @@
    -# ~/.profile: executed by the command interpreter for login shells.
    -# This file is not read by bash(1), if ~/.bash_profile or ~/.bash_login
    -# exists.
    -# see /usr/share/doc/bash/examples/startup-files for examples.
    -# the files are located in the bash-doc package.
    -
    -# the default umask is set in /etc/profile; for setting the umask
    -# for ssh logins, install and configure the libpam-umask package.
    -#umask 022
    -
    -# if running bash
    -if [ -n "$BASH_VERSION" ]; then
    -    # include .bashrc if it exists
    -    if [ -f "$HOME/.bashrc" ]; then
    -   . "$HOME/.bashrc"
    -    fi
    -fi
    -
    -# set PATH so it includes user's private bin if it exists
    -if [ -d "$HOME/bin" ] ; then
    -    PATH="$HOME/bin:$PATH"
    -fi
    -
    -# set PATH so it includes user's private bin if it exists
    -if [ -d "$HOME/.local/bin" ] ; then
    -    PATH="$HOME/.local/bin:$PATH"
    -fi
    +PATH=/opt/gitlab/embedded/bin:/opt/gitlab/bin:$PATH[2024-03-06T19:59:43+00:00] INFO: file[/var/opt/gitlab/postgresql/.profile] mode changed to 600

    - change mode from '0644' to '0600'
Recipe: postgresql::sysctl
  * gitlab_sysctl[kernel.shmmax] action create
    * directory[create /etc/sysctl.d for kernel.shmmax] action create (skipped due to only_if)
    * file[create /opt/gitlab/embedded/etc/90-omnibus-gitlab-kernel.shmmax.conf kernel.shmmax] action create (skipped due to only_if)
    * link[/etc/sysctl.d/90-omnibus-gitlab-kernel.shmmax.conf] action create (skipped due to only_if)
    * execute[load sysctl conf kernel.shmmax] action nothing (skipped due to action :nothing)
     (up to date)
  * gitlab_sysctl[kernel.shmall] action create
    * directory[create /etc/sysctl.d for kernel.shmall] action create (skipped due to only_if)
    * file[create /opt/gitlab/embedded/etc/90-omnibus-gitlab-kernel.shmall.conf kernel.shmall] action create (skipped due to only_if)
    * link[/etc/sysctl.d/90-omnibus-gitlab-kernel.shmall.conf] action create (skipped due to only_if)
    * execute[load sysctl conf kernel.shmall] action nothing (skipped due to action :nothing)
     (up to date)
  * gitlab_sysctl[kernel.sem] action create
    * directory[create /etc/sysctl.d for kernel.sem] action create (skipped due to only_if)
    * file[create /opt/gitlab/embedded/etc/90-omnibus-gitlab-kernel.sem.conf kernel.sem] action create (skipped due to only_if)
    * link[/etc/sysctl.d/90-omnibus-gitlab-kernel.sem.conf] action create (skipped due to only_if)
    * execute[load sysctl conf kernel.sem] action nothing (skipped due to action :nothing)
     (up to date)
Recipe: postgresql::enable
  * directory[/var/opt/gitlab/postgresql] action create (up to date)
  * directory[/var/opt/gitlab/postgresql/data] action create[2024-03-06T19:59:43+00:00] INFO: directory[/var/opt/gitlab/postgresql/data] created directory /var/opt/gitlab/postgresql/data

    - create new directory /var/opt/gitlab/postgresql/data[2024-03-06T19:59:43+00:00] INFO: directory[/var/opt/gitlab/postgresql/data] owner changed to 996
[2024-03-06T19:59:43+00:00] INFO: directory[/var/opt/gitlab/postgresql/data] mode changed to 700

    - change mode from '' to '0700'
    - change owner from '' to 'gitlab-psql'
  * directory[/var/opt/gitlab/postgresql/data] action create (up to date)
  * directory[/var/log/gitlab/postgresql] action create[2024-03-06T19:59:43+00:00] INFO: directory[/var/log/gitlab/postgresql] created directory /var/log/gitlab/postgresql

    - create new directory /var/log/gitlab/postgresql[2024-03-06T19:59:43+00:00] INFO: directory[/var/log/gitlab/postgresql] owner changed to 996
[2024-03-06T19:59:43+00:00] INFO: directory[/var/log/gitlab/postgresql] mode changed to 700

    - change mode from '' to '0700'
    - change owner from '' to 'gitlab-psql'
  * execute[/opt/gitlab/embedded/bin/initdb -D /var/opt/gitlab/postgresql/data -E UTF8] action run
    [execute] The files belonging to this database system will be owned by user "gitlab-psql".
              This user must also own the server process.
              
              The database cluster will be initialized with locale "C.UTF-8".
              The default text search configuration will be set to "english".
              
              Data page checksums are disabled.
              
              fixing permissions on existing directory /var/opt/gitlab/postgresql/data ... ok
              creating subdirectories ... ok
              selecting dynamic shared memory implementation ... posix
              selecting default max_connections ... 100
              selecting default shared_buffers ... 128MB
              selecting default time zone ... Etc/UTC
              creating configuration files ... ok
              running bootstrap script ... ok
              performing post-bootstrap initialization ... ok
              syncing data to disk ... ok
              
              
              Success. You can now start the database server using:
              
                  /opt/gitlab/embedded/bin/pg_ctl -D /var/opt/gitlab/postgresql/data -l logfile start
              
              initdb: warning: enabling "trust" authentication for local connections
              You can change this by editing pg_hba.conf or using the option -A, or
              --auth-local and --auth-host, the next time you run initdb.
[2024-03-06T19:59:44+00:00] INFO: execute[/opt/gitlab/embedded/bin/initdb -D /var/opt/gitlab/postgresql/data -E UTF8] ran successfully
    - execute /opt/gitlab/embedded/bin/initdb -D /var/opt/gitlab/postgresql/data -E UTF8
  * file[/var/opt/gitlab/postgresql/data/server.crt] action create[2024-03-06T19:59:44+00:00] INFO: file[/var/opt/gitlab/postgresql/data/server.crt] created file /var/opt/gitlab/postgresql/data/server.crt

    - create new file /var/opt/gitlab/postgresql/data/server.crt[2024-03-06T19:59:44+00:00] INFO: file[/var/opt/gitlab/postgresql/data/server.crt] updated file contents /var/opt/gitlab/postgresql/data/server.crt

    - update content in file /var/opt/gitlab/postgresql/data/server.crt from none to 0d91b4
    - suppressed sensitive resource[2024-03-06T19:59:44+00:00] INFO: file[/var/opt/gitlab/postgresql/data/server.crt] owner changed to 996
[2024-03-06T19:59:44+00:00] INFO: file[/var/opt/gitlab/postgresql/data/server.crt] group changed to 996
[2024-03-06T19:59:44+00:00] INFO: file[/var/opt/gitlab/postgresql/data/server.crt] mode changed to 400

    - change mode from '' to '0400'
    - change owner from '' to 'gitlab-psql'
    - change group from '' to 'gitlab-psql'
  * file[/var/opt/gitlab/postgresql/data/server.key] action create[2024-03-06T19:59:44+00:00] INFO: file[/var/opt/gitlab/postgresql/data/server.key] created file /var/opt/gitlab/postgresql/data/server.key

    - create new file /var/opt/gitlab/postgresql/data/server.key[2024-03-06T19:59:44+00:00] INFO: file[/var/opt/gitlab/postgresql/data/server.key] updated file contents /var/opt/gitlab/postgresql/data/server.key

    - update content in file /var/opt/gitlab/postgresql/data/server.key from none to 35d50b
    - suppressed sensitive resource[2024-03-06T19:59:44+00:00] INFO: file[/var/opt/gitlab/postgresql/data/server.key] owner changed to 996
[2024-03-06T19:59:44+00:00] INFO: file[/var/opt/gitlab/postgresql/data/server.key] group changed to 996
[2024-03-06T19:59:44+00:00] INFO: file[/var/opt/gitlab/postgresql/data/server.key] mode changed to 400

    - change mode from '' to '0400'
    - change owner from '' to 'gitlab-psql'
    - change group from '' to 'gitlab-psql'
  * postgresql_config[gitlab] action create
    * template[/var/opt/gitlab/postgresql/data/postgresql.conf] action create[2024-03-06T19:59:44+00:00] INFO: template[/var/opt/gitlab/postgresql/data/postgresql.conf] backed up to /opt/gitlab/embedded/cookbooks/cache/backup/var/opt/gitlab/postgresql/data/postgresql.conf.chef-20240306195944.505414
[2024-03-06T19:59:44+00:00] INFO: template[/var/opt/gitlab/postgresql/data/postgresql.conf] updated file contents /var/opt/gitlab/postgresql/data/postgresql.conf

      - update content in file /var/opt/gitlab/postgresql/data/postgresql.conf from 245ccc to 5d4143
      --- /var/opt/gitlab/postgresql/data/postgresql.conf       2024-03-06 19:59:43.165567434 +0000
      +++ /var/opt/gitlab/postgresql/data/.chef-postgresql20240306-34-kupmze.conf       2024-03-06 19:59:44.472913433 +0000
      @@ -1,3 +1,7 @@
      +# This file is managed by gitlab-ctl. Manual changes will be
      +# erased! To change the contents below, edit /etc/gitlab/gitlab.rb
      +# and run `sudo gitlab-ctl reconfigure`.
      +
       # -----------------------------
       # PostgreSQL configuration file
       # -----------------------------
      @@ -16,19 +20,18 @@
       #
       # This file is read on server startup and when the server receives a SIGHUP
       # signal.  If you edit the file on a running system, you have to SIGHUP the
      -# server for the changes to take effect, run "pg_ctl reload", or execute
      -# "SELECT pg_reload_conf()".  Some parameters, which are marked below,
      -# require a server shutdown and restart to take effect.
      +# server for the changes to take effect, or use "pg_ctl reload".  Some
      +# parameters, which are marked below, require a server shutdown and restart to
      +# take effect.
       #
       # Any parameter can also be given as a command-line option to the server, e.g.,
       # "postgres -c log_connections=on".  Some parameters can be changed at run time
       # with the "SET" SQL command.
       #
      -# Memory units:  B  = bytes            Time units:  us  = microseconds
      -#                kB = kilobytes                     ms  = milliseconds
      +# Memory units:  kB = kilobytes        Time units:  ms  = milliseconds
       #                MB = megabytes                     s   = seconds
       #                GB = gigabytes                     min = minutes
      -#                TB = terabytes                     h   = hours
      +#                                                   h   = hours
       #                                                   d   = days
       
       
      @@ -39,16 +42,16 @@
       # The default values of these variables are driven from the -D command-line
       # option or PGDATA environment variable, represented here as ConfigDir.
       
      -#data_directory = 'ConfigDir'            # use data in another directory
      -                                 # (change requires restart)
      -#hba_file = 'ConfigDir/pg_hba.conf'      # host-based authentication file
      -                                 # (change requires restart)
      -#ident_file = 'ConfigDir/pg_ident.conf'  # ident configuration file
      -                                 # (change requires restart)
      +#data_directory = 'ConfigDir'   # use data in another directory
      +          # (change requires restart)
      +#hba_file = 'ConfigDir/pg_hba.conf' # host-based authentication file
      +          # (change requires restart)
      +#ident_file = 'ConfigDir/pg_ident.conf' # ident configuration file
      +          # (change requires restart)
       
       # If external_pid_file is not explicitly set, no extra PID file is written.
      -#external_pid_file = ''                  # write an extra PID file
      -                                 # (change requires restart)
      +#external_pid_file = '(none)'   # write an extra PID file
      +          # (change requires restart)
       
       
       #------------------------------------------------------------------------------
      @@ -57,60 +60,57 @@
       
       # - Connection Settings -
       
      -#listen_addresses = 'localhost'          # what IP address(es) to listen on;
      -                                 # comma-separated list of addresses;
      -                                 # defaults to 'localhost'; use '*' for all
      -                                 # (change requires restart)
      -#port = 5432                             # (change requires restart)
      -max_connections = 100                    # (change requires restart)
      -#superuser_reserved_connections = 3      # (change requires restart)
      -#unix_socket_directories = '/tmp'        # comma-separated list of directories
      -                                 # (change requires restart)
      -#unix_socket_group = ''                  # (change requires restart)
      -#unix_socket_permissions = 0777          # begin with 0 to use octal notation
      -                                 # (change requires restart)
      -#bonjour = off                           # advertise server via Bonjour
      -                                 # (change requires restart)
      -#bonjour_name = ''                       # defaults to the computer name
      -                                 # (change requires restart)
      +listen_addresses = ''    # what IP address(es) to listen on;
      +          # comma-separated list of addresses;
      +          # defaults to 'localhost', '*' = all
      +          # (change requires restart)
      +port = 5432        # (change requires restart)
      +max_connections = 400      # (change requires restart)
      +# Note:  Increasing max_connections costs ~400 bytes of shared memory per
      +# connection slot, plus lock space (see max_locks_per_transaction).
      +#superuser_reserved_connections = 3 # (change requires restart)
      +unix_socket_directories = '/var/opt/gitlab/postgresql'   # (change requires restart)
      +#unix_socket_group = ''     # (change requires restart)
      +#unix_socket_permissions = 0777   # begin with 0 to use octal notation
      +          # (change requires restart)
      +#bonjour = off        # advertise server via Bonjour
      +          # (change requires restart)
      +#bonjour_name = ''      # defaults to the computer name
      +          # (change requires restart)
       
      -# - TCP settings -
      -# see "man tcp" for details
      +# - Security and Authentication -
       
      -#tcp_keepalives_idle = 0         # TCP_KEEPIDLE, in seconds;
      -                                 # 0 selects the system default
      -#tcp_keepalives_interval = 0             # TCP_KEEPINTVL, in seconds;
      -                                 # 0 selects the system default
      -#tcp_keepalives_count = 0                # TCP_KEEPCNT;
      -                                 # 0 selects the system default
      -#tcp_user_timeout = 0                    # TCP_USER_TIMEOUT, in milliseconds;
      -                                 # 0 selects the system default
      +#authentication_timeout = 1min    # 1s-600s
       
      -# - Authentication -
      +# change requires restart
      +ssl = on
       
      -#authentication_timeout = 1min           # 1s-600s
      -#password_encryption = md5               # md5 or scram-sha-256
      +# allowed SSL ciphers
      +ssl_ciphers = 'HIGH:MEDIUM:+3DES:!aNULL:!SSLv3:!TLSv1'
      +
      +ssl_cert_file = 'server.crt'
      +ssl_key_file = 'server.key'
      +ssl_ca_file = '/opt/gitlab/embedded/ssl/certs/cacert.pem'
      +
      +
      +#ssl_renegotiation_limit = 512MB  # amount of data between renegotiations
      +#password_encryption = on
       #db_user_namespace = off
       
      -# GSSAPI using Kerberos
      -#krb_server_keyfile = 'FILE:${sysconfdir}/krb5.keytab'
      +# Kerberos and GSSAPI
      +#krb_server_keyfile = ''
      +#krb_srvname = 'postgres'   # (Kerberos only)
       #krb_caseins_users = off
       
      -# - SSL -
      +# - TCP Keepalives -
      +# see "man 7 tcp" for details
       
      -#ssl = off
      -#ssl_ca_file = ''
      -#ssl_cert_file = 'server.crt'
      -#ssl_crl_file = ''
      -#ssl_key_file = 'server.key'
      -#ssl_ciphers = 'HIGH:MEDIUM:+3DES:!aNULL' # allowed SSL ciphers
      -#ssl_prefer_server_ciphers = on
      -#ssl_ecdh_curve = 'prime256v1'
      -#ssl_min_protocol_version = 'TLSv1.2'
      -#ssl_max_protocol_version = ''
      -#ssl_dh_params_file = ''
      -#ssl_passphrase_command = ''
      -#ssl_passphrase_command_supports_reload = off
      +#tcp_keepalives_idle = 0    # TCP_KEEPIDLE, in seconds;
      +          # 0 selects the system default
      +#tcp_keepalives_interval = 0    # TCP_KEEPINTVL, in seconds;
      +          # 0 selects the system default
      +#tcp_keepalives_count = 0   # TCP_KEEPCNT;
      +          # 0 selects the system default
       
       
       #------------------------------------------------------------------------------
      @@ -119,233 +119,105 @@
       
       # - Memory -
       
      -shared_buffers = 128MB                   # min 128kB
      -                                 # (change requires restart)
      -#huge_pages = try                        # on, off, or try
      -                                 # (change requires restart)
      -#temp_buffers = 8MB                      # min 800kB
      -#max_prepared_transactions = 0           # zero disables the feature
      -                                 # (change requires restart)
      -# Caution: it is not advisable to set max_prepared_transactions nonzero unless
      -# you actively intend to use prepared transactions.
      -#work_mem = 4MB                          # min 64kB
      -#hash_mem_multiplier = 1.0               # 1-1000.0 multiplier on hash table work_mem
      -#maintenance_work_mem = 64MB             # min 1MB
      -#autovacuum_work_mem = -1                # min 1MB, or -1 to use maintenance_work_mem
      -#logical_decoding_work_mem = 64MB        # min 64kB
      -#max_stack_depth = 2MB                   # min 100kB
      -#shared_memory_type = mmap               # the default is the first option
      -                                 # supported by the operating system:
      -                                 #   mmap
      -                                 #   sysv
      -                                 #   windows
      -                                 # (change requires restart)
      -dynamic_shared_memory_type = posix       # the default is the first option
      -                                 # supported by the operating system:
      -                                 #   posix
      -                                 #   sysv
      -                                 #   windows
      -                                 #   mmap
      -                                 # (change requires restart)
      +shared_buffers = 1MB # min 128kB
      +          # (change requires restart)
      +#temp_buffers = 8MB     # min 800kB
      +#max_prepared_transactions = 0    # zero disables the feature
      +          # (change requires restart)
      +# Note:  Increasing max_prepared_transactions costs ~600 bytes of shared memory
      +# per transaction slot, plus lock space (see max_locks_per_transaction).
      +# It is not advisable to set max_prepared_transactions nonzero unless you
      +# actively intend to use prepared transactions.
      +#max_stack_depth = 2MB      # min 100kB
       
      -# - Disk -
      +# - Kernel Resource Usage -
       
      -#temp_file_limit = -1                    # limits per-process temp file space
      -                                 # in kilobytes, or -1 for no limit
      +#max_files_per_process = 1000   # min 25
      +          # (change requires restart)
      +shared_preload_libraries = ''    # (change requires restart)
       
      -# - Kernel Resources -
      -
      -#max_files_per_process = 1000            # min 64
      -                                 # (change requires restart)
      -
       # - Cost-Based Vacuum Delay -
       
      -#vacuum_cost_delay = 0                   # 0-100 milliseconds (0 disables)
      -#vacuum_cost_page_hit = 1                # 0-10000 credits
      -#vacuum_cost_page_miss = 10              # 0-10000 credits
      -#vacuum_cost_page_dirty = 20             # 0-10000 credits
      -#vacuum_cost_limit = 200         # 1-10000 credits
      +#vacuum_cost_delay = 0ms    # 0-100 milliseconds
      +#vacuum_cost_page_hit = 1   # 0-10000 credits
      +#vacuum_cost_page_miss = 10   # 0-10000 credits
      +#vacuum_cost_page_dirty = 20    # 0-10000 credits
      +#vacuum_cost_limit = 200    # 1-10000 credits
       
       # - Background Writer -
       
      -#bgwriter_delay = 200ms                  # 10-10000ms between rounds
      -#bgwriter_lru_maxpages = 100             # max buffers written/round, 0 disables
      -#bgwriter_lru_multiplier = 2.0           # 0-10.0 multiplier on buffers scanned/round
      -#bgwriter_flush_after = 512kB            # measured in pages, 0 disables
      +#bgwriter_delay = 200ms     # 10-10000ms between rounds
      +#bgwriter_lru_maxpages = 100    # 0-1000 max buffers written/round
      +#bgwriter_lru_multiplier = 2.0    # 0-10.0 multipler on buffers scanned/round
       
       # - Asynchronous Behavior -
       
      -#effective_io_concurrency = 1            # 1-1000; 0 disables prefetching
      -#maintenance_io_concurrency = 10 # 1-1000; 0 disables prefetching
      -#max_worker_processes = 8                # (change requires restart)
      -#max_parallel_maintenance_workers = 2    # taken from max_parallel_workers
      -#max_parallel_workers_per_gather = 2     # taken from max_parallel_workers
      -#parallel_leader_participation = on
      -#max_parallel_workers = 8                # maximum number of max_worker_processes that
      -                                 # can be used in parallel operations
      -#old_snapshot_threshold = -1             # 1min-60d; -1 disables; 0 is immediate
      -                                 # (change requires restart)
      -#backend_flush_after = 0         # measured in pages, 0 disables
      +#effective_io_concurrency = 1   # 1-1000. 0 disables prefetching
       
       
       #------------------------------------------------------------------------------
      -# WRITE-AHEAD LOG
      +# WRITE AHEAD LOG
       #------------------------------------------------------------------------------
       
       # - Settings -
       
      -#wal_level = replica                     # minimal, replica, or logical
      -                                 # (change requires restart)
      -#fsync = on                              # flush data to disk for crash safety
      -                                 # (turning this off can cause
      -                                 # unrecoverable data corruption)
      -#synchronous_commit = on         # synchronization level;
      -                                 # off, local, remote_write, remote_apply, or on
      -#wal_sync_method = fsync         # the default is the first option
      -                                 # supported by the operating system:
      -                                 #   open_datasync
      -                                 #   fdatasync (default on Linux and FreeBSD)
      -                                 #   fsync
      -                                 #   fsync_writethrough
      -                                 #   open_sync
      -#full_page_writes = on                   # recover from partial page writes
      -#wal_compression = off                   # enable compression of full-page writes
      -#wal_log_hints = off                     # also do full page writes of non-critical updates
      -                                 # (change requires restart)
      -#wal_init_zero = on                      # zero-fill new WAL files
      -#wal_recycle = on                        # recycle WAL files
      -#wal_buffers = -1                        # min 32kB, -1 sets based on shared_buffers
      -                                 # (change requires restart)
      -#wal_writer_delay = 200ms                # 1-10000 milliseconds
      -#wal_writer_flush_after = 1MB            # measured in pages, 0 disables
      -#wal_skip_threshold = 2MB
      +wal_level = minimal
      +wal_log_hints = off      # also do full page writes of non-critical updates
      +          # (change requires restart)
      +#fsync = on       # turns forced synchronization on or off
      +#wal_sync_method = fsync    # the default is the first option
      +          # supported by the operating system:
      +          #   open_datasync
      +          #   fdatasync (default on Linux)
      +          #   fsync
      +          #   fsync_writethrough
      +          #   open_sync
      +#full_page_writes = on      # recover from partial page writes
      +wal_buffers = -1 # -1     # min 32kB, -1 sets based on shared_buffers
      +          # (change requires restart)
      +#wal_writer_delay = 200ms   # 1-10000 milliseconds
       
      -#commit_delay = 0                        # range 0-100000, in microseconds
      -#commit_siblings = 5                     # range 1-1000
      +#commit_delay = 0     # range 0-100000, in microseconds
      +#commit_siblings = 5      # range 1-1000
       
      -# - Checkpoints -
      -
      -#checkpoint_timeout = 5min               # range 30s-1d
      -max_wal_size = 1GB
       min_wal_size = 80MB
      -#checkpoint_completion_target = 0.5      # checkpoint target duration, 0.0 - 1.0
      -#checkpoint_flush_after = 256kB          # measured in pages, 0 disables
      -#checkpoint_warning = 30s                # 0 disables
      +max_wal_size = 1GB
       
      -# - Archiving -
      +# The number of replication slots to reserve.
      +max_replication_slots = 0
       
      -#archive_mode = off              # enables archiving; off, on, or always
      -                         # (change requires restart)
      -#archive_command = ''            # command to use to archive a logfile segment
      -                         # placeholders: %p = path of file to archive
      -                         #               %f = file name only
      -                         # e.g. 'test ! -f /mnt/server/archivedir/%f && cp %p /mnt/server/archivedir/%f'
      -#archive_timeout = 0             # force a logfile segment switch after this
      -                         # number of seconds; 0 disables
       
      -# - Archive Recovery -
      +# - Archiving -
       
      -# These are only used in recovery mode.
      +archive_mode = off   # allows archiving to be done
      +        # (change requires restart, also requires 'wal_level' of 'hot_standby' OR 'replica')
       
      -#restore_command = ''            # command to use to restore an archived logfile segment
      -                         # placeholders: %p = path of file to restore
      -                         #               %f = file name only
      -                         # e.g. 'cp /mnt/server/archivedir/%f %p'
      -                         # (change requires restart)
      -#archive_cleanup_command = ''    # command to execute at every restartpoint
      -#recovery_end_command = ''       # command to execute at completion of recovery
      -
      -# - Recovery Target -
      -
      -# Set these only when performing a targeted recovery.
      -
      -#recovery_target = ''            # 'immediate' to end recovery as soon as a
      -                                # consistent state is reached
      -                         # (change requires restart)
      -#recovery_target_name = ''       # the named restore point to which recovery will proceed
      -                         # (change requires restart)
      -#recovery_target_time = ''       # the time stamp up to which recovery will proceed
      -                         # (change requires restart)
      -#recovery_target_xid = ''        # the transaction ID up to which recovery will proceed
      -                         # (change requires restart)
      -#recovery_target_lsn = ''        # the WAL LSN up to which recovery will proceed
      -                         # (change requires restart)
      -#recovery_target_inclusive = on # Specifies whether to stop:
      -                         # just after the specified recovery target (on)
      -                         # just before the recovery target (off)
      -                         # (change requires restart)
      -#recovery_target_timeline = 'latest'     # 'current', 'latest', or timeline ID
      -                         # (change requires restart)
      -#recovery_target_action = 'pause'        # 'pause', 'promote', 'shutdown'
      -                         # (change requires restart)
      -
      -
       #------------------------------------------------------------------------------
       # REPLICATION
       #------------------------------------------------------------------------------
       
      -# - Sending Servers -
      -
      -# Set these on the master and on any standby that will send replication data.
      -
      -#max_wal_senders = 10            # max number of walsender processes
      -                         # (change requires restart)
      -#wal_keep_size = 0               # in megabytes; 0 disables
      -#max_slot_wal_keep_size = -1     # in megabytes; -1 disables
      -#wal_sender_timeout = 60s        # in milliseconds; 0 disables
      -
      -#max_replication_slots = 10      # max number of replication slots
      -                         # (change requires restart)
      -#track_commit_timestamp = off    # collect timestamp of transaction commit
      -                         # (change requires restart)
      -
       # - Master Server -
       
      -# These settings are ignored on a standby server.
      +# These settings are ignored on a standby server
       
      -#synchronous_standby_names = ''  # standby servers that provide sync rep
      -                         # method to choose sync standbys, number of sync standbys,
      -                         # and comma-separated list of application_name
      -                         # from standby(s); '*' = all
      -#vacuum_defer_cleanup_age = 0    # number of xacts by which cleanup is delayed
      +max_wal_senders = 0
      +        # (change requires restart)
      +#wal_sender_delay = 1s    # walsender cycle time, 1-10000 milliseconds
      +#vacuum_defer_cleanup_age = 0 # number of xacts by which cleanup is delayed
      +#replication_timeout = 60s  # in milliseconds; 0 disables
      +#synchronous_standby_names = '' # standby servers that provide sync rep
      +        # comma-separated list of application_name
      +        # from standby(s); '*' = all
       
       # - Standby Servers -
       
      -# These settings are ignored on a master server.
      +# These settings are ignored on a master server
       
      -#primary_conninfo = ''                   # connection string to sending server
      -#primary_slot_name = ''                  # replication slot on sending server
      -#promote_trigger_file = ''               # file name whose presence ends recovery
      -#hot_standby = on                        # "off" disallows queries during recovery
      -                                 # (change requires restart)
      -#max_standby_archive_delay = 30s # max delay before canceling queries
      -                                 # when reading WAL from archive;
      -                                 # -1 allows indefinite delay
      -#max_standby_streaming_delay = 30s       # max delay before canceling queries
      -                                 # when reading streaming WAL;
      -                                 # -1 allows indefinite delay
      -#wal_receiver_create_temp_slot = off     # create temp slot if primary_slot_name
      -                                 # is not set
      -#wal_receiver_status_interval = 10s      # send replies at least this often
      -                                 # 0 disables
      -#hot_standby_feedback = off              # send info from standby to prevent
      -                                 # query conflicts
      -#wal_receiver_timeout = 60s              # time that receiver waits for
      -                                 # communication from master
      -                                 # in milliseconds; 0 disables
      -#wal_retrieve_retry_interval = 5s        # time to wait before retrying to
      -                                 # retrieve WAL after a failed attempt
      -#recovery_min_apply_delay = 0            # minimum delay for applying changes during recovery
      +hot_standby = off
      +          # (change requires restart)
      +#wal_receiver_status_interval = 10s # send replies at least this often
      +          # 0 disables
       
      -# - Subscribers -
      -
      -# These settings are ignored on a publisher.
      -
      -#max_logical_replication_workers = 4     # taken from max_worker_processes
      -                                 # (change requires restart)
      -#max_sync_workers_per_subscription = 2   # taken from max_logical_replication_workers
      -
      -
       #------------------------------------------------------------------------------
       # QUERY TUNING
       #------------------------------------------------------------------------------
      @@ -356,237 +228,126 @@
       #enable_hashagg = on
       #enable_hashjoin = on
       #enable_indexscan = on
      -#enable_indexonlyscan = on
       #enable_material = on
       #enable_mergejoin = on
       #enable_nestloop = on
      -#enable_parallel_append = on
       #enable_seqscan = on
       #enable_sort = on
      -#enable_incremental_sort = on
       #enable_tidscan = on
      -#enable_partitionwise_join = off
      -#enable_partitionwise_aggregate = off
      -#enable_parallel_hash = on
      -#enable_partition_pruning = on
       
       # - Planner Cost Constants -
       
      -#seq_page_cost = 1.0                     # measured on an arbitrary scale
      -#random_page_cost = 4.0                  # same scale as above
      -#cpu_tuple_cost = 0.01                   # same scale as above
      -#cpu_index_tuple_cost = 0.005            # same scale as above
      -#cpu_operator_cost = 0.0025              # same scale as above
      -#parallel_tuple_cost = 0.1               # same scale as above
      -#parallel_setup_cost = 1000.0    # same scale as above
      +#cpu_tuple_cost = 0.01      # same scale as above
      +#cpu_index_tuple_cost = 0.005   # same scale as above
      +#cpu_operator_cost = 0.0025   # same scale as above
       
      -#jit_above_cost = 100000         # perform JIT compilation if available
      -                                 # and query more expensive than this;
      -                                 # -1 disables
      -#jit_inline_above_cost = 500000          # inline small functions if query is
      -                                 # more expensive than this; -1 disables
      -#jit_optimize_above_cost = 500000        # use expensive JIT optimizations if
      -                                 # query is more expensive than this;
      -                                 # -1 disables
      -
      -#min_parallel_table_scan_size = 8MB
      -#min_parallel_index_scan_size = 512kB
      -#effective_cache_size = 4GB
      -
       # - Genetic Query Optimizer -
       
       #geqo = on
       #geqo_threshold = 12
      -#geqo_effort = 5                 # range 1-10
      -#geqo_pool_size = 0                      # selects default based on effort
      -#geqo_generations = 0                    # selects default based on effort
      -#geqo_selection_bias = 2.0               # range 1.5-2.0
      -#geqo_seed = 0.0                 # range 0.0-1.0
      +#geqo_effort = 5      # range 1-10
      +#geqo_pool_size = 0     # selects default based on effort
      +#geqo_generations = 0     # selects default based on effort
      +#geqo_selection_bias = 2.0    # range 1.5-2.0
      +#geqo_seed = 0.0      # range 0.0-1.0
       
       # - Other Planner Options -
       
      -#default_statistics_target = 100 # range 1-10000
      -#constraint_exclusion = partition        # on, off, or partition
      -#cursor_tuple_fraction = 0.1             # range 0.0-1.0
      +#default_statistics_target = 100  # range 1-10000
      +#constraint_exclusion = partition # on, off, or partition
      +#cursor_tuple_fraction = 0.1    # range 0.0-1.0
       #from_collapse_limit = 8
      -#join_collapse_limit = 8         # 1 disables collapsing of explicit
      -                                 # JOIN clauses
      -#force_parallel_mode = off
      -#jit = on                                # allow JIT compilation
      -#plan_cache_mode = auto                  # auto, force_generic_plan or
      -                                 # force_custom_plan
      +#join_collapse_limit = 8    # 1 disables collapsing of explicit
      +          # JOIN clauses
       
       
       #------------------------------------------------------------------------------
      -# REPORTING AND LOGGING
      +# ERROR REPORTING AND LOGGING
       #------------------------------------------------------------------------------
       
      -# - Where to Log -
       
      -#log_destination = 'stderr'              # Valid values are combinations of
      -                                 # stderr, csvlog, syslog, and eventlog,
      -                                 # depending on platform.  csvlog
      -                                 # requires logging_collector to be on.
      -
      -# This is used when logging to stderr:
      -#logging_collector = off         # Enable capturing of stderr and csvlog
      -                                 # into log files. Required to be on for
      -                                 # csvlogs.
      -                                 # (change requires restart)
      -
      -# These are only used if logging_collector is on:
      -#log_directory = 'log'                   # directory where log files are written,
      -                                 # can be absolute or relative to PGDATA
      -#log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log' # log file name pattern,
      -                                 # can include strftime() escapes
      -#log_file_mode = 0600                    # creation mode for log files,
      -                                 # begin with 0 to use octal notation
      -#log_truncate_on_rotation = off          # If on, an existing log file with the
      -                                 # same name as the new log file will be
      -                                 # truncated rather than appended to.
      -                                 # But such truncation only occurs on
      -                                 # time-driven rotation, not on restarts
      -                                 # or size-driven rotation.  Default is
      -                                 # off, meaning append to existing files
      -                                 # in all cases.
      -#log_rotation_age = 1d                   # Automatic rotation of logfiles will
      -                                 # happen after that time.  0 disables.
      -#log_rotation_size = 10MB                # Automatic rotation of logfiles will
      -                                 # happen after that much log output.
      -                                 # 0 disables.
      -
       # These are relevant when logging to syslog:
       #syslog_facility = 'LOCAL0'
       #syslog_ident = 'postgres'
      -#syslog_sequence_numbers = on
      -#syslog_split_messages = on
       
      -# This is only relevant when logging to eventlog (win32):
      -# (change requires restart)
      -#event_source = 'PostgreSQL'
      +#silent_mode = off      # Run server silently.
      +          # DO NOT USE without syslog or
      +          # logging_collector
      +          # (change requires restart)
       
      +
       # - When to Log -
       
      -#log_min_messages = warning              # values in order of decreasing detail:
      -                                 #   debug5
      -                                 #   debug4
      -                                 #   debug3
      -                                 #   debug2
      -                                 #   debug1
      -                                 #   info
      -                                 #   notice
      -                                 #   warning
      -                                 #   error
      -                                 #   log
      -                                 #   fatal
      -                                 #   panic
      +#client_min_messages = notice   # values in order of decreasing detail:
      +          #   debug5
      +          #   debug4
      +          #   debug3
      +          #   debug2
      +          #   debug1
      +          #   log
      +          #   notice
      +          #   warning
      +          #   error
       
      -#log_min_error_statement = error # values in order of decreasing detail:
      -                                 #   debug5
      -                                 #   debug4
      -                                 #   debug3
      -                                 #   debug2
      -                                 #   debug1
      -                                 #   info
      -                                 #   notice
      -                                 #   warning
      -                                 #   error
      -                                 #   log
      -                                 #   fatal
      -                                 #   panic (effectively off)
      +#log_min_messages = warning   # values in order of decreasing detail:
      +          #   debug5
      +          #   debug4
      +          #   debug3
      +          #   debug2
      +          #   debug1
      +          #   info
      +          #   notice
      +          #   warning
      +          #   error
      +          #   log
      +          #   fatal
      +          #   panic
       
      -#log_min_duration_statement = -1 # -1 is disabled, 0 logs all statements
      -                                 # and their durations, > 0 logs only
      -                                 # statements running at least this number
      -                                 # of milliseconds
      +#log_min_error_statement = error  # values in order of decreasing detail:
      +          #   debug5
      +          #   debug4
      +          #   debug3
      +          #   debug2
      +          #   debug1
      +          #   info
      +          #   notice
      +          #   warning
      +          #   error
      +          #   log
      +          #   fatal
      +          #   panic (effectively off)
       
      -#log_min_duration_sample = -1            # -1 is disabled, 0 logs a sample of statements
      -                                 # and their durations, > 0 logs only a sample of
      -                                 # statements running at least this number
      -                                 # of milliseconds;
      -                                 # sample fraction is determined by log_statement_sample_rate
      -
      -#log_statement_sample_rate = 1.0 # fraction of logged statements exceeding
      -                                 # log_min_duration_sample to be logged;
      -                                 # 1.0 logs all such statements, 0.0 never logs
      -
      -
      -#log_transaction_sample_rate = 0.0       # fraction of transactions whose statements
      -                                 # are logged regardless of their duration; 1.0 logs all
      -                                 # statements from all transactions, 0.0 never logs
      -
       # - What to Log -
       
       #debug_print_parse = off
       #debug_print_rewritten = off
       #debug_print_plan = off
       #debug_pretty_print = on
      -#log_checkpoints = off
       #log_connections = off
       #log_disconnections = off
       #log_duration = off
      -#log_error_verbosity = default           # terse, default, or verbose messages
      +#log_error_verbosity = default    # terse, default, or verbose messages
       #log_hostname = off
      -#log_line_prefix = '%m [%p] '            # special values:
      -                                 #   %a = application name
      -                                 #   %u = user name
      -                                 #   %d = database name
      -                                 #   %r = remote host and port
      -                                 #   %h = remote host
      -                                 #   %b = backend type
      -                                 #   %p = process ID
      -                                 #   %t = timestamp without milliseconds
      -                                 #   %m = timestamp with milliseconds
      -                                 #   %n = timestamp with milliseconds (as a Unix epoch)
      -                                 #   %i = command tag
      -                                 #   %e = SQL state
      -                                 #   %c = session ID
      -                                 #   %l = session line number
      -                                 #   %s = session start timestamp
      -                                 #   %v = virtual transaction ID
      -                                 #   %x = transaction ID (0 if none)
      -                                 #   %q = stop here in non-session
      -                                 #        processes
      -                                 #   %% = '%'
      -                                 # e.g. '<%u%%%d> '
      -#log_lock_waits = off                    # log lock waits >= deadlock_timeout
      -#log_parameter_max_length = -1           # when logging statements, limit logged
      -                                 # bind-parameter values to N bytes;
      -                                 # -1 means print in full, 0 disables
      -#log_parameter_max_length_on_error = 0   # when logging an error, limit logged
      -                                 # bind-parameter values to N bytes;
      -                                 # -1 means print in full, 0 disables
      -#log_statement = 'none'                  # none, ddl, mod, all
      -#log_replication_commands = off
      -#log_temp_files = -1                     # log temporary files equal or larger
      -                                 # than the specified size in kilobytes;
      -                                 # -1 disables, 0 logs all temp files
      -log_timezone = 'Etc/UTC'
      +#log_lock_waits = off     # log lock waits >= deadlock_timeout
      +#log_statement = 'none'     # none, ddl, mod, all
      +#log_timezone = '(defaults to server environment setting)'
       
      -#------------------------------------------------------------------------------
      -# PROCESS TITLE
      -#------------------------------------------------------------------------------
       
      -#cluster_name = ''                       # added to process titles if nonempty
      -                                 # (change requires restart)
      -#update_process_title = on
      -
      -
       #------------------------------------------------------------------------------
      -# STATISTICS
      +# RUNTIME STATISTICS
       #------------------------------------------------------------------------------
       
      -# - Query and Index Statistics Collector -
      +# - Query/Index Statistics Collector -
       
       #track_activities = on
       #track_counts = on
      -#track_io_timing = off
      -#track_functions = none                  # none, pl, all
      -#track_activity_query_size = 1024        # (change requires restart)
      +#track_functions = none     # none, pl, all
      +track_activity_query_size = 1024 # (change requires restart)
      +#update_process_title = on
       #stats_temp_directory = 'pg_stat_tmp'
       
       
      -# - Monitoring -
      +# - Statistics Monitoring -
       
       #log_parser_stats = off
       #log_planner_stats = off
      @@ -595,122 +356,53 @@
       
       
       #------------------------------------------------------------------------------
      -# AUTOVACUUM
      +# AUTOVACUUM PARAMETERS
       #------------------------------------------------------------------------------
       
      -#autovacuum = on                 # Enable autovacuum subprocess?  'on'
      -                                 # requires track_counts to also be on.
      -#log_autovacuum_min_duration = -1        # -1 disables, 0 logs all actions and
      -                                 # their durations, > 0 logs only
      -                                 # actions running at least this number
      -                                 # of milliseconds.
      -#autovacuum_max_workers = 3              # max number of autovacuum subprocesses
      -                                 # (change requires restart)
      -#autovacuum_naptime = 1min               # time between autovacuum runs
      -#autovacuum_vacuum_threshold = 50        # min number of row updates before
      -                                 # vacuum
      -#autovacuum_vacuum_insert_threshold = 1000       # min number of row inserts
      -                                 # before vacuum; -1 disables insert
      -                                 # vacuums
      -#autovacuum_analyze_threshold = 50       # min number of row updates before
      -                                 # analyze
      -#autovacuum_vacuum_scale_factor = 0.2    # fraction of table size before vacuum
      -#autovacuum_vacuum_insert_scale_factor = 0.2     # fraction of inserts over table
      -                                 # size before insert vacuum
      -#autovacuum_analyze_scale_factor = 0.1   # fraction of table size before analyze
      -#autovacuum_freeze_max_age = 200000000   # maximum XID age before forced vacuum
      -                                 # (change requires restart)
      -#autovacuum_multixact_freeze_max_age = 400000000 # maximum multixact age
      -                                 # before forced vacuum
      -                                 # (change requires restart)
      -#autovacuum_vacuum_cost_delay = 2ms      # default vacuum cost delay for
      -                                 # autovacuum, in milliseconds;
      -                                 # -1 means use vacuum_cost_delay
      -#autovacuum_vacuum_cost_limit = -1       # default vacuum cost limit for
      -                                 # autovacuum, -1 means use
      -                                 # vacuum_cost_limit
      -
      -
      +autovacuum_max_workers = 3 # max number of autovacuum subprocesses
      +          # (change requires restart)
      +autovacuum_freeze_max_age = 200000000  # maximum XID age before forced vacuum
      +          # (change requires restart)
       #------------------------------------------------------------------------------
       # CLIENT CONNECTION DEFAULTS
       #------------------------------------------------------------------------------
       
       # - Statement Behavior -
       
      -#client_min_messages = notice            # values in order of decreasing detail:
      -                                 #   debug5
      -                                 #   debug4
      -                                 #   debug3
      -                                 #   debug2
      -                                 #   debug1
      -                                 #   log
      -                                 #   notice
      -                                 #   warning
      -                                 #   error
      -#search_path = '"$user", public' # schema names
      -#row_security = on
      -#default_tablespace = ''         # a tablespace name, '' uses the default
      -#temp_tablespaces = ''                   # a list of tablespace names, '' uses
      -                                 # only default tablespace
      -#default_table_access_method = 'heap'
      +#search_path = '"$user",public'   # schema names
      +#default_tablespace = ''    # a tablespace name, '' uses the default
      +#temp_tablespaces = ''      # a list of tablespace names, '' uses
      +          # only default tablespace
       #check_function_bodies = on
       #default_transaction_isolation = 'read committed'
       #default_transaction_read_only = off
       #default_transaction_deferrable = off
       #session_replication_role = 'origin'
      -#statement_timeout = 0                   # in milliseconds, 0 is disabled
      -#lock_timeout = 0                        # in milliseconds, 0 is disabled
      -#idle_in_transaction_session_timeout = 0 # in milliseconds, 0 is disabled
       #vacuum_freeze_min_age = 50000000
       #vacuum_freeze_table_age = 150000000
      -#vacuum_multixact_freeze_min_age = 5000000
      -#vacuum_multixact_freeze_table_age = 150000000
      -#vacuum_cleanup_index_scale_factor = 0.1 # fraction of total number of tuples
      -                                         # before index cleanup, 0 always performs
      -                                         # index cleanup
      -#bytea_output = 'hex'                    # hex, escape
      +#bytea_output = 'hex'     # hex, escape
       #xmlbinary = 'base64'
       #xmloption = 'content'
      -#gin_fuzzy_search_limit = 0
      -#gin_pending_list_limit = 4MB
       
       # - Locale and Formatting -
       
      -datestyle = 'iso, mdy'
       #intervalstyle = 'postgres'
      -timezone = 'Etc/UTC'
      +#timezone = '(defaults to server environment setting)'
       #timezone_abbreviations = 'Default'     # Select the set of available time zone
      -                                 # abbreviations.  Currently, there are
      -                                 #   Default
      -                                 #   Australia (historical usage)
      -                                 #   India
      -                                 # You can create your own file in
      -                                 # share/timezonesets/.
      -#extra_float_digits = 1                  # min -15, max 3; any value >0 actually
      -                                 # selects precise output mode
      -#client_encoding = sql_ascii             # actually, defaults to database
      -                                 # encoding
      +          # abbreviations.  Currently, there are
      +          #   Default
      +          #   Australia
      +          #   India
      +          # You can create your own file in
      +          # share/timezonesets/.
      +#extra_float_digits = 0     # min -15, max 3
      +#client_encoding = sql_ascii    # actually, defaults to database
      +          # encoding
       
      -# These settings are initialized by initdb, but they can be changed.
      -lc_messages = 'C.UTF-8'                  # locale for system error message
      -                                 # strings
      -lc_monetary = 'C.UTF-8'                  # locale for monetary formatting
      -lc_numeric = 'C.UTF-8'                   # locale for number formatting
      -lc_time = 'C.UTF-8'                              # locale for time formatting
      -
      -# default configuration for text search
      -default_text_search_config = 'pg_catalog.english'
      -
      -# - Shared Library Preloading -
      -
      -#shared_preload_libraries = ''   # (change requires restart)
      -#local_preload_libraries = ''
      -#session_preload_libraries = ''
      -#jit_provider = 'llvmjit'                # JIT library to use
      -
       # - Other Defaults -
       
       #dynamic_library_path = '$libdir'
      +#local_preload_libraries = ''
       
       
       #------------------------------------------------------------------------------
      @@ -718,28 +410,27 @@
       #------------------------------------------------------------------------------
       
       #deadlock_timeout = 1s
      -#max_locks_per_transaction = 64          # min 10
      -                                 # (change requires restart)
      -#max_pred_locks_per_transaction = 64     # min 10
      -                                 # (change requires restart)
      -#max_pred_locks_per_relation = -2        # negative values mean
      -                                 # (max_pred_locks_per_transaction
      -                                 #  / -max_pred_locks_per_relation) - 1
      -#max_pred_locks_per_page = 2            # min 0
      +max_locks_per_transaction = 128   # min 10
      +          # (change requires restart)
      +# Note:  Each lock table slot uses ~270 bytes of shared memory, and there are
      +# max_locks_per_transaction * (max_connections + max_prepared_transactions)
      +# lock table slots.
      +#max_pred_locks_per_transaction = 64  # min 10
      +          # (change requires restart)
       
      -
       #------------------------------------------------------------------------------
      -# VERSION AND PLATFORM COMPATIBILITY
      +# VERSION/PLATFORM COMPATIBILITY
       #------------------------------------------------------------------------------
       
       # - Previous PostgreSQL Versions -
       
       #array_nulls = on
      -#backslash_quote = safe_encoding # on, off, or safe_encoding
      +#backslash_quote = safe_encoding  # on, off, or safe_encoding
      +#default_with_oids = off
       #escape_string_warning = on
       #lo_compat_privileges = off
      -#operator_precedence_warning = off
       #quote_all_identifiers = off
      +#sql_inheritance = on
       #standard_conforming_strings = on
       #synchronize_seqscans = on
       
      @@ -752,30 +443,15 @@
       # ERROR HANDLING
       #------------------------------------------------------------------------------
       
      -#exit_on_error = off                     # terminate session on any error?
      -#restart_after_crash = on                # reinitialize after backend crash?
      -#data_sync_retry = off                   # retry or panic on failure to fsync
      -                                 # data?
      -                                 # (change requires restart)
      +#exit_on_error = off        # terminate session on any error?
      +#restart_after_crash = on     # reinitialize after backend crash?
       
       
       #------------------------------------------------------------------------------
      -# CONFIG FILE INCLUDES
      -#------------------------------------------------------------------------------
      -
      -# These options allow settings to be loaded from files other than the
      -# default postgresql.conf.  Note that these are directives, not variable
      -# assignments, so they can usefully be given more than once.
      -
      -#include_dir = '...'                     # include files ending in '.conf' from
      -                                 # a directory, e.g., 'conf.d'
      -#include_if_exists = '...'               # include file only if it exists
      -#include = '...'                 # include file
      -
      -
      -#------------------------------------------------------------------------------
       # CUSTOMIZED OPTIONS
       #------------------------------------------------------------------------------
       
      -# Add settings for extensions here
      +#custom_variable_classes = ''   # list of custom variable class names
      +
      +include 'runtime.conf'[2024-03-06T19:59:44+00:00] INFO: template[/var/opt/gitlab/postgresql/data/postgresql.conf] mode changed to 644

      - change mode from '0600' to '0644'
    * template[/var/opt/gitlab/postgresql/data/runtime.conf] action create[2024-03-06T19:59:44+00:00] INFO: template[/var/opt/gitlab/postgresql/data/runtime.conf] created file /var/opt/gitlab/postgresql/data/runtime.conf

      - create new file /var/opt/gitlab/postgresql/data/runtime.conf[2024-03-06T19:59:44+00:00] INFO: template[/var/opt/gitlab/postgresql/data/runtime.conf] updated file contents /var/opt/gitlab/postgresql/data/runtime.conf

      - update content in file /var/opt/gitlab/postgresql/data/runtime.conf from none to 7cab33
      --- /var/opt/gitlab/postgresql/data/runtime.conf  2024-03-06 19:59:44.520889434 +0000
      +++ /var/opt/gitlab/postgresql/data/.chef-runtime20240306-34-3szdb0.conf  2024-03-06 19:59:44.520889434 +0000
      @@ -1,134 +1,268 @@
      +# This file is managed by gitlab-ctl. Manual changes will be
      +# erased! To change the contents below, edit /etc/gitlab/gitlab.rb
      +# and run `sudo gitlab-ctl reconfigure`.
      +
      +# Changing variables in this file should only require a reload of PostgreSQL
      +# As the gitlab-psql user, run:
      +# /opt/gitlab/embedded/bin/pg_ctl reload -D /var/opt/gitlab/postgresql/data
      +work_mem = 16MB                          # min 64kB
      +maintenance_work_mem = 16MB # 16MB    # min 1MB
      +synchronous_commit = on # synchronization level; on, off, or local
      +synchronous_standby_names = ''
      +
      +# - Checkpoints -
      +min_wal_size = 80MB
      +max_wal_size = 1GB
      +
      +checkpoint_timeout = 5min                # range 30s-1h, default 5min
      +checkpoint_completion_target = 0.9       # checkpoint target duration, 0.0 - 1.0, default 0.5
      +checkpoint_warning = 30s         # 0 disables, default 30s
      +
      +# - Logging -
      +log_directory = '/var/log/gitlab/postgresql'
      +
      +# - Archiving -
      +archive_command = ''   # command to use to archive a logfile segment
      +archive_timeout = 0    # force a logfile segment switch after this
      +        # number of seconds; 0 disables
      +
      +# - Replication
      +wal_keep_size = 160
      +
      +max_standby_archive_delay = 30s # max delay before canceling queries
      +          # when reading WAL from archive;
      +          # -1 allows indefinite delay
      +max_standby_streaming_delay = 30s # max delay before canceling queries
      +          # when reading streaming WAL;
      +          # -1 allows indefinite delay
      +
      +hot_standby_feedback = off   # send info from standby to prevent
      +          # query conflicts
      +
      +# - Planner Cost Constants -
      +#seq_page_cost = 1.0      # measured on an arbitrary scale
      +random_page_cost = 2.0     # same scale as above
      +
      +effective_cache_size = 2946MB # Default 128MB
      +
      +log_min_duration_statement = -1  # -1 is disabled, 0 logs all statements
      +          # and their durations, > 0 logs only
      +          # statements running at least this number
      +          # of milliseconds
      +
      +log_checkpoints = off
      +
      +log_line_prefix = '' # default '', special values:
      +          #   %a = application name
      +          #   %u = user name
      +          #   %d = database name
      +          #   %r = remote host and port
      +          #   %h = remote host
      +          #   %p = process ID
      +          #   %t = timestamp without milliseconds
      +          #   %m = timestamp with milliseconds
      +          #   %i = command tag
      +          #   %e = SQL state
      +          #   %c = session ID
      +          #   %l = session line number
      +          #   %s = session start timestamp
      +          #   %v = virtual transaction ID
      +          #   %x = transaction ID (0 if none)
      +          #   %q = stop here in non-session
      +          #        processes
      +          #   %% = '%'
      +
      +log_temp_files = -1      # log temporary files equal or larger
      +          # than the specified size in kilobytes;
      +          # -1 disables, 0 logs all temp files
      +
      +
      +# - Autovacuum parameters -
      +autovacuum = on # Enable autovacuum subprocess?  'on'
      +          # requires track_counts to also be on.
      +
      +log_autovacuum_min_duration = -1 # -1 disables, 0 logs all actions and
      +          # their durations, > 0 logs only
      +          # actions running at least this number
      +          # of milliseconds.
      +
      +autovacuum_naptime = 1min # time between autovacuum runs
      +autovacuum_vacuum_threshold = 50 # min number of row updates before
      +          # vacuum
      +autovacuum_analyze_threshold = 50 # min number of row updates before
      +          # analyze
      +autovacuum_vacuum_scale_factor = 0.02 # fraction of table size before vacuum
      +autovacuum_analyze_scale_factor = 0.01 # fraction of table size before analyze
      +autovacuum_vacuum_cost_delay = 20ms # default vacuum cost delay for
      +          # autovacuum, in milliseconds;
      +          # -1 means use vacuum_cost_delay
      +autovacuum_vacuum_cost_limit = -1 # default vacuum cost limit for
      +          # autovacuum, -1 means use
      +          # vacuum_cost_limit
      +
      +# Parameters for gathering statistics
      +default_statistics_target = 1000
      +
      +# - Client connection timeouts
      +statement_timeout = 60000
      +
      +idle_in_transaction_session_timeout = 60000
      +
      +# IO settings
      +effective_io_concurrency = 1
      +track_io_timing = 'off'
      +
      +# Parallel worker settings
      +max_worker_processes = 8
      +max_parallel_workers_per_gather = 0
      +
      +# Deadlock handling and logging
      +deadlock_timeout = '5s'
      +log_lock_waits = 1
      +
      +# - Locale and Formatting -
      +datestyle = 'iso, mdy'
      +
      +# These settings are initialized by initdb, but they can be changed.
      +lc_messages = 'C'     # locale for system error message
      +          # strings
      +lc_monetary = 'C'     # locale for monetary formatting
      +lc_numeric = 'C'      # locale for number formatting
      +lc_time = 'C'       # locale for time formatting
      +
      +# default configuration for text search
      +default_text_search_config = 'pg_catalog.english'[2024-03-06T19:59:44+00:00] INFO: template[/var/opt/gitlab/postgresql/data/runtime.conf] owner changed to 996
[2024-03-06T19:59:44+00:00] INFO: template[/var/opt/gitlab/postgresql/data/runtime.conf] mode changed to 644

      - change mode from '' to '0644'
      - change owner from '' to 'gitlab-psql'
    * template[/var/opt/gitlab/postgresql/data/pg_hba.conf] action create[2024-03-06T19:59:44+00:00] INFO: template[/var/opt/gitlab/postgresql/data/pg_hba.conf] backed up to /opt/gitlab/embedded/cookbooks/cache/backup/var/opt/gitlab/postgresql/data/pg_hba.conf.chef-20240306195944.553793
[2024-03-06T19:59:44+00:00] INFO: template[/var/opt/gitlab/postgresql/data/pg_hba.conf] updated file contents /var/opt/gitlab/postgresql/data/pg_hba.conf

      - update content in file /var/opt/gitlab/postgresql/data/pg_hba.conf from 98c8d4 to 40e348
      --- /var/opt/gitlab/postgresql/data/pg_hba.conf   2024-03-06 19:59:43.165567434 +0000
      +++ /var/opt/gitlab/postgresql/data/.chef-pg_hba20240306-34-pxcwip.conf   2024-03-06 19:59:44.536881433 +0000
      @@ -1,98 +1,74 @@
      +# This file is managed by gitlab-ctl. Manual changes will be
      +# erased! To change the contents below, edit /etc/gitlab/gitlab.rb
      +# and run `sudo gitlab-ctl reconfigure`.
      +
       # PostgreSQL Client Authentication Configuration File
       # ===================================================
       #
      -# Refer to the "Client Authentication" section in the PostgreSQL
      -# documentation for a complete description of this file.  A short
      -# synopsis follows.
      +# Refer to the "Client Authentication" section in the
      +# PostgreSQL documentation for a complete description
      +# of this file.  A short synopsis follows.
       #
       # This file controls: which hosts are allowed to connect, how clients
       # are authenticated, which PostgreSQL user names they can use, which
       # databases they can access.  Records take one of these forms:
       #
      -# local         DATABASE  USER  METHOD  [OPTIONS]
      -# host          DATABASE  USER  ADDRESS  METHOD  [OPTIONS]
      -# hostssl       DATABASE  USER  ADDRESS  METHOD  [OPTIONS]
      -# hostnossl     DATABASE  USER  ADDRESS  METHOD  [OPTIONS]
      -# hostgssenc    DATABASE  USER  ADDRESS  METHOD  [OPTIONS]
      -# hostnogssenc  DATABASE  USER  ADDRESS  METHOD  [OPTIONS]
      +# local      DATABASE  USER  METHOD  [OPTION]
      +# host       DATABASE  USER  CIDR-ADDRESS  METHOD  [OPTION]
      +# hostssl    DATABASE  USER  CIDR-ADDRESS  METHOD  [OPTION]
      +# hostnossl  DATABASE  USER  CIDR-ADDRESS  METHOD  [OPTION]
       #
       # (The uppercase items must be replaced by actual values.)
       #
      -# The first field is the connection type: "local" is a Unix-domain
      -# socket, "host" is either a plain or SSL-encrypted TCP/IP socket,
      -# "hostssl" is an SSL-encrypted TCP/IP socket, and "hostnossl" is a
      -# non-SSL TCP/IP socket.  Similarly, "hostgssenc" uses a
      -# GSSAPI-encrypted TCP/IP socket, while "hostnogssenc" uses a
      -# non-GSSAPI socket.
      +# The first field is the connection type: "local" is a Unix-domain socket,
      +# "host" is either a plain or SSL-encrypted TCP/IP socket, "hostssl" is an
      +# SSL-encrypted TCP/IP socket, and "hostnossl" is a plain TCP/IP socket.
       #
      -# DATABASE can be "all", "sameuser", "samerole", "replication", a
      -# database name, or a comma-separated list thereof. The "all"
      -# keyword does not match "replication". Access to replication
      -# must be enabled in a separate record (see example below).
      +# DATABASE can be "all", "sameuser", "samerole", a database name, or
      +# a comma-separated list thereof.
       #
      -# USER can be "all", a user name, a group name prefixed with "+", or a
      -# comma-separated list thereof.  In both the DATABASE and USER fields
      -# you can also write a file name prefixed with "@" to include names
      -# from a separate file.
      +# USER can be "all", a user name, a group name prefixed with "+", or
      +# a comma-separated list thereof.  In both the DATABASE and USER fields
      +# you can also write a file name prefixed with "@" to include names from
      +# a separate file.
       #
      -# ADDRESS specifies the set of hosts the record matches.  It can be a
      -# host name, or it is made up of an IP address and a CIDR mask that is
      -# an integer (between 0 and 32 (IPv4) or 128 (IPv6) inclusive) that
      -# specifies the number of significant bits in the mask.  A host name
      -# that starts with a dot (.) matches a suffix of the actual host name.
      -# Alternatively, you can write an IP address and netmask in separate
      -# columns to specify the set of hosts.  Instead of a CIDR-address, you
      -# can write "samehost" to match any of the server's own IP addresses,
      -# or "samenet" to match any address in any subnet that the server is
      -# directly connected to.
      +# CIDR-ADDRESS specifies the set of hosts the record matches.
      +# It is made up of an IP address and a CIDR mask that is an integer
      +# (between 0 and 32 (IPv4) or 128 (IPv6) inclusive) that specifies
      +# the number of significant bits in the mask.  Alternatively, you can write
      +# an IP address and netmask in separate columns to specify the set of hosts.
       #
      -# METHOD can be "trust", "reject", "md5", "password", "scram-sha-256",
      -# "gss", "sspi", "ident", "peer", "pam", "ldap", "radius" or "cert".
      -# Note that "password" sends passwords in clear text; "md5" or
      -# "scram-sha-256" are preferred since they send encrypted passwords.
      +# METHOD can be "trust", "reject", "md5", "crypt", "password", "gss", "sspi",
      +# "krb5", "ident", "pam" or "ldap".  Note that "password" sends passwords
      +# in clear text; "md5" is preferred since it sends encrypted passwords.
       #
      -# OPTIONS are a set of options for the authentication in the format
      -# NAME=VALUE.  The available options depend on the different
      -# authentication methods -- refer to the "Client Authentication"
      -# section in the documentation for a list of which options are
      -# available for which authentication methods.
      +# OPTION is the ident map or the name of the PAM service, depending on METHOD.
       #
      -# Database and user names containing spaces, commas, quotes and other
      -# special characters must be quoted.  Quoting one of the keywords
      -# "all", "sameuser", "samerole" or "replication" makes the name lose
      -# its special character, and just match a database or username with
      -# that name.
      +# Database and user names containing spaces, commas, quotes and other special
      +# characters must be quoted. Quoting one of the keywords "all", "sameuser" or
      +# "samerole" makes the name lose its special character, and just match a
      +# database or username with that name.
       #
      -# This file is read on server startup and when the server receives a
      -# SIGHUP signal.  If you edit the file on a running system, you have to
      -# SIGHUP the server for the changes to take effect, run "pg_ctl reload",
      -# or execute "SELECT pg_reload_conf()".
      -#
      +# This file is read on server startup and when the postmaster receives
      +# a SIGHUP signal.  If you edit the file on a running system, you have
      +# to SIGHUP the postmaster for the changes to take effect.  You can use
      +# "pg_ctl reload" to do that.
      +
       # Put your actual configuration here
       # ----------------------------------
       #
       # If you want to allow non-local connections, you need to add more
      -# "host" records.  In that case you will also need to make PostgreSQL
      -# listen on a non-local interface via the listen_addresses
      -# configuration parameter, or via the -i or -h command line switches.
      +# "host" records. In that case you will also need to make PostgreSQL listen
      +# on a non-local interface via the listen_addresses configuration parameter,
      +# or via the -i or -h command line switches.
      +#
       
      -# CAUTION: Configuring the system for local "trust" authentication
      -# allows any local user to connect as any PostgreSQL user, including
      -# the database superuser.  If you do not trust all your local users,
      -# use another authentication method.
       
      +# TYPE  DATABASE    USER        CIDR-ADDRESS          METHOD
       
      -# TYPE  DATABASE        USER            ADDRESS                 METHOD
      -
       # "local" is for Unix domain socket connections only
      -local   all             all                                     trust
      -# IPv4 local connections:
      -host    all             all             127.0.0.1/32            trust
      -# IPv6 local connections:
      -host    all             all             ::1/128                 trust
      -# Allow replication connections from localhost, by a user with the
      -# replication privilege.
      -local   replication     all                                     trust
      -host    replication     all             127.0.0.1/32            trust
      -host    replication     all             ::1/128                 trust
      +local   all         all                               peer map=gitlab
      +
      +
      +[2024-03-06T19:59:44+00:00] INFO: template[/var/opt/gitlab/postgresql/data/pg_hba.conf] mode changed to 644

      - change mode from '0600' to '0644'
    * template[/var/opt/gitlab/postgresql/data/pg_ident.conf] action create[2024-03-06T19:59:44+00:00] INFO: template[/var/opt/gitlab/postgresql/data/pg_ident.conf] backed up to /opt/gitlab/embedded/cookbooks/cache/backup/var/opt/gitlab/postgresql/data/pg_ident.conf.chef-20240306195944.570190
[2024-03-06T19:59:44+00:00] INFO: template[/var/opt/gitlab/postgresql/data/pg_ident.conf] updated file contents /var/opt/gitlab/postgresql/data/pg_ident.conf

      - update content in file /var/opt/gitlab/postgresql/data/pg_ident.conf from 297f46 to 5399a1
      --- /var/opt/gitlab/postgresql/data/pg_ident.conf 2024-03-06 19:59:43.165567434 +0000
      +++ /var/opt/gitlab/postgresql/data/.chef-pg_ident20240306-34-v16h1x.conf 2024-03-06 19:59:44.556871434 +0000
      @@ -40,4 +40,8 @@
       # ----------------------------------
       
       # MAPNAME       SYSTEM-USERNAME         PG-USERNAME
      +gitlab  git  gitlab
      +gitlab  mattermost  gitlab_mattermost
      +# Default to a 1-1 mapping between system usernames and Postgres usernames
      +gitlab  /^(.*)$  \1[2024-03-06T19:59:44+00:00] INFO: template[/var/opt/gitlab/postgresql/data/pg_ident.conf] mode changed to 644

      - change mode from '0600' to '0644'
  
Recipe: postgresql::standalone
  * service[postgresql] action nothing (skipped due to action :nothing)
  * runit_service[postgresql] action enable
    * ruby_block[restart_service] action nothing (skipped due to action :nothing)
    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
    * directory[/opt/gitlab/sv/postgresql] action create[2024-03-06T19:59:44+00:00] INFO: directory[/opt/gitlab/sv/postgresql] created directory /opt/gitlab/sv/postgresql

      - create new directory /opt/gitlab/sv/postgresql[2024-03-06T19:59:44+00:00] INFO: directory[/opt/gitlab/sv/postgresql] owner changed to 0
[2024-03-06T19:59:44+00:00] INFO: directory[/opt/gitlab/sv/postgresql] group changed to 0
[2024-03-06T19:59:44+00:00] INFO: directory[/opt/gitlab/sv/postgresql] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * template[/opt/gitlab/sv/postgresql/run] action create[2024-03-06T19:59:44+00:00] INFO: template[/opt/gitlab/sv/postgresql/run] created file /opt/gitlab/sv/postgresql/run

      - create new file /opt/gitlab/sv/postgresql/run[2024-03-06T19:59:44+00:00] INFO: template[/opt/gitlab/sv/postgresql/run] updated file contents /opt/gitlab/sv/postgresql/run

      - update content in file /opt/gitlab/sv/postgresql/run from none to dc5689
      --- /opt/gitlab/sv/postgresql/run 2024-03-06 19:59:44.584857433 +0000
      +++ /opt/gitlab/sv/postgresql/.chef-run20240306-34-9va90t 2024-03-06 19:59:44.584857433 +0000
      @@ -1,4 +1,8 @@
      +#!/bin/sh
      +exec 2>&1
      +
      +exec chpst -P -U gitlab-psql:gitlab-psql -u gitlab-psql:gitlab-psql /opt/gitlab/embedded/bin/postgres -D /var/opt/gitlab/postgresql/data[2024-03-06T19:59:44+00:00] INFO: template[/opt/gitlab/sv/postgresql/run] owner changed to 0
[2024-03-06T19:59:44+00:00] INFO: template[/opt/gitlab/sv/postgresql/run] group changed to 0
[2024-03-06T19:59:44+00:00] INFO: template[/opt/gitlab/sv/postgresql/run] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/postgresql/log] action create[2024-03-06T19:59:44+00:00] INFO: directory[/opt/gitlab/sv/postgresql/log] created directory /opt/gitlab/sv/postgresql/log

      - create new directory /opt/gitlab/sv/postgresql/log[2024-03-06T19:59:44+00:00] INFO: directory[/opt/gitlab/sv/postgresql/log] owner changed to 0
[2024-03-06T19:59:44+00:00] INFO: directory[/opt/gitlab/sv/postgresql/log] group changed to 0
[2024-03-06T19:59:44+00:00] INFO: directory[/opt/gitlab/sv/postgresql/log] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/postgresql/log/main] action create[2024-03-06T19:59:44+00:00] INFO: directory[/opt/gitlab/sv/postgresql/log/main] created directory /opt/gitlab/sv/postgresql/log/main

      - create new directory /opt/gitlab/sv/postgresql/log/main[2024-03-06T19:59:44+00:00] INFO: directory[/opt/gitlab/sv/postgresql/log/main] owner changed to 0
[2024-03-06T19:59:44+00:00] INFO: directory[/opt/gitlab/sv/postgresql/log/main] group changed to 0
[2024-03-06T19:59:44+00:00] INFO: directory[/opt/gitlab/sv/postgresql/log/main] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * template[/opt/gitlab/sv/postgresql/log/config] action create[2024-03-06T19:59:44+00:00] INFO: template[/opt/gitlab/sv/postgresql/log/config] created file /opt/gitlab/sv/postgresql/log/config

      - create new file /opt/gitlab/sv/postgresql/log/config[2024-03-06T19:59:44+00:00] INFO: template[/opt/gitlab/sv/postgresql/log/config] updated file contents /opt/gitlab/sv/postgresql/log/config

      - update content in file /opt/gitlab/sv/postgresql/log/config from none to 623c00
      --- /opt/gitlab/sv/postgresql/log/config  2024-03-06 19:59:44.616841433 +0000
      +++ /opt/gitlab/sv/postgresql/log/.chef-config20240306-34-pf689w  2024-03-06 19:59:44.616841433 +0000
      @@ -1,6 +1,12 @@
      +s209715200
      +n30
      +t86400
      +!gzip
      +
      +[2024-03-06T19:59:44+00:00] INFO: template[/opt/gitlab/sv/postgresql/log/config] owner changed to 0
[2024-03-06T19:59:44+00:00] INFO: template[/opt/gitlab/sv/postgresql/log/config] group changed to 0
[2024-03-06T19:59:44+00:00] INFO: template[/opt/gitlab/sv/postgresql/log/config] mode changed to 644

      - change mode from '' to '0644'
      - change owner from '' to 'root'
      - change group from '' to 'root'
[2024-03-06T19:59:44+00:00] INFO: template[/opt/gitlab/sv/postgresql/log/config] sending create action to ruby_block[verify_chown_persisted_on_postgresql] (immediate)
    * ruby_block[verify_chown_persisted_on_postgresql] action create[2024-03-06T19:59:44+00:00] INFO: ruby_block[verify_chown_persisted_on_postgresql] called

      - execute the ruby block verify_chown_persisted_on_postgresql
    * ruby_block[verify_chown_persisted_on_postgresql] action nothing (skipped due to action :nothing)
    * link[/var/log/gitlab/postgresql/config] action create[2024-03-06T19:59:44+00:00] INFO: link[/var/log/gitlab/postgresql/config] created

      - create symlink at /var/log/gitlab/postgresql/config to /opt/gitlab/sv/postgresql/log/config
    * template[/opt/gitlab/sv/postgresql/log/run] action create[2024-03-06T19:59:44+00:00] INFO: template[/opt/gitlab/sv/postgresql/log/run] created file /opt/gitlab/sv/postgresql/log/run

      - create new file /opt/gitlab/sv/postgresql/log/run[2024-03-06T19:59:44+00:00] INFO: template[/opt/gitlab/sv/postgresql/log/run] updated file contents /opt/gitlab/sv/postgresql/log/run

      - update content in file /opt/gitlab/sv/postgresql/log/run from none to 9c7bfd
      --- /opt/gitlab/sv/postgresql/log/run     2024-03-06 19:59:44.628835433 +0000
      +++ /opt/gitlab/sv/postgresql/log/.chef-run20240306-34-nb4u4y     2024-03-06 19:59:44.628835433 +0000
      @@ -1,5 +1,10 @@
      +#!/bin/sh
      +exec chpst -P \
      +  -U root:root \
      +  -u root:root \
      +  svlogd -tt /var/log/gitlab/postgresql[2024-03-06T19:59:44+00:00] INFO: template[/opt/gitlab/sv/postgresql/log/run] owner changed to 0
[2024-03-06T19:59:44+00:00] INFO: template[/opt/gitlab/sv/postgresql/log/run] group changed to 0
[2024-03-06T19:59:44+00:00] INFO: template[/opt/gitlab/sv/postgresql/log/run] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/postgresql/env] action create[2024-03-06T19:59:44+00:00] INFO: directory[/opt/gitlab/sv/postgresql/env] created directory /opt/gitlab/sv/postgresql/env

      - create new directory /opt/gitlab/sv/postgresql/env[2024-03-06T19:59:44+00:00] INFO: directory[/opt/gitlab/sv/postgresql/env] owner changed to 0
[2024-03-06T19:59:44+00:00] INFO: directory[/opt/gitlab/sv/postgresql/env] group changed to 0
[2024-03-06T19:59:44+00:00] INFO: directory[/opt/gitlab/sv/postgresql/env] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * ruby_block[Delete unmanaged env files for postgresql service] action run (skipped due to only_if)
    * template[/opt/gitlab/sv/postgresql/check] action create (skipped due to only_if)
    * template[/opt/gitlab/sv/postgresql/finish] action create (skipped due to only_if)
    * directory[/opt/gitlab/sv/postgresql/control] action create[2024-03-06T19:59:44+00:00] INFO: directory[/opt/gitlab/sv/postgresql/control] created directory /opt/gitlab/sv/postgresql/control

      - create new directory /opt/gitlab/sv/postgresql/control[2024-03-06T19:59:44+00:00] INFO: directory[/opt/gitlab/sv/postgresql/control] owner changed to 0
[2024-03-06T19:59:44+00:00] INFO: directory[/opt/gitlab/sv/postgresql/control] group changed to 0
[2024-03-06T19:59:44+00:00] INFO: directory[/opt/gitlab/sv/postgresql/control] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * template[/opt/gitlab/sv/postgresql/control/t] action create[2024-03-06T19:59:44+00:00] INFO: template[/opt/gitlab/sv/postgresql/control/t] created file /opt/gitlab/sv/postgresql/control/t

      - create new file /opt/gitlab/sv/postgresql/control/t[2024-03-06T19:59:44+00:00] INFO: template[/opt/gitlab/sv/postgresql/control/t] updated file contents /opt/gitlab/sv/postgresql/control/t

      - update content in file /opt/gitlab/sv/postgresql/control/t from none to 05ae12
      --- /opt/gitlab/sv/postgresql/control/t   2024-03-06 19:59:44.644827433 +0000
      +++ /opt/gitlab/sv/postgresql/control/.chef-t20240306-34-u3i71q   2024-03-06 19:59:44.644827433 +0000
      @@ -1,3 +1,6 @@
      +#!/bin/sh
      +echo "received TERM from runit, sending INT instead to force quit connections"
      +/opt/gitlab/embedded/bin/sv interrupt postgresql[2024-03-06T19:59:44+00:00] INFO: template[/opt/gitlab/sv/postgresql/control/t] owner changed to 0
[2024-03-06T19:59:44+00:00] INFO: template[/opt/gitlab/sv/postgresql/control/t] group changed to 0
[2024-03-06T19:59:44+00:00] INFO: template[/opt/gitlab/sv/postgresql/control/t] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * link[/opt/gitlab/init/postgresql] action create[2024-03-06T19:59:44+00:00] INFO: link[/opt/gitlab/init/postgresql] created

      - create symlink at /opt/gitlab/init/postgresql to /opt/gitlab/embedded/bin/sv
    * file[/opt/gitlab/sv/postgresql/down] action nothing (skipped due to action :nothing)
[2024-03-06T19:59:44+00:00] INFO: template[/opt/gitlab/sv/postgresql/run] sending run action to ruby_block[restart_service] (delayed)
    * ruby_block[restart_service] action run (skipped due to only_if)
[2024-03-06T19:59:44+00:00] INFO: template[/opt/gitlab/sv/postgresql/log/config] sending create action to ruby_block[reload_log_service] (delayed)
    * ruby_block[reload_log_service] action create
      * ruby_block[restart_service] action nothing (skipped due to action :nothing)
      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/sv/postgresql] action create (up to date)
      * template[/opt/gitlab/sv/postgresql/run] action create (up to date)
      * directory[/opt/gitlab/sv/postgresql/log] action create (up to date)
      * directory[/opt/gitlab/sv/postgresql/log/main] action create (up to date)
      * template[/opt/gitlab/sv/postgresql/log/config] action create (up to date)
      * ruby_block[verify_chown_persisted_on_postgresql] action nothing (skipped due to action :nothing)
      * link[/var/log/gitlab/postgresql/config] action create (up to date)
      * template[/opt/gitlab/sv/postgresql/log/run] action create (up to date)
      * directory[/opt/gitlab/sv/postgresql/env] action create (up to date)
      * ruby_block[Delete unmanaged env files for postgresql service] action run (skipped due to only_if)
      * template[/opt/gitlab/sv/postgresql/check] action create (skipped due to only_if)
      * template[/opt/gitlab/sv/postgresql/finish] action create (skipped due to only_if)
      * directory[/opt/gitlab/sv/postgresql/control] action create (up to date)
      * template[/opt/gitlab/sv/postgresql/control/t] action create (up to date)
      * link[/opt/gitlab/init/postgresql] action create (up to date)
      * file[/opt/gitlab/sv/postgresql/down] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/service] action create (up to date)
      * link[/opt/gitlab/service/postgresql] action create[2024-03-06T19:59:44+00:00] INFO: link[/opt/gitlab/service/postgresql] created

        - create symlink at /opt/gitlab/service/postgresql to /opt/gitlab/sv/postgresql
      * ruby_block[wait for postgresql service socket] action run[2024-03-06T19:59:46+00:00] INFO: ruby_block[wait for postgresql service socket] called

        - execute the ruby block wait for postgresql service socket
      * directory[/opt/gitlab/service/postgresql/supervise] action create[2024-03-06T19:59:46+00:00] INFO: directory[/opt/gitlab/service/postgresql/supervise] mode changed to 755

        - change mode from '0700' to '0755'
      * directory[/opt/gitlab/service/postgresql/log/supervise] action create[2024-03-06T19:59:46+00:00] INFO: directory[/opt/gitlab/service/postgresql/log/supervise] mode changed to 755

        - change mode from '0700' to '0755'
      * file[/opt/gitlab/service/postgresql/supervise/ok] action touch[2024-03-06T19:59:46+00:00] INFO: file[/opt/gitlab/service/postgresql/supervise/ok] created file /opt/gitlab/service/postgresql/supervise/ok

        - create new file /opt/gitlab/service/postgresql/supervise/ok[2024-03-06T19:59:46+00:00] INFO: file[/opt/gitlab/service/postgresql/supervise/ok] owner changed to 996
[2024-03-06T19:59:46+00:00] INFO: file[/opt/gitlab/service/postgresql/supervise/ok] group changed to 996

        - change owner from '' to 'gitlab-psql'
        - change group from '' to 'gitlab-psql'[2024-03-06T19:59:46+00:00] INFO: file[/opt/gitlab/service/postgresql/supervise/ok] updated atime and mtime to 2024-03-06 19:59:46 +0000

        - update utime on file /opt/gitlab/service/postgresql/supervise/ok
      * file[/opt/gitlab/service/postgresql/log/supervise/ok] action touch[2024-03-06T19:59:46+00:00] INFO: file[/opt/gitlab/service/postgresql/log/supervise/ok] created file /opt/gitlab/service/postgresql/log/supervise/ok

        - create new file /opt/gitlab/service/postgresql/log/supervise/ok[2024-03-06T19:59:46+00:00] INFO: file[/opt/gitlab/service/postgresql/log/supervise/ok] owner changed to 996
[2024-03-06T19:59:46+00:00] INFO: file[/opt/gitlab/service/postgresql/log/supervise/ok] group changed to 996

        - change owner from '' to 'gitlab-psql'
        - change group from '' to 'gitlab-psql'[2024-03-06T19:59:46+00:00] INFO: file[/opt/gitlab/service/postgresql/log/supervise/ok] updated atime and mtime to 2024-03-06 19:59:46 +0000

        - update utime on file /opt/gitlab/service/postgresql/log/supervise/ok
      * file[/opt/gitlab/service/postgresql/supervise/status] action touch[2024-03-06T19:59:46+00:00] INFO: file[/opt/gitlab/service/postgresql/supervise/status] owner changed to 996
[2024-03-06T19:59:46+00:00] INFO: file[/opt/gitlab/service/postgresql/supervise/status] group changed to 996

        - change owner from 'root' to 'gitlab-psql'
        - change group from 'root' to 'gitlab-psql'[2024-03-06T19:59:46+00:00] INFO: file[/opt/gitlab/service/postgresql/supervise/status] updated atime and mtime to 2024-03-06 19:59:46 +0000

        - update utime on file /opt/gitlab/service/postgresql/supervise/status
      * file[/opt/gitlab/service/postgresql/log/supervise/status] action touch[2024-03-06T19:59:46+00:00] INFO: file[/opt/gitlab/service/postgresql/log/supervise/status] owner changed to 996
[2024-03-06T19:59:46+00:00] INFO: file[/opt/gitlab/service/postgresql/log/supervise/status] group changed to 996

        - change owner from 'root' to 'gitlab-psql'
        - change group from 'root' to 'gitlab-psql'[2024-03-06T19:59:46+00:00] INFO: file[/opt/gitlab/service/postgresql/log/supervise/status] updated atime and mtime to 2024-03-06 19:59:46 +0000

        - update utime on file /opt/gitlab/service/postgresql/log/supervise/status
      * file[/opt/gitlab/service/postgresql/supervise/control] action touch[2024-03-06T19:59:46+00:00] INFO: file[/opt/gitlab/service/postgresql/supervise/control] created file /opt/gitlab/service/postgresql/supervise/control

        - create new file /opt/gitlab/service/postgresql/supervise/control[2024-03-06T19:59:46+00:00] INFO: file[/opt/gitlab/service/postgresql/supervise/control] owner changed to 996
[2024-03-06T19:59:46+00:00] INFO: file[/opt/gitlab/service/postgresql/supervise/control] group changed to 996

        - change owner from '' to 'gitlab-psql'
        - change group from '' to 'gitlab-psql'[2024-03-06T19:59:46+00:00] INFO: file[/opt/gitlab/service/postgresql/supervise/control] updated atime and mtime to 2024-03-06 19:59:46 +0000

        - update utime on file /opt/gitlab/service/postgresql/supervise/control
      * file[/opt/gitlab/service/postgresql/log/supervise/control] action touch[2024-03-06T19:59:46+00:00] INFO: file[/opt/gitlab/service/postgresql/log/supervise/control] created file /opt/gitlab/service/postgresql/log/supervise/control

        - create new file /opt/gitlab/service/postgresql/log/supervise/control[2024-03-06T19:59:46+00:00] INFO: file[/opt/gitlab/service/postgresql/log/supervise/control] owner changed to 996
[2024-03-06T19:59:46+00:00] INFO: file[/opt/gitlab/service/postgresql/log/supervise/control] group changed to 996

        - change owner from '' to 'gitlab-psql'
        - change group from '' to 'gitlab-psql'[2024-03-06T19:59:46+00:00] INFO: file[/opt/gitlab/service/postgresql/log/supervise/control] updated atime and mtime to 2024-03-06 19:59:46 +0000

        - update utime on file /opt/gitlab/service/postgresql/log/supervise/control
      * file[/var/log/gitlab/postgresql/current] action touch (skipped due to only_if)
[2024-03-06T19:59:48+00:00] INFO: ruby_block[reload_log_service] called
      - execute the ruby block reload_log_service
[2024-03-06T19:59:48+00:00] INFO: template[/opt/gitlab/sv/postgresql/log/run] sending run action to ruby_block[restart_log_service] (delayed)
    * ruby_block[restart_log_service] action run
      * ruby_block[restart_service] action nothing (skipped due to action :nothing)
      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/sv/postgresql] action create (up to date)
      * template[/opt/gitlab/sv/postgresql/run] action create (up to date)
      * directory[/opt/gitlab/sv/postgresql/log] action create (up to date)
      * directory[/opt/gitlab/sv/postgresql/log/main] action create (up to date)
      * template[/opt/gitlab/sv/postgresql/log/config] action create (up to date)
      * ruby_block[verify_chown_persisted_on_postgresql] action nothing (skipped due to action :nothing)
      * link[/var/log/gitlab/postgresql/config] action create (up to date)
      * template[/opt/gitlab/sv/postgresql/log/run] action create (up to date)
      * directory[/opt/gitlab/sv/postgresql/env] action create (up to date)
      * ruby_block[Delete unmanaged env files for postgresql service] action run (skipped due to only_if)
      * template[/opt/gitlab/sv/postgresql/check] action create (skipped due to only_if)
      * template[/opt/gitlab/sv/postgresql/finish] action create (skipped due to only_if)
      * directory[/opt/gitlab/sv/postgresql/control] action create (up to date)
      * template[/opt/gitlab/sv/postgresql/control/t] action create (up to date)
      * link[/opt/gitlab/init/postgresql] action create (up to date)
      * file[/opt/gitlab/sv/postgresql/down] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/service] action create (up to date)
      * link[/opt/gitlab/service/postgresql] action create (up to date)
      * ruby_block[wait for postgresql service socket] action run (skipped due to not_if)
      * directory[/opt/gitlab/service/postgresql/supervise] action create (up to date)
      * directory[/opt/gitlab/service/postgresql/log/supervise] action create (up to date)
      * file[/opt/gitlab/service/postgresql/supervise/ok] action touch (skipped due to only_if)
      * file[/opt/gitlab/service/postgresql/log/supervise/ok] action touch (skipped due to only_if)
      * file[/opt/gitlab/service/postgresql/supervise/status] action touch (skipped due to only_if)
      * file[/opt/gitlab/service/postgresql/log/supervise/status] action touch[2024-03-06T19:59:48+00:00] INFO: file[/opt/gitlab/service/postgresql/log/supervise/status] owner changed to 996
[2024-03-06T19:59:48+00:00] INFO: file[/opt/gitlab/service/postgresql/log/supervise/status] group changed to 996

        - change owner from 'root' to 'gitlab-psql'
        - change group from 'root' to 'gitlab-psql'[2024-03-06T19:59:48+00:00] INFO: file[/opt/gitlab/service/postgresql/log/supervise/status] updated atime and mtime to 2024-03-06 19:59:48 +0000

        - update utime on file /opt/gitlab/service/postgresql/log/supervise/status
      * file[/opt/gitlab/service/postgresql/supervise/control] action touch (skipped due to only_if)
      * file[/opt/gitlab/service/postgresql/log/supervise/control] action touch (skipped due to only_if)
      * file[/var/log/gitlab/postgresql/current] action touch (skipped due to only_if)
[2024-03-06T19:59:49+00:00] INFO: ruby_block[restart_log_service] called
      - execute the ruby block restart_log_service
    * directory[/opt/gitlab/service] action create (up to date)
    * link[/opt/gitlab/service/postgresql] action create (up to date)
    * ruby_block[wait for postgresql service socket] action run (skipped due to not_if)
    * directory[/opt/gitlab/service/postgresql/supervise] action create (up to date)
    * directory[/opt/gitlab/service/postgresql/log/supervise] action create (up to date)
    * file[/opt/gitlab/service/postgresql/supervise/ok] action touch (skipped due to only_if)
    * file[/opt/gitlab/service/postgresql/log/supervise/ok] action touch (skipped due to only_if)
    * file[/opt/gitlab/service/postgresql/supervise/status] action touch (skipped due to only_if)
    * file[/opt/gitlab/service/postgresql/log/supervise/status] action touch[2024-03-06T19:59:49+00:00] INFO: file[/opt/gitlab/service/postgresql/log/supervise/status] owner changed to 996
[2024-03-06T19:59:49+00:00] INFO: file[/opt/gitlab/service/postgresql/log/supervise/status] group changed to 996

      - change owner from 'root' to 'gitlab-psql'
      - change group from 'root' to 'gitlab-psql'[2024-03-06T19:59:49+00:00] INFO: file[/opt/gitlab/service/postgresql/log/supervise/status] updated atime and mtime to 2024-03-06 19:59:49 +0000

      - update utime on file /opt/gitlab/service/postgresql/log/supervise/status
    * file[/opt/gitlab/service/postgresql/supervise/control] action touch (skipped due to only_if)
    * file[/opt/gitlab/service/postgresql/log/supervise/control] action touch (skipped due to only_if)
    * file[/var/log/gitlab/postgresql/current] action touch (skipped due to only_if)
  
  * execute[/opt/gitlab/bin/gitlab-ctl start postgresql] action run
    [execute] ok: run: postgresql: (pid 586) 4s
[2024-03-06T19:59:50+00:00] INFO: execute[/opt/gitlab/bin/gitlab-ctl start postgresql] ran successfully
    - execute /opt/gitlab/bin/gitlab-ctl start postgresql
  * database_objects[postgresql] action create
    * postgresql_user[gitlab] action create
      * execute[create gitlab postgresql user] action run
        [execute] CREATE ROLE
[2024-03-06T19:59:50+00:00] INFO: execute[create gitlab postgresql user] ran successfully
        - execute /opt/gitlab/bin/gitlab-psql -d template1 -c "CREATE USER \"gitlab\""
    
    * postgresql_user[gitlab_replicator] action create
      * execute[create gitlab_replicator postgresql user] action run
        [execute] CREATE ROLE
[2024-03-06T19:59:50+00:00] INFO: execute[create gitlab_replicator postgresql user] ran successfully
        - execute /opt/gitlab/bin/gitlab-psql -d template1 -c "CREATE USER \"gitlab_replicator\""
      * execute[set options for gitlab_replicator postgresql user] action run
        [execute] ALTER ROLE
[2024-03-06T19:59:50+00:00] INFO: execute[set options for gitlab_replicator postgresql user] ran successfully
        - execute /opt/gitlab/bin/gitlab-psql -d template1 -c "ALTER USER \"gitlab_replicator\" replication"
    
    * postgresql_database[gitlabhq_production] action create
      * execute[create database gitlabhq_production] action run[2024-03-06T19:59:50+00:00] INFO: execute[create database gitlabhq_production] ran successfully

        - execute /opt/gitlab/embedded/bin/createdb --port 5432 -h /var/opt/gitlab/postgresql -O gitlab gitlabhq_production
    
    * postgresql_extension[pg_trgm] action enable
      * postgresql_query[enable pg_trgm extension] action run
        * execute[enable pg_trgm extension (postgresql)] action run
          [execute] CREATE EXTENSION
[2024-03-06T19:59:50+00:00] INFO: execute[enable pg_trgm extension (postgresql)] ran successfully
          - execute /opt/gitlab/bin/gitlab-psql -d gitlabhq_production -c "CREATE EXTENSION IF NOT EXISTS pg_trgm"
      
    
    * postgresql_extension[btree_gist] action enable
      * postgresql_query[enable btree_gist extension] action run
        * execute[enable btree_gist extension (postgresql)] action run
          [execute] CREATE EXTENSION
[2024-03-06T19:59:51+00:00] INFO: execute[enable btree_gist extension (postgresql)] ran successfully
          - execute /opt/gitlab/bin/gitlab-psql -d gitlabhq_production -c "CREATE EXTENSION IF NOT EXISTS btree_gist"
      
    
  
  * version_file[Create version file for PostgreSQL] action create
    * file[/var/opt/gitlab/postgresql/VERSION] action create[2024-03-06T19:59:51+00:00] INFO: file[/var/opt/gitlab/postgresql/VERSION] created file /var/opt/gitlab/postgresql/VERSION

      - create new file /var/opt/gitlab/postgresql/VERSION[2024-03-06T19:59:51+00:00] INFO: file[/var/opt/gitlab/postgresql/VERSION] updated file contents /var/opt/gitlab/postgresql/VERSION

      - update content in file /var/opt/gitlab/postgresql/VERSION from none to 828552
      --- /var/opt/gitlab/postgresql/VERSION    2024-03-06 19:59:51.193551436 +0000
      +++ /var/opt/gitlab/postgresql/.chef-VERSION20240306-34-tb6ito    2024-03-06 19:59:51.193551436 +0000
      @@ -1 +1,2 @@
      +postgres (PostgreSQL) 13.8
  
  * ruby_block[warn pending postgresql restart] action run (skipped due to only_if)
  * execute[reload postgresql] action nothing (skipped due to action :nothing)
  * execute[start postgresql] action nothing (skipped due to action :nothing)
Recipe: praefect::disable
  * service[praefect] action nothing (skipped due to action :nothing)
  * runit_service[praefect] action disable
    * ruby_block[disable praefect] action run (skipped due to only_if)
     (up to date)
  * consul_service[praefect] action delete
    * file[/var/opt/gitlab/consul/config.d/praefect-service.json] action delete (up to date)
     (up to date)
Recipe: gitlab-kas::enable
  * directory[/var/opt/gitlab/gitlab-kas] action create[2024-03-06T19:59:51+00:00] INFO: directory[/var/opt/gitlab/gitlab-kas] created directory /var/opt/gitlab/gitlab-kas

    - create new directory /var/opt/gitlab/gitlab-kas[2024-03-06T19:59:51+00:00] INFO: directory[/var/opt/gitlab/gitlab-kas] owner changed to 998
[2024-03-06T19:59:51+00:00] INFO: directory[/var/opt/gitlab/gitlab-kas] mode changed to 700

    - change mode from '' to '0700'
    - change owner from '' to 'git'
  * directory[/opt/gitlab/etc/gitlab-kas] action create[2024-03-06T19:59:51+00:00] INFO: directory[/opt/gitlab/etc/gitlab-kas] created directory /opt/gitlab/etc/gitlab-kas

    - create new directory /opt/gitlab/etc/gitlab-kas[2024-03-06T19:59:51+00:00] INFO: directory[/opt/gitlab/etc/gitlab-kas] owner changed to 998
[2024-03-06T19:59:51+00:00] INFO: directory[/opt/gitlab/etc/gitlab-kas] mode changed to 700

    - change mode from '' to '0700'
    - change owner from '' to 'git'
  * directory[/var/log/gitlab/gitlab-kas] action create[2024-03-06T19:59:51+00:00] INFO: directory[/var/log/gitlab/gitlab-kas] created directory /var/log/gitlab/gitlab-kas

    - create new directory /var/log/gitlab/gitlab-kas[2024-03-06T19:59:51+00:00] INFO: directory[/var/log/gitlab/gitlab-kas] owner changed to 998
[2024-03-06T19:59:51+00:00] INFO: directory[/var/log/gitlab/gitlab-kas] mode changed to 700

    - change mode from '' to '0700'
    - change owner from '' to 'git'
  * ruby_block[websocket TLS termination] action run (skipped due to only_if)
  * version_file[Create version file for Gitlab KAS] action create
    * file[/var/opt/gitlab/gitlab-kas/VERSION] action create[2024-03-06T19:59:51+00:00] INFO: file[/var/opt/gitlab/gitlab-kas/VERSION] created file /var/opt/gitlab/gitlab-kas/VERSION

      - create new file /var/opt/gitlab/gitlab-kas/VERSION[2024-03-06T19:59:51+00:00] INFO: file[/var/opt/gitlab/gitlab-kas/VERSION] updated file contents /var/opt/gitlab/gitlab-kas/VERSION

      - update content in file /var/opt/gitlab/gitlab-kas/VERSION from none to 717ae4
      --- /var/opt/gitlab/gitlab-kas/VERSION    2024-03-06 19:59:51.353471436 +0000
      +++ /var/opt/gitlab/gitlab-kas/.chef-VERSION20240306-34-cvus41    2024-03-06 19:59:51.353471436 +0000
      @@ -1 +1,2 @@
      +kas version v16.0.1, commit: 27e3eb8e, built: 20230517.175020
  
  * file[/var/opt/gitlab/gitlab-kas/authentication_secret_file] action create[2024-03-06T19:59:51+00:00] INFO: file[/var/opt/gitlab/gitlab-kas/authentication_secret_file] created file /var/opt/gitlab/gitlab-kas/authentication_secret_file

    - create new file /var/opt/gitlab/gitlab-kas/authentication_secret_file[2024-03-06T19:59:51+00:00] INFO: file[/var/opt/gitlab/gitlab-kas/authentication_secret_file] updated file contents /var/opt/gitlab/gitlab-kas/authentication_secret_file

    - update content in file /var/opt/gitlab/gitlab-kas/authentication_secret_file from none to b088a3
    --- /var/opt/gitlab/gitlab-kas/authentication_secret_file   2024-03-06 19:59:51.369463436 +0000
    +++ /var/opt/gitlab/gitlab-kas/.chef-authentication_secret_file20240306-34-xkbv4z   2024-03-06 19:59:51.369463436 +0000
    @@ -1 +1,2 @@
    +ZmMxNTY4YjU4YTVhN2UzNTJhYzI3MjMyOGVlZGUwM2E=[2024-03-06T19:59:51+00:00] INFO: file[/var/opt/gitlab/gitlab-kas/authentication_secret_file] owner changed to 0
[2024-03-06T19:59:51+00:00] INFO: file[/var/opt/gitlab/gitlab-kas/authentication_secret_file] group changed to 998
[2024-03-06T19:59:51+00:00] INFO: file[/var/opt/gitlab/gitlab-kas/authentication_secret_file] mode changed to 640

    - change mode from '' to '0640'
    - change owner from '' to 'root'
    - change group from '' to 'git'
[2024-03-06T19:59:51+00:00] INFO: file[/var/opt/gitlab/gitlab-kas/authentication_secret_file] not queuing delayed action restart on runit_service[gitlab-kas] (delayed), as it's already been queued
  * file[/var/opt/gitlab/gitlab-kas/private_api_authentication_secret_file] action create[2024-03-06T19:59:51+00:00] INFO: file[/var/opt/gitlab/gitlab-kas/private_api_authentication_secret_file] created file /var/opt/gitlab/gitlab-kas/private_api_authentication_secret_file

    - create new file /var/opt/gitlab/gitlab-kas/private_api_authentication_secret_file[2024-03-06T19:59:51+00:00] INFO: file[/var/opt/gitlab/gitlab-kas/private_api_authentication_secret_file] updated file contents /var/opt/gitlab/gitlab-kas/private_api_authentication_secret_file

    - update content in file /var/opt/gitlab/gitlab-kas/private_api_authentication_secret_file from none to 8a2bd0
    --- /var/opt/gitlab/gitlab-kas/private_api_authentication_secret_file       2024-03-06 19:59:51.385455436 +0000
    +++ /var/opt/gitlab/gitlab-kas/.chef-private_api_authentication_secret_file20240306-34-phd7of       2024-03-06 19:59:51.385455436 +0000
    @@ -1 +1,2 @@
    +NDI3Y2VkYzZmOTEyMGQ5ZDllODgxZmRkOGNkZDUyOWY=[2024-03-06T19:59:51+00:00] INFO: file[/var/opt/gitlab/gitlab-kas/private_api_authentication_secret_file] owner changed to 0
[2024-03-06T19:59:51+00:00] INFO: file[/var/opt/gitlab/gitlab-kas/private_api_authentication_secret_file] group changed to 998
[2024-03-06T19:59:51+00:00] INFO: file[/var/opt/gitlab/gitlab-kas/private_api_authentication_secret_file] mode changed to 640

    - change mode from '' to '0640'
    - change owner from '' to 'root'
    - change group from '' to 'git'
[2024-03-06T19:59:51+00:00] INFO: file[/var/opt/gitlab/gitlab-kas/private_api_authentication_secret_file] not queuing delayed action restart on runit_service[gitlab-kas] (delayed), as it's already been queued
  * file[/var/opt/gitlab/gitlab-kas/redis_password_file] action create (skipped due to only_if)
  * template[/var/opt/gitlab/gitlab-kas/gitlab-kas-config.yml] action create[2024-03-06T19:59:51+00:00] INFO: template[/var/opt/gitlab/gitlab-kas/gitlab-kas-config.yml] created file /var/opt/gitlab/gitlab-kas/gitlab-kas-config.yml

    - create new file /var/opt/gitlab/gitlab-kas/gitlab-kas-config.yml[2024-03-06T19:59:51+00:00] INFO: template[/var/opt/gitlab/gitlab-kas/gitlab-kas-config.yml] updated file contents /var/opt/gitlab/gitlab-kas/gitlab-kas-config.yml

    - update content in file /var/opt/gitlab/gitlab-kas/gitlab-kas-config.yml from none to 8f2d42
    --- /var/opt/gitlab/gitlab-kas/gitlab-kas-config.yml        2024-03-06 19:59:51.405445436 +0000
    +++ /var/opt/gitlab/gitlab-kas/.chef-gitlab-kas-config20240306-34-e4x2bj.yml        2024-03-06 19:59:51.405445436 +0000
    @@ -1,44 +1,88 @@
    +agent:
    +  listen:
    +    address: localhost:8150
    +    network: tcp
    +    websocket: true
    +  configuration:
    +    poll_period: 20s
    +  gitops:
    +    poll_period: 20s
    +    project_info_cache_ttl: 300s
    +    project_info_cache_error_ttl: 60s
    +  kubernetes_api:
    +    listen:
    +      address: localhost:8154
    +    url_path_prefix: /
    +  info_cache_ttl: 300s
    +  info_cache_error_ttl: 60s
    +gitlab:
    +  address: http://4957012b6a55
    +  external_url: http://4957012b6a55
    +  authentication_secret_file: /var/opt/gitlab/gitlab-kas/authentication_secret_file
    +observability:
    +  listen:
    +    address: localhost:8151
    +    network: tcp
    +  usage_reporting_period: 60s
    +  logging:
    +    level: info
    +redis:
    +  network: unix
    +  tls:
    +    enabled: false
    +  server:
    +    address: '/var/opt/gitlab/redis/redis.socket'
    +api:
    +  listen:
    +    network: tcp
    +    address: localhost:8153
    +    authentication_secret_file: /var/opt/gitlab/gitlab-kas/authentication_secret_file
    +private_api:
    +  listen:
    +    network: tcp
    +    address: localhost:8155
    +    authentication_secret_file: /var/opt/gitlab/gitlab-kas/private_api_authentication_secret_file[2024-03-06T19:59:51+00:00] INFO: template[/var/opt/gitlab/gitlab-kas/gitlab-kas-config.yml] owner changed to 0
[2024-03-06T19:59:51+00:00] INFO: template[/var/opt/gitlab/gitlab-kas/gitlab-kas-config.yml] group changed to 998
[2024-03-06T19:59:51+00:00] INFO: template[/var/opt/gitlab/gitlab-kas/gitlab-kas-config.yml] mode changed to 640

    - change mode from '' to '0640'
    - change owner from '' to 'root'
    - change group from '' to 'git'
[2024-03-06T19:59:51+00:00] INFO: template[/var/opt/gitlab/gitlab-kas/gitlab-kas-config.yml] not queuing delayed action restart on runit_service[gitlab-kas] (delayed), as it's already been queued
  * env_dir[/opt/gitlab/etc/gitlab-kas/env] action create
    * directory[/opt/gitlab/etc/gitlab-kas/env] action create[2024-03-06T19:59:51+00:00] INFO: directory[/opt/gitlab/etc/gitlab-kas/env] created directory /opt/gitlab/etc/gitlab-kas/env

      - create new directory /opt/gitlab/etc/gitlab-kas/env
    * file[/opt/gitlab/etc/gitlab-kas/env/SSL_CERT_DIR] action create[2024-03-06T19:59:51+00:00] INFO: file[/opt/gitlab/etc/gitlab-kas/env/SSL_CERT_DIR] created file /opt/gitlab/etc/gitlab-kas/env/SSL_CERT_DIR

      - create new file /opt/gitlab/etc/gitlab-kas/env/SSL_CERT_DIR[2024-03-06T19:59:51+00:00] INFO: file[/opt/gitlab/etc/gitlab-kas/env/SSL_CERT_DIR] updated file contents /opt/gitlab/etc/gitlab-kas/env/SSL_CERT_DIR

      - update content in file /opt/gitlab/etc/gitlab-kas/env/SSL_CERT_DIR from none to 4f45cf
      - suppressed sensitive resource
    * file[/opt/gitlab/etc/gitlab-kas/env/OWN_PRIVATE_API_URL] action create[2024-03-06T19:59:51+00:00] INFO: file[/opt/gitlab/etc/gitlab-kas/env/OWN_PRIVATE_API_URL] created file /opt/gitlab/etc/gitlab-kas/env/OWN_PRIVATE_API_URL

      - create new file /opt/gitlab/etc/gitlab-kas/env/OWN_PRIVATE_API_URL[2024-03-06T19:59:51+00:00] INFO: file[/opt/gitlab/etc/gitlab-kas/env/OWN_PRIVATE_API_URL] updated file contents /opt/gitlab/etc/gitlab-kas/env/OWN_PRIVATE_API_URL

      - update content in file /opt/gitlab/etc/gitlab-kas/env/OWN_PRIVATE_API_URL from none to 45b898
      - suppressed sensitive resource
  
  * service[gitlab-kas] action nothing (skipped due to action :nothing)
  * runit_service[gitlab-kas] action enable
    * ruby_block[restart_service] action nothing (skipped due to action :nothing)
    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
    * directory[/opt/gitlab/sv/gitlab-kas] action create[2024-03-06T19:59:51+00:00] INFO: directory[/opt/gitlab/sv/gitlab-kas] created directory /opt/gitlab/sv/gitlab-kas

      - create new directory /opt/gitlab/sv/gitlab-kas[2024-03-06T19:59:51+00:00] INFO: directory[/opt/gitlab/sv/gitlab-kas] owner changed to 0
[2024-03-06T19:59:51+00:00] INFO: directory[/opt/gitlab/sv/gitlab-kas] group changed to 0
[2024-03-06T19:59:51+00:00] INFO: directory[/opt/gitlab/sv/gitlab-kas] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * template[/opt/gitlab/sv/gitlab-kas/run] action create[2024-03-06T19:59:51+00:00] INFO: template[/opt/gitlab/sv/gitlab-kas/run] created file /opt/gitlab/sv/gitlab-kas/run

      - create new file /opt/gitlab/sv/gitlab-kas/run[2024-03-06T19:59:51+00:00] INFO: template[/opt/gitlab/sv/gitlab-kas/run] updated file contents /opt/gitlab/sv/gitlab-kas/run

      - update content in file /opt/gitlab/sv/gitlab-kas/run from none to ac037b
      --- /opt/gitlab/sv/gitlab-kas/run 2024-03-06 19:59:51.453421436 +0000
      +++ /opt/gitlab/sv/gitlab-kas/.chef-run20240306-34-guj6to 2024-03-06 19:59:51.453421436 +0000
      @@ -1,11 +1,22 @@
      +#!/bin/bash
      +
      +# Let runit capture all script error messages
      +exec 2>&1
      +
      +
      +
      +exec chpst -e /opt/gitlab/etc/gitlab-kas/env -P \
      +  -u git:git \
      +  -U git:git \
      +  /opt/gitlab/embedded/bin/gitlab-kas --configuration-file /var/opt/gitlab/gitlab-kas/gitlab-kas-config.yml[2024-03-06T19:59:51+00:00] INFO: template[/opt/gitlab/sv/gitlab-kas/run] owner changed to 0
[2024-03-06T19:59:51+00:00] INFO: template[/opt/gitlab/sv/gitlab-kas/run] group changed to 0
[2024-03-06T19:59:51+00:00] INFO: template[/opt/gitlab/sv/gitlab-kas/run] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/gitlab-kas/log] action create[2024-03-06T19:59:51+00:00] INFO: directory[/opt/gitlab/sv/gitlab-kas/log] created directory /opt/gitlab/sv/gitlab-kas/log

      - create new directory /opt/gitlab/sv/gitlab-kas/log[2024-03-06T19:59:51+00:00] INFO: directory[/opt/gitlab/sv/gitlab-kas/log] owner changed to 0
[2024-03-06T19:59:51+00:00] INFO: directory[/opt/gitlab/sv/gitlab-kas/log] group changed to 0
[2024-03-06T19:59:51+00:00] INFO: directory[/opt/gitlab/sv/gitlab-kas/log] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/gitlab-kas/log/main] action create[2024-03-06T19:59:51+00:00] INFO: directory[/opt/gitlab/sv/gitlab-kas/log/main] created directory /opt/gitlab/sv/gitlab-kas/log/main

      - create new directory /opt/gitlab/sv/gitlab-kas/log/main[2024-03-06T19:59:51+00:00] INFO: directory[/opt/gitlab/sv/gitlab-kas/log/main] owner changed to 0
[2024-03-06T19:59:51+00:00] INFO: directory[/opt/gitlab/sv/gitlab-kas/log/main] group changed to 0
[2024-03-06T19:59:51+00:00] INFO: directory[/opt/gitlab/sv/gitlab-kas/log/main] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * template[/opt/gitlab/sv/gitlab-kas/log/config] action create[2024-03-06T19:59:51+00:00] INFO: template[/opt/gitlab/sv/gitlab-kas/log/config] created file /opt/gitlab/sv/gitlab-kas/log/config

      - create new file /opt/gitlab/sv/gitlab-kas/log/config[2024-03-06T19:59:51+00:00] INFO: template[/opt/gitlab/sv/gitlab-kas/log/config] updated file contents /opt/gitlab/sv/gitlab-kas/log/config

      - update content in file /opt/gitlab/sv/gitlab-kas/log/config from none to 623c00
      --- /opt/gitlab/sv/gitlab-kas/log/config  2024-03-06 19:59:51.521387436 +0000
      +++ /opt/gitlab/sv/gitlab-kas/log/.chef-config20240306-34-xpfupd  2024-03-06 19:59:51.521387436 +0000
      @@ -1,6 +1,12 @@
      +s209715200
      +n30
      +t86400
      +!gzip
      +
      +[2024-03-06T19:59:51+00:00] INFO: template[/opt/gitlab/sv/gitlab-kas/log/config] owner changed to 0
[2024-03-06T19:59:51+00:00] INFO: template[/opt/gitlab/sv/gitlab-kas/log/config] group changed to 0
[2024-03-06T19:59:51+00:00] INFO: template[/opt/gitlab/sv/gitlab-kas/log/config] mode changed to 644

      - change mode from '' to '0644'
      - change owner from '' to 'root'
      - change group from '' to 'root'
[2024-03-06T19:59:51+00:00] INFO: template[/opt/gitlab/sv/gitlab-kas/log/config] sending create action to ruby_block[verify_chown_persisted_on_gitlab-kas] (immediate)
    * ruby_block[verify_chown_persisted_on_gitlab-kas] action create[2024-03-06T19:59:51+00:00] INFO: ruby_block[verify_chown_persisted_on_gitlab-kas] called

      - execute the ruby block verify_chown_persisted_on_gitlab-kas
    * ruby_block[verify_chown_persisted_on_gitlab-kas] action nothing (skipped due to action :nothing)
    * link[/var/log/gitlab/gitlab-kas/config] action create[2024-03-06T19:59:51+00:00] INFO: link[/var/log/gitlab/gitlab-kas/config] created

      - create symlink at /var/log/gitlab/gitlab-kas/config to /opt/gitlab/sv/gitlab-kas/log/config
    * template[/opt/gitlab/sv/gitlab-kas/log/run] action create[2024-03-06T19:59:51+00:00] INFO: template[/opt/gitlab/sv/gitlab-kas/log/run] created file /opt/gitlab/sv/gitlab-kas/log/run

      - create new file /opt/gitlab/sv/gitlab-kas/log/run[2024-03-06T19:59:51+00:00] INFO: template[/opt/gitlab/sv/gitlab-kas/log/run] updated file contents /opt/gitlab/sv/gitlab-kas/log/run

      - update content in file /opt/gitlab/sv/gitlab-kas/log/run from none to 22436c
      --- /opt/gitlab/sv/gitlab-kas/log/run     2024-03-06 19:59:51.553371437 +0000
      +++ /opt/gitlab/sv/gitlab-kas/log/.chef-run20240306-34-ews59w     2024-03-06 19:59:51.553371437 +0000
      @@ -1,5 +1,10 @@
      +#!/bin/sh
      +exec chpst -P \
      +  -U root:root \
      +  -u root:root \
      +  svlogd -tt /var/log/gitlab/gitlab-kas[2024-03-06T19:59:51+00:00] INFO: template[/opt/gitlab/sv/gitlab-kas/log/run] owner changed to 0
[2024-03-06T19:59:51+00:00] INFO: template[/opt/gitlab/sv/gitlab-kas/log/run] group changed to 0
[2024-03-06T19:59:51+00:00] INFO: template[/opt/gitlab/sv/gitlab-kas/log/run] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/gitlab-kas/env] action create[2024-03-06T19:59:51+00:00] INFO: directory[/opt/gitlab/sv/gitlab-kas/env] created directory /opt/gitlab/sv/gitlab-kas/env

      - create new directory /opt/gitlab/sv/gitlab-kas/env[2024-03-06T19:59:51+00:00] INFO: directory[/opt/gitlab/sv/gitlab-kas/env] owner changed to 0
[2024-03-06T19:59:51+00:00] INFO: directory[/opt/gitlab/sv/gitlab-kas/env] group changed to 0
[2024-03-06T19:59:51+00:00] INFO: directory[/opt/gitlab/sv/gitlab-kas/env] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * ruby_block[Delete unmanaged env files for gitlab-kas service] action run (skipped due to only_if)
    * template[/opt/gitlab/sv/gitlab-kas/check] action create (skipped due to only_if)
    * template[/opt/gitlab/sv/gitlab-kas/finish] action create (skipped due to only_if)
    * directory[/opt/gitlab/sv/gitlab-kas/control] action create[2024-03-06T19:59:51+00:00] INFO: directory[/opt/gitlab/sv/gitlab-kas/control] created directory /opt/gitlab/sv/gitlab-kas/control

      - create new directory /opt/gitlab/sv/gitlab-kas/control[2024-03-06T19:59:51+00:00] INFO: directory[/opt/gitlab/sv/gitlab-kas/control] owner changed to 0
[2024-03-06T19:59:51+00:00] INFO: directory[/opt/gitlab/sv/gitlab-kas/control] group changed to 0
[2024-03-06T19:59:51+00:00] INFO: directory[/opt/gitlab/sv/gitlab-kas/control] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * link[/opt/gitlab/init/gitlab-kas] action create[2024-03-06T19:59:51+00:00] INFO: link[/opt/gitlab/init/gitlab-kas] created

      - create symlink at /opt/gitlab/init/gitlab-kas to /opt/gitlab/embedded/bin/sv
    * file[/opt/gitlab/sv/gitlab-kas/down] action nothing (skipped due to action :nothing)
[2024-03-06T19:59:51+00:00] INFO: template[/opt/gitlab/sv/gitlab-kas/run] sending run action to ruby_block[restart_service] (delayed)
    * ruby_block[restart_service] action run (skipped due to only_if)
[2024-03-06T19:59:51+00:00] INFO: template[/opt/gitlab/sv/gitlab-kas/log/config] sending create action to ruby_block[reload_log_service] (delayed)
    * ruby_block[reload_log_service] action create
      * ruby_block[restart_service] action nothing (skipped due to action :nothing)
      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/sv/gitlab-kas] action create (up to date)
      * template[/opt/gitlab/sv/gitlab-kas/run] action create (up to date)
      * directory[/opt/gitlab/sv/gitlab-kas/log] action create (up to date)
      * directory[/opt/gitlab/sv/gitlab-kas/log/main] action create (up to date)
      * template[/opt/gitlab/sv/gitlab-kas/log/config] action create (up to date)
      * ruby_block[verify_chown_persisted_on_gitlab-kas] action nothing (skipped due to action :nothing)
      * link[/var/log/gitlab/gitlab-kas/config] action create (up to date)
      * template[/opt/gitlab/sv/gitlab-kas/log/run] action create (up to date)
      * directory[/opt/gitlab/sv/gitlab-kas/env] action create (up to date)
      * ruby_block[Delete unmanaged env files for gitlab-kas service] action run (skipped due to only_if)
      * template[/opt/gitlab/sv/gitlab-kas/check] action create (skipped due to only_if)
      * template[/opt/gitlab/sv/gitlab-kas/finish] action create (skipped due to only_if)
      * directory[/opt/gitlab/sv/gitlab-kas/control] action create (up to date)
      * link[/opt/gitlab/init/gitlab-kas] action create (up to date)
      * file[/opt/gitlab/sv/gitlab-kas/down] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/service] action create (up to date)
      * link[/opt/gitlab/service/gitlab-kas] action create[2024-03-06T19:59:51+00:00] INFO: link[/opt/gitlab/service/gitlab-kas] created

        - create symlink at /opt/gitlab/service/gitlab-kas to /opt/gitlab/sv/gitlab-kas
      * ruby_block[wait for gitlab-kas service socket] action run[2024-03-06T19:59:53+00:00] INFO: ruby_block[wait for gitlab-kas service socket] called

        - execute the ruby block wait for gitlab-kas service socket
      * file[/var/log/gitlab/gitlab-kas/current] action touch (skipped due to only_if)
[2024-03-06T19:59:54+00:00] INFO: ruby_block[reload_log_service] called
      - execute the ruby block reload_log_service
[2024-03-06T19:59:54+00:00] INFO: template[/opt/gitlab/sv/gitlab-kas/log/run] sending run action to ruby_block[restart_log_service] (delayed)
    * ruby_block[restart_log_service] action run
      * ruby_block[restart_service] action nothing (skipped due to action :nothing)
      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/sv/gitlab-kas] action create (up to date)
      * template[/opt/gitlab/sv/gitlab-kas/run] action create (up to date)
      * directory[/opt/gitlab/sv/gitlab-kas/log] action create (up to date)
      * directory[/opt/gitlab/sv/gitlab-kas/log/main] action create (up to date)
      * template[/opt/gitlab/sv/gitlab-kas/log/config] action create (up to date)
      * ruby_block[verify_chown_persisted_on_gitlab-kas] action nothing (skipped due to action :nothing)
      * link[/var/log/gitlab/gitlab-kas/config] action create (up to date)
      * template[/opt/gitlab/sv/gitlab-kas/log/run] action create (up to date)
      * directory[/opt/gitlab/sv/gitlab-kas/env] action create (up to date)
      * ruby_block[Delete unmanaged env files for gitlab-kas service] action run (skipped due to only_if)
      * template[/opt/gitlab/sv/gitlab-kas/check] action create (skipped due to only_if)
      * template[/opt/gitlab/sv/gitlab-kas/finish] action create (skipped due to only_if)
      * directory[/opt/gitlab/sv/gitlab-kas/control] action create (up to date)
      * link[/opt/gitlab/init/gitlab-kas] action create (up to date)
      * file[/opt/gitlab/sv/gitlab-kas/down] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/service] action create (up to date)
      * link[/opt/gitlab/service/gitlab-kas] action create (up to date)
      * ruby_block[wait for gitlab-kas service socket] action run (skipped due to not_if)
      * file[/var/log/gitlab/gitlab-kas/current] action touch (skipped due to only_if)
[2024-03-06T19:59:56+00:00] INFO: ruby_block[restart_log_service] called
      - execute the ruby block restart_log_service
    * directory[/opt/gitlab/service] action create (up to date)
    * link[/opt/gitlab/service/gitlab-kas] action create (up to date)
    * ruby_block[wait for gitlab-kas service socket] action run (skipped due to not_if)
    * file[/var/log/gitlab/gitlab-kas/current] action touch (skipped due to only_if)
  
Recipe: gitlab::database_migrations
  * ruby_block[check remote PG version] action nothing (skipped due to action :nothing)
  * rails_migration[gitlab-rails] action run[2024-03-06T19:59:56+00:00] WARN: gitlab-rails does not have a log_group or default logdir mode defined. Setting to 0700.

    * bash_hide_env[migrate gitlab-rails database] action run
      [execute] Running db:schema:load rake task
                psql:/opt/gitlab/embedded/service/gitlab-rails/db/structure.sql:9: NOTICE:  extension "btree_gist" already exists, skipping
                psql:/opt/gitlab/embedded/service/gitlab-rails/db/structure.sql:11: NOTICE:  extension "pg_trgm" already exists, skipping
                
                == Seed from /opt/gitlab/embedded/service/gitlab-rails/db/fixtures/production/001_application_settings.rb
                Creating the default ApplicationSetting record.
                
                == Seed from /opt/gitlab/embedded/service/gitlab-rails/db/fixtures/production/002_admin.rb
                Administrator account created:
                
                login:    root
                password: ******
                
                
                == Seed from /opt/gitlab/embedded/service/gitlab-rails/db/fixtures/production/003_create_base_work_item_types.rb
                
                OK
                
                == Seed from /opt/gitlab/embedded/service/gitlab-rails/db/fixtures/production/004_add_security_training_providers.rb
                
                OK
                
                == Seed from /opt/gitlab/embedded/service/gitlab-rails/db/fixtures/production/010_settings.rb
                Saved CI JWT signing key
                
                == Seed from /opt/gitlab/embedded/service/gitlab-rails/db/fixtures/production/020_create_work_item_hierarchy_restrictions.rb
                
                OK
                
                == Seed from /opt/gitlab/embedded/service/gitlab-rails/db/fixtures/production/999_common_metrics.rb
[2024-03-06T20:00:19+00:00] INFO: bash_hide_env[migrate gitlab-rails database] ran successfully
      - execute "bash" 
  
[2024-03-06T20:00:19+00:00] INFO: rails_migration[gitlab-rails] sending run action to execute[clear the gitlab-rails cache] (immediate)
Recipe: gitlab::gitlab-rails
  * execute[clear the gitlab-rails cache] action run[2024-03-06T20:00:33+00:00] INFO: execute[clear the gitlab-rails cache] ran successfully

    - execute /opt/gitlab/bin/gitlab-rake cache:clear
[2024-03-06T20:00:33+00:00] INFO: rails_migration[gitlab-rails] sending run action to ruby_block[check remote PG version] (immediate)
Recipe: gitlab::database_migrations
  * ruby_block[check remote PG version] action run (skipped due to only_if)
Recipe: crond::disable
  * service[crond] action nothing (skipped due to action :nothing)
  * runit_service[crond] action disable
    * ruby_block[disable crond] action run (skipped due to only_if)
     (up to date)
Recipe: gitlab::puma
  * directory[/opt/gitlab/var/puma] action create[2024-03-06T20:00:33+00:00] INFO: directory[/opt/gitlab/var/puma] created directory /opt/gitlab/var/puma

    - create new directory /opt/gitlab/var/puma[2024-03-06T20:00:33+00:00] INFO: directory[/opt/gitlab/var/puma] owner changed to 998
[2024-03-06T20:00:33+00:00] INFO: directory[/opt/gitlab/var/puma] mode changed to 700

    - change mode from '' to '0700'
    - change owner from '' to 'git'
  * directory[/var/log/gitlab/puma] action create[2024-03-06T20:00:33+00:00] INFO: directory[/var/log/gitlab/puma] created directory /var/log/gitlab/puma

    - create new directory /var/log/gitlab/puma[2024-03-06T20:00:33+00:00] INFO: directory[/var/log/gitlab/puma] owner changed to 998
[2024-03-06T20:00:33+00:00] INFO: directory[/var/log/gitlab/puma] mode changed to 700

    - change mode from '' to '0700'
    - change owner from '' to 'git'
  * directory[/var/opt/gitlab/gitlab-rails/sockets] action create[2024-03-06T20:00:33+00:00] INFO: directory[/var/opt/gitlab/gitlab-rails/sockets] created directory /var/opt/gitlab/gitlab-rails/sockets

    - create new directory /var/opt/gitlab/gitlab-rails/sockets[2024-03-06T20:00:33+00:00] INFO: directory[/var/opt/gitlab/gitlab-rails/sockets] owner changed to 998
[2024-03-06T20:00:33+00:00] INFO: directory[/var/opt/gitlab/gitlab-rails/sockets] group changed to 999
[2024-03-06T20:00:33+00:00] INFO: directory[/var/opt/gitlab/gitlab-rails/sockets] mode changed to 750

    - change mode from '' to '0750'
    - change owner from '' to 'git'
    - change group from '' to 'gitlab-www'
  * puma_config[/var/opt/gitlab/gitlab-rails/etc/puma.rb] action create
    * directory[/var/opt/gitlab/gitlab-rails/etc] action create (up to date)
    * template[/var/opt/gitlab/gitlab-rails/etc/puma.rb] action create[2024-03-06T20:00:33+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/puma.rb] created file /var/opt/gitlab/gitlab-rails/etc/puma.rb

      - create new file /var/opt/gitlab/gitlab-rails/etc/puma.rb[2024-03-06T20:00:33+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/puma.rb] updated file contents /var/opt/gitlab/gitlab-rails/etc/puma.rb

      - update content in file /var/opt/gitlab/gitlab-rails/etc/puma.rb from none to 199a78
      --- /var/opt/gitlab/gitlab-rails/etc/puma.rb      2024-03-06 20:00:33.832221419 +0000
      +++ /var/opt/gitlab/gitlab-rails/etc/.chef-puma20240306-34-493rpj.rb      2024-03-06 20:00:33.832221419 +0000
      @@ -1,109 +1,218 @@
      +# frozen_string_literal: true
      +
      +# This file is managed by gitlab-ctl. Manual changes will be
      +# erased! To change the contents below, edit /etc/gitlab/gitlab.rb
      +# and run `sudo gitlab-ctl reconfigure`.
      +
      +# Load "path" as a rackup file.
      +#
      +# The default is "config.ru".
      +#
      +environment 'production'
      +rackup '/opt/gitlab/embedded/service/gitlab-rails/config.ru'
      +pidfile '/opt/gitlab/var/puma/puma.pid'
      +state_path '/opt/gitlab/var/puma/puma.state'
      +
      +stdout_redirect '/var/log/gitlab/puma/puma_stdout.log', '/var/log/gitlab/puma/puma_stderr.log', true
      +
      +# Configure "min" to be the minimum number of threads to use to answer
      +# requests and "max" the maximum.
      +#
      +# The default is "0, 16".
      +#
      +threads 4, 4
      +
      +# By default, workers accept all requests and queue them to pass to handlers.
      +# When false, workers accept the number of simultaneous requests configured.
      +#
      +# Queueing requests generally improves performance, but can cause deadlocks if
      +# the app is waiting on a request to itself. See https://github.com/puma/puma/issues/612
      +#
      +# When set to false this may require a reverse proxy to handle slow clients and
      +# queue requests before they reach puma. This is due to disabling HTTP keepalive
      +queue_requests false
      +
      +# Bind the server to "url". "tcp://", "unix://" and "ssl://" are the only
      +# accepted protocols.
      +bind 'unix:///var/opt/gitlab/gitlab-rails/sockets/gitlab.socket'
      +
      +bind 'tcp://127.0.0.1:8080'
      +
      +
      +directory '/var/opt/gitlab/gitlab-rails/working'
      +
      +workers 4
      +
      +require_relative "/opt/gitlab/embedded/service/gitlab-rails/lib/gitlab/cluster/lifecycle_events"
      +
      +on_restart do
      +  # Signal application hooks that we're about to restart
      +  Gitlab::Cluster::LifecycleEvents.do_before_master_restart
      +end
      +
      +options = { workers: 4 }
      +
      +before_fork do
      +  # Signal application hooks that we're about to fork
      +  Gitlab::Cluster::LifecycleEvents.do_before_fork
      +end
      +
      +Gitlab::Cluster::LifecycleEvents.set_puma_options options
      +on_worker_boot do
      +  # Signal application hooks of worker start
      +  Gitlab::Cluster::LifecycleEvents.do_worker_start
      +end
      +
      +on_worker_shutdown do
      +  # Signal application hooks that a worker is shutting down
      +  Gitlab::Cluster::LifecycleEvents.do_worker_stop
      +end
      +
      +# Preload the application before starting the workers; this conflicts with
      +# phased restart feature. (off by default)
      +
      +preload_app!
      +
      +tag 'gitlab-puma-worker'
      +
      +# Verifies that all workers have checked in to the master process within
      +# the given timeout. If not the worker process will be restarted. Default
      +# value is 60 seconds.
      +#
      +worker_timeout 60
      +
      +# https://github.com/puma/puma/blob/master/5.0-Upgrade.md#lower-latency-better-throughput
      +wait_for_less_busy_worker ENV.fetch('PUMA_WAIT_FOR_LESS_BUSY_WORKER', 0.001).to_f
      +
      +# nakayoshi_fork was removed in Puma 6.0: https://github.com/puma/puma/issues/2258
      +# https://github.com/puma/puma/blob/master/5.0-Upgrade.md#nakayoshi_fork
      +if Gem::Version.new(Puma::Const::PUMA_VERSION).canonical_segments.first == 5 &&
      +     ENV['DISABLE_PUMA_NAKAYOSHI_FORK'] != 'true'
      +  nakayoshi_fork
      +end
      +
      +# Use customised JSON formatter for Puma log
      +require_relative "/opt/gitlab/embedded/service/gitlab-rails/lib/gitlab/puma_logging/json_formatter"
      +
      +json_formatter = Gitlab::PumaLogging::JSONFormatter.new
      +log_formatter do |str|
      +    json_formatter.call(str)
      +end
      +
      +lowlevel_error_handler do |ex, env|
      +  if Raven.configuration.capture_allowed?
      +    Raven.capture_exception(ex, tags: { 'handler': 'puma_low_level' }, extra: { puma_env: env })
      +  end
      +
      +  # note the below is just a Rack response
      +  [500, {}, ["An error has occurred and reported in the system's low-level error handler."]]
      +end[2024-03-06T20:00:33+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/puma.rb] owner changed to 0
[2024-03-06T20:00:33+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/puma.rb] group changed to 0
[2024-03-06T20:00:33+00:00] INFO: template[/var/opt/gitlab/gitlab-rails/etc/puma.rb] mode changed to 644

      - change mode from '' to '0644'
      - change owner from '' to 'root'
      - change group from '' to 'root'
  
  * service[puma] action nothing (skipped due to action :nothing)
  * runit_service[puma] action enable
    * ruby_block[restart_service] action nothing (skipped due to action :nothing)
    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
    * directory[/opt/gitlab/sv/puma] action create[2024-03-06T20:00:33+00:00] INFO: directory[/opt/gitlab/sv/puma] created directory /opt/gitlab/sv/puma

      - create new directory /opt/gitlab/sv/puma[2024-03-06T20:00:33+00:00] INFO: directory[/opt/gitlab/sv/puma] owner changed to 0
[2024-03-06T20:00:33+00:00] INFO: directory[/opt/gitlab/sv/puma] group changed to 0
[2024-03-06T20:00:33+00:00] INFO: directory[/opt/gitlab/sv/puma] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * template[/opt/gitlab/sv/puma/run] action create[2024-03-06T20:00:33+00:00] INFO: template[/opt/gitlab/sv/puma/run] created file /opt/gitlab/sv/puma/run

      - create new file /opt/gitlab/sv/puma/run[2024-03-06T20:00:33+00:00] INFO: template[/opt/gitlab/sv/puma/run] updated file contents /opt/gitlab/sv/puma/run

      - update content in file /opt/gitlab/sv/puma/run from none to 571752
      --- /opt/gitlab/sv/puma/run       2024-03-06 20:00:33.868203418 +0000
      +++ /opt/gitlab/sv/puma/.chef-run20240306-34-j2gdir       2024-03-06 20:00:33.868203418 +0000
      @@ -1,22 +1,44 @@
      +#!/bin/bash
      +
      +# Let runit capture all script error messages
      +exec 2>&1
      +
      +# Setup run directory.
      +mkdir -p /dev/shm/gitlab/puma
      +chmod 0700 /dev/shm/gitlab/puma
      +chown git /dev/shm/gitlab/puma
      +export prometheus_run_dir='/dev/shm/gitlab/puma'
      +
      +
      +
      +
      +exec chpst -P \
      +  -u git:git \
      +  -U git:git \
      +  -e /opt/gitlab/etc/gitlab-rails/env \
      +  /usr/bin/env \
      +    prometheus_multiproc_dir="${prometheus_run_dir}" \
      +    ACTION_CABLE_WORKER_POOL_SIZE=4 \
      +    /opt/gitlab/embedded/bin/bundle exec puma -C /var/opt/gitlab/gitlab-rails/etc/puma.rb[2024-03-06T20:00:33+00:00] INFO: template[/opt/gitlab/sv/puma/run] owner changed to 0
[2024-03-06T20:00:33+00:00] INFO: template[/opt/gitlab/sv/puma/run] group changed to 0
[2024-03-06T20:00:33+00:00] INFO: template[/opt/gitlab/sv/puma/run] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/puma/log] action create[2024-03-06T20:00:33+00:00] INFO: directory[/opt/gitlab/sv/puma/log] created directory /opt/gitlab/sv/puma/log

      - create new directory /opt/gitlab/sv/puma/log[2024-03-06T20:00:33+00:00] INFO: directory[/opt/gitlab/sv/puma/log] owner changed to 0
[2024-03-06T20:00:33+00:00] INFO: directory[/opt/gitlab/sv/puma/log] group changed to 0
[2024-03-06T20:00:33+00:00] INFO: directory[/opt/gitlab/sv/puma/log] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/puma/log/main] action create[2024-03-06T20:00:33+00:00] INFO: directory[/opt/gitlab/sv/puma/log/main] created directory /opt/gitlab/sv/puma/log/main

      - create new directory /opt/gitlab/sv/puma/log/main[2024-03-06T20:00:33+00:00] INFO: directory[/opt/gitlab/sv/puma/log/main] owner changed to 0
[2024-03-06T20:00:33+00:00] INFO: directory[/opt/gitlab/sv/puma/log/main] group changed to 0
[2024-03-06T20:00:33+00:00] INFO: directory[/opt/gitlab/sv/puma/log/main] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * template[/opt/gitlab/sv/puma/log/config] action create[2024-03-06T20:00:33+00:00] INFO: template[/opt/gitlab/sv/puma/log/config] created file /opt/gitlab/sv/puma/log/config

      - create new file /opt/gitlab/sv/puma/log/config[2024-03-06T20:00:33+00:00] INFO: template[/opt/gitlab/sv/puma/log/config] updated file contents /opt/gitlab/sv/puma/log/config

      - update content in file /opt/gitlab/sv/puma/log/config from none to 623c00
      --- /opt/gitlab/sv/puma/log/config        2024-03-06 20:00:33.888193419 +0000
      +++ /opt/gitlab/sv/puma/log/.chef-config20240306-34-x91ia5        2024-03-06 20:00:33.888193419 +0000
      @@ -1,6 +1,12 @@
      +s209715200
      +n30
      +t86400
      +!gzip
      +
      +[2024-03-06T20:00:33+00:00] INFO: template[/opt/gitlab/sv/puma/log/config] owner changed to 0
[2024-03-06T20:00:33+00:00] INFO: template[/opt/gitlab/sv/puma/log/config] group changed to 0
[2024-03-06T20:00:33+00:00] INFO: template[/opt/gitlab/sv/puma/log/config] mode changed to 644

      - change mode from '' to '0644'
      - change owner from '' to 'root'
      - change group from '' to 'root'
[2024-03-06T20:00:33+00:00] INFO: template[/opt/gitlab/sv/puma/log/config] sending create action to ruby_block[verify_chown_persisted_on_puma] (immediate)
    * ruby_block[verify_chown_persisted_on_puma] action create[2024-03-06T20:00:33+00:00] INFO: ruby_block[verify_chown_persisted_on_puma] called

      - execute the ruby block verify_chown_persisted_on_puma
    * ruby_block[verify_chown_persisted_on_puma] action nothing (skipped due to action :nothing)
    * link[/var/log/gitlab/puma/config] action create[2024-03-06T20:00:33+00:00] INFO: link[/var/log/gitlab/puma/config] created

      - create symlink at /var/log/gitlab/puma/config to /opt/gitlab/sv/puma/log/config
    * template[/opt/gitlab/sv/puma/log/run] action create[2024-03-06T20:00:33+00:00] INFO: template[/opt/gitlab/sv/puma/log/run] created file /opt/gitlab/sv/puma/log/run

      - create new file /opt/gitlab/sv/puma/log/run[2024-03-06T20:00:33+00:00] INFO: template[/opt/gitlab/sv/puma/log/run] updated file contents /opt/gitlab/sv/puma/log/run

      - update content in file /opt/gitlab/sv/puma/log/run from none to b9d2d5
      --- /opt/gitlab/sv/puma/log/run   2024-03-06 20:00:33.908183418 +0000
      +++ /opt/gitlab/sv/puma/log/.chef-run20240306-34-iasncv   2024-03-06 20:00:33.908183418 +0000
      @@ -1,5 +1,10 @@
      +#!/bin/sh
      +exec chpst -P \
      +  -U root:root \
      +  -u root:root \
      +  svlogd -tt /var/log/gitlab/puma[2024-03-06T20:00:33+00:00] INFO: template[/opt/gitlab/sv/puma/log/run] owner changed to 0
[2024-03-06T20:00:33+00:00] INFO: template[/opt/gitlab/sv/puma/log/run] group changed to 0
[2024-03-06T20:00:33+00:00] INFO: template[/opt/gitlab/sv/puma/log/run] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/puma/env] action create[2024-03-06T20:00:33+00:00] INFO: directory[/opt/gitlab/sv/puma/env] created directory /opt/gitlab/sv/puma/env

      - create new directory /opt/gitlab/sv/puma/env[2024-03-06T20:00:33+00:00] INFO: directory[/opt/gitlab/sv/puma/env] owner changed to 0
[2024-03-06T20:00:33+00:00] INFO: directory[/opt/gitlab/sv/puma/env] group changed to 0
[2024-03-06T20:00:33+00:00] INFO: directory[/opt/gitlab/sv/puma/env] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * ruby_block[Delete unmanaged env files for puma service] action run (skipped due to only_if)
    * template[/opt/gitlab/sv/puma/check] action create (skipped due to only_if)
    * template[/opt/gitlab/sv/puma/finish] action create (skipped due to only_if)
    * directory[/opt/gitlab/sv/puma/control] action create[2024-03-06T20:00:33+00:00] INFO: directory[/opt/gitlab/sv/puma/control] created directory /opt/gitlab/sv/puma/control

      - create new directory /opt/gitlab/sv/puma/control[2024-03-06T20:00:33+00:00] INFO: directory[/opt/gitlab/sv/puma/control] owner changed to 0
[2024-03-06T20:00:33+00:00] INFO: directory[/opt/gitlab/sv/puma/control] group changed to 0
[2024-03-06T20:00:33+00:00] INFO: directory[/opt/gitlab/sv/puma/control] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * template[/opt/gitlab/sv/puma/control/t] action create[2024-03-06T20:00:33+00:00] INFO: template[/opt/gitlab/sv/puma/control/t] created file /opt/gitlab/sv/puma/control/t

      - create new file /opt/gitlab/sv/puma/control/t[2024-03-06T20:00:33+00:00] INFO: template[/opt/gitlab/sv/puma/control/t] updated file contents /opt/gitlab/sv/puma/control/t

      - update content in file /opt/gitlab/sv/puma/control/t from none to d8e9e7
      --- /opt/gitlab/sv/puma/control/t 2024-03-06 20:00:33.928173418 +0000
      +++ /opt/gitlab/sv/puma/control/.chef-t20240306-34-u65m93 2024-03-06 20:00:33.928173418 +0000
      @@ -1,3 +1,6 @@
      +#!/bin/sh
      +echo "Received TERM from runit, sending to process group (-PID)"
      +kill -- -$(cat /opt/gitlab/service/puma/supervise/pid)[2024-03-06T20:00:33+00:00] INFO: template[/opt/gitlab/sv/puma/control/t] owner changed to 0
[2024-03-06T20:00:33+00:00] INFO: template[/opt/gitlab/sv/puma/control/t] group changed to 0
[2024-03-06T20:00:33+00:00] INFO: template[/opt/gitlab/sv/puma/control/t] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * template[/opt/gitlab/sv/puma/control/h] action create[2024-03-06T20:00:33+00:00] INFO: template[/opt/gitlab/sv/puma/control/h] created file /opt/gitlab/sv/puma/control/h

      - create new file /opt/gitlab/sv/puma/control/h[2024-03-06T20:00:33+00:00] INFO: template[/opt/gitlab/sv/puma/control/h] updated file contents /opt/gitlab/sv/puma/control/h

      - update content in file /opt/gitlab/sv/puma/control/h from none to 22e721
      --- /opt/gitlab/sv/puma/control/h 2024-03-06 20:00:33.944165418 +0000
      +++ /opt/gitlab/sv/puma/control/.chef-h20240306-34-8qs4an 2024-03-06 20:00:33.944165418 +0000
      @@ -1,47 +1,94 @@
      +#!/bin/sh
      +
      +# This control handler is meant to be invoked by omnibus-gitlab via Runit
      +
      +# Let runit capture all script error messages
      +exec 2>&1
      +
      +PID=$(cat /opt/gitlab/service/puma/supervise/pid)
      +
      +readonly puma_graceful_shutdown_sec=90
      +readonly puma_forceful_shutdown_sec=20
      +readonly puma_kill_shutdown_sec=10
      +
      +echo "Received HUP from runit, sending INT signal to perform graceful restart"
      +
      +signal() {
      +  local pid="$1"
      +  local signal="$2"
      +  local tries="$3"
      +
      +  echo "Sending $signal signal to Puma $pid..."
      +  kill "-$signal" "$pid"
      +
      +  for i in $(seq 1 "$tries"); do
      +    echo "Waiting for Puma $pid to exit ($i)..."
      +    if ! kill -0 "$pid"; then
      +      echo "Puma $pid did exit."
      +      return 0
      +    fi
      +
      +    sleep 1
      +  done
      +
      +  echo "Puma $pid did not exit after $signal."
      +  return 1
      +}
      +
      +(
      +  # we run it in subshell, as `runit` requires
      +  # the process it runs to exit in order to reap
      +  # the service
      +  signal "$PID" "INT" "$puma_graceful_shutdown_sec" ||
      +  signal "$PID" "TERM" "$puma_forceful_shutdown_sec" ||
      +  signal "$PID" "KILL" "$puma_kill_shutdown_sec"
      +) &
      +
      +exit 0[2024-03-06T20:00:33+00:00] INFO: template[/opt/gitlab/sv/puma/control/h] owner changed to 0
[2024-03-06T20:00:33+00:00] INFO: template[/opt/gitlab/sv/puma/control/h] group changed to 0
[2024-03-06T20:00:33+00:00] INFO: template[/opt/gitlab/sv/puma/control/h] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * link[/opt/gitlab/init/puma] action create[2024-03-06T20:00:33+00:00] INFO: link[/opt/gitlab/init/puma] created

      - create symlink at /opt/gitlab/init/puma to /opt/gitlab/embedded/bin/sv
    * file[/opt/gitlab/sv/puma/down] action nothing (skipped due to action :nothing)
[2024-03-06T20:00:33+00:00] INFO: template[/opt/gitlab/sv/puma/run] sending run action to ruby_block[restart_service] (delayed)
    * ruby_block[restart_service] action run (skipped due to only_if)
[2024-03-06T20:00:33+00:00] INFO: template[/opt/gitlab/sv/puma/log/config] sending create action to ruby_block[reload_log_service] (delayed)
    * ruby_block[reload_log_service] action create
      * ruby_block[restart_service] action nothing (skipped due to action :nothing)
      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/sv/puma] action create (up to date)
      * template[/opt/gitlab/sv/puma/run] action create (up to date)
      * directory[/opt/gitlab/sv/puma/log] action create (up to date)
      * directory[/opt/gitlab/sv/puma/log/main] action create (up to date)
      * template[/opt/gitlab/sv/puma/log/config] action create (up to date)
      * ruby_block[verify_chown_persisted_on_puma] action nothing (skipped due to action :nothing)
      * link[/var/log/gitlab/puma/config] action create (up to date)
      * template[/opt/gitlab/sv/puma/log/run] action create (up to date)
      * directory[/opt/gitlab/sv/puma/env] action create (up to date)
      * ruby_block[Delete unmanaged env files for puma service] action run (skipped due to only_if)
      * template[/opt/gitlab/sv/puma/check] action create (skipped due to only_if)
      * template[/opt/gitlab/sv/puma/finish] action create (skipped due to only_if)
      * directory[/opt/gitlab/sv/puma/control] action create (up to date)
      * template[/opt/gitlab/sv/puma/control/t] action create (up to date)
      * template[/opt/gitlab/sv/puma/control/h] action create (up to date)
      * link[/opt/gitlab/init/puma] action create (up to date)
      * file[/opt/gitlab/sv/puma/down] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/service] action create (up to date)
      * link[/opt/gitlab/service/puma] action create[2024-03-06T20:00:34+00:00] INFO: link[/opt/gitlab/service/puma] created

        - create symlink at /opt/gitlab/service/puma to /opt/gitlab/sv/puma
      * ruby_block[wait for puma service socket] action run[2024-03-06T20:00:36+00:00] INFO: ruby_block[wait for puma service socket] called

        - execute the ruby block wait for puma service socket
      * file[/var/log/gitlab/puma/current] action touch (skipped due to only_if)
[2024-03-06T20:00:37+00:00] INFO: ruby_block[reload_log_service] called
      - execute the ruby block reload_log_service
[2024-03-06T20:00:37+00:00] INFO: template[/opt/gitlab/sv/puma/log/run] sending run action to ruby_block[restart_log_service] (delayed)
    * ruby_block[restart_log_service] action run
      * ruby_block[restart_service] action nothing (skipped due to action :nothing)
      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/sv/puma] action create (up to date)
      * template[/opt/gitlab/sv/puma/run] action create (up to date)
      * directory[/opt/gitlab/sv/puma/log] action create (up to date)
      * directory[/opt/gitlab/sv/puma/log/main] action create (up to date)
      * template[/opt/gitlab/sv/puma/log/config] action create (up to date)
      * ruby_block[verify_chown_persisted_on_puma] action nothing (skipped due to action :nothing)
      * link[/var/log/gitlab/puma/config] action create (up to date)
      * template[/opt/gitlab/sv/puma/log/run] action create (up to date)
      * directory[/opt/gitlab/sv/puma/env] action create (up to date)
      * ruby_block[Delete unmanaged env files for puma service] action run (skipped due to only_if)
      * template[/opt/gitlab/sv/puma/check] action create (skipped due to only_if)
      * template[/opt/gitlab/sv/puma/finish] action create (skipped due to only_if)
      * directory[/opt/gitlab/sv/puma/control] action create (up to date)
      * template[/opt/gitlab/sv/puma/control/t] action create (up to date)
      * template[/opt/gitlab/sv/puma/control/h] action create (up to date)
      * link[/opt/gitlab/init/puma] action create (up to date)
      * file[/opt/gitlab/sv/puma/down] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/service] action create (up to date)
      * link[/opt/gitlab/service/puma] action create (up to date)
      * ruby_block[wait for puma service socket] action run (skipped due to not_if)
      * file[/var/log/gitlab/puma/current] action touch (skipped due to only_if)
[2024-03-06T20:00:37+00:00] INFO: ruby_block[restart_log_service] called
      - execute the ruby block restart_log_service
    * directory[/opt/gitlab/service] action create (up to date)
    * link[/opt/gitlab/service/puma] action create (up to date)
    * ruby_block[wait for puma service socket] action run (skipped due to not_if)
    * file[/var/log/gitlab/puma/current] action touch (skipped due to only_if)
  
  * execute[/opt/gitlab/bin/gitlab-ctl start puma] action run
    [execute] ok: run: puma: (pid 790) 2s
[2024-03-06T20:00:37+00:00] INFO: execute[/opt/gitlab/bin/gitlab-ctl start puma] ran successfully
    - execute /opt/gitlab/bin/gitlab-ctl start puma
  * consul_service[rails] action delete
    * file[/var/opt/gitlab/consul/config.d/rails-service.json] action delete (up to date)
     (up to date)
  * gitlab_sysctl[net.core.somaxconn] action create
    * directory[create /etc/sysctl.d for net.core.somaxconn] action create (skipped due to only_if)
    * file[create /opt/gitlab/embedded/etc/90-omnibus-gitlab-net.core.somaxconn.conf net.core.somaxconn] action create (skipped due to only_if)
    * link[/etc/sysctl.d/90-omnibus-gitlab-net.core.somaxconn.conf] action create (skipped due to only_if)
    * execute[load sysctl conf net.core.somaxconn] action nothing (skipped due to action :nothing)
     (up to date)
Recipe: gitlab::sidekiq
  * sidekiq_service[sidekiq] action enable[2024-03-06T20:00:37+00:00] WARN: sidekiq does not have a log_group or default logdir mode defined. Setting to 0700.

    * directory[/var/log/gitlab/sidekiq] action create[2024-03-06T20:00:37+00:00] INFO: directory[/var/log/gitlab/sidekiq] created directory /var/log/gitlab/sidekiq

      - create new directory /var/log/gitlab/sidekiq[2024-03-06T20:00:37+00:00] INFO: directory[/var/log/gitlab/sidekiq] owner changed to 998
[2024-03-06T20:00:37+00:00] INFO: directory[/var/log/gitlab/sidekiq] mode changed to 700

      - change mode from '' to '0700'
      - change owner from '' to 'git'
    * service[sidekiq] action nothing (skipped due to action :nothing)
    * runit_service[sidekiq] action enable
      * ruby_block[restart_service] action nothing (skipped due to action :nothing)
      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/sv/sidekiq] action create[2024-03-06T20:00:37+00:00] INFO: directory[/opt/gitlab/sv/sidekiq] created directory /opt/gitlab/sv/sidekiq

        - create new directory /opt/gitlab/sv/sidekiq[2024-03-06T20:00:37+00:00] INFO: directory[/opt/gitlab/sv/sidekiq] owner changed to 0
[2024-03-06T20:00:37+00:00] INFO: directory[/opt/gitlab/sv/sidekiq] group changed to 0
[2024-03-06T20:00:37+00:00] INFO: directory[/opt/gitlab/sv/sidekiq] mode changed to 755

        - change mode from '' to '0755'
        - change owner from '' to 'root'
        - change group from '' to 'root'
      * template[/opt/gitlab/sv/sidekiq/run] action create[2024-03-06T20:00:37+00:00] INFO: template[/opt/gitlab/sv/sidekiq/run] created file /opt/gitlab/sv/sidekiq/run

        - create new file /opt/gitlab/sv/sidekiq/run[2024-03-06T20:00:37+00:00] INFO: template[/opt/gitlab/sv/sidekiq/run] updated file contents /opt/gitlab/sv/sidekiq/run

        - update content in file /opt/gitlab/sv/sidekiq/run from none to 0e5a09
        --- /opt/gitlab/sv/sidekiq/run  2024-03-06 20:00:37.970151412 +0000
        +++ /opt/gitlab/sv/sidekiq/.chef-run20240306-34-gfepe   2024-03-06 20:00:37.970151412 +0000
        @@ -1,27 +1,54 @@
        +#!/bin/sh
        +
        +cd /var/opt/gitlab/gitlab-rails/working
        +
        +exec 2>&1
        +# Setup run directory.
        +mkdir -p /dev/shm/gitlab/sidekiq
        +rm /dev/shm/gitlab/sidekiq/*.db 2> /dev/null
        +chmod 0700 /dev/shm/gitlab/sidekiq
        +chown git /dev/shm/gitlab/sidekiq
        +export prometheus_run_dir='/dev/shm/gitlab/sidekiq'
        +
        +
        +
        +exec chpst -e /opt/gitlab/etc/gitlab-rails/env -P \
        +  -U git:git \
        +  -u git:git \
        +  /usr/bin/env \
        +    prometheus_multiproc_dir="${prometheus_run_dir}" \
        +    /opt/gitlab/embedded/service/gitlab-rails/bin/sidekiq-cluster \
        +      -e production \
        +      -r /opt/gitlab/embedded/service/gitlab-rails \
        +      -m 20 \
        +      --timeout 25 \
        +        "*" \
        +
        +# Do not remove this line; it prevents trouble with the trailing backslashes above.[2024-03-06T20:00:37+00:00] INFO: template[/opt/gitlab/sv/sidekiq/run] owner changed to 0
[2024-03-06T20:00:37+00:00] INFO: template[/opt/gitlab/sv/sidekiq/run] group changed to 0
[2024-03-06T20:00:37+00:00] INFO: template[/opt/gitlab/sv/sidekiq/run] mode changed to 755

        - change mode from '' to '0755'
        - change owner from '' to 'root'
        - change group from '' to 'root'
      * directory[/opt/gitlab/sv/sidekiq/log] action create[2024-03-06T20:00:37+00:00] INFO: directory[/opt/gitlab/sv/sidekiq/log] created directory /opt/gitlab/sv/sidekiq/log

        - create new directory /opt/gitlab/sv/sidekiq/log[2024-03-06T20:00:37+00:00] INFO: directory[/opt/gitlab/sv/sidekiq/log] owner changed to 0
[2024-03-06T20:00:37+00:00] INFO: directory[/opt/gitlab/sv/sidekiq/log] group changed to 0
[2024-03-06T20:00:37+00:00] INFO: directory[/opt/gitlab/sv/sidekiq/log] mode changed to 755

        - change mode from '' to '0755'
        - change owner from '' to 'root'
        - change group from '' to 'root'
      * directory[/opt/gitlab/sv/sidekiq/log/main] action create[2024-03-06T20:00:37+00:00] INFO: directory[/opt/gitlab/sv/sidekiq/log/main] created directory /opt/gitlab/sv/sidekiq/log/main

        - create new directory /opt/gitlab/sv/sidekiq/log/main[2024-03-06T20:00:37+00:00] INFO: directory[/opt/gitlab/sv/sidekiq/log/main] owner changed to 0
[2024-03-06T20:00:37+00:00] INFO: directory[/opt/gitlab/sv/sidekiq/log/main] group changed to 0
[2024-03-06T20:00:37+00:00] INFO: directory[/opt/gitlab/sv/sidekiq/log/main] mode changed to 755

        - change mode from '' to '0755'
        - change owner from '' to 'root'
        - change group from '' to 'root'
      * template[/opt/gitlab/sv/sidekiq/log/config] action create[2024-03-06T20:00:38+00:00] INFO: template[/opt/gitlab/sv/sidekiq/log/config] created file /opt/gitlab/sv/sidekiq/log/config

        - create new file /opt/gitlab/sv/sidekiq/log/config[2024-03-06T20:00:38+00:00] INFO: template[/opt/gitlab/sv/sidekiq/log/config] updated file contents /opt/gitlab/sv/sidekiq/log/config

        - update content in file /opt/gitlab/sv/sidekiq/log/config from none to 623c00
        --- /opt/gitlab/sv/sidekiq/log/config   2024-03-06 20:00:37.990141413 +0000
        +++ /opt/gitlab/sv/sidekiq/log/.chef-config20240306-34-pin78v   2024-03-06 20:00:37.990141413 +0000
        @@ -1,6 +1,12 @@
        +s209715200
        +n30
        +t86400
        +!gzip
        +
        +[2024-03-06T20:00:38+00:00] INFO: template[/opt/gitlab/sv/sidekiq/log/config] owner changed to 0
[2024-03-06T20:00:38+00:00] INFO: template[/opt/gitlab/sv/sidekiq/log/config] group changed to 0
[2024-03-06T20:00:38+00:00] INFO: template[/opt/gitlab/sv/sidekiq/log/config] mode changed to 644

        - change mode from '' to '0644'
        - change owner from '' to 'root'
        - change group from '' to 'root'
[2024-03-06T20:00:38+00:00] INFO: template[/opt/gitlab/sv/sidekiq/log/config] sending create action to ruby_block[verify_chown_persisted_on_sidekiq] (immediate)
      * ruby_block[verify_chown_persisted_on_sidekiq] action create[2024-03-06T20:00:38+00:00] INFO: ruby_block[verify_chown_persisted_on_sidekiq] called

        - execute the ruby block verify_chown_persisted_on_sidekiq
      * ruby_block[verify_chown_persisted_on_sidekiq] action nothing (skipped due to action :nothing)
      * link[/var/log/gitlab/sidekiq/config] action create[2024-03-06T20:00:38+00:00] INFO: link[/var/log/gitlab/sidekiq/config] created

        - create symlink at /var/log/gitlab/sidekiq/config to /opt/gitlab/sv/sidekiq/log/config
      * template[/opt/gitlab/sv/sidekiq/log/run] action create[2024-03-06T20:00:38+00:00] INFO: template[/opt/gitlab/sv/sidekiq/log/run] created file /opt/gitlab/sv/sidekiq/log/run

        - create new file /opt/gitlab/sv/sidekiq/log/run[2024-03-06T20:00:38+00:00] INFO: template[/opt/gitlab/sv/sidekiq/log/run] updated file contents /opt/gitlab/sv/sidekiq/log/run

        - update content in file /opt/gitlab/sv/sidekiq/log/run from none to 421ac5
        --- /opt/gitlab/sv/sidekiq/log/run      2024-03-06 20:00:38.006133413 +0000
        +++ /opt/gitlab/sv/sidekiq/log/.chef-run20240306-34-uyviko      2024-03-06 20:00:38.006133413 +0000
        @@ -1,5 +1,10 @@
        +#!/bin/sh
        +exec chpst -P \
        +  -U root:root \
        +  -u root:root \
        +  svlogd /var/log/gitlab/sidekiq[2024-03-06T20:00:38+00:00] INFO: template[/opt/gitlab/sv/sidekiq/log/run] owner changed to 0
[2024-03-06T20:00:38+00:00] INFO: template[/opt/gitlab/sv/sidekiq/log/run] group changed to 0
[2024-03-06T20:00:38+00:00] INFO: template[/opt/gitlab/sv/sidekiq/log/run] mode changed to 755

        - change mode from '' to '0755'
        - change owner from '' to 'root'
        - change group from '' to 'root'
      * directory[/opt/gitlab/sv/sidekiq/env] action create[2024-03-06T20:00:38+00:00] INFO: directory[/opt/gitlab/sv/sidekiq/env] created directory /opt/gitlab/sv/sidekiq/env

        - create new directory /opt/gitlab/sv/sidekiq/env[2024-03-06T20:00:38+00:00] INFO: directory[/opt/gitlab/sv/sidekiq/env] owner changed to 0
[2024-03-06T20:00:38+00:00] INFO: directory[/opt/gitlab/sv/sidekiq/env] group changed to 0
[2024-03-06T20:00:38+00:00] INFO: directory[/opt/gitlab/sv/sidekiq/env] mode changed to 755

        - change mode from '' to '0755'
        - change owner from '' to 'root'
        - change group from '' to 'root'
      * ruby_block[Delete unmanaged env files for sidekiq service] action run (skipped due to only_if)
      * template[/opt/gitlab/sv/sidekiq/check] action create (skipped due to only_if)
      * template[/opt/gitlab/sv/sidekiq/finish] action create (skipped due to only_if)
      * directory[/opt/gitlab/sv/sidekiq/control] action create[2024-03-06T20:00:38+00:00] INFO: directory[/opt/gitlab/sv/sidekiq/control] created directory /opt/gitlab/sv/sidekiq/control

        - create new directory /opt/gitlab/sv/sidekiq/control[2024-03-06T20:00:38+00:00] INFO: directory[/opt/gitlab/sv/sidekiq/control] owner changed to 0
[2024-03-06T20:00:38+00:00] INFO: directory[/opt/gitlab/sv/sidekiq/control] group changed to 0
[2024-03-06T20:00:38+00:00] INFO: directory[/opt/gitlab/sv/sidekiq/control] mode changed to 755

        - change mode from '' to '0755'
        - change owner from '' to 'root'
        - change group from '' to 'root'
      * link[/opt/gitlab/init/sidekiq] action create[2024-03-06T20:00:38+00:00] INFO: link[/opt/gitlab/init/sidekiq] created

        - create symlink at /opt/gitlab/init/sidekiq to /opt/gitlab/embedded/bin/sv
      * file[/opt/gitlab/sv/sidekiq/down] action nothing (skipped due to action :nothing)
[2024-03-06T20:00:38+00:00] INFO: template[/opt/gitlab/sv/sidekiq/run] sending run action to ruby_block[restart_service] (delayed)
      * ruby_block[restart_service] action run (skipped due to only_if)
[2024-03-06T20:00:38+00:00] INFO: template[/opt/gitlab/sv/sidekiq/log/config] sending create action to ruby_block[reload_log_service] (delayed)
      * ruby_block[reload_log_service] action create
        * ruby_block[restart_service] action nothing (skipped due to action :nothing)
        * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
        * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
        * directory[/opt/gitlab/sv/sidekiq] action create (up to date)
        * template[/opt/gitlab/sv/sidekiq/run] action create (up to date)
        * directory[/opt/gitlab/sv/sidekiq/log] action create (up to date)
        * directory[/opt/gitlab/sv/sidekiq/log/main] action create (up to date)
        * template[/opt/gitlab/sv/sidekiq/log/config] action create (up to date)
        * ruby_block[verify_chown_persisted_on_sidekiq] action nothing (skipped due to action :nothing)
        * link[/var/log/gitlab/sidekiq/config] action create (up to date)
        * template[/opt/gitlab/sv/sidekiq/log/run] action create (up to date)
        * directory[/opt/gitlab/sv/sidekiq/env] action create (up to date)
        * ruby_block[Delete unmanaged env files for sidekiq service] action run (skipped due to only_if)
        * template[/opt/gitlab/sv/sidekiq/check] action create (skipped due to only_if)
        * template[/opt/gitlab/sv/sidekiq/finish] action create (skipped due to only_if)
        * directory[/opt/gitlab/sv/sidekiq/control] action create (up to date)
        * link[/opt/gitlab/init/sidekiq] action create (up to date)
        * file[/opt/gitlab/sv/sidekiq/down] action nothing (skipped due to action :nothing)
        * directory[/opt/gitlab/service] action create (up to date)
        * link[/opt/gitlab/service/sidekiq] action create[2024-03-06T20:00:38+00:00] INFO: link[/opt/gitlab/service/sidekiq] created

          - create symlink at /opt/gitlab/service/sidekiq to /opt/gitlab/sv/sidekiq
        * ruby_block[wait for sidekiq service socket] action run[2024-03-06T20:00:42+00:00] INFO: ruby_block[wait for sidekiq service socket] called

          - execute the ruby block wait for sidekiq service socket
        * file[/var/log/gitlab/sidekiq/current] action touch (skipped due to only_if)
[2024-03-06T20:00:43+00:00] INFO: ruby_block[reload_log_service] called
        - execute the ruby block reload_log_service
[2024-03-06T20:00:43+00:00] INFO: template[/opt/gitlab/sv/sidekiq/log/run] sending run action to ruby_block[restart_log_service] (delayed)
      * ruby_block[restart_log_service] action run
        * ruby_block[restart_service] action nothing (skipped due to action :nothing)
        * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
        * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
        * directory[/opt/gitlab/sv/sidekiq] action create (up to date)
        * template[/opt/gitlab/sv/sidekiq/run] action create (up to date)
        * directory[/opt/gitlab/sv/sidekiq/log] action create (up to date)
        * directory[/opt/gitlab/sv/sidekiq/log/main] action create (up to date)
        * template[/opt/gitlab/sv/sidekiq/log/config] action create (up to date)
        * ruby_block[verify_chown_persisted_on_sidekiq] action nothing (skipped due to action :nothing)
        * link[/var/log/gitlab/sidekiq/config] action create (up to date)
        * template[/opt/gitlab/sv/sidekiq/log/run] action create (up to date)
        * directory[/opt/gitlab/sv/sidekiq/env] action create (up to date)
        * ruby_block[Delete unmanaged env files for sidekiq service] action run (skipped due to only_if)
        * template[/opt/gitlab/sv/sidekiq/check] action create (skipped due to only_if)
        * template[/opt/gitlab/sv/sidekiq/finish] action create (skipped due to only_if)
        * directory[/opt/gitlab/sv/sidekiq/control] action create (up to date)
        * link[/opt/gitlab/init/sidekiq] action create (up to date)
        * file[/opt/gitlab/sv/sidekiq/down] action nothing (skipped due to action :nothing)
        * directory[/opt/gitlab/service] action create (up to date)
        * link[/opt/gitlab/service/sidekiq] action create (up to date)
        * ruby_block[wait for sidekiq service socket] action run (skipped due to not_if)
        * file[/var/log/gitlab/sidekiq/current] action touch (skipped due to only_if)
[2024-03-06T20:00:43+00:00] INFO: ruby_block[restart_log_service] called
        - execute the ruby block restart_log_service
      * directory[/opt/gitlab/service] action create (up to date)
      * link[/opt/gitlab/service/sidekiq] action create (up to date)
      * ruby_block[wait for sidekiq service socket] action run (skipped due to not_if)
      * file[/var/log/gitlab/sidekiq/current] action touch (skipped due to only_if)
    
    * execute[/opt/gitlab/bin/gitlab-ctl start sidekiq] action run
      [execute] ok: run: sidekiq: (pid 811) 2s
[2024-03-06T20:00:43+00:00] INFO: execute[/opt/gitlab/bin/gitlab-ctl start sidekiq] ran successfully
      - execute /opt/gitlab/bin/gitlab-ctl start sidekiq
  
  * consul_service[sidekiq] action delete
    * file[/var/opt/gitlab/consul/config.d/sidekiq-service.json] action delete (up to date)
     (up to date)
Recipe: gitlab::gitlab-workhorse
  * directory[/var/opt/gitlab/gitlab-workhorse] action create[2024-03-06T20:00:44+00:00] INFO: directory[/var/opt/gitlab/gitlab-workhorse] created directory /var/opt/gitlab/gitlab-workhorse

    - create new directory /var/opt/gitlab/gitlab-workhorse[2024-03-06T20:00:44+00:00] INFO: directory[/var/opt/gitlab/gitlab-workhorse] owner changed to 998
[2024-03-06T20:00:44+00:00] INFO: directory[/var/opt/gitlab/gitlab-workhorse] group changed to 999
[2024-03-06T20:00:44+00:00] INFO: directory[/var/opt/gitlab/gitlab-workhorse] mode changed to 750

    - change mode from '' to '0750'
    - change owner from '' to 'git'
    - change group from '' to 'gitlab-www'
  * directory[/var/opt/gitlab/gitlab-workhorse/sockets] action create[2024-03-06T20:00:44+00:00] INFO: directory[/var/opt/gitlab/gitlab-workhorse/sockets] created directory /var/opt/gitlab/gitlab-workhorse/sockets

    - create new directory /var/opt/gitlab/gitlab-workhorse/sockets[2024-03-06T20:00:44+00:00] INFO: directory[/var/opt/gitlab/gitlab-workhorse/sockets] owner changed to 998
[2024-03-06T20:00:44+00:00] INFO: directory[/var/opt/gitlab/gitlab-workhorse/sockets] group changed to 999
[2024-03-06T20:00:44+00:00] INFO: directory[/var/opt/gitlab/gitlab-workhorse/sockets] mode changed to 750

    - change mode from '' to '0750'
    - change owner from '' to 'git'
    - change group from '' to 'gitlab-www'
  * directory[/var/log/gitlab/gitlab-workhorse] action create[2024-03-06T20:00:44+00:00] INFO: directory[/var/log/gitlab/gitlab-workhorse] created directory /var/log/gitlab/gitlab-workhorse

    - create new directory /var/log/gitlab/gitlab-workhorse[2024-03-06T20:00:44+00:00] INFO: directory[/var/log/gitlab/gitlab-workhorse] owner changed to 998
[2024-03-06T20:00:44+00:00] INFO: directory[/var/log/gitlab/gitlab-workhorse] mode changed to 700

    - change mode from '' to '0700'
    - change owner from '' to 'git'
  * directory[/opt/gitlab/etc/gitlab-workhorse] action create[2024-03-06T20:00:44+00:00] INFO: directory[/opt/gitlab/etc/gitlab-workhorse] created directory /opt/gitlab/etc/gitlab-workhorse

    - create new directory /opt/gitlab/etc/gitlab-workhorse[2024-03-06T20:00:44+00:00] INFO: directory[/opt/gitlab/etc/gitlab-workhorse] owner changed to 998
[2024-03-06T20:00:44+00:00] INFO: directory[/opt/gitlab/etc/gitlab-workhorse] mode changed to 700

    - change mode from '' to '0700'
    - change owner from '' to 'git'
  * env_dir[/opt/gitlab/etc/gitlab-workhorse/env] action create
    * directory[/opt/gitlab/etc/gitlab-workhorse/env] action create[2024-03-06T20:00:44+00:00] INFO: directory[/opt/gitlab/etc/gitlab-workhorse/env] created directory /opt/gitlab/etc/gitlab-workhorse/env

      - create new directory /opt/gitlab/etc/gitlab-workhorse/env
    * file[/opt/gitlab/etc/gitlab-workhorse/env/PATH] action create[2024-03-06T20:00:44+00:00] INFO: file[/opt/gitlab/etc/gitlab-workhorse/env/PATH] created file /opt/gitlab/etc/gitlab-workhorse/env/PATH

      - create new file /opt/gitlab/etc/gitlab-workhorse/env/PATH[2024-03-06T20:00:44+00:00] INFO: file[/opt/gitlab/etc/gitlab-workhorse/env/PATH] updated file contents /opt/gitlab/etc/gitlab-workhorse/env/PATH

      - update content in file /opt/gitlab/etc/gitlab-workhorse/env/PATH from none to d5dc07
      - suppressed sensitive resource
    * file[/opt/gitlab/etc/gitlab-workhorse/env/HOME] action create[2024-03-06T20:00:44+00:00] INFO: file[/opt/gitlab/etc/gitlab-workhorse/env/HOME] created file /opt/gitlab/etc/gitlab-workhorse/env/HOME

      - create new file /opt/gitlab/etc/gitlab-workhorse/env/HOME[2024-03-06T20:00:44+00:00] INFO: file[/opt/gitlab/etc/gitlab-workhorse/env/HOME] updated file contents /opt/gitlab/etc/gitlab-workhorse/env/HOME

      - update content in file /opt/gitlab/etc/gitlab-workhorse/env/HOME from none to 205bb9
      - suppressed sensitive resource
    * file[/opt/gitlab/etc/gitlab-workhorse/env/SSL_CERT_DIR] action create[2024-03-06T20:00:44+00:00] INFO: file[/opt/gitlab/etc/gitlab-workhorse/env/SSL_CERT_DIR] created file /opt/gitlab/etc/gitlab-workhorse/env/SSL_CERT_DIR

      - create new file /opt/gitlab/etc/gitlab-workhorse/env/SSL_CERT_DIR[2024-03-06T20:00:44+00:00] INFO: file[/opt/gitlab/etc/gitlab-workhorse/env/SSL_CERT_DIR] updated file contents /opt/gitlab/etc/gitlab-workhorse/env/SSL_CERT_DIR

      - update content in file /opt/gitlab/etc/gitlab-workhorse/env/SSL_CERT_DIR from none to 4f45cf
      - suppressed sensitive resource
  
[2024-03-06T20:00:44+00:00] INFO: env_dir[/opt/gitlab/etc/gitlab-workhorse/env] not queuing delayed action restart on runit_service[gitlab-workhorse] (delayed), as it's already been queued
  * service[gitlab-workhorse] action nothing (skipped due to action :nothing)
  * runit_service[gitlab-workhorse] action enable
    * ruby_block[restart_service] action nothing (skipped due to action :nothing)
    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
    * directory[/opt/gitlab/sv/gitlab-workhorse] action create[2024-03-06T20:00:44+00:00] INFO: directory[/opt/gitlab/sv/gitlab-workhorse] created directory /opt/gitlab/sv/gitlab-workhorse

      - create new directory /opt/gitlab/sv/gitlab-workhorse[2024-03-06T20:00:44+00:00] INFO: directory[/opt/gitlab/sv/gitlab-workhorse] owner changed to 0
[2024-03-06T20:00:44+00:00] INFO: directory[/opt/gitlab/sv/gitlab-workhorse] group changed to 0
[2024-03-06T20:00:44+00:00] INFO: directory[/opt/gitlab/sv/gitlab-workhorse] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * template[/opt/gitlab/sv/gitlab-workhorse/run] action create[2024-03-06T20:00:44+00:00] INFO: template[/opt/gitlab/sv/gitlab-workhorse/run] created file /opt/gitlab/sv/gitlab-workhorse/run

      - create new file /opt/gitlab/sv/gitlab-workhorse/run[2024-03-06T20:00:44+00:00] INFO: template[/opt/gitlab/sv/gitlab-workhorse/run] updated file contents /opt/gitlab/sv/gitlab-workhorse/run

      - update content in file /opt/gitlab/sv/gitlab-workhorse/run from none to b1d72f
      --- /opt/gitlab/sv/gitlab-workhorse/run   2024-03-06 20:00:44.087091411 +0000
      +++ /opt/gitlab/sv/gitlab-workhorse/.chef-run20240306-34-wxii2o   2024-03-06 20:00:44.087091411 +0000
      @@ -1,27 +1,54 @@
      +#!/bin/sh
      +set -e # fail on errors
      +
      +# Redirect stderr -> stdout
      +exec 2>&1
      +
      +
      +
      +cd /var/opt/gitlab/gitlab-workhorse
      +
      +exec chpst -e /opt/gitlab/etc/gitlab-workhorse/env -P \
      +  -U git:git \
      +  -u git:git \
      +  /opt/gitlab/embedded/bin/gitlab-workhorse \
      +    -listenNetwork unix \
      +    -listenUmask 0 \
      +    -listenAddr /var/opt/gitlab/gitlab-workhorse/sockets/socket \
      +    -authBackend http://localhost:8080 \
      +    -authSocket /var/opt/gitlab/gitlab-rails/sockets/gitlab.socket \
      +    -documentRoot /opt/gitlab/embedded/service/gitlab-rails/public \
      +    -pprofListenAddr ''\
      +    -prometheusListenAddr localhost:9229 \
      +    -secretPath /opt/gitlab/embedded/service/gitlab-rails/.gitlab_workhorse_secret \
      +    -logFormat json \
      +    -config config.toml \
      +
      +# Do not remove this line; it prevents trouble with the trailing backslashes above.[2024-03-06T20:00:44+00:00] INFO: template[/opt/gitlab/sv/gitlab-workhorse/run] owner changed to 0
[2024-03-06T20:00:44+00:00] INFO: template[/opt/gitlab/sv/gitlab-workhorse/run] group changed to 0
[2024-03-06T20:00:44+00:00] INFO: template[/opt/gitlab/sv/gitlab-workhorse/run] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/gitlab-workhorse/log] action create[2024-03-06T20:00:44+00:00] INFO: directory[/opt/gitlab/sv/gitlab-workhorse/log] created directory /opt/gitlab/sv/gitlab-workhorse/log

      - create new directory /opt/gitlab/sv/gitlab-workhorse/log[2024-03-06T20:00:44+00:00] INFO: directory[/opt/gitlab/sv/gitlab-workhorse/log] owner changed to 0
[2024-03-06T20:00:44+00:00] INFO: directory[/opt/gitlab/sv/gitlab-workhorse/log] group changed to 0
[2024-03-06T20:00:44+00:00] INFO: directory[/opt/gitlab/sv/gitlab-workhorse/log] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/gitlab-workhorse/log/main] action create[2024-03-06T20:00:44+00:00] INFO: directory[/opt/gitlab/sv/gitlab-workhorse/log/main] created directory /opt/gitlab/sv/gitlab-workhorse/log/main

      - create new directory /opt/gitlab/sv/gitlab-workhorse/log/main[2024-03-06T20:00:44+00:00] INFO: directory[/opt/gitlab/sv/gitlab-workhorse/log/main] owner changed to 0
[2024-03-06T20:00:44+00:00] INFO: directory[/opt/gitlab/sv/gitlab-workhorse/log/main] group changed to 0
[2024-03-06T20:00:44+00:00] INFO: directory[/opt/gitlab/sv/gitlab-workhorse/log/main] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * template[/opt/gitlab/sv/gitlab-workhorse/log/config] action create[2024-03-06T20:00:44+00:00] INFO: template[/opt/gitlab/sv/gitlab-workhorse/log/config] created file /opt/gitlab/sv/gitlab-workhorse/log/config

      - create new file /opt/gitlab/sv/gitlab-workhorse/log/config[2024-03-06T20:00:44+00:00] INFO: template[/opt/gitlab/sv/gitlab-workhorse/log/config] updated file contents /opt/gitlab/sv/gitlab-workhorse/log/config

      - update content in file /opt/gitlab/sv/gitlab-workhorse/log/config from none to 623c00
      --- /opt/gitlab/sv/gitlab-workhorse/log/config    2024-03-06 20:00:44.107081410 +0000
      +++ /opt/gitlab/sv/gitlab-workhorse/log/.chef-config20240306-34-s73gbp    2024-03-06 20:00:44.107081410 +0000
      @@ -1,6 +1,12 @@
      +s209715200
      +n30
      +t86400
      +!gzip
      +
      +[2024-03-06T20:00:44+00:00] INFO: template[/opt/gitlab/sv/gitlab-workhorse/log/config] owner changed to 0
[2024-03-06T20:00:44+00:00] INFO: template[/opt/gitlab/sv/gitlab-workhorse/log/config] group changed to 0
[2024-03-06T20:00:44+00:00] INFO: template[/opt/gitlab/sv/gitlab-workhorse/log/config] mode changed to 644

      - change mode from '' to '0644'
      - change owner from '' to 'root'
      - change group from '' to 'root'
[2024-03-06T20:00:44+00:00] INFO: template[/opt/gitlab/sv/gitlab-workhorse/log/config] sending create action to ruby_block[verify_chown_persisted_on_gitlab-workhorse] (immediate)
    * ruby_block[verify_chown_persisted_on_gitlab-workhorse] action create[2024-03-06T20:00:44+00:00] INFO: ruby_block[verify_chown_persisted_on_gitlab-workhorse] called

      - execute the ruby block verify_chown_persisted_on_gitlab-workhorse
    * ruby_block[verify_chown_persisted_on_gitlab-workhorse] action nothing (skipped due to action :nothing)
    * link[/var/log/gitlab/gitlab-workhorse/config] action create[2024-03-06T20:00:44+00:00] INFO: link[/var/log/gitlab/gitlab-workhorse/config] created

      - create symlink at /var/log/gitlab/gitlab-workhorse/config to /opt/gitlab/sv/gitlab-workhorse/log/config
    * template[/opt/gitlab/sv/gitlab-workhorse/log/run] action create[2024-03-06T20:00:44+00:00] INFO: template[/opt/gitlab/sv/gitlab-workhorse/log/run] created file /opt/gitlab/sv/gitlab-workhorse/log/run

      - create new file /opt/gitlab/sv/gitlab-workhorse/log/run[2024-03-06T20:00:44+00:00] INFO: template[/opt/gitlab/sv/gitlab-workhorse/log/run] updated file contents /opt/gitlab/sv/gitlab-workhorse/log/run

      - update content in file /opt/gitlab/sv/gitlab-workhorse/log/run from none to b3b03a
      --- /opt/gitlab/sv/gitlab-workhorse/log/run       2024-03-06 20:00:44.123073411 +0000
      +++ /opt/gitlab/sv/gitlab-workhorse/log/.chef-run20240306-34-pj1ga9       2024-03-06 20:00:44.123073411 +0000
      @@ -1,5 +1,10 @@
      +#!/bin/sh
      +exec chpst -P \
      +  -U root:root \
      +  -u root:root \
      +  svlogd /var/log/gitlab/gitlab-workhorse[2024-03-06T20:00:44+00:00] INFO: template[/opt/gitlab/sv/gitlab-workhorse/log/run] owner changed to 0
[2024-03-06T20:00:44+00:00] INFO: template[/opt/gitlab/sv/gitlab-workhorse/log/run] group changed to 0
[2024-03-06T20:00:44+00:00] INFO: template[/opt/gitlab/sv/gitlab-workhorse/log/run] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/gitlab-workhorse/env] action create[2024-03-06T20:00:44+00:00] INFO: directory[/opt/gitlab/sv/gitlab-workhorse/env] created directory /opt/gitlab/sv/gitlab-workhorse/env

      - create new directory /opt/gitlab/sv/gitlab-workhorse/env[2024-03-06T20:00:44+00:00] INFO: directory[/opt/gitlab/sv/gitlab-workhorse/env] owner changed to 0
[2024-03-06T20:00:44+00:00] INFO: directory[/opt/gitlab/sv/gitlab-workhorse/env] group changed to 0
[2024-03-06T20:00:44+00:00] INFO: directory[/opt/gitlab/sv/gitlab-workhorse/env] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * ruby_block[Delete unmanaged env files for gitlab-workhorse service] action run (skipped due to only_if)
    * template[/opt/gitlab/sv/gitlab-workhorse/check] action create (skipped due to only_if)
    * template[/opt/gitlab/sv/gitlab-workhorse/finish] action create (skipped due to only_if)
    * directory[/opt/gitlab/sv/gitlab-workhorse/control] action create[2024-03-06T20:00:44+00:00] INFO: directory[/opt/gitlab/sv/gitlab-workhorse/control] created directory /opt/gitlab/sv/gitlab-workhorse/control

      - create new directory /opt/gitlab/sv/gitlab-workhorse/control[2024-03-06T20:00:44+00:00] INFO: directory[/opt/gitlab/sv/gitlab-workhorse/control] owner changed to 0
[2024-03-06T20:00:44+00:00] INFO: directory[/opt/gitlab/sv/gitlab-workhorse/control] group changed to 0
[2024-03-06T20:00:44+00:00] INFO: directory[/opt/gitlab/sv/gitlab-workhorse/control] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * link[/opt/gitlab/init/gitlab-workhorse] action create[2024-03-06T20:00:44+00:00] INFO: link[/opt/gitlab/init/gitlab-workhorse] created

      - create symlink at /opt/gitlab/init/gitlab-workhorse to /opt/gitlab/embedded/bin/sv
    * file[/opt/gitlab/sv/gitlab-workhorse/down] action nothing (skipped due to action :nothing)
[2024-03-06T20:00:44+00:00] INFO: template[/opt/gitlab/sv/gitlab-workhorse/run] sending run action to ruby_block[restart_service] (delayed)
    * ruby_block[restart_service] action run (skipped due to only_if)
[2024-03-06T20:00:44+00:00] INFO: template[/opt/gitlab/sv/gitlab-workhorse/log/config] sending create action to ruby_block[reload_log_service] (delayed)
    * ruby_block[reload_log_service] action create
      * ruby_block[restart_service] action nothing (skipped due to action :nothing)
      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/sv/gitlab-workhorse] action create (up to date)
      * template[/opt/gitlab/sv/gitlab-workhorse/run] action create (up to date)
      * directory[/opt/gitlab/sv/gitlab-workhorse/log] action create (up to date)
      * directory[/opt/gitlab/sv/gitlab-workhorse/log/main] action create (up to date)
      * template[/opt/gitlab/sv/gitlab-workhorse/log/config] action create (up to date)
      * ruby_block[verify_chown_persisted_on_gitlab-workhorse] action nothing (skipped due to action :nothing)
      * link[/var/log/gitlab/gitlab-workhorse/config] action create (up to date)
      * template[/opt/gitlab/sv/gitlab-workhorse/log/run] action create (up to date)
      * directory[/opt/gitlab/sv/gitlab-workhorse/env] action create (up to date)
      * ruby_block[Delete unmanaged env files for gitlab-workhorse service] action run (skipped due to only_if)
      * template[/opt/gitlab/sv/gitlab-workhorse/check] action create (skipped due to only_if)
      * template[/opt/gitlab/sv/gitlab-workhorse/finish] action create (skipped due to only_if)
      * directory[/opt/gitlab/sv/gitlab-workhorse/control] action create (up to date)
      * link[/opt/gitlab/init/gitlab-workhorse] action create (up to date)
      * file[/opt/gitlab/sv/gitlab-workhorse/down] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/service] action create (up to date)
      * link[/opt/gitlab/service/gitlab-workhorse] action create[2024-03-06T20:00:44+00:00] INFO: link[/opt/gitlab/service/gitlab-workhorse] created

        - create symlink at /opt/gitlab/service/gitlab-workhorse to /opt/gitlab/sv/gitlab-workhorse
      * ruby_block[wait for gitlab-workhorse service socket] action run[2024-03-06T20:00:48+00:00] INFO: ruby_block[wait for gitlab-workhorse service socket] called

        - execute the ruby block wait for gitlab-workhorse service socket
      * file[/var/log/gitlab/gitlab-workhorse/current] action touch (skipped due to only_if)
[2024-03-06T20:00:48+00:00] INFO: ruby_block[reload_log_service] called
      - execute the ruby block reload_log_service
[2024-03-06T20:00:48+00:00] INFO: template[/opt/gitlab/sv/gitlab-workhorse/log/run] sending run action to ruby_block[restart_log_service] (delayed)
    * ruby_block[restart_log_service] action run
      * ruby_block[restart_service] action nothing (skipped due to action :nothing)
      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/sv/gitlab-workhorse] action create (up to date)
      * template[/opt/gitlab/sv/gitlab-workhorse/run] action create (up to date)
      * directory[/opt/gitlab/sv/gitlab-workhorse/log] action create (up to date)
      * directory[/opt/gitlab/sv/gitlab-workhorse/log/main] action create (up to date)
      * template[/opt/gitlab/sv/gitlab-workhorse/log/config] action create (up to date)
      * ruby_block[verify_chown_persisted_on_gitlab-workhorse] action nothing (skipped due to action :nothing)
      * link[/var/log/gitlab/gitlab-workhorse/config] action create (up to date)
      * template[/opt/gitlab/sv/gitlab-workhorse/log/run] action create (up to date)
      * directory[/opt/gitlab/sv/gitlab-workhorse/env] action create (up to date)
      * ruby_block[Delete unmanaged env files for gitlab-workhorse service] action run (skipped due to only_if)
      * template[/opt/gitlab/sv/gitlab-workhorse/check] action create (skipped due to only_if)
      * template[/opt/gitlab/sv/gitlab-workhorse/finish] action create (skipped due to only_if)
      * directory[/opt/gitlab/sv/gitlab-workhorse/control] action create (up to date)
      * link[/opt/gitlab/init/gitlab-workhorse] action create (up to date)
      * file[/opt/gitlab/sv/gitlab-workhorse/down] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/service] action create (up to date)
      * link[/opt/gitlab/service/gitlab-workhorse] action create (up to date)
      * ruby_block[wait for gitlab-workhorse service socket] action run (skipped due to not_if)
      * file[/var/log/gitlab/gitlab-workhorse/current] action touch (skipped due to only_if)
[2024-03-06T20:00:48+00:00] INFO: ruby_block[restart_log_service] called
      - execute the ruby block restart_log_service
    * directory[/opt/gitlab/service] action create (up to date)
    * link[/opt/gitlab/service/gitlab-workhorse] action create (up to date)
    * ruby_block[wait for gitlab-workhorse service socket] action run (skipped due to not_if)
    * file[/var/log/gitlab/gitlab-workhorse/current] action touch (skipped due to only_if)
  
  * consul_service[workhorse] action delete
    * file[/var/opt/gitlab/consul/config.d/workhorse-service.json] action delete (up to date)
     (up to date)
  * version_file[Create version file for Workhorse] action create
    * file[/var/opt/gitlab/gitlab-workhorse/VERSION] action create[2024-03-06T20:00:48+00:00] INFO: file[/var/opt/gitlab/gitlab-workhorse/VERSION] created file /var/opt/gitlab/gitlab-workhorse/VERSION

      - create new file /var/opt/gitlab/gitlab-workhorse/VERSION[2024-03-06T20:00:48+00:00] INFO: file[/var/opt/gitlab/gitlab-workhorse/VERSION] updated file contents /var/opt/gitlab/gitlab-workhorse/VERSION

      - update content in file /var/opt/gitlab/gitlab-workhorse/VERSION from none to 41d101
      --- /var/opt/gitlab/gitlab-workhorse/VERSION      2024-03-06 20:00:48.904681409 +0000
      +++ /var/opt/gitlab/gitlab-workhorse/.chef-VERSION20240306-34-x0gqq8      2024-03-06 20:00:48.900683408 +0000
      @@ -1 +1,2 @@
      +gitlab-workhorse (v16.0.0)-(20230518.174745)
  
[2024-03-06T20:00:48+00:00] INFO: version_file[Create version file for Workhorse] not queuing delayed action restart on runit_service[gitlab-workhorse] (delayed), as it's already been queued
  * template[/var/opt/gitlab/gitlab-workhorse/config.toml] action create[2024-03-06T20:00:48+00:00] INFO: template[/var/opt/gitlab/gitlab-workhorse/config.toml] created file /var/opt/gitlab/gitlab-workhorse/config.toml

    - create new file /var/opt/gitlab/gitlab-workhorse/config.toml[2024-03-06T20:00:48+00:00] INFO: template[/var/opt/gitlab/gitlab-workhorse/config.toml] updated file contents /var/opt/gitlab/gitlab-workhorse/config.toml

    - update content in file /var/opt/gitlab/gitlab-workhorse/config.toml from none to fd1275
    - suppressed sensitive resource[2024-03-06T20:00:48+00:00] INFO: template[/var/opt/gitlab/gitlab-workhorse/config.toml] owner changed to 0
[2024-03-06T20:00:48+00:00] INFO: template[/var/opt/gitlab/gitlab-workhorse/config.toml] group changed to 998
[2024-03-06T20:00:48+00:00] INFO: template[/var/opt/gitlab/gitlab-workhorse/config.toml] mode changed to 640

    - change mode from '' to '0640'
    - change owner from '' to 'root'
    - change group from '' to 'git'
[2024-03-06T20:00:48+00:00] INFO: template[/var/opt/gitlab/gitlab-workhorse/config.toml] not queuing delayed action restart on runit_service[gitlab-workhorse] (delayed), as it's already been queued
Recipe: gitlab::mailroom_disable
  * service[mailroom] action nothing (skipped due to action :nothing)
  * runit_service[mailroom] action disable
    * ruby_block[disable mailroom] action run (skipped due to only_if)
     (up to date)
Recipe: gitlab::nginx
  * directory[/var/opt/gitlab/nginx] action create[2024-03-06T20:00:48+00:00] INFO: directory[/var/opt/gitlab/nginx] owner changed to 0

    - change owner from 'gitlab-www' to 'root'
  * directory[/var/opt/gitlab/nginx/conf] action create[2024-03-06T20:00:48+00:00] INFO: directory[/var/opt/gitlab/nginx/conf] created directory /var/opt/gitlab/nginx/conf

    - create new directory /var/opt/gitlab/nginx/conf[2024-03-06T20:00:48+00:00] INFO: directory[/var/opt/gitlab/nginx/conf] owner changed to 0
[2024-03-06T20:00:48+00:00] INFO: directory[/var/opt/gitlab/nginx/conf] group changed to 999
[2024-03-06T20:00:48+00:00] INFO: directory[/var/opt/gitlab/nginx/conf] mode changed to 750

    - change mode from '' to '0750'
    - change owner from '' to 'root'
    - change group from '' to 'gitlab-www'
  * directory[/var/log/gitlab/nginx] action create[2024-03-06T20:00:48+00:00] INFO: directory[/var/log/gitlab/nginx] created directory /var/log/gitlab/nginx

    - create new directory /var/log/gitlab/nginx[2024-03-06T20:00:48+00:00] INFO: directory[/var/log/gitlab/nginx] owner changed to 0
[2024-03-06T20:00:48+00:00] INFO: directory[/var/log/gitlab/nginx] group changed to 999
[2024-03-06T20:00:48+00:00] INFO: directory[/var/log/gitlab/nginx] mode changed to 750

    - change mode from '' to '0750'
    - change owner from '' to 'root'
    - change group from '' to 'gitlab-www'
  * link[/var/opt/gitlab/nginx/logs] action create[2024-03-06T20:00:48+00:00] INFO: link[/var/opt/gitlab/nginx/logs] created

    - create symlink at /var/opt/gitlab/nginx/logs to /var/log/gitlab/nginx
  * template[/var/opt/gitlab/nginx/conf/gitlab-http.conf] action create[2024-03-06T20:00:48+00:00] INFO: template[/var/opt/gitlab/nginx/conf/gitlab-http.conf] created file /var/opt/gitlab/nginx/conf/gitlab-http.conf

    - create new file /var/opt/gitlab/nginx/conf/gitlab-http.conf[2024-03-06T20:00:48+00:00] INFO: template[/var/opt/gitlab/nginx/conf/gitlab-http.conf] updated file contents /var/opt/gitlab/nginx/conf/gitlab-http.conf

    - update content in file /var/opt/gitlab/nginx/conf/gitlab-http.conf from none to cdd153
    --- /var/opt/gitlab/nginx/conf/gitlab-http.conf     2024-03-06 20:00:48.952657408 +0000
    +++ /var/opt/gitlab/nginx/conf/.chef-gitlab-http20240306-34-apdu58.conf     2024-03-06 20:00:48.952657408 +0000
    @@ -1,142 +1,284 @@
    +# This file is managed by gitlab-ctl. Manual changes will be
    +# erased! To change the contents below, edit /etc/gitlab/gitlab.rb
    +# and run `sudo gitlab-ctl reconfigure`.
    +
    +## GitLab
    +## Modified from https://gitlab.com/gitlab-org/gitlab-foss/blob/master/lib/support/nginx/gitlab-ssl & https://gitlab.com/gitlab-org/gitlab-foss/blob/master/lib/support/nginx/gitlab
    +##
    +## Lines starting with two hashes (##) are comments with information.
    +## Lines starting with one hash (#) are configuration parameters that can be uncommented.
    +##
    +##################################
    +##        CHUNKED TRANSFER      ##
    +##################################
    +##
    +## It is a known issue that Git-over-HTTP requires chunked transfer encoding [0]
    +## which is not supported by Nginx < 1.3.9 [1]. As a result, pushing a large object
    +## with Git (i.e. a single large file) can lead to a 411 error. In theory you can get
    +## around this by tweaking this configuration file and either:
    +## - installing an old version of Nginx with the chunkin module [2] compiled in, or
    +## - using a newer version of Nginx.
    +##
    +## At the time of writing we do not know if either of these theoretical solutions works.
    +## As a workaround users can use Git over SSH to push large files.
    +##
    +## [0] https://git.kernel.org/cgit/git/git.git/tree/Documentation/technical/http-protocol.txt#n99
    +## [1] https://github.com/agentzh/chunkin-nginx-module#status
    +## [2] https://github.com/agentzh/chunkin-nginx-module
    +##
    +###################################
    +##         configuration         ##
    +###################################
    +
    +
    +server { ## HTTPS server
    +  listen *:80;
    +
    +
    +  server_name 4957012b6a55;
    +  server_tokens off; ## Don't show the nginx version number, a security best practice
    +
    +  ## Increase this if you want to upload large attachments
    +  ## Or if you want to accept large git objects over http
    +  client_max_body_size 0;
    +
    +
    +  ## Real IP Module Config
    +  ## http://nginx.org/en/docs/http/ngx_http_realip_module.html
    +
    +  ## HSTS Config
    +  ## https://www.nginx.com/blog/http-strict-transport-security-hsts-and-nginx/
    +  add_header Strict-Transport-Security "max-age=63072000";
    +
    +  # Rails sets a default policy of strict-origin-when-cross-origin, so
    +  # hide that and just send the one we've configured for nginx
    +  proxy_hide_header Referrer-Policy;
    +  add_header Referrer-Policy strict-origin-when-cross-origin;
    +
    +  ## Individual nginx logs for this GitLab vhost
    +  access_log  /var/log/gitlab/nginx/gitlab_access.log gitlab_access;
    +  error_log   /var/log/gitlab/nginx/gitlab_error.log error;
    +
    +  if ($http_host = "") {
    +    set $http_host_with_default "4957012b6a55";
    +  }
    +
    +  if ($http_host != "") {
    +    set $http_host_with_default $http_host;
    +  }
    +
    +  gzip on;
    +  gzip_static on;
    +  gzip_comp_level 2;
    +  gzip_http_version 1.1;
    +  gzip_vary on;
    +  gzip_disable "msie6";
    +  gzip_min_length 250;
    +  gzip_proxied no-cache no-store private expired auth;
    +  gzip_types text/plain text/css application/x-javascript text/xml application/xml application/xml+rss text/javascript application/json;
    +
    +  ## https://github.com/gitlabhq/gitlabhq/issues/694
    +  ## Some requests take more than 30 seconds.
    +  proxy_read_timeout      3600;
    +  proxy_connect_timeout   300;
    +  proxy_redirect          off;
    +  proxy_http_version 1.1;
    +
    +  proxy_set_header Host $http_host_with_default;
    +  proxy_set_header X-Real-IP $remote_addr;
    +  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    +  proxy_set_header Upgrade $http_upgrade;
    +  proxy_set_header Connection $connection_upgrade;
    +  proxy_set_header X-Forwarded-Proto http;
    +
    +  location ~ (/api/v\d/jobs/\d+/artifacts$|/import/gitlab_project$|\.git/git-receive-pack$|\.git/gitlab-lfs/objects|\.git/info/lfs/objects/batch$) {
    +    proxy_cache off;
    +    proxy_pass http://gitlab-workhorse;
    +    proxy_request_buffering off;
    +  }
    +
    +  location ~ ^/api/v\d {
    +    proxy_cache off;
    +    proxy_pass http://gitlab-workhorse;
    +    proxy_intercept_errors off;
    +  }
    +
    +
    +  location = /-/kubernetes-agent/ {
    +    proxy_pass http://localhost:8150/;
    +    proxy_intercept_errors off;
    +  }
    +
    +  location /-/kubernetes-agent/k8s-proxy/ {
    +    proxy_pass http://localhost:8154/;
    +    proxy_buffering off;
    +    proxy_intercept_errors off;
    +  }
    +
    +  # health checks configuration
    +  include /var/opt/gitlab/nginx/conf/gitlab-health.conf;
    +
    +
    +  location / {
    +    proxy_cache off;
    +    proxy_pass  http://gitlab-workhorse;
    +  }
    +
    +  location /assets {
    +    add_header X-Content-Type-Options nosniff;
    +    proxy_cache gitlab;
    +    proxy_pass  http://gitlab-workhorse;
    +  }
    +
    +  error_page 404 /404.html;
    +  error_page 500 /500.html;
    +  error_page 502 /502.html;
    +  location ~ ^/(404|500|502)(-custom)?\.html$ {
    +    root /opt/gitlab/embedded/service/gitlab-rails/public;
    +    internal;
    +  }
    +
    +  
    +} ## end HTTPS server[2024-03-06T20:00:48+00:00] INFO: template[/var/opt/gitlab/nginx/conf/gitlab-http.conf] owner changed to 0
[2024-03-06T20:00:48+00:00] INFO: template[/var/opt/gitlab/nginx/conf/gitlab-http.conf] group changed to 0
[2024-03-06T20:00:48+00:00] INFO: template[/var/opt/gitlab/nginx/conf/gitlab-http.conf] mode changed to 644

    - change mode from '' to '0644'
    - change owner from '' to 'root'
    - change group from '' to 'root'
  * template[/var/opt/gitlab/nginx/conf/gitlab-smartcard-http.conf] action delete (up to date)
  * template[/var/opt/gitlab/nginx/conf/gitlab-health.conf] action create[2024-03-06T20:00:48+00:00] INFO: template[/var/opt/gitlab/nginx/conf/gitlab-health.conf] created file /var/opt/gitlab/nginx/conf/gitlab-health.conf

    - create new file /var/opt/gitlab/nginx/conf/gitlab-health.conf[2024-03-06T20:00:48+00:00] INFO: template[/var/opt/gitlab/nginx/conf/gitlab-health.conf] updated file contents /var/opt/gitlab/nginx/conf/gitlab-health.conf

    - update content in file /var/opt/gitlab/nginx/conf/gitlab-health.conf from none to 92d04b
    --- /var/opt/gitlab/nginx/conf/gitlab-health.conf   2024-03-06 20:00:48.988639408 +0000
    +++ /var/opt/gitlab/nginx/conf/.chef-gitlab-health20240306-34-gzqk3z.conf   2024-03-06 20:00:48.988639408 +0000
    @@ -1,29 +1,58 @@
    +# This file is managed by gitlab-ctl. Manual changes will be
    +# erased! To change the contents below, edit /etc/gitlab/gitlab.rb
    +# and run `sudo gitlab-ctl reconfigure`.
    +
    +location /error.txt {
    +  # return code here is ignored by the error_page directive
    +  return 500 'nginx returned $status when communicating with gitlab-workhorse\n';
    +}
    +
    +location /error.json  {
    +  # return code here is ignored by the error_page directive
    +  return 500 '{"error":"nginx returned $status when communicating with gitlab-workhorse","status":$status}\n';
    +}
    +
    +location = /-/health {
    +  proxy_cache off;
    +  proxy_pass  http://gitlab-workhorse;
    +  error_page 404 500 502 /error.txt;
    +}
    +location = /-/readiness {
    +  proxy_cache off;
    +  proxy_pass  http://gitlab-workhorse;
    +  error_page 404 500 502 /error.json;
    +}
    +location = /-/liveness {
    +  proxy_cache off;
    +  proxy_pass  http://gitlab-workhorse;
    +  error_page 404 500 502 /error.json;
    +}[2024-03-06T20:00:48+00:00] INFO: template[/var/opt/gitlab/nginx/conf/gitlab-health.conf] owner changed to 0
[2024-03-06T20:00:48+00:00] INFO: template[/var/opt/gitlab/nginx/conf/gitlab-health.conf] group changed to 0
[2024-03-06T20:00:48+00:00] INFO: template[/var/opt/gitlab/nginx/conf/gitlab-health.conf] mode changed to 644

    - change mode from '' to '0644'
    - change owner from '' to 'root'
    - change group from '' to 'root'
  * template[/var/opt/gitlab/nginx/conf/gitlab-pages.conf] action delete (up to date)
  * template[/var/opt/gitlab/nginx/conf/gitlab-registry.conf] action delete (up to date)
  * template[/var/opt/gitlab/nginx/conf/gitlab-mattermost-http.conf] action delete (up to date)
  * template[/var/opt/gitlab/nginx/conf/gitlab-kas.conf] action delete (up to date)
  * template[/var/opt/gitlab/nginx/conf/nginx-status.conf] action create[2024-03-06T20:00:49+00:00] INFO: template[/var/opt/gitlab/nginx/conf/nginx-status.conf] created file /var/opt/gitlab/nginx/conf/nginx-status.conf

    - create new file /var/opt/gitlab/nginx/conf/nginx-status.conf[2024-03-06T20:00:49+00:00] INFO: template[/var/opt/gitlab/nginx/conf/nginx-status.conf] updated file contents /var/opt/gitlab/nginx/conf/nginx-status.conf

    - update content in file /var/opt/gitlab/nginx/conf/nginx-status.conf from none to 74440c
    --- /var/opt/gitlab/nginx/conf/nginx-status.conf    2024-03-06 20:00:49.060603409 +0000
    +++ /var/opt/gitlab/nginx/conf/.chef-nginx-status20240306-34-xhhm3w.conf    2024-03-06 20:00:49.060603409 +0000
    @@ -1,28 +1,56 @@
    +server  {
    +    listen *:8060;
    +    server_name localhost;
    +    location /nginx_status {
    +      stub_status;
    +      server_tokens off;
    +      access_log off;
    +      allow 127.0.0.1;
    +      deny all;
    +    }
    +    location /metrics {
    +      vhost_traffic_status_display;
    +      vhost_traffic_status_display_format prometheus;
    +      server_tokens off;
    +      access_log off;
    +      allow 127.0.0.1;
    +      deny all;
    +    }
    +
    +    location /rails-metrics {
    +      proxy_cache off;
    +      proxy_pass  http://gitlab-workhorse/-/metrics;
    +      server_tokens off;
    +      access_log off;
    +      allow 127.0.0.1;
    +      deny all;
    +    }
    +}[2024-03-06T20:00:49+00:00] INFO: template[/var/opt/gitlab/nginx/conf/nginx-status.conf] owner changed to 0
[2024-03-06T20:00:49+00:00] INFO: template[/var/opt/gitlab/nginx/conf/nginx-status.conf] group changed to 0
[2024-03-06T20:00:49+00:00] INFO: template[/var/opt/gitlab/nginx/conf/nginx-status.conf] mode changed to 644

    - change mode from '' to '0644'
    - change owner from '' to 'root'
    - change group from '' to 'root'
  * consul_service[nginx] action delete
    * file[/var/opt/gitlab/consul/config.d/nginx-service.json] action delete (up to date)
     (up to date)
  * template[/var/opt/gitlab/nginx/conf/nginx.conf] action create[2024-03-06T20:00:49+00:00] INFO: template[/var/opt/gitlab/nginx/conf/nginx.conf] created file /var/opt/gitlab/nginx/conf/nginx.conf

    - create new file /var/opt/gitlab/nginx/conf/nginx.conf[2024-03-06T20:00:49+00:00] INFO: template[/var/opt/gitlab/nginx/conf/nginx.conf] updated file contents /var/opt/gitlab/nginx/conf/nginx.conf

    - update content in file /var/opt/gitlab/nginx/conf/nginx.conf from none to 542397
    --- /var/opt/gitlab/nginx/conf/nginx.conf   2024-03-06 20:00:49.088589409 +0000
    +++ /var/opt/gitlab/nginx/conf/.chef-nginx20240306-34-z7mx9x.conf   2024-03-06 20:00:49.088589409 +0000
    @@ -1,94 +1,188 @@
    +# This file is managed by gitlab-ctl. Manual changes will be
    +# erased! To change the contents below, edit /etc/gitlab/gitlab.rb
    +# and run `sudo gitlab-ctl reconfigure`.
    +
    +user gitlab-www gitlab-www;
    +worker_processes 6;
    +error_log stderr;
    +pid nginx.pid;
    +
    +daemon off;
    +
    +events {
    +  worker_connections 10240;
    +}
    +
    +http {
    +  log_format gitlab_access '$remote_addr - $remote_user [$time_local] "$request_method $filtered_request_uri $server_protocol" $status $body_bytes_sent "$filtered_http_referer" "$http_user_agent" $gzip_ratio';
    +  log_format gitlab_mattermost_access '$remote_addr - $remote_user [$time_local] "$request_method $filtered_request_uri $server_protocol" $status $body_bytes_sent "$filtered_http_referer" "$http_user_agent" $gzip_ratio';
    +
    +  hide_server_tokens off;
    +
    +  server_names_hash_bucket_size 64;
    +
    +  sendfile on;
    +  tcp_nopush on;
    +  tcp_nodelay on;
    +
    +  keepalive_timeout 65;
    +  keepalive_time 1h;
    +
    +  gzip on;
    +  gzip_http_version 1.1;
    +  gzip_comp_level 2;
    +  gzip_proxied no-cache no-store private expired auth;
    +  gzip_types text/plain text/css application/x-javascript text/xml application/xml application/xml+rss text/javascript application/json;
    +
    +  include /opt/gitlab/embedded/conf/mime.types;
    +
    +  proxy_cache_path proxy_cache keys_zone=gitlab:10m max_size=1g levels=1:2;
    +  proxy_cache gitlab;
    +
    +  map $http_upgrade $connection_upgrade {
    +      default upgrade;
    +      ''      close;
    +  }
    +
    +  # Remove private_token from the request URI
    +  # In:  /foo?private_token=unfiltered&authenticity_token=unfiltered&rss_token=unfiltered&...
    +  # Out: /foo?private_token=[FILTERED]&authenticity_token=unfiltered&rss_token=unfiltered&...
    +  map $request_uri $temp_request_uri_1 {
    +    default $request_uri;
    +    ~(?i)^(?<start>.*)(?<temp>[\?&]private[\-_]token)=[^&]*(?<rest>.*)$ "$start$temp=[FILTERED]$rest";
    +  }
    +
    +  # Remove authenticity_token from the request URI
    +  # In:  /foo?private_token=[FILTERED]&authenticity_token=unfiltered&rss_token=unfiltered&...
    +  # Out: /foo?private_token=[FILTERED]&authenticity_token=[FILTERED]&rss_token=unfiltered&...
    +  map $temp_request_uri_1 $temp_request_uri_2 {
    +    default $temp_request_uri_1;
    +    ~(?i)^(?<start>.*)(?<temp>[\?&]authenticity[\-_]token)=[^&]*(?<rest>.*)$ "$start$temp=[FILTERED]$rest";
    +  }
    +
    +  # Remove rss_token from the request URI
    +  # In:  /foo?private_token=[FILTERED]&authenticity_token=[FILTERED]&rss_token=unfiltered&...
    +  # Out: /foo?private_token=[FILTERED]&authenticity_token=[FILTERED]&rss_token=[FILTERED]&...
    +  map $temp_request_uri_2 $filtered_request_uri {
    +    default $temp_request_uri_2;
    +    ~(?i)^(?<start>.*)(?<temp>[\?&]rss[\-_]token)=[^&]*(?<rest>.*)$ "$start$temp=[FILTERED]$rest";
    +  }
    +
    +  # A version of the referer without the query string
    +  map $http_referer $filtered_http_referer {
    +    default $http_referer;
    +    ~^(?<temp>.*)\? $temp;
    +  }
    +
    +  # Enable vts status module.
    +  vhost_traffic_status_zone;
    +
    +  upstream gitlab-workhorse {
    +    server unix:/var/opt/gitlab/gitlab-workhorse/sockets/socket;
    +  }
    +
    +  include /var/opt/gitlab/nginx/conf/gitlab-http.conf;
    +
    +
    +
    +
    +
    +
    +  include /var/opt/gitlab/nginx/conf/nginx-status.conf;
    +
    +  
    +}[2024-03-06T20:00:49+00:00] INFO: template[/var/opt/gitlab/nginx/conf/nginx.conf] owner changed to 0
[2024-03-06T20:00:49+00:00] INFO: template[/var/opt/gitlab/nginx/conf/nginx.conf] group changed to 0
[2024-03-06T20:00:49+00:00] INFO: template[/var/opt/gitlab/nginx/conf/nginx.conf] mode changed to 644

    - change mode from '' to '0644'
    - change owner from '' to 'root'
    - change group from '' to 'root'
Recipe: nginx::enable
  * service[nginx] action nothing (skipped due to action :nothing)
  * runit_service[nginx] action enable
    * ruby_block[restart_service] action nothing (skipped due to action :nothing)
    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
    * directory[/opt/gitlab/sv/nginx] action create[2024-03-06T20:00:49+00:00] INFO: directory[/opt/gitlab/sv/nginx] created directory /opt/gitlab/sv/nginx

      - create new directory /opt/gitlab/sv/nginx[2024-03-06T20:00:49+00:00] INFO: directory[/opt/gitlab/sv/nginx] owner changed to 0
[2024-03-06T20:00:49+00:00] INFO: directory[/opt/gitlab/sv/nginx] group changed to 0
[2024-03-06T20:00:49+00:00] INFO: directory[/opt/gitlab/sv/nginx] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * template[/opt/gitlab/sv/nginx/run] action create[2024-03-06T20:00:49+00:00] INFO: template[/opt/gitlab/sv/nginx/run] created file /opt/gitlab/sv/nginx/run

      - create new file /opt/gitlab/sv/nginx/run[2024-03-06T20:00:49+00:00] INFO: template[/opt/gitlab/sv/nginx/run] updated file contents /opt/gitlab/sv/nginx/run

      - update content in file /opt/gitlab/sv/nginx/run from none to d75aea
      --- /opt/gitlab/sv/nginx/run      2024-03-06 20:00:49.120573409 +0000
      +++ /opt/gitlab/sv/nginx/.chef-run20240306-34-kfg94p      2024-03-06 20:00:49.120573409 +0000
      @@ -1,5 +1,10 @@
      +#!/bin/sh
      +exec 2>&1
      +
      +cd /var/opt/gitlab/nginx
      +exec chpst -P /opt/gitlab/embedded/sbin/nginx -p /var/opt/gitlab/nginx[2024-03-06T20:00:49+00:00] INFO: template[/opt/gitlab/sv/nginx/run] owner changed to 0
[2024-03-06T20:00:49+00:00] INFO: template[/opt/gitlab/sv/nginx/run] group changed to 0
[2024-03-06T20:00:49+00:00] INFO: template[/opt/gitlab/sv/nginx/run] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/nginx/log] action create[2024-03-06T20:00:49+00:00] INFO: directory[/opt/gitlab/sv/nginx/log] created directory /opt/gitlab/sv/nginx/log

      - create new directory /opt/gitlab/sv/nginx/log[2024-03-06T20:00:49+00:00] INFO: directory[/opt/gitlab/sv/nginx/log] owner changed to 0
[2024-03-06T20:00:49+00:00] INFO: directory[/opt/gitlab/sv/nginx/log] group changed to 0
[2024-03-06T20:00:49+00:00] INFO: directory[/opt/gitlab/sv/nginx/log] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/nginx/log/main] action create[2024-03-06T20:00:49+00:00] INFO: directory[/opt/gitlab/sv/nginx/log/main] created directory /opt/gitlab/sv/nginx/log/main

      - create new directory /opt/gitlab/sv/nginx/log/main[2024-03-06T20:00:49+00:00] INFO: directory[/opt/gitlab/sv/nginx/log/main] owner changed to 0
[2024-03-06T20:00:49+00:00] INFO: directory[/opt/gitlab/sv/nginx/log/main] group changed to 0
[2024-03-06T20:00:49+00:00] INFO: directory[/opt/gitlab/sv/nginx/log/main] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * template[/opt/gitlab/sv/nginx/log/config] action create[2024-03-06T20:00:49+00:00] INFO: template[/opt/gitlab/sv/nginx/log/config] created file /opt/gitlab/sv/nginx/log/config

      - create new file /opt/gitlab/sv/nginx/log/config[2024-03-06T20:00:49+00:00] INFO: template[/opt/gitlab/sv/nginx/log/config] updated file contents /opt/gitlab/sv/nginx/log/config

      - update content in file /opt/gitlab/sv/nginx/log/config from none to 623c00
      --- /opt/gitlab/sv/nginx/log/config       2024-03-06 20:00:49.140563409 +0000
      +++ /opt/gitlab/sv/nginx/log/.chef-config20240306-34-psrgpr       2024-03-06 20:00:49.140563409 +0000
      @@ -1,6 +1,12 @@
      +s209715200
      +n30
      +t86400
      +!gzip
      +
      +[2024-03-06T20:00:49+00:00] INFO: template[/opt/gitlab/sv/nginx/log/config] owner changed to 0
[2024-03-06T20:00:49+00:00] INFO: template[/opt/gitlab/sv/nginx/log/config] group changed to 0
[2024-03-06T20:00:49+00:00] INFO: template[/opt/gitlab/sv/nginx/log/config] mode changed to 644

      - change mode from '' to '0644'
      - change owner from '' to 'root'
      - change group from '' to 'root'
[2024-03-06T20:00:49+00:00] INFO: template[/opt/gitlab/sv/nginx/log/config] sending create action to ruby_block[verify_chown_persisted_on_nginx] (immediate)
    * ruby_block[verify_chown_persisted_on_nginx] action create[2024-03-06T20:00:49+00:00] INFO: ruby_block[verify_chown_persisted_on_nginx] called

      - execute the ruby block verify_chown_persisted_on_nginx
    * ruby_block[verify_chown_persisted_on_nginx] action nothing (skipped due to action :nothing)
    * link[/var/log/gitlab/nginx/config] action create[2024-03-06T20:00:49+00:00] INFO: link[/var/log/gitlab/nginx/config] created

      - create symlink at /var/log/gitlab/nginx/config to /opt/gitlab/sv/nginx/log/config
    * template[/opt/gitlab/sv/nginx/log/run] action create[2024-03-06T20:00:49+00:00] INFO: template[/opt/gitlab/sv/nginx/log/run] created file /opt/gitlab/sv/nginx/log/run

      - create new file /opt/gitlab/sv/nginx/log/run[2024-03-06T20:00:49+00:00] INFO: template[/opt/gitlab/sv/nginx/log/run] updated file contents /opt/gitlab/sv/nginx/log/run

      - update content in file /opt/gitlab/sv/nginx/log/run from none to 2d00df
      --- /opt/gitlab/sv/nginx/log/run  2024-03-06 20:00:49.160553409 +0000
      +++ /opt/gitlab/sv/nginx/log/.chef-run20240306-34-xm45sc  2024-03-06 20:00:49.160553409 +0000
      @@ -1,5 +1,10 @@
      +#!/bin/sh
      +exec chpst -P \
      +  -U root:root \
      +  -u root:root \
      +  svlogd -tt /var/log/gitlab/nginx[2024-03-06T20:00:49+00:00] INFO: template[/opt/gitlab/sv/nginx/log/run] owner changed to 0
[2024-03-06T20:00:49+00:00] INFO: template[/opt/gitlab/sv/nginx/log/run] group changed to 0
[2024-03-06T20:00:49+00:00] INFO: template[/opt/gitlab/sv/nginx/log/run] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/nginx/env] action create[2024-03-06T20:00:49+00:00] INFO: directory[/opt/gitlab/sv/nginx/env] created directory /opt/gitlab/sv/nginx/env

      - create new directory /opt/gitlab/sv/nginx/env[2024-03-06T20:00:49+00:00] INFO: directory[/opt/gitlab/sv/nginx/env] owner changed to 0
[2024-03-06T20:00:49+00:00] INFO: directory[/opt/gitlab/sv/nginx/env] group changed to 0
[2024-03-06T20:00:49+00:00] INFO: directory[/opt/gitlab/sv/nginx/env] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * ruby_block[Delete unmanaged env files for nginx service] action run (skipped due to only_if)
    * template[/opt/gitlab/sv/nginx/check] action create (skipped due to only_if)
    * template[/opt/gitlab/sv/nginx/finish] action create (skipped due to only_if)
    * directory[/opt/gitlab/sv/nginx/control] action create[2024-03-06T20:00:49+00:00] INFO: directory[/opt/gitlab/sv/nginx/control] created directory /opt/gitlab/sv/nginx/control

      - create new directory /opt/gitlab/sv/nginx/control[2024-03-06T20:00:49+00:00] INFO: directory[/opt/gitlab/sv/nginx/control] owner changed to 0
[2024-03-06T20:00:49+00:00] INFO: directory[/opt/gitlab/sv/nginx/control] group changed to 0
[2024-03-06T20:00:49+00:00] INFO: directory[/opt/gitlab/sv/nginx/control] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * link[/opt/gitlab/init/nginx] action create[2024-03-06T20:00:49+00:00] INFO: link[/opt/gitlab/init/nginx] created

      - create symlink at /opt/gitlab/init/nginx to /opt/gitlab/embedded/bin/sv
    * file[/opt/gitlab/sv/nginx/down] action nothing (skipped due to action :nothing)
[2024-03-06T20:00:49+00:00] INFO: template[/opt/gitlab/sv/nginx/run] sending run action to ruby_block[restart_service] (delayed)
    * ruby_block[restart_service] action run (skipped due to only_if)
[2024-03-06T20:00:49+00:00] INFO: template[/opt/gitlab/sv/nginx/log/config] sending create action to ruby_block[reload_log_service] (delayed)
    * ruby_block[reload_log_service] action create
      * ruby_block[restart_service] action nothing (skipped due to action :nothing)
      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/sv/nginx] action create (up to date)
      * template[/opt/gitlab/sv/nginx/run] action create (up to date)
      * directory[/opt/gitlab/sv/nginx/log] action create (up to date)
      * directory[/opt/gitlab/sv/nginx/log/main] action create (up to date)
      * template[/opt/gitlab/sv/nginx/log/config] action create (up to date)
      * ruby_block[verify_chown_persisted_on_nginx] action nothing (skipped due to action :nothing)
      * link[/var/log/gitlab/nginx/config] action create (up to date)
      * template[/opt/gitlab/sv/nginx/log/run] action create (up to date)
      * directory[/opt/gitlab/sv/nginx/env] action create (up to date)
      * ruby_block[Delete unmanaged env files for nginx service] action run (skipped due to only_if)
      * template[/opt/gitlab/sv/nginx/check] action create (skipped due to only_if)
      * template[/opt/gitlab/sv/nginx/finish] action create (skipped due to only_if)
      * directory[/opt/gitlab/sv/nginx/control] action create (up to date)
      * link[/opt/gitlab/init/nginx] action create (up to date)
      * file[/opt/gitlab/sv/nginx/down] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/service] action create (up to date)
      * link[/opt/gitlab/service/nginx] action create[2024-03-06T20:00:49+00:00] INFO: link[/opt/gitlab/service/nginx] created

        - create symlink at /opt/gitlab/service/nginx to /opt/gitlab/sv/nginx
      * ruby_block[wait for nginx service socket] action run[2024-03-06T20:00:54+00:00] INFO: ruby_block[wait for nginx service socket] called

        - execute the ruby block wait for nginx service socket
      * file[/var/log/gitlab/nginx/current] action touch (skipped due to only_if)
[2024-03-06T20:00:55+00:00] INFO: ruby_block[reload_log_service] called
      - execute the ruby block reload_log_service
[2024-03-06T20:00:55+00:00] INFO: template[/opt/gitlab/sv/nginx/log/run] sending run action to ruby_block[restart_log_service] (delayed)
    * ruby_block[restart_log_service] action run
      * ruby_block[restart_service] action nothing (skipped due to action :nothing)
      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/sv/nginx] action create (up to date)
      * template[/opt/gitlab/sv/nginx/run] action create (up to date)
      * directory[/opt/gitlab/sv/nginx/log] action create (up to date)
      * directory[/opt/gitlab/sv/nginx/log/main] action create (up to date)
      * template[/opt/gitlab/sv/nginx/log/config] action create (up to date)
      * ruby_block[verify_chown_persisted_on_nginx] action nothing (skipped due to action :nothing)
      * link[/var/log/gitlab/nginx/config] action create (up to date)
      * template[/opt/gitlab/sv/nginx/log/run] action create (up to date)
      * directory[/opt/gitlab/sv/nginx/env] action create (up to date)
      * ruby_block[Delete unmanaged env files for nginx service] action run (skipped due to only_if)
      * template[/opt/gitlab/sv/nginx/check] action create (skipped due to only_if)
      * template[/opt/gitlab/sv/nginx/finish] action create (skipped due to only_if)
      * directory[/opt/gitlab/sv/nginx/control] action create (up to date)
      * link[/opt/gitlab/init/nginx] action create (up to date)
      * file[/opt/gitlab/sv/nginx/down] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/service] action create (up to date)
      * link[/opt/gitlab/service/nginx] action create (up to date)
      * ruby_block[wait for nginx service socket] action run (skipped due to not_if)
      * file[/var/log/gitlab/nginx/current] action touch (skipped due to only_if)
[2024-03-06T20:00:55+00:00] INFO: ruby_block[restart_log_service] called
      - execute the ruby block restart_log_service
    * directory[/opt/gitlab/service] action create (up to date)
    * link[/opt/gitlab/service/nginx] action create (up to date)
    * ruby_block[wait for nginx service socket] action run (skipped due to not_if)
    * file[/var/log/gitlab/nginx/current] action touch (skipped due to only_if)
  
  * execute[reload nginx] action nothing (skipped due to action :nothing)
Recipe: gitlab::nginx
  * execute[/opt/gitlab/bin/gitlab-ctl start nginx] action run
    [execute] ok: run: nginx: (pid 901) 3s
[2024-03-06T20:00:56+00:00] INFO: execute[/opt/gitlab/bin/gitlab-ctl start nginx] ran successfully
    - execute /opt/gitlab/bin/gitlab-ctl start nginx
Recipe: gitlab::remote-syslog_disable
  * service[remote-syslog] action nothing (skipped due to action :nothing)
  * runit_service[remote-syslog] action disable
    * ruby_block[disable remote-syslog] action run (skipped due to only_if)
     (up to date)
Recipe: gitlab::bootstrap
  * file[/var/opt/gitlab/bootstrapped] action create[2024-03-06T20:00:56+00:00] INFO: file[/var/opt/gitlab/bootstrapped] created file /var/opt/gitlab/bootstrapped

    - create new file /var/opt/gitlab/bootstrapped[2024-03-06T20:00:56+00:00] INFO: file[/var/opt/gitlab/bootstrapped] updated file contents /var/opt/gitlab/bootstrapped

    - update content in file /var/opt/gitlab/bootstrapped from none to 4ae00c
    --- /var/opt/gitlab/bootstrapped    2024-03-06 20:00:56.101081395 +0000
    +++ /var/opt/gitlab/.chef-bootstrapped20240306-34-n46ku7    2024-03-06 20:00:56.101081395 +0000
    @@ -1 +1,2 @@
    +All your bootstraps are belong to Chef[2024-03-06T20:00:56+00:00] INFO: file[/var/opt/gitlab/bootstrapped] owner changed to 0
[2024-03-06T20:00:56+00:00] INFO: file[/var/opt/gitlab/bootstrapped] group changed to 0
[2024-03-06T20:00:56+00:00] INFO: file[/var/opt/gitlab/bootstrapped] mode changed to 600

    - change mode from '' to '0600'
    - change owner from '' to 'root'
    - change group from '' to 'root'
Recipe: gitlab::storage-check_disable
  * service[storage-check] action nothing (skipped due to action :nothing)
  * runit_service[storage-check] action disable
    * ruby_block[disable storage-check] action run (skipped due to only_if)
     (up to date)
Recipe: gitlab-pages::disable
  * service[gitlab-pages] action nothing (skipped due to action :nothing)
  * runit_service[gitlab-pages] action disable
    * ruby_block[disable gitlab-pages] action run (skipped due to only_if)
     (up to date)
Recipe: registry::disable
  * service[registry] action nothing (skipped due to action :nothing)
  * runit_service[registry] action disable
    * ruby_block[disable registry] action run (skipped due to only_if)
     (up to date)
Recipe: mattermost::disable
  * service[mattermost] action nothing (skipped due to action :nothing)
  * runit_service[mattermost] action disable
    * ruby_block[disable mattermost] action run (skipped due to only_if)
     (up to date)
Recipe: letsencrypt::disable
  * crond_job[letsencrypt-renew] action delete
    * file[/var/opt/gitlab/crond/letsencrypt-renew] action delete (up to date)
     (up to date)
Recipe: gitlab::gitlab-healthcheck
  * template[/opt/gitlab/etc/gitlab-healthcheck-rc] action create[2024-03-06T20:00:56+00:00] INFO: template[/opt/gitlab/etc/gitlab-healthcheck-rc] created file /opt/gitlab/etc/gitlab-healthcheck-rc

    - create new file /opt/gitlab/etc/gitlab-healthcheck-rc[2024-03-06T20:00:56+00:00] INFO: template[/opt/gitlab/etc/gitlab-healthcheck-rc] updated file contents /opt/gitlab/etc/gitlab-healthcheck-rc

    - update content in file /opt/gitlab/etc/gitlab-healthcheck-rc from none to f612c8
    --- /opt/gitlab/etc/gitlab-healthcheck-rc   2024-03-06 20:00:56.145059397 +0000
    +++ /opt/gitlab/etc/.chef-gitlab-healthcheck-rc20240306-34-klhw03   2024-03-06 20:00:56.145059397 +0000
    @@ -1,2 +1,4 @@
    +url='http://localhost:80/help'
    +flags=(--insecure)[2024-03-06T20:00:56+00:00] INFO: template[/opt/gitlab/etc/gitlab-healthcheck-rc] owner changed to 0
[2024-03-06T20:00:56+00:00] INFO: template[/opt/gitlab/etc/gitlab-healthcheck-rc] group changed to 0

    - change owner from '' to 'root'
    - change group from '' to 'root'
Recipe: monitoring::node-exporter_disable
  * service[node-exporter] action nothing (skipped due to action :nothing)
  * runit_service[node-exporter] action disable
    * ruby_block[disable node-exporter] action run (skipped due to only_if)
     (up to date)
  * consul_service[node-exporter] action delete
    * file[/var/opt/gitlab/consul/config.d/node-exporter-service.json] action delete (up to date)
     (up to date)
Recipe: monitoring::gitlab-exporter
  * directory[/var/opt/gitlab/gitlab-exporter] action create[2024-03-06T20:00:56+00:00] INFO: directory[/var/opt/gitlab/gitlab-exporter] created directory /var/opt/gitlab/gitlab-exporter

    - create new directory /var/opt/gitlab/gitlab-exporter[2024-03-06T20:00:56+00:00] INFO: directory[/var/opt/gitlab/gitlab-exporter] owner changed to 998
[2024-03-06T20:00:56+00:00] INFO: directory[/var/opt/gitlab/gitlab-exporter] mode changed to 755

    - change mode from '' to '0755'
    - change owner from '' to 'git'
  * directory[/var/log/gitlab/gitlab-exporter] action create[2024-03-06T20:00:56+00:00] INFO: directory[/var/log/gitlab/gitlab-exporter] created directory /var/log/gitlab/gitlab-exporter

    - create new directory /var/log/gitlab/gitlab-exporter[2024-03-06T20:00:56+00:00] INFO: directory[/var/log/gitlab/gitlab-exporter] owner changed to 998
[2024-03-06T20:00:56+00:00] INFO: directory[/var/log/gitlab/gitlab-exporter] mode changed to 700

    - change mode from '' to '0700'
    - change owner from '' to 'git'
  * env_dir[/opt/gitlab/etc/gitlab-exporter/env] action create
    * directory[/opt/gitlab/etc/gitlab-exporter/env] action create[2024-03-06T20:00:56+00:00] INFO: directory[/opt/gitlab/etc/gitlab-exporter/env] created directory /opt/gitlab/etc/gitlab-exporter/env

      - create new directory /opt/gitlab/etc/gitlab-exporter/env
    * file[/opt/gitlab/etc/gitlab-exporter/env/MALLOC_CONF] action create[2024-03-06T20:00:56+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/MALLOC_CONF] created file /opt/gitlab/etc/gitlab-exporter/env/MALLOC_CONF

      - create new file /opt/gitlab/etc/gitlab-exporter/env/MALLOC_CONF[2024-03-06T20:00:56+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/MALLOC_CONF] updated file contents /opt/gitlab/etc/gitlab-exporter/env/MALLOC_CONF

      - update content in file /opt/gitlab/etc/gitlab-exporter/env/MALLOC_CONF from none to 2ea29b
      - suppressed sensitive resource
    * file[/opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_INIT_SLOTS] action create[2024-03-06T20:00:56+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_INIT_SLOTS] created file /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_INIT_SLOTS

      - create new file /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_INIT_SLOTS[2024-03-06T20:00:56+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_INIT_SLOTS] updated file contents /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_INIT_SLOTS

      - update content in file /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_INIT_SLOTS from none to 47b250
      - suppressed sensitive resource
    * file[/opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MIN_RATIO] action create[2024-03-06T20:00:56+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MIN_RATIO] created file /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MIN_RATIO

      - create new file /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MIN_RATIO[2024-03-06T20:00:56+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MIN_RATIO] updated file contents /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MIN_RATIO

      - update content in file /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MIN_RATIO from none to c945fb
      - suppressed sensitive resource
    * file[/opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MAX_RATIO] action create[2024-03-06T20:00:56+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MAX_RATIO] created file /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MAX_RATIO

      - create new file /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MAX_RATIO[2024-03-06T20:00:56+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MAX_RATIO] updated file contents /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MAX_RATIO

      - update content in file /opt/gitlab/etc/gitlab-exporter/env/RUBY_GC_HEAP_FREE_SLOTS_MAX_RATIO from none to 8a60e9
      - suppressed sensitive resource
    * file[/opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_DIR] action create[2024-03-06T20:00:56+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_DIR] created file /opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_DIR

      - create new file /opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_DIR[2024-03-06T20:00:56+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_DIR] updated file contents /opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_DIR

      - update content in file /opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_DIR from none to 4f45cf
      - suppressed sensitive resource
    * file[/opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_FILE] action create[2024-03-06T20:00:56+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_FILE] created file /opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_FILE

      - create new file /opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_FILE[2024-03-06T20:00:56+00:00] INFO: file[/opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_FILE] updated file contents /opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_FILE

      - update content in file /opt/gitlab/etc/gitlab-exporter/env/SSL_CERT_FILE from none to f7ce84
      - suppressed sensitive resource
  
  * template[/var/opt/gitlab/gitlab-exporter/gitlab-exporter.yml] action create[2024-03-06T20:00:56+00:00] INFO: template[/var/opt/gitlab/gitlab-exporter/gitlab-exporter.yml] created file /var/opt/gitlab/gitlab-exporter/gitlab-exporter.yml

    - create new file /var/opt/gitlab/gitlab-exporter/gitlab-exporter.yml[2024-03-06T20:00:56+00:00] INFO: template[/var/opt/gitlab/gitlab-exporter/gitlab-exporter.yml] updated file contents /var/opt/gitlab/gitlab-exporter/gitlab-exporter.yml

    - update content in file /var/opt/gitlab/gitlab-exporter/gitlab-exporter.yml from none to d60133
    - suppressed sensitive resource[2024-03-06T20:00:56+00:00] INFO: template[/var/opt/gitlab/gitlab-exporter/gitlab-exporter.yml] owner changed to 998
[2024-03-06T20:00:56+00:00] INFO: template[/var/opt/gitlab/gitlab-exporter/gitlab-exporter.yml] mode changed to 600

    - change mode from '' to '0600'
    - change owner from '' to 'git'
[2024-03-06T20:00:56+00:00] INFO: template[/var/opt/gitlab/gitlab-exporter/gitlab-exporter.yml] not queuing delayed action restart on runit_service[gitlab-exporter] (delayed), as it's already been queued
  * version_file[Create version file for GitLab-Exporter] action create
    * file[/var/opt/gitlab/gitlab-exporter/RUBY_VERSION] action create[2024-03-06T20:00:56+00:00] INFO: file[/var/opt/gitlab/gitlab-exporter/RUBY_VERSION] created file /var/opt/gitlab/gitlab-exporter/RUBY_VERSION

      - create new file /var/opt/gitlab/gitlab-exporter/RUBY_VERSION[2024-03-06T20:00:56+00:00] INFO: file[/var/opt/gitlab/gitlab-exporter/RUBY_VERSION] updated file contents /var/opt/gitlab/gitlab-exporter/RUBY_VERSION

      - update content in file /var/opt/gitlab/gitlab-exporter/RUBY_VERSION from none to b4a021
      --- /var/opt/gitlab/gitlab-exporter/RUBY_VERSION  2024-03-06 20:00:56.344959404 +0000
      +++ /var/opt/gitlab/gitlab-exporter/.chef-RUBY_VERSION20240306-34-arhwj7  2024-03-06 20:00:56.344959404 +0000
      @@ -1 +1,2 @@
      +ruby 3.0.6p216 (2023-03-30 revision 23a532679b) [x86_64-linux]
  
[2024-03-06T20:00:56+00:00] INFO: version_file[Create version file for GitLab-Exporter] not queuing delayed action restart on runit_service[gitlab-exporter] (delayed), as it's already been queued
  * service[gitlab-exporter] action nothing (skipped due to action :nothing)
  * runit_service[gitlab-exporter] action enable
    * ruby_block[restart_service] action nothing (skipped due to action :nothing)
    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
    * directory[/opt/gitlab/sv/gitlab-exporter] action create[2024-03-06T20:00:56+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter] created directory /opt/gitlab/sv/gitlab-exporter

      - create new directory /opt/gitlab/sv/gitlab-exporter[2024-03-06T20:00:56+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter] owner changed to 0
[2024-03-06T20:00:56+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter] group changed to 0
[2024-03-06T20:00:56+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * template[/opt/gitlab/sv/gitlab-exporter/run] action create[2024-03-06T20:00:56+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/run] created file /opt/gitlab/sv/gitlab-exporter/run

      - create new file /opt/gitlab/sv/gitlab-exporter/run[2024-03-06T20:00:56+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/run] updated file contents /opt/gitlab/sv/gitlab-exporter/run

      - update content in file /opt/gitlab/sv/gitlab-exporter/run from none to 455cb2
      --- /opt/gitlab/sv/gitlab-exporter/run    2024-03-06 20:00:56.368947405 +0000
      +++ /opt/gitlab/sv/gitlab-exporter/.chef-run20240306-34-bi0fwz    2024-03-06 20:00:56.368947405 +0000
      @@ -1,9 +1,18 @@
      +#!/bin/sh
      +exec 2>&1
      +
      +umask 077
      +exec chpst -P -e /opt/gitlab/etc/gitlab-exporter/env \
      +  -U git:git \
      +  -u git:git \
      +  /opt/gitlab/embedded/bin/gitlab-exporter web \
      +    -c /var/opt/gitlab/gitlab-exporter/gitlab-exporter.yml[2024-03-06T20:00:56+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/run] owner changed to 0
[2024-03-06T20:00:56+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/run] group changed to 0
[2024-03-06T20:00:56+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/run] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/gitlab-exporter/log] action create[2024-03-06T20:00:56+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/log] created directory /opt/gitlab/sv/gitlab-exporter/log

      - create new directory /opt/gitlab/sv/gitlab-exporter/log[2024-03-06T20:00:56+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/log] owner changed to 0
[2024-03-06T20:00:56+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/log] group changed to 0
[2024-03-06T20:00:56+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/log] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/gitlab-exporter/log/main] action create[2024-03-06T20:00:56+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/log/main] created directory /opt/gitlab/sv/gitlab-exporter/log/main

      - create new directory /opt/gitlab/sv/gitlab-exporter/log/main[2024-03-06T20:00:56+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/log/main] owner changed to 0
[2024-03-06T20:00:56+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/log/main] group changed to 0
[2024-03-06T20:00:56+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/log/main] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * template[/opt/gitlab/sv/gitlab-exporter/log/config] action create[2024-03-06T20:00:56+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/config] created file /opt/gitlab/sv/gitlab-exporter/log/config

      - create new file /opt/gitlab/sv/gitlab-exporter/log/config[2024-03-06T20:00:56+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/config] updated file contents /opt/gitlab/sv/gitlab-exporter/log/config

      - update content in file /opt/gitlab/sv/gitlab-exporter/log/config from none to 623c00
      --- /opt/gitlab/sv/gitlab-exporter/log/config     2024-03-06 20:00:56.388937406 +0000
      +++ /opt/gitlab/sv/gitlab-exporter/log/.chef-config20240306-34-guhab9     2024-03-06 20:00:56.388937406 +0000
      @@ -1,6 +1,12 @@
      +s209715200
      +n30
      +t86400
      +!gzip
      +
      +[2024-03-06T20:00:56+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/config] owner changed to 0
[2024-03-06T20:00:56+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/config] group changed to 0
[2024-03-06T20:00:56+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/config] mode changed to 644

      - change mode from '' to '0644'
      - change owner from '' to 'root'
      - change group from '' to 'root'
[2024-03-06T20:00:56+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/config] sending create action to ruby_block[verify_chown_persisted_on_gitlab-exporter] (immediate)
    * ruby_block[verify_chown_persisted_on_gitlab-exporter] action create[2024-03-06T20:00:56+00:00] INFO: ruby_block[verify_chown_persisted_on_gitlab-exporter] called

      - execute the ruby block verify_chown_persisted_on_gitlab-exporter
    * ruby_block[verify_chown_persisted_on_gitlab-exporter] action nothing (skipped due to action :nothing)
    * link[/var/log/gitlab/gitlab-exporter/config] action create[2024-03-06T20:00:56+00:00] INFO: link[/var/log/gitlab/gitlab-exporter/config] created

      - create symlink at /var/log/gitlab/gitlab-exporter/config to /opt/gitlab/sv/gitlab-exporter/log/config
    * template[/opt/gitlab/sv/gitlab-exporter/log/run] action create[2024-03-06T20:00:56+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/run] created file /opt/gitlab/sv/gitlab-exporter/log/run

      - create new file /opt/gitlab/sv/gitlab-exporter/log/run[2024-03-06T20:00:56+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/run] updated file contents /opt/gitlab/sv/gitlab-exporter/log/run

      - update content in file /opt/gitlab/sv/gitlab-exporter/log/run from none to 0b0a31
      --- /opt/gitlab/sv/gitlab-exporter/log/run        2024-03-06 20:00:56.412925406 +0000
      +++ /opt/gitlab/sv/gitlab-exporter/log/.chef-run20240306-34-ijesrq        2024-03-06 20:00:56.408927406 +0000
      @@ -1,5 +1,10 @@
      +#!/bin/sh
      +exec chpst -P \
      +  -U root:root \
      +  -u root:root \
      +  svlogd -tt /var/log/gitlab/gitlab-exporter[2024-03-06T20:00:56+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/run] owner changed to 0
[2024-03-06T20:00:56+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/run] group changed to 0
[2024-03-06T20:00:56+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/run] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/gitlab-exporter/env] action create[2024-03-06T20:00:56+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/env] created directory /opt/gitlab/sv/gitlab-exporter/env

      - create new directory /opt/gitlab/sv/gitlab-exporter/env[2024-03-06T20:00:56+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/env] owner changed to 0
[2024-03-06T20:00:56+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/env] group changed to 0
[2024-03-06T20:00:56+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/env] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * ruby_block[Delete unmanaged env files for gitlab-exporter service] action run (skipped due to only_if)
    * template[/opt/gitlab/sv/gitlab-exporter/check] action create (skipped due to only_if)
    * template[/opt/gitlab/sv/gitlab-exporter/finish] action create (skipped due to only_if)
    * directory[/opt/gitlab/sv/gitlab-exporter/control] action create[2024-03-06T20:00:56+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/control] created directory /opt/gitlab/sv/gitlab-exporter/control

      - create new directory /opt/gitlab/sv/gitlab-exporter/control[2024-03-06T20:00:56+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/control] owner changed to 0
[2024-03-06T20:00:56+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/control] group changed to 0
[2024-03-06T20:00:56+00:00] INFO: directory[/opt/gitlab/sv/gitlab-exporter/control] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * link[/opt/gitlab/init/gitlab-exporter] action create[2024-03-06T20:00:56+00:00] INFO: link[/opt/gitlab/init/gitlab-exporter] created

      - create symlink at /opt/gitlab/init/gitlab-exporter to /opt/gitlab/embedded/bin/sv
    * file[/opt/gitlab/sv/gitlab-exporter/down] action nothing (skipped due to action :nothing)
[2024-03-06T20:00:56+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/run] sending run action to ruby_block[restart_service] (delayed)
    * ruby_block[restart_service] action run (skipped due to only_if)
[2024-03-06T20:00:56+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/config] sending create action to ruby_block[reload_log_service] (delayed)
    * ruby_block[reload_log_service] action create
      * ruby_block[restart_service] action nothing (skipped due to action :nothing)
      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/sv/gitlab-exporter] action create (up to date)
      * template[/opt/gitlab/sv/gitlab-exporter/run] action create (up to date)
      * directory[/opt/gitlab/sv/gitlab-exporter/log] action create (up to date)
      * directory[/opt/gitlab/sv/gitlab-exporter/log/main] action create (up to date)
      * template[/opt/gitlab/sv/gitlab-exporter/log/config] action create (up to date)
      * ruby_block[verify_chown_persisted_on_gitlab-exporter] action nothing (skipped due to action :nothing)
      * link[/var/log/gitlab/gitlab-exporter/config] action create (up to date)
      * template[/opt/gitlab/sv/gitlab-exporter/log/run] action create (up to date)
      * directory[/opt/gitlab/sv/gitlab-exporter/env] action create (up to date)
      * ruby_block[Delete unmanaged env files for gitlab-exporter service] action run (skipped due to only_if)
      * template[/opt/gitlab/sv/gitlab-exporter/check] action create (skipped due to only_if)
      * template[/opt/gitlab/sv/gitlab-exporter/finish] action create (skipped due to only_if)
      * directory[/opt/gitlab/sv/gitlab-exporter/control] action create (up to date)
      * link[/opt/gitlab/init/gitlab-exporter] action create (up to date)
      * file[/opt/gitlab/sv/gitlab-exporter/down] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/service] action create (up to date)
      * link[/opt/gitlab/service/gitlab-exporter] action create[2024-03-06T20:00:56+00:00] INFO: link[/opt/gitlab/service/gitlab-exporter] created

        - create symlink at /opt/gitlab/service/gitlab-exporter to /opt/gitlab/sv/gitlab-exporter
      * ruby_block[wait for gitlab-exporter service socket] action run[2024-03-06T20:00:59+00:00] INFO: ruby_block[wait for gitlab-exporter service socket] called

        - execute the ruby block wait for gitlab-exporter service socket
      * file[/var/log/gitlab/gitlab-exporter/current] action touch (skipped due to only_if)
[2024-03-06T20:00:59+00:00] INFO: ruby_block[reload_log_service] called
      - execute the ruby block reload_log_service
[2024-03-06T20:00:59+00:00] INFO: template[/opt/gitlab/sv/gitlab-exporter/log/run] sending run action to ruby_block[restart_log_service] (delayed)
    * ruby_block[restart_log_service] action run
      * ruby_block[restart_service] action nothing (skipped due to action :nothing)
      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/sv/gitlab-exporter] action create (up to date)
      * template[/opt/gitlab/sv/gitlab-exporter/run] action create (up to date)
      * directory[/opt/gitlab/sv/gitlab-exporter/log] action create (up to date)
      * directory[/opt/gitlab/sv/gitlab-exporter/log/main] action create (up to date)
      * template[/opt/gitlab/sv/gitlab-exporter/log/config] action create (up to date)
      * ruby_block[verify_chown_persisted_on_gitlab-exporter] action nothing (skipped due to action :nothing)
      * link[/var/log/gitlab/gitlab-exporter/config] action create (up to date)
      * template[/opt/gitlab/sv/gitlab-exporter/log/run] action create (up to date)
      * directory[/opt/gitlab/sv/gitlab-exporter/env] action create (up to date)
      * ruby_block[Delete unmanaged env files for gitlab-exporter service] action run (skipped due to only_if)
      * template[/opt/gitlab/sv/gitlab-exporter/check] action create (skipped due to only_if)
      * template[/opt/gitlab/sv/gitlab-exporter/finish] action create (skipped due to only_if)
      * directory[/opt/gitlab/sv/gitlab-exporter/control] action create (up to date)
      * link[/opt/gitlab/init/gitlab-exporter] action create (up to date)
      * file[/opt/gitlab/sv/gitlab-exporter/down] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/service] action create (up to date)
      * link[/opt/gitlab/service/gitlab-exporter] action create (up to date)
      * ruby_block[wait for gitlab-exporter service socket] action run (skipped due to not_if)
      * file[/var/log/gitlab/gitlab-exporter/current] action touch (skipped due to only_if)
[2024-03-06T20:01:01+00:00] INFO: ruby_block[restart_log_service] called
      - execute the ruby block restart_log_service
    * directory[/opt/gitlab/service] action create (up to date)
    * link[/opt/gitlab/service/gitlab-exporter] action create (up to date)
    * ruby_block[wait for gitlab-exporter service socket] action run (skipped due to not_if)
    * file[/var/log/gitlab/gitlab-exporter/current] action touch (skipped due to only_if)
  
  * execute[/opt/gitlab/bin/gitlab-ctl start gitlab-exporter] action run
    [execute] ok: run: gitlab-exporter: (pid 931) 2s
[2024-03-06T20:01:01+00:00] INFO: execute[/opt/gitlab/bin/gitlab-ctl start gitlab-exporter] ran successfully
    - execute /opt/gitlab/bin/gitlab-ctl start gitlab-exporter
  * consul_service[gitlab-exporter] action delete
    * file[/var/opt/gitlab/consul/config.d/gitlab-exporter-service.json] action delete (up to date)
     (up to date)
Recipe: monitoring::redis-exporter
  * directory[/var/log/gitlab/redis-exporter] action create[2024-03-06T20:01:01+00:00] INFO: directory[/var/log/gitlab/redis-exporter] created directory /var/log/gitlab/redis-exporter

    - create new directory /var/log/gitlab/redis-exporter[2024-03-06T20:01:01+00:00] INFO: directory[/var/log/gitlab/redis-exporter] owner changed to 997
[2024-03-06T20:01:01+00:00] INFO: directory[/var/log/gitlab/redis-exporter] mode changed to 700

    - change mode from '' to '0700'
    - change owner from '' to 'gitlab-redis'
  * directory[/opt/gitlab/etc/redis-exporter/env] action create[2024-03-06T20:01:01+00:00] INFO: directory[/opt/gitlab/etc/redis-exporter/env] created directory /opt/gitlab/etc/redis-exporter/env

    - create new directory /opt/gitlab/etc/redis-exporter/env[2024-03-06T20:01:01+00:00] INFO: directory[/opt/gitlab/etc/redis-exporter/env] owner changed to 997
[2024-03-06T20:01:01+00:00] INFO: directory[/opt/gitlab/etc/redis-exporter/env] mode changed to 700

    - change mode from '' to '0700'
    - change owner from '' to 'gitlab-redis'
  * env_dir[/opt/gitlab/etc/redis-exporter/env] action create
    * directory[/opt/gitlab/etc/redis-exporter/env] action create (up to date)
    * file[/opt/gitlab/etc/redis-exporter/env/SSL_CERT_DIR] action create[2024-03-06T20:01:01+00:00] INFO: file[/opt/gitlab/etc/redis-exporter/env/SSL_CERT_DIR] created file /opt/gitlab/etc/redis-exporter/env/SSL_CERT_DIR

      - create new file /opt/gitlab/etc/redis-exporter/env/SSL_CERT_DIR[2024-03-06T20:01:01+00:00] INFO: file[/opt/gitlab/etc/redis-exporter/env/SSL_CERT_DIR] updated file contents /opt/gitlab/etc/redis-exporter/env/SSL_CERT_DIR

      - update content in file /opt/gitlab/etc/redis-exporter/env/SSL_CERT_DIR from none to 4f45cf
      - suppressed sensitive resource
  
  * service[redis-exporter] action nothing (skipped due to action :nothing)
  * runit_service[redis-exporter] action enable
    * ruby_block[restart_service] action nothing (skipped due to action :nothing)
    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
    * directory[/opt/gitlab/sv/redis-exporter] action create[2024-03-06T20:01:01+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter] created directory /opt/gitlab/sv/redis-exporter

      - create new directory /opt/gitlab/sv/redis-exporter[2024-03-06T20:01:01+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter] owner changed to 0
[2024-03-06T20:01:01+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter] group changed to 0
[2024-03-06T20:01:01+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * template[/opt/gitlab/sv/redis-exporter/run] action create[2024-03-06T20:01:01+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/run] created file /opt/gitlab/sv/redis-exporter/run

      - create new file /opt/gitlab/sv/redis-exporter/run[2024-03-06T20:01:01+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/run] updated file contents /opt/gitlab/sv/redis-exporter/run

      - update content in file /opt/gitlab/sv/redis-exporter/run from none to a21d3f
      --- /opt/gitlab/sv/redis-exporter/run     2024-03-06 20:01:01.586337405 +0000
      +++ /opt/gitlab/sv/redis-exporter/.chef-run20240306-34-1wclh7     2024-03-06 20:01:01.586337405 +0000
      @@ -1,8 +1,16 @@
      +#!/bin/sh
      +exec 2>&1
      +
      +umask 077
      +exec chpst -P -e /opt/gitlab/etc/redis-exporter/env \
      +  -U gitlab-redis:git \
      +  -u gitlab-redis:git \
      +  /opt/gitlab/embedded/bin/redis_exporter --web.listen-address=localhost:9121 --redis.addr=unix:///var/opt/gitlab/redis/redis.socket[2024-03-06T20:01:01+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/run] owner changed to 0
[2024-03-06T20:01:01+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/run] group changed to 0
[2024-03-06T20:01:01+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/run] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/redis-exporter/log] action create[2024-03-06T20:01:01+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/log] created directory /opt/gitlab/sv/redis-exporter/log

      - create new directory /opt/gitlab/sv/redis-exporter/log[2024-03-06T20:01:01+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/log] owner changed to 0
[2024-03-06T20:01:01+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/log] group changed to 0
[2024-03-06T20:01:01+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/log] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/redis-exporter/log/main] action create[2024-03-06T20:01:01+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/log/main] created directory /opt/gitlab/sv/redis-exporter/log/main

      - create new directory /opt/gitlab/sv/redis-exporter/log/main[2024-03-06T20:01:01+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/log/main] owner changed to 0
[2024-03-06T20:01:01+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/log/main] group changed to 0
[2024-03-06T20:01:01+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/log/main] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * template[/opt/gitlab/sv/redis-exporter/log/config] action create[2024-03-06T20:01:01+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/config] created file /opt/gitlab/sv/redis-exporter/log/config

      - create new file /opt/gitlab/sv/redis-exporter/log/config[2024-03-06T20:01:01+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/config] updated file contents /opt/gitlab/sv/redis-exporter/log/config

      - update content in file /opt/gitlab/sv/redis-exporter/log/config from none to 623c00
      --- /opt/gitlab/sv/redis-exporter/log/config      2024-03-06 20:01:01.606327406 +0000
      +++ /opt/gitlab/sv/redis-exporter/log/.chef-config20240306-34-16mbj7      2024-03-06 20:01:01.606327406 +0000
      @@ -1,6 +1,12 @@
      +s209715200
      +n30
      +t86400
      +!gzip
      +
      +[2024-03-06T20:01:01+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/config] owner changed to 0
[2024-03-06T20:01:01+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/config] group changed to 0
[2024-03-06T20:01:01+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/config] mode changed to 644

      - change mode from '' to '0644'
      - change owner from '' to 'root'
      - change group from '' to 'root'
[2024-03-06T20:01:01+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/config] sending create action to ruby_block[verify_chown_persisted_on_redis-exporter] (immediate)
    * ruby_block[verify_chown_persisted_on_redis-exporter] action create[2024-03-06T20:01:01+00:00] INFO: ruby_block[verify_chown_persisted_on_redis-exporter] called

      - execute the ruby block verify_chown_persisted_on_redis-exporter
    * ruby_block[verify_chown_persisted_on_redis-exporter] action nothing (skipped due to action :nothing)
    * link[/var/log/gitlab/redis-exporter/config] action create[2024-03-06T20:01:01+00:00] INFO: link[/var/log/gitlab/redis-exporter/config] created

      - create symlink at /var/log/gitlab/redis-exporter/config to /opt/gitlab/sv/redis-exporter/log/config
    * template[/opt/gitlab/sv/redis-exporter/log/run] action create[2024-03-06T20:01:01+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/run] created file /opt/gitlab/sv/redis-exporter/log/run

      - create new file /opt/gitlab/sv/redis-exporter/log/run[2024-03-06T20:01:01+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/run] updated file contents /opt/gitlab/sv/redis-exporter/log/run

      - update content in file /opt/gitlab/sv/redis-exporter/log/run from none to 2dc23f
      --- /opt/gitlab/sv/redis-exporter/log/run 2024-03-06 20:01:01.634313406 +0000
      +++ /opt/gitlab/sv/redis-exporter/log/.chef-run20240306-34-l1sveo 2024-03-06 20:01:01.634313406 +0000
      @@ -1,5 +1,10 @@
      +#!/bin/sh
      +exec chpst -P \
      +  -U root:root \
      +  -u root:root \
      +  svlogd -tt /var/log/gitlab/redis-exporter[2024-03-06T20:01:01+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/run] owner changed to 0
[2024-03-06T20:01:01+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/run] group changed to 0
[2024-03-06T20:01:01+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/run] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/redis-exporter/env] action create[2024-03-06T20:01:01+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/env] created directory /opt/gitlab/sv/redis-exporter/env

      - create new directory /opt/gitlab/sv/redis-exporter/env[2024-03-06T20:01:01+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/env] owner changed to 0
[2024-03-06T20:01:01+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/env] group changed to 0
[2024-03-06T20:01:01+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/env] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * ruby_block[Delete unmanaged env files for redis-exporter service] action run (skipped due to only_if)
    * template[/opt/gitlab/sv/redis-exporter/check] action create (skipped due to only_if)
    * template[/opt/gitlab/sv/redis-exporter/finish] action create (skipped due to only_if)
    * directory[/opt/gitlab/sv/redis-exporter/control] action create[2024-03-06T20:01:01+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/control] created directory /opt/gitlab/sv/redis-exporter/control

      - create new directory /opt/gitlab/sv/redis-exporter/control[2024-03-06T20:01:01+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/control] owner changed to 0
[2024-03-06T20:01:01+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/control] group changed to 0
[2024-03-06T20:01:01+00:00] INFO: directory[/opt/gitlab/sv/redis-exporter/control] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * link[/opt/gitlab/init/redis-exporter] action create[2024-03-06T20:01:01+00:00] INFO: link[/opt/gitlab/init/redis-exporter] created

      - create symlink at /opt/gitlab/init/redis-exporter to /opt/gitlab/embedded/bin/sv
    * file[/opt/gitlab/sv/redis-exporter/down] action nothing (skipped due to action :nothing)
[2024-03-06T20:01:01+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/run] sending run action to ruby_block[restart_service] (delayed)
    * ruby_block[restart_service] action run (skipped due to only_if)
[2024-03-06T20:01:01+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/config] sending create action to ruby_block[reload_log_service] (delayed)
    * ruby_block[reload_log_service] action create
      * ruby_block[restart_service] action nothing (skipped due to action :nothing)
      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/sv/redis-exporter] action create (up to date)
      * template[/opt/gitlab/sv/redis-exporter/run] action create (up to date)
      * directory[/opt/gitlab/sv/redis-exporter/log] action create (up to date)
      * directory[/opt/gitlab/sv/redis-exporter/log/main] action create (up to date)
      * template[/opt/gitlab/sv/redis-exporter/log/config] action create (up to date)
      * ruby_block[verify_chown_persisted_on_redis-exporter] action nothing (skipped due to action :nothing)
      * link[/var/log/gitlab/redis-exporter/config] action create (up to date)
      * template[/opt/gitlab/sv/redis-exporter/log/run] action create (up to date)
      * directory[/opt/gitlab/sv/redis-exporter/env] action create (up to date)
      * ruby_block[Delete unmanaged env files for redis-exporter service] action run (skipped due to only_if)
      * template[/opt/gitlab/sv/redis-exporter/check] action create (skipped due to only_if)
      * template[/opt/gitlab/sv/redis-exporter/finish] action create (skipped due to only_if)
      * directory[/opt/gitlab/sv/redis-exporter/control] action create (up to date)
      * link[/opt/gitlab/init/redis-exporter] action create (up to date)
      * file[/opt/gitlab/sv/redis-exporter/down] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/service] action create (up to date)
      * link[/opt/gitlab/service/redis-exporter] action create[2024-03-06T20:01:01+00:00] INFO: link[/opt/gitlab/service/redis-exporter] created

        - create symlink at /opt/gitlab/service/redis-exporter to /opt/gitlab/sv/redis-exporter
      * ruby_block[wait for redis-exporter service socket] action run[2024-03-06T20:01:06+00:00] INFO: ruby_block[wait for redis-exporter service socket] called

        - execute the ruby block wait for redis-exporter service socket
      * file[/var/log/gitlab/redis-exporter/current] action touch (skipped due to only_if)
[2024-03-06T20:01:07+00:00] INFO: ruby_block[reload_log_service] called
      - execute the ruby block reload_log_service
[2024-03-06T20:01:07+00:00] INFO: template[/opt/gitlab/sv/redis-exporter/log/run] sending run action to ruby_block[restart_log_service] (delayed)
    * ruby_block[restart_log_service] action run
      * ruby_block[restart_service] action nothing (skipped due to action :nothing)
      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/sv/redis-exporter] action create (up to date)
      * template[/opt/gitlab/sv/redis-exporter/run] action create (up to date)
      * directory[/opt/gitlab/sv/redis-exporter/log] action create (up to date)
      * directory[/opt/gitlab/sv/redis-exporter/log/main] action create (up to date)
      * template[/opt/gitlab/sv/redis-exporter/log/config] action create (up to date)
      * ruby_block[verify_chown_persisted_on_redis-exporter] action nothing (skipped due to action :nothing)
      * link[/var/log/gitlab/redis-exporter/config] action create (up to date)
      * template[/opt/gitlab/sv/redis-exporter/log/run] action create (up to date)
      * directory[/opt/gitlab/sv/redis-exporter/env] action create (up to date)
      * ruby_block[Delete unmanaged env files for redis-exporter service] action run (skipped due to only_if)
      * template[/opt/gitlab/sv/redis-exporter/check] action create (skipped due to only_if)
      * template[/opt/gitlab/sv/redis-exporter/finish] action create (skipped due to only_if)
      * directory[/opt/gitlab/sv/redis-exporter/control] action create (up to date)
      * link[/opt/gitlab/init/redis-exporter] action create (up to date)
      * file[/opt/gitlab/sv/redis-exporter/down] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/service] action create (up to date)
      * link[/opt/gitlab/service/redis-exporter] action create (up to date)
      * ruby_block[wait for redis-exporter service socket] action run (skipped due to not_if)
      * file[/var/log/gitlab/redis-exporter/current] action touch (skipped due to only_if)
[2024-03-06T20:01:07+00:00] INFO: ruby_block[restart_log_service] called
      - execute the ruby block restart_log_service
    * directory[/opt/gitlab/service] action create (up to date)
    * link[/opt/gitlab/service/redis-exporter] action create (up to date)
    * ruby_block[wait for redis-exporter service socket] action run (skipped due to not_if)
    * file[/var/log/gitlab/redis-exporter/current] action touch (skipped due to only_if)
  
  * execute[/opt/gitlab/bin/gitlab-ctl start redis-exporter] action run
    [execute] ok: run: redis-exporter: (pid 1017) 2s
[2024-03-06T20:01:07+00:00] INFO: execute[/opt/gitlab/bin/gitlab-ctl start redis-exporter] ran successfully
    - execute /opt/gitlab/bin/gitlab-ctl start redis-exporter
  * consul_service[redis-exporter] action delete
    * file[/var/opt/gitlab/consul/config.d/redis-exporter-service.json] action delete (up to date)
     (up to date)
Recipe: monitoring::user
  * account[Prometheus user and group] action create (up to date)
Recipe: monitoring::prometheus
  * directory[/var/opt/gitlab/prometheus] action create (up to date)
  * directory[/var/opt/gitlab/prometheus/rules] action create[2024-03-06T20:01:07+00:00] INFO: directory[/var/opt/gitlab/prometheus/rules] created directory /var/opt/gitlab/prometheus/rules

    - create new directory /var/opt/gitlab/prometheus/rules[2024-03-06T20:01:07+00:00] INFO: directory[/var/opt/gitlab/prometheus/rules] owner changed to 992
[2024-03-06T20:01:07+00:00] INFO: directory[/var/opt/gitlab/prometheus/rules] mode changed to 750

    - change mode from '' to '0750'
    - change owner from '' to 'gitlab-prometheus'
  * directory[/var/log/gitlab/prometheus] action create[2024-03-06T20:01:07+00:00] INFO: directory[/var/log/gitlab/prometheus] created directory /var/log/gitlab/prometheus

    - create new directory /var/log/gitlab/prometheus[2024-03-06T20:01:07+00:00] INFO: directory[/var/log/gitlab/prometheus] owner changed to 992
[2024-03-06T20:01:07+00:00] INFO: directory[/var/log/gitlab/prometheus] mode changed to 700

    - change mode from '' to '0700'
    - change owner from '' to 'gitlab-prometheus'
  * directory[/opt/gitlab/etc/prometheus/env] action create[2024-03-06T20:01:07+00:00] INFO: directory[/opt/gitlab/etc/prometheus/env] created directory /opt/gitlab/etc/prometheus/env

    - create new directory /opt/gitlab/etc/prometheus/env[2024-03-06T20:01:07+00:00] INFO: directory[/opt/gitlab/etc/prometheus/env] owner changed to 992
[2024-03-06T20:01:07+00:00] INFO: directory[/opt/gitlab/etc/prometheus/env] mode changed to 700

    - change mode from '' to '0700'
    - change owner from '' to 'gitlab-prometheus'
  * env_dir[/opt/gitlab/etc/prometheus/env] action create
    * directory[/opt/gitlab/etc/prometheus/env] action create (up to date)
    * file[/opt/gitlab/etc/prometheus/env/SSL_CERT_DIR] action create[2024-03-06T20:01:07+00:00] INFO: file[/opt/gitlab/etc/prometheus/env/SSL_CERT_DIR] created file /opt/gitlab/etc/prometheus/env/SSL_CERT_DIR

      - create new file /opt/gitlab/etc/prometheus/env/SSL_CERT_DIR[2024-03-06T20:01:07+00:00] INFO: file[/opt/gitlab/etc/prometheus/env/SSL_CERT_DIR] updated file contents /opt/gitlab/etc/prometheus/env/SSL_CERT_DIR

      - update content in file /opt/gitlab/etc/prometheus/env/SSL_CERT_DIR from none to 4f45cf
      - suppressed sensitive resource
  
  * execute[reload prometheus] action nothing (skipped due to action :nothing)
  * file[Prometheus config] action create[2024-03-06T20:01:08+00:00] INFO: file[Prometheus config] created file /var/opt/gitlab/prometheus/prometheus.yml

    - create new file /var/opt/gitlab/prometheus/prometheus.yml[2024-03-06T20:01:08+00:00] INFO: file[Prometheus config] updated file contents /var/opt/gitlab/prometheus/prometheus.yml

    - update content in file /var/opt/gitlab/prometheus/prometheus.yml from none to 6be477
    --- /var/opt/gitlab/prometheus/prometheus.yml       2024-03-06 20:01:08.011123405 +0000
    +++ /var/opt/gitlab/prometheus/.chef-prometheus20240306-34-t1c4fw.yml       2024-03-06 20:01:08.011123405 +0000
    @@ -1,167 +1,334 @@
    +---
    +global:
    +  scrape_interval: 15s
    +  scrape_timeout: 15s
    +  external_labels: {}
    +remote_read: []
    +remote_write: []
    +rule_files:
    +- "/var/opt/gitlab/prometheus/rules/*.rules"
    +scrape_configs:
    +- job_name: prometheus
    +  static_configs:
    +  - targets:
    +    - localhost:9090
    +- job_name: nginx
    +  static_configs:
    +  - targets:
    +    - localhost:8060
    +- job_name: redis
    +  static_configs:
    +  - targets:
    +    - localhost:9121
    +- job_name: postgres
    +  static_configs:
    +  - targets:
    +    - localhost:9187
    +- job_name: gitlab-workhorse
    +  static_configs:
    +  - targets:
    +    - localhost:9229
    +- job_name: gitlab-rails
    +  metrics_path: "/-/metrics"
    +  static_configs:
    +  - targets:
    +    - 127.0.0.1:8080
    +  relabel_configs:
    +  - source_labels:
    +    - __address__
    +    regex: 127.0.0.1:(.*)
    +    replacement: localhost:$1
    +    target_label: instance
    +- job_name: gitlab-sidekiq
    +  static_configs:
    +  - targets:
    +    - 127.0.0.1:8082
    +  relabel_configs:
    +  - source_labels:
    +    - __address__
    +    regex: 127.0.0.1:(.*)
    +    replacement: localhost:$1
    +    target_label: instance
    +- job_name: gitlab_exporter_database
    +  metrics_path: "/database"
    +  static_configs:
    +  - targets:
    +    - localhost:9168
    +- job_name: gitlab_exporter_sidekiq
    +  metrics_path: "/sidekiq"
    +  static_configs:
    +  - targets:
    +    - localhost:9168
    +- job_name: gitlab_exporter_ruby
    +  metrics_path: "/ruby"
    +  static_configs:
    +  - targets:
    +    - localhost:9168
    +- job_name: gitaly
    +  static_configs:
    +  - targets:
    +    - localhost:9236
    +- job_name: kubernetes-cadvisor
    +  scheme: https
    +  tls_config:
    +    ca_file: "/var/run/secrets/kubernetes.io/serviceaccount/ca.crt"
    +    insecure_skip_verify: true
    +  bearer_token_file: "/var/run/secrets/kubernetes.io/serviceaccount/token"
    +  kubernetes_sd_configs:
    +  - role: node
    +    api_server: https://kubernetes.default.svc:443
    +    tls_config:
    +      ca_file: "/var/run/secrets/kubernetes.io/serviceaccount/ca.crt"
    +    bearer_token_file: "/var/run/secrets/kubernetes.io/serviceaccount/token"
    +  relabel_configs:
    +  - action: labelmap
    +    regex: __meta_kubernetes_node_label_(.+)
    +  - target_label: __address__
    +    replacement: kubernetes.default.svc:443
    +  - source_labels:
    +    - __meta_kubernetes_node_name
    +    regex: "(.+)"
    +    target_label: __metrics_path__
    +    replacement: "/api/v1/nodes/${1}/proxy/metrics/cadvisor"
    +  metric_relabel_configs:
    +  - source_labels:
    +    - pod_name
    +    target_label: environment
    +    regex: "(.+)-.+-.+"
    +- job_name: kubernetes-nodes
    +  scheme: https
    +  tls_config:
    +    ca_file: "/var/run/secrets/kubernetes.io/serviceaccount/ca.crt"
    +    insecure_skip_verify: true
    +  bearer_token_file: "/var/run/secrets/kubernetes.io/serviceaccount/token"
    +  kubernetes_sd_configs:
    +  - role: node
    +    api_server: https://kubernetes.default.svc:443
    +    tls_config:
    +      ca_file: "/var/run/secrets/kubernetes.io/serviceaccount/ca.crt"
    +    bearer_token_file: "/var/run/secrets/kubernetes.io/serviceaccount/token"
    +  relabel_configs:
    +  - action: labelmap
    +    regex: __meta_kubernetes_node_label_(.+)
    +  - target_label: __address__
    +    replacement: kubernetes.default.svc:443
    +  - source_labels:
    +    - __meta_kubernetes_node_name
    +    regex: "(.+)"
    +    target_label: __metrics_path__
    +    replacement: "/api/v1/nodes/${1}/proxy/metrics"
    +  metric_relabel_configs:
    +  - source_labels:
    +    - pod_name
    +    target_label: environment
    +    regex: "(.+)-.+-.+"
    +- job_name: kubernetes-pods
    +  tls_config:
    +    ca_file: "/var/run/secrets/kubernetes.io/serviceaccount/ca.crt"
    +    insecure_skip_verify: true
    +  bearer_token_file: "/var/run/secrets/kubernetes.io/serviceaccount/token"
    +  kubernetes_sd_configs:
    +  - role: pod
    +    api_server: https://kubernetes.default.svc:443
    +    tls_config:
    +      ca_file: "/var/run/secrets/kubernetes.io/serviceaccount/ca.crt"
    +    bearer_token_file: "/var/run/secrets/kubernetes.io/serviceaccount/token"
    +  relabel_configs:
    +  - source_labels:
    +    - __meta_kubernetes_pod_annotation_prometheus_io_scrape
    +    action: keep
    +    regex: 'true'
    +  - source_labels:
    +    - __meta_kubernetes_pod_annotation_prometheus_io_path
    +    action: replace
    +    target_label: __metrics_path__
    +    regex: "(.+)"
    +  - source_labels:
    +    - __address__
    +    - __meta_kubernetes_pod_annotation_prometheus_io_port
    +    action: replace
    +    regex: "([^:]+)(?::[0-9]+)?;([0-9]+)"
    +    replacement: "$1:$2"
    +    target_label: __address__
    +  - action: labelmap
    +    regex: __meta_kubernetes_pod_label_(.+)
    +  - source_labels:
    +    - __meta_kubernetes_namespace
    +    action: replace
    +    target_label: kubernetes_namespace
    +  - source_labels:
    +    - __meta_kubernetes_pod_name
    +    action: replace
    +    target_label: kubernetes_pod_name
    +alerting:
    +  alertmanagers:
    +  - static_configs:
    +    - targets:
    +      - localhost:9093[2024-03-06T20:01:08+00:00] INFO: file[Prometheus config] owner changed to 992
[2024-03-06T20:01:08+00:00] INFO: file[Prometheus config] mode changed to 644

    - change mode from '' to '0644'
    - change owner from '' to 'gitlab-prometheus'
  * service[prometheus] action nothing (skipped due to action :nothing)
  * runit_service[prometheus] action enable
    * ruby_block[restart_service] action nothing (skipped due to action :nothing)
    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
    * directory[/opt/gitlab/sv/prometheus] action create[2024-03-06T20:01:08+00:00] INFO: directory[/opt/gitlab/sv/prometheus] created directory /opt/gitlab/sv/prometheus

      - create new directory /opt/gitlab/sv/prometheus[2024-03-06T20:01:08+00:00] INFO: directory[/opt/gitlab/sv/prometheus] owner changed to 0
[2024-03-06T20:01:08+00:00] INFO: directory[/opt/gitlab/sv/prometheus] group changed to 0
[2024-03-06T20:01:08+00:00] INFO: directory[/opt/gitlab/sv/prometheus] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * template[/opt/gitlab/sv/prometheus/run] action create[2024-03-06T20:01:08+00:00] INFO: template[/opt/gitlab/sv/prometheus/run] created file /opt/gitlab/sv/prometheus/run

      - create new file /opt/gitlab/sv/prometheus/run[2024-03-06T20:01:08+00:00] INFO: template[/opt/gitlab/sv/prometheus/run] updated file contents /opt/gitlab/sv/prometheus/run

      - update content in file /opt/gitlab/sv/prometheus/run from none to 60f91b
      --- /opt/gitlab/sv/prometheus/run 2024-03-06 20:01:08.027115406 +0000
      +++ /opt/gitlab/sv/prometheus/.chef-run20240306-34-y5okep 2024-03-06 20:01:08.027115406 +0000
      @@ -1,8 +1,16 @@
      +#!/bin/sh
      +exec 2>&1
      +
      +umask 077
      +exec chpst -P -e /opt/gitlab/etc/prometheus/env \
      +  -U gitlab-prometheus:gitlab-prometheus \
      +  -u gitlab-prometheus:gitlab-prometheus \
      +  /opt/gitlab/embedded/bin/prometheus --web.listen-address=localhost:9090 --storage.tsdb.path=/var/opt/gitlab/prometheus/data --config.file=/var/opt/gitlab/prometheus/prometheus.yml[2024-03-06T20:01:08+00:00] INFO: template[/opt/gitlab/sv/prometheus/run] owner changed to 0
[2024-03-06T20:01:08+00:00] INFO: template[/opt/gitlab/sv/prometheus/run] group changed to 0
[2024-03-06T20:01:08+00:00] INFO: template[/opt/gitlab/sv/prometheus/run] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/prometheus/log] action create[2024-03-06T20:01:08+00:00] INFO: directory[/opt/gitlab/sv/prometheus/log] created directory /opt/gitlab/sv/prometheus/log

      - create new directory /opt/gitlab/sv/prometheus/log[2024-03-06T20:01:08+00:00] INFO: directory[/opt/gitlab/sv/prometheus/log] owner changed to 0
[2024-03-06T20:01:08+00:00] INFO: directory[/opt/gitlab/sv/prometheus/log] group changed to 0
[2024-03-06T20:01:08+00:00] INFO: directory[/opt/gitlab/sv/prometheus/log] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/prometheus/log/main] action create[2024-03-06T20:01:08+00:00] INFO: directory[/opt/gitlab/sv/prometheus/log/main] created directory /opt/gitlab/sv/prometheus/log/main

      - create new directory /opt/gitlab/sv/prometheus/log/main[2024-03-06T20:01:08+00:00] INFO: directory[/opt/gitlab/sv/prometheus/log/main] owner changed to 0
[2024-03-06T20:01:08+00:00] INFO: directory[/opt/gitlab/sv/prometheus/log/main] group changed to 0
[2024-03-06T20:01:08+00:00] INFO: directory[/opt/gitlab/sv/prometheus/log/main] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * template[/opt/gitlab/sv/prometheus/log/config] action create[2024-03-06T20:01:08+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/config] created file /opt/gitlab/sv/prometheus/log/config

      - create new file /opt/gitlab/sv/prometheus/log/config[2024-03-06T20:01:08+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/config] updated file contents /opt/gitlab/sv/prometheus/log/config

      - update content in file /opt/gitlab/sv/prometheus/log/config from none to 623c00
      --- /opt/gitlab/sv/prometheus/log/config  2024-03-06 20:01:08.063097405 +0000
      +++ /opt/gitlab/sv/prometheus/log/.chef-config20240306-34-7km7fn  2024-03-06 20:01:08.063097405 +0000
      @@ -1,6 +1,12 @@
      +s209715200
      +n30
      +t86400
      +!gzip
      +
      +[2024-03-06T20:01:08+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/config] owner changed to 0
[2024-03-06T20:01:08+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/config] group changed to 0
[2024-03-06T20:01:08+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/config] mode changed to 644

      - change mode from '' to '0644'
      - change owner from '' to 'root'
      - change group from '' to 'root'
[2024-03-06T20:01:08+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/config] sending create action to ruby_block[verify_chown_persisted_on_prometheus] (immediate)
    * ruby_block[verify_chown_persisted_on_prometheus] action create[2024-03-06T20:01:08+00:00] INFO: ruby_block[verify_chown_persisted_on_prometheus] called

      - execute the ruby block verify_chown_persisted_on_prometheus
    * ruby_block[verify_chown_persisted_on_prometheus] action nothing (skipped due to action :nothing)
    * link[/var/log/gitlab/prometheus/config] action create[2024-03-06T20:01:08+00:00] INFO: link[/var/log/gitlab/prometheus/config] created

      - create symlink at /var/log/gitlab/prometheus/config to /opt/gitlab/sv/prometheus/log/config
    * template[/opt/gitlab/sv/prometheus/log/run] action create[2024-03-06T20:01:08+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/run] created file /opt/gitlab/sv/prometheus/log/run

      - create new file /opt/gitlab/sv/prometheus/log/run[2024-03-06T20:01:08+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/run] updated file contents /opt/gitlab/sv/prometheus/log/run

      - update content in file /opt/gitlab/sv/prometheus/log/run from none to 8afdb7
      --- /opt/gitlab/sv/prometheus/log/run     2024-03-06 20:01:08.075091405 +0000
      +++ /opt/gitlab/sv/prometheus/log/.chef-run20240306-34-nb7zdt     2024-03-06 20:01:08.075091405 +0000
      @@ -1,5 +1,10 @@
      +#!/bin/sh
      +exec chpst -P \
      +  -U root:root \
      +  -u root:root \
      +  svlogd -tt /var/log/gitlab/prometheus[2024-03-06T20:01:08+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/run] owner changed to 0
[2024-03-06T20:01:08+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/run] group changed to 0
[2024-03-06T20:01:08+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/run] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/prometheus/env] action create[2024-03-06T20:01:08+00:00] INFO: directory[/opt/gitlab/sv/prometheus/env] created directory /opt/gitlab/sv/prometheus/env

      - create new directory /opt/gitlab/sv/prometheus/env[2024-03-06T20:01:08+00:00] INFO: directory[/opt/gitlab/sv/prometheus/env] owner changed to 0
[2024-03-06T20:01:08+00:00] INFO: directory[/opt/gitlab/sv/prometheus/env] group changed to 0
[2024-03-06T20:01:08+00:00] INFO: directory[/opt/gitlab/sv/prometheus/env] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * ruby_block[Delete unmanaged env files for prometheus service] action run (skipped due to only_if)
    * template[/opt/gitlab/sv/prometheus/check] action create (skipped due to only_if)
    * template[/opt/gitlab/sv/prometheus/finish] action create (skipped due to only_if)
    * directory[/opt/gitlab/sv/prometheus/control] action create[2024-03-06T20:01:08+00:00] INFO: directory[/opt/gitlab/sv/prometheus/control] created directory /opt/gitlab/sv/prometheus/control

      - create new directory /opt/gitlab/sv/prometheus/control[2024-03-06T20:01:08+00:00] INFO: directory[/opt/gitlab/sv/prometheus/control] owner changed to 0
[2024-03-06T20:01:08+00:00] INFO: directory[/opt/gitlab/sv/prometheus/control] group changed to 0
[2024-03-06T20:01:08+00:00] INFO: directory[/opt/gitlab/sv/prometheus/control] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * link[/opt/gitlab/init/prometheus] action create[2024-03-06T20:01:08+00:00] INFO: link[/opt/gitlab/init/prometheus] created

      - create symlink at /opt/gitlab/init/prometheus to /opt/gitlab/embedded/bin/sv
    * file[/opt/gitlab/sv/prometheus/down] action nothing (skipped due to action :nothing)
[2024-03-06T20:01:08+00:00] INFO: template[/opt/gitlab/sv/prometheus/run] sending run action to ruby_block[restart_service] (delayed)
    * ruby_block[restart_service] action run (skipped due to only_if)
[2024-03-06T20:01:08+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/config] sending create action to ruby_block[reload_log_service] (delayed)
    * ruby_block[reload_log_service] action create
      * ruby_block[restart_service] action nothing (skipped due to action :nothing)
      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/sv/prometheus] action create (up to date)
      * template[/opt/gitlab/sv/prometheus/run] action create (up to date)
      * directory[/opt/gitlab/sv/prometheus/log] action create (up to date)
      * directory[/opt/gitlab/sv/prometheus/log/main] action create (up to date)
      * template[/opt/gitlab/sv/prometheus/log/config] action create (up to date)
      * ruby_block[verify_chown_persisted_on_prometheus] action nothing (skipped due to action :nothing)
      * link[/var/log/gitlab/prometheus/config] action create (up to date)
      * template[/opt/gitlab/sv/prometheus/log/run] action create (up to date)
      * directory[/opt/gitlab/sv/prometheus/env] action create (up to date)
      * ruby_block[Delete unmanaged env files for prometheus service] action run (skipped due to only_if)
      * template[/opt/gitlab/sv/prometheus/check] action create (skipped due to only_if)
      * template[/opt/gitlab/sv/prometheus/finish] action create (skipped due to only_if)
      * directory[/opt/gitlab/sv/prometheus/control] action create (up to date)
      * link[/opt/gitlab/init/prometheus] action create (up to date)
      * file[/opt/gitlab/sv/prometheus/down] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/service] action create (up to date)
      * link[/opt/gitlab/service/prometheus] action create[2024-03-06T20:01:08+00:00] INFO: link[/opt/gitlab/service/prometheus] created

        - create symlink at /opt/gitlab/service/prometheus to /opt/gitlab/sv/prometheus
      * ruby_block[wait for prometheus service socket] action run[2024-03-06T20:01:12+00:00] INFO: ruby_block[wait for prometheus service socket] called

        - execute the ruby block wait for prometheus service socket
      * file[/var/log/gitlab/prometheus/current] action touch (skipped due to only_if)
[2024-03-06T20:01:13+00:00] INFO: ruby_block[reload_log_service] called
      - execute the ruby block reload_log_service
[2024-03-06T20:01:13+00:00] INFO: template[/opt/gitlab/sv/prometheus/log/run] sending run action to ruby_block[restart_log_service] (delayed)
    * ruby_block[restart_log_service] action run
      * ruby_block[restart_service] action nothing (skipped due to action :nothing)
      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/sv/prometheus] action create (up to date)
      * template[/opt/gitlab/sv/prometheus/run] action create (up to date)
      * directory[/opt/gitlab/sv/prometheus/log] action create (up to date)
      * directory[/opt/gitlab/sv/prometheus/log/main] action create (up to date)
      * template[/opt/gitlab/sv/prometheus/log/config] action create (up to date)
      * ruby_block[verify_chown_persisted_on_prometheus] action nothing (skipped due to action :nothing)
      * link[/var/log/gitlab/prometheus/config] action create (up to date)
      * template[/opt/gitlab/sv/prometheus/log/run] action create (up to date)
      * directory[/opt/gitlab/sv/prometheus/env] action create (up to date)
      * ruby_block[Delete unmanaged env files for prometheus service] action run (skipped due to only_if)
      * template[/opt/gitlab/sv/prometheus/check] action create (skipped due to only_if)
      * template[/opt/gitlab/sv/prometheus/finish] action create (skipped due to only_if)
      * directory[/opt/gitlab/sv/prometheus/control] action create (up to date)
      * link[/opt/gitlab/init/prometheus] action create (up to date)
      * file[/opt/gitlab/sv/prometheus/down] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/service] action create (up to date)
      * link[/opt/gitlab/service/prometheus] action create (up to date)
      * ruby_block[wait for prometheus service socket] action run (skipped due to not_if)
      * file[/var/log/gitlab/prometheus/current] action touch (skipped due to only_if)
[2024-03-06T20:01:13+00:00] INFO: ruby_block[restart_log_service] called
      - execute the ruby block restart_log_service
    * directory[/opt/gitlab/service] action create (up to date)
    * link[/opt/gitlab/service/prometheus] action create (up to date)
    * ruby_block[wait for prometheus service socket] action run (skipped due to not_if)
    * file[/var/log/gitlab/prometheus/current] action touch (skipped due to only_if)
  
  * consul_service[prometheus] action delete
    * file[/var/opt/gitlab/consul/config.d/prometheus-service.json] action delete (up to date)
     (up to date)
  * execute[/opt/gitlab/bin/gitlab-ctl start prometheus] action run
    [execute] ok: run: prometheus: (pid 1046) 3s
[2024-03-06T20:01:14+00:00] INFO: execute[/opt/gitlab/bin/gitlab-ctl start prometheus] ran successfully
    - execute /opt/gitlab/bin/gitlab-ctl start prometheus
  * template[/var/opt/gitlab/prometheus/rules/gitlab.rules] action create[2024-03-06T20:01:14+00:00] INFO: template[/var/opt/gitlab/prometheus/rules/gitlab.rules] created file /var/opt/gitlab/prometheus/rules/gitlab.rules

    - create new file /var/opt/gitlab/prometheus/rules/gitlab.rules[2024-03-06T20:01:14+00:00] INFO: template[/var/opt/gitlab/prometheus/rules/gitlab.rules] updated file contents /var/opt/gitlab/prometheus/rules/gitlab.rules

    - update content in file /var/opt/gitlab/prometheus/rules/gitlab.rules from none to a55956
    --- /var/opt/gitlab/prometheus/rules/gitlab.rules   2024-03-06 20:01:14.467893401 +0000
    +++ /var/opt/gitlab/prometheus/rules/.chef-gitlab20240306-34-qsce0l.rules   2024-03-06 20:01:14.463895400 +0000
    @@ -1,492 +1,984 @@
    +---
    +groups:
    +- name: GitLab
    +  rules:
    +  - record: instance:puma_utilization:ratio
    +    expr: >
    +      sum by (instance) (
    +        puma_active_connections
    +      ) /
    +      sum by (instance) (
    +        puma_max_threads
    +      )
    +  - record: job_route_method_code:gitlab_workhorse_http_request_duration_seconds_count:rate5m
    +    expr: >
    +      sum by (job, route, method, code) (
    +        rate(gitlab_workhorse_http_request_duration_seconds_count[5m])
    +      )
    +
    +  - alert: ServiceDown
    +    expr: avg_over_time(up[5m]) * 100 < 50
    +    annotations:
    +      description: The service {{ $labels.job }} instance {{ $labels.instance }} is
    +        not responding for more than 50% of the time for 5 minutes.
    +      summary: The service {{ $labels.job }} is not responding
    +  - alert: RedisDown
    +    expr: avg_over_time(redis_up[5m]) * 100 < 50
    +    annotations:
    +      description: The Redis service {{ $labels.job }} instance {{ $labels.instance
    +        }} is not responding for more than 50% of the time for 5 minutes.
    +      summary: The Redis service {{ $labels.job }} is not responding
    +  - alert: PostgresDown
    +    expr: avg_over_time(pg_up[5m]) * 100 < 50
    +    annotations:
    +      description: The Postgres service {{ $labels.job }} instance {{ $labels.instance
    +        }} is not responding for more than 50% of the time for 5 minutes.
    +      summary: The Postgres service {{ $labels.job }} is not responding
    +  - alert: PumaQueueing
    +    expr: avg_over_time(puma_queued_connections[30m]) > 1
    +    annotations:
    +      description: Puma instance {{ $labels.instance }} is queueing requests with
    +        an average of {{ $value | printf "%.1f" }} over the last 30 minutes.
    +      summary: Puma is queueing requests
    +  - alert: HighPumaUtilization
    +    expr: instance:puma_utilization:ratio * 100 > 90
    +    for: 60m
    +    annotations:
    +      description: Puma instance {{ $labels.instance }} has more than 90% thread utilization ({{ $value | printf "%.1f" }}%) over the last 60 minutes.
    +      summary: Puma is has high utilization
    +  - alert: SidekiqJobsQueuing
    +    expr: sum by (name) (sidekiq_queue_size) > 0
    +    for: 60m
    +    annotations:
    +      summary: Sidekiq has jobs queued
    +      description: Sidekiq queue {{ $labels.name }} has {{ $value }} jobs queued for 60 minutes.
    +  - alert: HighgRPCResourceExhaustedRate
    +    expr: >
    +      sum without (grpc_code, grpc_method, grpc_service, grpc_type) (
    +        rate(grpc_server_handled_total{grpc_code="ResourceExhausted"}[5m])
    +      ) /
    +      sum without (grpc_code, grpc_method, grpc_service, grpc_type) (
    +        rate(grpc_server_handled_total[5m])
    +      ) * 100 > 1
    +    for: 60m
    +    annotations:
    +      summary: High gRPC ResourceExhausted error rate
    +      description: Job {{ $labels.job }} instance {{ $labels.instance }} gRPC is returning more than 1% ({{ $value | printf "%.1f" }}%) ResourceExhausted errors over the last 60 minutes.
    +  - alert: PostgresDatabaseDeadlocks
    +    expr: increase(pg_stat_database_deadlocks[5m]) > 0
    +    annotations:
    +      summary: Postgres database has deadlocks
    +      description: Postgres database {{ $labels.instance }} had {{ $value | printf "%d" }} deadlocks in the last 5 minutes.
    +  - alert: PostgresDatabaseDeadlockCancels
    +    expr: increase(pg_stat_database_deadlocks[5m]) > 0
    +    annotations:
    +      summary: Postgres database has queries canceled due to deadlocks
    +      description: Postgres database {{ $labels.instance }} had {{ $value | printf "%d" }} queries canceled due to deadlocks in the last 5 minutes.
    +  # Low-traffic - < 10 QPS (600 RPM)
    +  - alert: WorkhorseHighErrorRate
    +    expr: >
    +      (
    +        sum without (job, code) (
    +          job_route_method_code:gitlab_workhorse_http_request_duration_seconds_count:rate5m{code=~"5.."}
    +        ) /
    +        sum without (job,code) (
    +          job_route_method_code:gitlab_workhorse_http_request_duration_seconds_count:rate5m
    +        ) < 10
    +      ) * 100 > 50
    +    annotations:
    +      summary: Workhorse has high error rates
    +      description: Workhorse route {{ $labels.route }} method {{ $labels.method }} has more than 50% errors ({{ $value | printf "%.1f" }}%) for the last 60 minutes.
    +  # High-traffic - >= 10 QPS (600 RPM)
    +  - alert: WorkhorseHighErrorRate
    +    expr: >
    +      (
    +        sum without (job, code) (
    +          job_route_method_code:gitlab_workhorse_http_request_duration_seconds_count:rate5m{code=~"5.."}
    +        ) /
    +        sum without (job,code) (
    +          job_route_method_code:gitlab_workhorse_http_request_duration_seconds_count:rate5m
    +        ) > 10
    +      ) * 100 > 10
    +    annotations:
    +      summary: Workhorse has high error rates
    +      description: Workhorse route {{ $labels.route }} method {{ $labels.method }} has more than 10% errors ({{ $value | printf "%.1f" }}%) for the last 60 minutes.
    +
    +###
    +# These metrics are top-level GitLab Service Level Indicators (SLIs). They can
    +# be used to monitor the overall health of a GitLab instance.
    +- name: Service Level Indicators
    +  interval: 30s
    +  rules:
    +  # Service availability.
    +  - record: gitlab_sli:job:availability:ratio
    +    expr: >
    +      avg by (job) (
    +        avg_over_time(up[30s])
    +      )
    +  # Rails worker/thread capacity.
    +  - record: gitlab_sli:rails_active_connections:avg30s
    +    expr: >
    +      sum(avg_over_time(puma_active_connections[30s]))
    +  - record: gitlab_sli:rails_queued_connections:avg30s
    +    expr: >
    +      sum(avg_over_time(puma_queued_connections[30s]))
    +  - record: gitlab_sli:rails_active_connections:max30s
    +    expr: >
    +      sum(max_over_time(puma_active_connections[30s]))
    +  - record: gitlab_sli:rails_queued_connections:max30s
    +    expr: >
    +      sum(max_over_time(puma_queued_connections[30s]))
    +  - record: gitlab_sli:rails_workers:avg30s
    +    expr: >
    +      count(avg_over_time(ruby_memory_bytes[30s])) or
    +      sum(avg_over_time(puma_max_threads[30s]))
    +  # Redis CPU use.
    +  - record: gitlab_sli:redis_cpu_seconds:rate1m
    +    expr: >
    +      (sum(rate(redis_used_cpu_sys[1m])) + sum(rate(redis_used_cpu_user[1m]))) or
    +      (sum(rate(redis_cpu_sys_seconds_total[1m])) + sum(rate(redis_cpu_user_seconds_total[1m])))
    +  # Workhorse traffic.
    +  - record: gitlab_sli:code_method_route:workhorse_http_request_count:rate1m
    +    expr: >
    +      sum by (code,method,route) (
    +        rate(gitlab_workhorse_http_request_duration_seconds_count[1m])
    +      )
    +  - record: gitlab_sli:code_method_route:workhorse_http_request_duration_seconds:rate1m
    +    expr: >
    +      sum by (code,method,route) (
    +        rate(gitlab_workhorse_http_request_duration_seconds_sum[1m])
    +      )
    +# SLI - Apdex
    +- name: Service Level Indicators - Apdex
    +  interval: 1m
    +  rules:
    +  # Gitaly goserver
    +  # Satisfied -> 0.5 seconds
    +  # Acceptable -> 1 seconds
    +  - record: gitlab_sli:gitlab_component_apdex:ratio
    +    labels:
    +      job: gitaly
    +    expr: >
    +      (
    +        sum(rate(grpc_server_handling_seconds_bucket{job="gitaly",grpc_type="unary",le="0.5",grpc_method!~"GarbageCollect|Fsck|RepackFull|RepackIncremental|CommitLanguages|CreateRepositoryFromURL|UserRebase|UserSquash|CreateFork|UserUpdateBranch|FindRemoteRepository|UserCherryPick|FetchRemote|UserRevert|FindRemoteRootRef"}[1m]))
    +        +
    +        sum(rate(grpc_server_handling_seconds_bucket{job="gitaly",grpc_type="unary",le="1",grpc_method!~"GarbageCollect|Fsck|RepackFull|RepackIncremental|CommitLanguages|CreateRepositoryFromURL|UserRebase|UserSquash|CreateFork|UserUpdateBranch|FindRemoteRepository|UserCherryPick|FetchRemote|UserRevert|FindRemoteRootRef"}[1m]))
    +      )
    +      /
    +      2 / sum(rate(grpc_server_handling_seconds_count{job="gitaly",grpc_type="unary",grpc_method!~"GarbageCollect|Fsck|RepackFull|RepackIncremental|CommitLanguages|CreateRepositoryFromURL|UserRebase|UserSquash|CreateFork|UserUpdateBranch|FindRemoteRepository|UserCherryPick|FetchRemote|UserRevert|FindRemoteRootRef"}[1m]))
    +  # Sidekiq TODO: https://gitlab.com/gitlab-org/gitlab-foss/issues/56752
    +  # - record: gitlab_sli:gitlab_component_apdex:ratio
    +  #   labels:
    +  #     job: gitlab-sidekiq
    +  #   expr: >
    +  #     (
    +  #       sum(rate(sidekiq_jobs_completion_time_seconds_bucket{le="25"}[1m]))
    +  #       +
    +  #       sum(rate(sidekiq_jobs_completion_time_seconds_bucket{le="50"}[1m]))
    +  #     )
    +  #     / 2
    +  #     /
    +  #     sum(rate(sidekiq_jobs_completion_time_seconds_count[1m]))
    +
    +  # Workhorse
    +  # Satisfied -> 1 seconds
    +  # Acceptable -> 10 seconds
    +  - record: gitlab_sli:gitlab_component_apdex:ratio
    +    labels:
    +      job: gitlab-workhorse
    +    expr: >
    +      (
    +        sum(rate(gitlab_workhorse_http_request_duration_seconds_bucket{le="1",route!="^/([^/]+/){1,}[^/]+/uploads\\z",route!="^/api/v4/jobs/request\\z"}[1m]))
    +      +
    +        sum(rate(gitlab_workhorse_http_request_duration_seconds_bucket{le="10",route!="^/([^/]+/){1,}[^/]+/uploads\\z",route!="^/api/v4/jobs/request\\z"}[1m]))
    +      )
    +      /
    +      2 / sum(rate(gitlab_workhorse_http_request_duration_seconds_count{route!="^/([^/]+/){1,}[^/]+/uploads\\z",route!="^/api/v4/jobs/request\\z"}[1m]))
    +
    +# SLI - Errors
    +- name: Service Level Indicators - Errors
    +  interval: 1m
    +  rules:
    +  # PostgreSQL
    +  - record: gitlab_sli:gitlab_component_ops:rate
    +    labels:
    +      job: postgres
    +    expr: >
    +      sum(rate(pg_stat_database_xact_commit[1m])) +
    +      sum(rate(pg_stat_database_xact_rollback[1m]))
    +  - record: gitlab_sli:gitlab_component_errors:rate
    +    labels:
    +      job: postgres
    +    expr: sum(rate(pg_stat_database_xact_rollback[1m]))
    +  # Rails (Puma)
    +  - record: gitlab_sli:gitlab_component_ops:rate
    +    labels:
    +      job: gitlab-rails
    +    expr: >
    +      sum(
    +        rate(http_request_duration_seconds_count{job="gitlab-rails"}[1m])
    +      )
    +  - record: gitlab_sli:gitlab_component_errors:rate
    +    labels:
    +      job: gitlab-rails
    +    expr: >
    +      sum(
    +        rate(http_request_duration_seconds_count{job="gitlab-rails",status=~"5.."}[1m])
    +      )
    +  # Sidekiq TODO: https://gitlab.com/gitlab-org/gitlab-foss/issues/56752
    +  # - record: gitlab_sli:gitlab_component_ops:rate
    +  #   labels:
    +  #     job: gitlab-sidekiq
    +  #   expr: >
    +  #     sum (
    +  #       rate(sidekiq_jobs_started_total{job="gitlab-sidekiq"}[1m])
    +  #     )
    +  # - record: gitlab_sli:gitlab_component_errors:rate
    +  #   labels:
    +  #     job: gitlab-sidekiq
    +  #   expr: >
    +  #     sum (
    +  #       rate(sidekiq_jobs_failed_total{job="gitlab-sidekiq"}[1m])
    +  #     )
    +  # Workhorse
    +  - record: gitlab_sli:gitlab_component_ops:rate
    +    labels:
    +      job: gitlab-workhorse
    +    expr: >
    +      sum(
    +        rate(gitlab_workhorse_http_requests_total{job="gitlab-workhorse"}[1m])
    +      )
    +  - record: gitlab_sli:gitlab_component_errors:rate
    +    labels:
    +      job: gitlab-workhorse
    +    expr: >
    +      sum(
    +        rate(gitlab_workhorse_http_requests_total{job="gitlab-workhorse",code=~"5.."}[1m])
    +      )
    +  ###
    +  # Calculate service error ratios
    +  - record: gitlab_sli:gitlab_component_errors:ratio
    +    expr: >
    +      gitlab_sli:gitlab_component_errors:rate /
    +      gitlab_sli:gitlab_component_ops:rate
    +
    +- name: GitLab Saturation Ratios
    +  interval: 1m
    +  rules:
    +  # type: *, component: cpu
    +  # this measures average CPU across all the cores for the entire fleet for the given service
    +  - record: gitlab_sli:gitlab_component_saturation:ratio
    +    labels:
    +      component: 'cpu'
    +    expr: >
    +      avg(1 - rate(node_cpu_seconds_total{mode="idle"}[1m]))
    +
    +  # type: *, component: single_node_cpu
    +  # this measures the maximum cpu availability across all the codes on a single server
    +  # this can be helpful if CPU is not even distributed across the fleet.
    +  - record: gitlab_sli:gitlab_component_saturation:ratio
    +    labels:
    +      component: 'single_node_cpu'
    +    expr: >
    +      max(
    +        avg(1 - rate(node_cpu_seconds_total{mode="idle"}[1m]))
    +      )
    +
    +  - record: gitlab_sli:gitlab_component_saturation:ratio
    +    labels:
    +      component: 'disk_space'
    +    expr: >
    +      max(
    +        (
    +          (
    +            node_filesystem_size_bytes{fstype=~"ext.|xfs|nfs.?"}
    +            -
    +            node_filesystem_free_bytes{fstype=~"ext.|xfs|nfs.?"}
    +          )
    +          /
    +          node_filesystem_size_bytes{fstype=~"ext.|xfs|nfs.?"}
    +        )
    +      )
    +
    +  - record: gitlab_sli:gitlab_component_saturation:ratio
    +    labels:
    +      component: 'memory'
    +    expr: max (instance:node_memory_utilization:ratio)
    +
    +  - record: gitlab_sli:gitlab_component_saturation:ratio
    +    labels:
    +      component: 'single_threaded_cpu'
    +    expr: >
    +      clamp_max(
    +        max (
    +         (rate(redis_cpu_user_seconds_total[1m]) + rate(redis_cpu_sys_seconds_total[1m])) or
    +         (rate(redis_used_cpu_user[1m]) + rate(redis_used_cpu_sys[1m]))
    +        ),
    +        1
    +      )
    +
    +  - record: gitlab_sli:gitlab_component_saturation:ratio
    +    labels:
    +      component: 'connection_pool'
    +    expr: >
    +      clamp_max(
    +        max(
    +          max_over_time(pgbouncer_pools_server_active_connections{user="gitlab"}[1m]) /
    +          (
    +            (
    +              pgbouncer_pools_server_idle_connections{user="gitlab"} +
    +              pgbouncer_pools_server_active_connections{user="gitlab"} +
    +              pgbouncer_pools_server_testing_connections{user="gitlab"} +
    +              pgbouncer_pools_server_used_connections{user="gitlab"} +
    +              pgbouncer_pools_server_login_connections{user="gitlab"}
    +            )
    +            > 0
    +          )
    +      ), 1)
    +
    +  # type: postgres-delayed, postgres-archive, patroni
    +  - record: gitlab_sli:gitlab_component_saturation:ratio
    +    labels:
    +      component: 'active_db_connections'
    +    expr: >
    +      clamp_max(
    +        max(
    +          sum without(state) (pg_stat_activity_count{datname="gitlabhq_production", state!="idle"})
    +          /
    +          (sum without(state) (pg_stat_activity_count{datname="gitlabhq_production"}) > 0)
    +      ), 1)
    +
    +  # type: redis, redis-cache, component: redis_clients
    +  # Records the saturation of redis client connections against a redis fleet
    +  - record: gitlab_sli:gitlab_component_saturation:ratio
    +    labels:
    +      component: 'redis_clients'
    +    expr: >
    +      max(
    +        max_over_time(redis_connected_clients[1m])
    +        /
    +        redis_config_maxclients
    +      )
    +
    +  # Aggregate over all components within a service using max
    +  - record: gitlab_sli:gitlab_service_saturation:ratio
    +    expr: >
    +      max by (component) (gitlab_sli:gitlab_component_saturation:ratio)
    +
    +  # Calculate the "sapdex" - the saturation apdex for the metric. 1 < less then soft limit, 0.5 < hard limit, else 0
    +  - record: gitlab_sli:gitlab_component_saturation:ratio:sapdex
    +    expr: >
    +      clamp_min(gitlab_sli:gitlab_component_saturation:ratio <= on(component) group_left slo:max:soft:gitlab_sli:gitlab_component_saturation:ratio, 1)
    +      or
    +      clamp_min(clamp_max(gitlab_sli:gitlab_component_saturation:ratio > on(component) group_left slo:max:soft:gitlab_sli:gitlab_component_saturation:ratio, 0.5), 0.5)
    +      or
    +      clamp_max(gitlab_sli:gitlab_component_saturation:ratio > on(component) group_left slo:max:hard:gitlab_sli:gitlab_component_saturation:ratio, 0)
    +
    +  # Open file descriptors
    +  - record: gitlab_sli:gitlab_component_saturation:ratio
    +    labels:
    +      component: 'open_fds'
    +    expr: >
    +      max(
    +        max_over_time(process_open_fds[1m])
    +        /
    +        max_over_time(process_max_fds[1m])
    +      )
    +  - record: gitlab_sli:gitlab_component_saturation:ratio
    +    labels:
    +      component: 'open_ruby_fds'
    +    expr: >
    +      max(
    +        max_over_time(ruby_file_descriptors[1m])
    +        /
    +        max_over_time(ruby_process_max_fds[1m])
    +      )
    +
    +# Unlike other service metrics, we record the stats for each component independently
    +- name: GitLab Saturation Ratios Stats
    +  interval: 5m
    +  rules:
    +  # Average values for each service, over a week
    +  - record: gitlab_sli:gitlab_component_saturation:ratio:avg_over_time_1w
    +    expr: >
    +      avg_over_time(gitlab_sli:gitlab_component_saturation:ratio[1w])
    +
    +  # Using linear week-on-week growth, what prediction to we have for 2w from now?
    +  - record: gitlab_sli:gitlab_component_saturation:ratio:predict_linear_2w
    +    expr: >
    +      predict_linear(gitlab_sli:gitlab_component_saturation:ratio:avg_over_time_1w[1w], 86400 * 14)
    +
    +  # Using linear week-on-week growth, what prediction to we have for 30d from now?
    +  - record: gitlab_sli:gitlab_component_saturation:ratio:predict_linear_30d
    +    expr: >
    +      predict_linear(gitlab_sli:gitlab_component_saturation:ratio:avg_over_time_1w[1w], 86400 * 30)
    +
    +  # Sapdex, average for week
    +  - record: gitlab_sli:gitlab_component_saturation:ratio:sapdex:avg_over_time_1w
    +    expr: >
    +      avg_over_time(gitlab_sli:gitlab_component_saturation:ratio:sapdex[1w])
    +
    +  # Sapdex long term trend forecasting
    +  # Using linear week-on-week growth, what prediction to we have for 30d from now?
    +  - record: gitlab_sli:gitlab_component_saturation:ratio:sapdex:avg_over_time_1w:predict_linear_30d
    +    expr: >
    +      predict_linear(gitlab_sli:gitlab_component_saturation:ratio:sapdex:avg_over_time_1w[1w], 86400 * 30)
    +
    +###
    +# Metrics used by Usage Ping reports. These are primarily for self-managed installations.
    +# See https://docs.gitlab.com/ee/development/telemetry/usage_ping.html#prometheus-queries
    +#
    +- name: GitLab Usage Ping
    +  interval: 5m
    +  rules:
    +  ###
    +  # Application wide metrics
    +  #
    +  - record: gitlab_usage_ping:ops:rate5m
    +    labels:
    +      service: workhorse
    +      component: http_requests
    +    expr: sum (rate (gitlab_workhorse_http_requests_total[5m]))
    +
    +  # Database Primary Performance Indicator: Query apdex
    +  # Target -> 100ms
    +  # Tolerable -> 250ms
    +  - record: gitlab_usage_ping:sql_duration_apdex:ratio_rate5m
    +    expr: >
    +      (
    +        sum(rate(gitlab_sql_duration_seconds_bucket{le="0.1"}[5m]))
    +        +
    +        sum(rate(gitlab_sql_duration_seconds_bucket{le="0.25"}[5m]))
    +      )
    +      /
    +      2
    +      /
    +      (
    +        sum(rate(gitlab_sql_duration_seconds_count[5m])) > 0
    +      )
    +
    +  - record: gitlab_usage_ping:gitaly_apdex:ratio_avg_over_time_5m
    +    expr: avg_over_time(gitlab_sli:gitlab_component_apdex:ratio{job="gitaly"}[5m])
    +
    +  ###
    +  # Node level metrics
    +  #
    +  - record: gitlab_usage_ping:node_cpus:count
    +    expr: max (instance:node_cpus:count) by (instance)
    +  - record: gitlab_usage_ping:node_memory_total_bytes:max
    +    expr: max (node_memory_MemTotal_bytes) by (instance)
    +  - record: gitlab_usage_ping:node_cpu_utilization:avg
    +    expr: avg (instance:node_cpu_utilization:ratio) by (instance)
    +  - record: gitlab_usage_ping:node_memory_utilization:avg
    +    expr: avg (instance:node_memory_utilization:ratio) by (instance)
    +
    +  ###
    +  # Service level metrics
    +  #
    +  - record: gitlab_usage_ping:node_service_process_resident_memory_bytes:avg
    +    expr: avg by (instance, job) ({__name__ =~ "(ruby_){0,1}process_resident_memory_bytes", job != "gitlab_exporter_process"})
    +  - record: gitlab_usage_ping:node_service_process_unique_memory_bytes:avg
    +    expr: avg by (instance, job) ({__name__ =~ "(ruby_){0,1}process_unique_memory_bytes", job != "gitlab_exporter_process"})
    +  - record: gitlab_usage_ping:node_service_process_proportional_memory_bytes:avg
    +    expr: avg by (instance, job) ({__name__ =~ "(ruby_){0,1}process_proportional_memory_bytes", job != "gitlab_exporter_process"})
    +  - record: gitlab_usage_ping:node_service_process:count
    +    expr: >
    +      count by (instance, job) (
    +        {__name__ =~ "(ruby_){0,1}process_start_time_seconds", job != "gitlab_exporter_process"}
    +      )
    +  - record: gitlab_usage_ping:node_service_app_server_workers:sum
    +    labels:
    +      server: puma
    +    expr: sum by (instance, job) (puma_workers)[2024-03-06T20:01:14+00:00] INFO: template[/var/opt/gitlab/prometheus/rules/gitlab.rules] owner changed to 992
[2024-03-06T20:01:14+00:00] INFO: template[/var/opt/gitlab/prometheus/rules/gitlab.rules] mode changed to 644

    - change mode from '' to '0644'
    - change owner from '' to 'gitlab-prometheus'
[2024-03-06T20:01:14+00:00] INFO: template[/var/opt/gitlab/prometheus/rules/gitlab.rules] not queuing delayed action run on execute[reload prometheus] (delayed), as it's already been queued
  * template[/var/opt/gitlab/prometheus/rules/node.rules] action create[2024-03-06T20:01:14+00:00] INFO: template[/var/opt/gitlab/prometheus/rules/node.rules] created file /var/opt/gitlab/prometheus/rules/node.rules

    - create new file /var/opt/gitlab/prometheus/rules/node.rules[2024-03-06T20:01:14+00:00] INFO: template[/var/opt/gitlab/prometheus/rules/node.rules] updated file contents /var/opt/gitlab/prometheus/rules/node.rules

    - update content in file /var/opt/gitlab/prometheus/rules/node.rules from none to bea78d
    --- /var/opt/gitlab/prometheus/rules/node.rules     2024-03-06 20:01:14.479887401 +0000
    +++ /var/opt/gitlab/prometheus/rules/.chef-node20240306-34-clvj5b.rules     2024-03-06 20:01:14.479887401 +0000
    @@ -1,42 +1,84 @@
    +groups:
    +- name: Node
    +  rules:
    +  - record: instance:node_cpus:count
    +    expr: count without(cpu, mode) (node_cpu{mode="idle"})
    +  - record: instance:node_cpus:count
    +    expr: count without(cpu, mode) (node_cpu_seconds_total{mode="idle"})
    +  - record: instance_cpu:node_cpu_seconds_not_idle:rate5m
    +    expr: sum without(mode) (rate(node_cpu{mode!="idle"}[5m]))
    +  - record: instance_cpu:node_cpu_seconds_not_idle:rate5m
    +    expr: sum without(mode) (rate(node_cpu_seconds_total{mode!="idle"}[5m]))
    +  - record: instance_mode:node_cpu_seconds:rate5m
    +    expr: sum without(cpu) (rate(node_cpu[5m]))
    +  - record: instance_mode:node_cpu_seconds:rate5m
    +    expr: sum without(cpu) (rate(node_cpu_seconds_total[5m]))
    +  - record: instance:node_cpu_utilization:ratio
    +    expr: sum without(mode) (instance_mode:node_cpu_seconds:rate5m{mode!="idle"})
    +      / instance:node_cpus:count
    +  - record: instance:node_memory_utilization:ratio
    +    expr: >
    +      1 - (
    +        node_memory_MemAvailable_bytes or
    +         (node_memory_MemFree_bytes + node_memory_Buffers_bytes + node_memory_Cached_bytes)
    +      ) / node_memory_MemTotal_bytes
    +  - record: instance:node_filesystem_avail:ratio
    +    expr: node_filesystem_avail_bytes / (node_filesystem_size_bytes > 0)
    +  - alert: FilesystemAlmostFull
    +    expr: instance:node_filesystem_avail:ratio * 100 < 5 and node_filesystem_avail_bytes < 10 * 1024 * 1024 * 1024
    +    for: 10m
    +    annotations:
    +      description: The filesystem {{ $labels.device }}:{{ $labels.mountpoint }} on
    +        {{ $labels.instance }} has {{ $value | printf "%.2f" }}% space available.
    +      summary: The filesystem {{ $labels.device }}:{{ $labels.mountpoint }} is almost
    +        full
    +  - alert: FilesystemFullIn1Day
    +    expr: predict_linear(node_filesystem_avail_bytes[6h], 24 * 3600) < 0
    +    for: 30m
    +    annotations:
    +      description: The filesystem {{ $labels.device }}:{{ $labels.mountpoint }} on
    +        {{ $labels.instance }} will be full in the next 24 hours.
    +      summary: The filesystem {{ $labels.device }}:{{ $labels.mountpoint }} will be
    +        full within 24 hours[2024-03-06T20:01:14+00:00] INFO: template[/var/opt/gitlab/prometheus/rules/node.rules] owner changed to 992
[2024-03-06T20:01:14+00:00] INFO: template[/var/opt/gitlab/prometheus/rules/node.rules] mode changed to 644

    - change mode from '' to '0644'
    - change owner from '' to 'gitlab-prometheus'
[2024-03-06T20:01:14+00:00] INFO: template[/var/opt/gitlab/prometheus/rules/node.rules] not queuing delayed action run on execute[reload prometheus] (delayed), as it's already been queued
Recipe: monitoring::alertmanager
  * directory[/var/opt/gitlab/alertmanager] action create[2024-03-06T20:01:14+00:00] INFO: directory[/var/opt/gitlab/alertmanager] created directory /var/opt/gitlab/alertmanager

    - create new directory /var/opt/gitlab/alertmanager[2024-03-06T20:01:14+00:00] INFO: directory[/var/opt/gitlab/alertmanager] owner changed to 992
[2024-03-06T20:01:14+00:00] INFO: directory[/var/opt/gitlab/alertmanager] mode changed to 750

    - change mode from '' to '0750'
    - change owner from '' to 'gitlab-prometheus'
  * directory[/var/log/gitlab/alertmanager] action create[2024-03-06T20:01:14+00:00] INFO: directory[/var/log/gitlab/alertmanager] created directory /var/log/gitlab/alertmanager

    - create new directory /var/log/gitlab/alertmanager[2024-03-06T20:01:14+00:00] INFO: directory[/var/log/gitlab/alertmanager] owner changed to 992
[2024-03-06T20:01:14+00:00] INFO: directory[/var/log/gitlab/alertmanager] mode changed to 700

    - change mode from '' to '0700'
    - change owner from '' to 'gitlab-prometheus'
  * directory[/opt/gitlab/etc/alertmanager/env] action create[2024-03-06T20:01:14+00:00] INFO: directory[/opt/gitlab/etc/alertmanager/env] created directory /opt/gitlab/etc/alertmanager/env

    - create new directory /opt/gitlab/etc/alertmanager/env[2024-03-06T20:01:14+00:00] INFO: directory[/opt/gitlab/etc/alertmanager/env] owner changed to 992
[2024-03-06T20:01:14+00:00] INFO: directory[/opt/gitlab/etc/alertmanager/env] mode changed to 700

    - change mode from '' to '0700'
    - change owner from '' to 'gitlab-prometheus'
  * env_dir[/opt/gitlab/etc/alertmanager/env] action create
    * directory[/opt/gitlab/etc/alertmanager/env] action create (up to date)
    * file[/opt/gitlab/etc/alertmanager/env/SSL_CERT_DIR] action create[2024-03-06T20:01:14+00:00] INFO: file[/opt/gitlab/etc/alertmanager/env/SSL_CERT_DIR] created file /opt/gitlab/etc/alertmanager/env/SSL_CERT_DIR

      - create new file /opt/gitlab/etc/alertmanager/env/SSL_CERT_DIR[2024-03-06T20:01:14+00:00] INFO: file[/opt/gitlab/etc/alertmanager/env/SSL_CERT_DIR] updated file contents /opt/gitlab/etc/alertmanager/env/SSL_CERT_DIR

      - update content in file /opt/gitlab/etc/alertmanager/env/SSL_CERT_DIR from none to 4f45cf
      - suppressed sensitive resource
  
  * file[Alertmanager config] action create[2024-03-06T20:01:14+00:00] INFO: file[Alertmanager config] created file /var/opt/gitlab/alertmanager/alertmanager.yml

    - create new file /var/opt/gitlab/alertmanager/alertmanager.yml[2024-03-06T20:01:14+00:00] INFO: file[Alertmanager config] updated file contents /var/opt/gitlab/alertmanager/alertmanager.yml

    - update content in file /var/opt/gitlab/alertmanager/alertmanager.yml from none to 21b7be
    --- /var/opt/gitlab/alertmanager/alertmanager.yml   2024-03-06 20:01:14.531861401 +0000
    +++ /var/opt/gitlab/alertmanager/.chef-alertmanager20240306-34-2rgjo9.yml   2024-03-06 20:01:14.531861401 +0000
    @@ -1,9 +1,18 @@
    +---
    +global: {}
    +templates: []
    +route:
    +  receiver: default-receiver
    +  routes: []
    +receivers:
    +- name: default-receiver
    +inhibit_rules: [][2024-03-06T20:01:14+00:00] INFO: file[Alertmanager config] owner changed to 992
[2024-03-06T20:01:14+00:00] INFO: file[Alertmanager config] mode changed to 644

    - change mode from '' to '0644'
    - change owner from '' to 'gitlab-prometheus'
[2024-03-06T20:01:14+00:00] INFO: file[Alertmanager config] not queuing delayed action restart on runit_service[alertmanager] (delayed), as it's already been queued
  * service[alertmanager] action nothing (skipped due to action :nothing)
  * runit_service[alertmanager] action enable
    * ruby_block[restart_service] action nothing (skipped due to action :nothing)
    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
    * directory[/opt/gitlab/sv/alertmanager] action create[2024-03-06T20:01:14+00:00] INFO: directory[/opt/gitlab/sv/alertmanager] created directory /opt/gitlab/sv/alertmanager

      - create new directory /opt/gitlab/sv/alertmanager[2024-03-06T20:01:14+00:00] INFO: directory[/opt/gitlab/sv/alertmanager] owner changed to 0
[2024-03-06T20:01:14+00:00] INFO: directory[/opt/gitlab/sv/alertmanager] group changed to 0
[2024-03-06T20:01:14+00:00] INFO: directory[/opt/gitlab/sv/alertmanager] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * template[/opt/gitlab/sv/alertmanager/run] action create[2024-03-06T20:01:14+00:00] INFO: template[/opt/gitlab/sv/alertmanager/run] created file /opt/gitlab/sv/alertmanager/run

      - create new file /opt/gitlab/sv/alertmanager/run[2024-03-06T20:01:14+00:00] INFO: template[/opt/gitlab/sv/alertmanager/run] updated file contents /opt/gitlab/sv/alertmanager/run

      - update content in file /opt/gitlab/sv/alertmanager/run from none to 36da8b
      --- /opt/gitlab/sv/alertmanager/run       2024-03-06 20:01:14.567843401 +0000
      +++ /opt/gitlab/sv/alertmanager/.chef-run20240306-34-rpn3gr       2024-03-06 20:01:14.563845401 +0000
      @@ -1,8 +1,16 @@
      +#!/bin/sh
      +exec 2>&1
      +
      +umask 077
      +exec chpst -P -e /opt/gitlab/etc/alertmanager/env \
      +  -U gitlab-prometheus:gitlab-prometheus \
      +  -u gitlab-prometheus:gitlab-prometheus \
      +  /opt/gitlab/embedded/bin/alertmanager --web.listen-address=localhost:9093 --storage.path=/var/opt/gitlab/alertmanager/data --config.file=/var/opt/gitlab/alertmanager/alertmanager.yml[2024-03-06T20:01:14+00:00] INFO: template[/opt/gitlab/sv/alertmanager/run] owner changed to 0
[2024-03-06T20:01:14+00:00] INFO: template[/opt/gitlab/sv/alertmanager/run] group changed to 0
[2024-03-06T20:01:14+00:00] INFO: template[/opt/gitlab/sv/alertmanager/run] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/alertmanager/log] action create[2024-03-06T20:01:14+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/log] created directory /opt/gitlab/sv/alertmanager/log

      - create new directory /opt/gitlab/sv/alertmanager/log[2024-03-06T20:01:14+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/log] owner changed to 0
[2024-03-06T20:01:14+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/log] group changed to 0
[2024-03-06T20:01:14+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/log] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/alertmanager/log/main] action create[2024-03-06T20:01:14+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/log/main] created directory /opt/gitlab/sv/alertmanager/log/main

      - create new directory /opt/gitlab/sv/alertmanager/log/main[2024-03-06T20:01:14+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/log/main] owner changed to 0
[2024-03-06T20:01:14+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/log/main] group changed to 0
[2024-03-06T20:01:14+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/log/main] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * template[/opt/gitlab/sv/alertmanager/log/config] action create[2024-03-06T20:01:14+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/config] created file /opt/gitlab/sv/alertmanager/log/config

      - create new file /opt/gitlab/sv/alertmanager/log/config[2024-03-06T20:01:14+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/config] updated file contents /opt/gitlab/sv/alertmanager/log/config

      - update content in file /opt/gitlab/sv/alertmanager/log/config from none to 623c00
      --- /opt/gitlab/sv/alertmanager/log/config        2024-03-06 20:01:14.583835400 +0000
      +++ /opt/gitlab/sv/alertmanager/log/.chef-config20240306-34-u1xgrq        2024-03-06 20:01:14.583835400 +0000
      @@ -1,6 +1,12 @@
      +s209715200
      +n30
      +t86400
      +!gzip
      +
      +[2024-03-06T20:01:14+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/config] owner changed to 0
[2024-03-06T20:01:14+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/config] group changed to 0
[2024-03-06T20:01:14+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/config] mode changed to 644

      - change mode from '' to '0644'
      - change owner from '' to 'root'
      - change group from '' to 'root'
[2024-03-06T20:01:14+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/config] sending create action to ruby_block[verify_chown_persisted_on_alertmanager] (immediate)
    * ruby_block[verify_chown_persisted_on_alertmanager] action create[2024-03-06T20:01:14+00:00] INFO: ruby_block[verify_chown_persisted_on_alertmanager] called

      - execute the ruby block verify_chown_persisted_on_alertmanager
    * ruby_block[verify_chown_persisted_on_alertmanager] action nothing (skipped due to action :nothing)
    * link[/var/log/gitlab/alertmanager/config] action create[2024-03-06T20:01:14+00:00] INFO: link[/var/log/gitlab/alertmanager/config] created

      - create symlink at /var/log/gitlab/alertmanager/config to /opt/gitlab/sv/alertmanager/log/config
    * template[/opt/gitlab/sv/alertmanager/log/run] action create[2024-03-06T20:01:14+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/run] created file /opt/gitlab/sv/alertmanager/log/run

      - create new file /opt/gitlab/sv/alertmanager/log/run[2024-03-06T20:01:14+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/run] updated file contents /opt/gitlab/sv/alertmanager/log/run

      - update content in file /opt/gitlab/sv/alertmanager/log/run from none to 9a4626
      --- /opt/gitlab/sv/alertmanager/log/run   2024-03-06 20:01:14.583835400 +0000
      +++ /opt/gitlab/sv/alertmanager/log/.chef-run20240306-34-uio3zm   2024-03-06 20:01:14.583835400 +0000
      @@ -1,5 +1,10 @@
      +#!/bin/sh
      +exec chpst -P \
      +  -U root:root \
      +  -u root:root \
      +  svlogd -tt /var/log/gitlab/alertmanager[2024-03-06T20:01:14+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/run] owner changed to 0
[2024-03-06T20:01:14+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/run] group changed to 0
[2024-03-06T20:01:14+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/run] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/alertmanager/env] action create[2024-03-06T20:01:14+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/env] created directory /opt/gitlab/sv/alertmanager/env

      - create new directory /opt/gitlab/sv/alertmanager/env[2024-03-06T20:01:14+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/env] owner changed to 0
[2024-03-06T20:01:14+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/env] group changed to 0
[2024-03-06T20:01:14+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/env] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * ruby_block[Delete unmanaged env files for alertmanager service] action run (skipped due to only_if)
    * template[/opt/gitlab/sv/alertmanager/check] action create (skipped due to only_if)
    * template[/opt/gitlab/sv/alertmanager/finish] action create (skipped due to only_if)
    * directory[/opt/gitlab/sv/alertmanager/control] action create[2024-03-06T20:01:14+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/control] created directory /opt/gitlab/sv/alertmanager/control

      - create new directory /opt/gitlab/sv/alertmanager/control[2024-03-06T20:01:14+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/control] owner changed to 0
[2024-03-06T20:01:14+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/control] group changed to 0
[2024-03-06T20:01:14+00:00] INFO: directory[/opt/gitlab/sv/alertmanager/control] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * link[/opt/gitlab/init/alertmanager] action create[2024-03-06T20:01:14+00:00] INFO: link[/opt/gitlab/init/alertmanager] created

      - create symlink at /opt/gitlab/init/alertmanager to /opt/gitlab/embedded/bin/sv
    * file[/opt/gitlab/sv/alertmanager/down] action nothing (skipped due to action :nothing)
[2024-03-06T20:01:14+00:00] INFO: template[/opt/gitlab/sv/alertmanager/run] sending run action to ruby_block[restart_service] (delayed)
    * ruby_block[restart_service] action run (skipped due to only_if)
[2024-03-06T20:01:14+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/config] sending create action to ruby_block[reload_log_service] (delayed)
    * ruby_block[reload_log_service] action create
      * ruby_block[restart_service] action nothing (skipped due to action :nothing)
      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/sv/alertmanager] action create (up to date)
      * template[/opt/gitlab/sv/alertmanager/run] action create (up to date)
      * directory[/opt/gitlab/sv/alertmanager/log] action create (up to date)
      * directory[/opt/gitlab/sv/alertmanager/log/main] action create (up to date)
      * template[/opt/gitlab/sv/alertmanager/log/config] action create (up to date)
      * ruby_block[verify_chown_persisted_on_alertmanager] action nothing (skipped due to action :nothing)
      * link[/var/log/gitlab/alertmanager/config] action create (up to date)
      * template[/opt/gitlab/sv/alertmanager/log/run] action create (up to date)
      * directory[/opt/gitlab/sv/alertmanager/env] action create (up to date)
      * ruby_block[Delete unmanaged env files for alertmanager service] action run (skipped due to only_if)
      * template[/opt/gitlab/sv/alertmanager/check] action create (skipped due to only_if)
      * template[/opt/gitlab/sv/alertmanager/finish] action create (skipped due to only_if)
      * directory[/opt/gitlab/sv/alertmanager/control] action create (up to date)
      * link[/opt/gitlab/init/alertmanager] action create (up to date)
      * file[/opt/gitlab/sv/alertmanager/down] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/service] action create (up to date)
      * link[/opt/gitlab/service/alertmanager] action create[2024-03-06T20:01:14+00:00] INFO: link[/opt/gitlab/service/alertmanager] created

        - create symlink at /opt/gitlab/service/alertmanager to /opt/gitlab/sv/alertmanager
      * ruby_block[wait for alertmanager service socket] action run[2024-03-06T20:01:17+00:00] INFO: ruby_block[wait for alertmanager service socket] called

        - execute the ruby block wait for alertmanager service socket
      * file[/var/log/gitlab/alertmanager/current] action touch (skipped due to only_if)
[2024-03-06T20:01:17+00:00] INFO: ruby_block[reload_log_service] called
      - execute the ruby block reload_log_service
[2024-03-06T20:01:17+00:00] INFO: template[/opt/gitlab/sv/alertmanager/log/run] sending run action to ruby_block[restart_log_service] (delayed)
    * ruby_block[restart_log_service] action run
      * ruby_block[restart_service] action nothing (skipped due to action :nothing)
      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/sv/alertmanager] action create (up to date)
      * template[/opt/gitlab/sv/alertmanager/run] action create (up to date)
      * directory[/opt/gitlab/sv/alertmanager/log] action create (up to date)
      * directory[/opt/gitlab/sv/alertmanager/log/main] action create (up to date)
      * template[/opt/gitlab/sv/alertmanager/log/config] action create (up to date)
      * ruby_block[verify_chown_persisted_on_alertmanager] action nothing (skipped due to action :nothing)
      * link[/var/log/gitlab/alertmanager/config] action create (up to date)
      * template[/opt/gitlab/sv/alertmanager/log/run] action create (up to date)
      * directory[/opt/gitlab/sv/alertmanager/env] action create (up to date)
      * ruby_block[Delete unmanaged env files for alertmanager service] action run (skipped due to only_if)
      * template[/opt/gitlab/sv/alertmanager/check] action create (skipped due to only_if)
      * template[/opt/gitlab/sv/alertmanager/finish] action create (skipped due to only_if)
      * directory[/opt/gitlab/sv/alertmanager/control] action create (up to date)
      * link[/opt/gitlab/init/alertmanager] action create (up to date)
      * file[/opt/gitlab/sv/alertmanager/down] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/service] action create (up to date)
      * link[/opt/gitlab/service/alertmanager] action create (up to date)
      * ruby_block[wait for alertmanager service socket] action run (skipped due to not_if)
      * file[/var/log/gitlab/alertmanager/current] action touch (skipped due to only_if)
[2024-03-06T20:01:19+00:00] INFO: ruby_block[restart_log_service] called
      - execute the ruby block restart_log_service
    * directory[/opt/gitlab/service] action create (up to date)
    * link[/opt/gitlab/service/alertmanager] action create (up to date)
    * ruby_block[wait for alertmanager service socket] action run (skipped due to not_if)
    * file[/var/log/gitlab/alertmanager/current] action touch (skipped due to only_if)
  
  * execute[/opt/gitlab/bin/gitlab-ctl start alertmanager] action run
    [execute] ok: run: alertmanager: (pid 1071) 2s
[2024-03-06T20:01:19+00:00] INFO: execute[/opt/gitlab/bin/gitlab-ctl start alertmanager] ran successfully
    - execute /opt/gitlab/bin/gitlab-ctl start alertmanager
Recipe: monitoring::postgres-exporter
  * directory[/var/log/gitlab/postgres-exporter] action create[2024-03-06T20:01:19+00:00] INFO: directory[/var/log/gitlab/postgres-exporter] created directory /var/log/gitlab/postgres-exporter

    - create new directory /var/log/gitlab/postgres-exporter[2024-03-06T20:01:19+00:00] INFO: directory[/var/log/gitlab/postgres-exporter] owner changed to 996
[2024-03-06T20:01:19+00:00] INFO: directory[/var/log/gitlab/postgres-exporter] mode changed to 700

    - change mode from '' to '0700'
    - change owner from '' to 'gitlab-psql'
  * directory[/var/opt/gitlab/postgres-exporter] action create[2024-03-06T20:01:19+00:00] INFO: directory[/var/opt/gitlab/postgres-exporter] created directory /var/opt/gitlab/postgres-exporter

    - create new directory /var/opt/gitlab/postgres-exporter[2024-03-06T20:01:19+00:00] INFO: directory[/var/opt/gitlab/postgres-exporter] owner changed to 996
[2024-03-06T20:01:19+00:00] INFO: directory[/var/opt/gitlab/postgres-exporter] mode changed to 700

    - change mode from '' to '0700'
    - change owner from '' to 'gitlab-psql'
  * env_dir[/opt/gitlab/etc/postgres-exporter/env] action create
    * directory[/opt/gitlab/etc/postgres-exporter/env] action create[2024-03-06T20:01:19+00:00] INFO: directory[/opt/gitlab/etc/postgres-exporter/env] created directory /opt/gitlab/etc/postgres-exporter/env

      - create new directory /opt/gitlab/etc/postgres-exporter/env
    * file[/opt/gitlab/etc/postgres-exporter/env/SSL_CERT_DIR] action create[2024-03-06T20:01:19+00:00] INFO: file[/opt/gitlab/etc/postgres-exporter/env/SSL_CERT_DIR] created file /opt/gitlab/etc/postgres-exporter/env/SSL_CERT_DIR

      - create new file /opt/gitlab/etc/postgres-exporter/env/SSL_CERT_DIR[2024-03-06T20:01:19+00:00] INFO: file[/opt/gitlab/etc/postgres-exporter/env/SSL_CERT_DIR] updated file contents /opt/gitlab/etc/postgres-exporter/env/SSL_CERT_DIR

      - update content in file /opt/gitlab/etc/postgres-exporter/env/SSL_CERT_DIR from none to 4f45cf
      - suppressed sensitive resource
    * file[/opt/gitlab/etc/postgres-exporter/env/DATA_SOURCE_NAME] action create[2024-03-06T20:01:19+00:00] INFO: file[/opt/gitlab/etc/postgres-exporter/env/DATA_SOURCE_NAME] created file /opt/gitlab/etc/postgres-exporter/env/DATA_SOURCE_NAME

      - create new file /opt/gitlab/etc/postgres-exporter/env/DATA_SOURCE_NAME[2024-03-06T20:01:19+00:00] INFO: file[/opt/gitlab/etc/postgres-exporter/env/DATA_SOURCE_NAME] updated file contents /opt/gitlab/etc/postgres-exporter/env/DATA_SOURCE_NAME

      - update content in file /opt/gitlab/etc/postgres-exporter/env/DATA_SOURCE_NAME from none to af4c92
      - suppressed sensitive resource
  
  * service[postgres-exporter] action nothing (skipped due to action :nothing)
  * runit_service[postgres-exporter] action enable
    * ruby_block[restart_service] action nothing (skipped due to action :nothing)
    * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
    * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
    * directory[/opt/gitlab/sv/postgres-exporter] action create[2024-03-06T20:01:19+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter] created directory /opt/gitlab/sv/postgres-exporter

      - create new directory /opt/gitlab/sv/postgres-exporter[2024-03-06T20:01:19+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter] owner changed to 0
[2024-03-06T20:01:19+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter] group changed to 0
[2024-03-06T20:01:19+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * template[/opt/gitlab/sv/postgres-exporter/run] action create[2024-03-06T20:01:19+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/run] created file /opt/gitlab/sv/postgres-exporter/run

      - create new file /opt/gitlab/sv/postgres-exporter/run[2024-03-06T20:01:19+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/run] updated file contents /opt/gitlab/sv/postgres-exporter/run

      - update content in file /opt/gitlab/sv/postgres-exporter/run from none to b40d34
      --- /opt/gitlab/sv/postgres-exporter/run  2024-03-06 20:01:19.541355384 +0000
      +++ /opt/gitlab/sv/postgres-exporter/.chef-run20240306-34-7ts6i1  2024-03-06 20:01:19.541355384 +0000
      @@ -1,6 +1,12 @@
      +#!/bin/sh
      +exec 2>&1
      +
      +umask 077
      +exec chpst -e /opt/gitlab/etc/postgres-exporter/env -P -U gitlab-psql:git -u gitlab-psql:git /opt/gitlab/embedded/bin/postgres_exporter --web.listen-address=localhost:9187 --extend.query-path=/var/opt/gitlab/postgres-exporter/queries.yaml
      +[2024-03-06T20:01:19+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/run] owner changed to 0
[2024-03-06T20:01:19+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/run] group changed to 0
[2024-03-06T20:01:19+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/run] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/postgres-exporter/log] action create[2024-03-06T20:01:19+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/log] created directory /opt/gitlab/sv/postgres-exporter/log

      - create new directory /opt/gitlab/sv/postgres-exporter/log[2024-03-06T20:01:19+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/log] owner changed to 0
[2024-03-06T20:01:19+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/log] group changed to 0
[2024-03-06T20:01:19+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/log] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/postgres-exporter/log/main] action create[2024-03-06T20:01:19+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/log/main] created directory /opt/gitlab/sv/postgres-exporter/log/main

      - create new directory /opt/gitlab/sv/postgres-exporter/log/main[2024-03-06T20:01:19+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/log/main] owner changed to 0
[2024-03-06T20:01:19+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/log/main] group changed to 0
[2024-03-06T20:01:19+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/log/main] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * template[/opt/gitlab/sv/postgres-exporter/log/config] action create[2024-03-06T20:01:19+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/config] created file /opt/gitlab/sv/postgres-exporter/log/config

      - create new file /opt/gitlab/sv/postgres-exporter/log/config[2024-03-06T20:01:19+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/config] updated file contents /opt/gitlab/sv/postgres-exporter/log/config

      - update content in file /opt/gitlab/sv/postgres-exporter/log/config from none to 623c00
      --- /opt/gitlab/sv/postgres-exporter/log/config   2024-03-06 20:01:19.581335385 +0000
      +++ /opt/gitlab/sv/postgres-exporter/log/.chef-config20240306-34-riwt61   2024-03-06 20:01:19.581335385 +0000
      @@ -1,6 +1,12 @@
      +s209715200
      +n30
      +t86400
      +!gzip
      +
      +[2024-03-06T20:01:19+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/config] owner changed to 0
[2024-03-06T20:01:19+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/config] group changed to 0
[2024-03-06T20:01:19+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/config] mode changed to 644

      - change mode from '' to '0644'
      - change owner from '' to 'root'
      - change group from '' to 'root'
[2024-03-06T20:01:19+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/config] sending create action to ruby_block[verify_chown_persisted_on_postgres-exporter] (immediate)
    * ruby_block[verify_chown_persisted_on_postgres-exporter] action create[2024-03-06T20:01:19+00:00] INFO: ruby_block[verify_chown_persisted_on_postgres-exporter] called

      - execute the ruby block verify_chown_persisted_on_postgres-exporter
    * ruby_block[verify_chown_persisted_on_postgres-exporter] action nothing (skipped due to action :nothing)
    * link[/var/log/gitlab/postgres-exporter/config] action create[2024-03-06T20:01:19+00:00] INFO: link[/var/log/gitlab/postgres-exporter/config] created

      - create symlink at /var/log/gitlab/postgres-exporter/config to /opt/gitlab/sv/postgres-exporter/log/config
    * template[/opt/gitlab/sv/postgres-exporter/log/run] action create[2024-03-06T20:01:19+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/run] created file /opt/gitlab/sv/postgres-exporter/log/run

      - create new file /opt/gitlab/sv/postgres-exporter/log/run[2024-03-06T20:01:19+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/run] updated file contents /opt/gitlab/sv/postgres-exporter/log/run

      - update content in file /opt/gitlab/sv/postgres-exporter/log/run from none to fd2977
      --- /opt/gitlab/sv/postgres-exporter/log/run      2024-03-06 20:01:19.601325386 +0000
      +++ /opt/gitlab/sv/postgres-exporter/log/.chef-run20240306-34-vz7lb1      2024-03-06 20:01:19.601325386 +0000
      @@ -1,5 +1,10 @@
      +#!/bin/sh
      +exec chpst -P \
      +  -U root:root \
      +  -u root:root \
      +  svlogd -tt /var/log/gitlab/postgres-exporter[2024-03-06T20:01:19+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/run] owner changed to 0
[2024-03-06T20:01:19+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/run] group changed to 0
[2024-03-06T20:01:19+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/run] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * directory[/opt/gitlab/sv/postgres-exporter/env] action create[2024-03-06T20:01:19+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/env] created directory /opt/gitlab/sv/postgres-exporter/env

      - create new directory /opt/gitlab/sv/postgres-exporter/env[2024-03-06T20:01:19+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/env] owner changed to 0
[2024-03-06T20:01:19+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/env] group changed to 0
[2024-03-06T20:01:19+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/env] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * ruby_block[Delete unmanaged env files for postgres-exporter service] action run (skipped due to only_if)
    * template[/opt/gitlab/sv/postgres-exporter/check] action create (skipped due to only_if)
    * template[/opt/gitlab/sv/postgres-exporter/finish] action create (skipped due to only_if)
    * directory[/opt/gitlab/sv/postgres-exporter/control] action create[2024-03-06T20:01:19+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/control] created directory /opt/gitlab/sv/postgres-exporter/control

      - create new directory /opt/gitlab/sv/postgres-exporter/control[2024-03-06T20:01:19+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/control] owner changed to 0
[2024-03-06T20:01:19+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/control] group changed to 0
[2024-03-06T20:01:19+00:00] INFO: directory[/opt/gitlab/sv/postgres-exporter/control] mode changed to 755

      - change mode from '' to '0755'
      - change owner from '' to 'root'
      - change group from '' to 'root'
    * link[/opt/gitlab/init/postgres-exporter] action create[2024-03-06T20:01:19+00:00] INFO: link[/opt/gitlab/init/postgres-exporter] created

      - create symlink at /opt/gitlab/init/postgres-exporter to /opt/gitlab/embedded/bin/sv
    * file[/opt/gitlab/sv/postgres-exporter/down] action nothing (skipped due to action :nothing)
[2024-03-06T20:01:19+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/run] sending run action to ruby_block[restart_service] (delayed)
    * ruby_block[restart_service] action run (skipped due to only_if)
[2024-03-06T20:01:19+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/config] sending create action to ruby_block[reload_log_service] (delayed)
    * ruby_block[reload_log_service] action create
      * ruby_block[restart_service] action nothing (skipped due to action :nothing)
      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/sv/postgres-exporter] action create (up to date)
      * template[/opt/gitlab/sv/postgres-exporter/run] action create (up to date)
      * directory[/opt/gitlab/sv/postgres-exporter/log] action create (up to date)
      * directory[/opt/gitlab/sv/postgres-exporter/log/main] action create (up to date)
      * template[/opt/gitlab/sv/postgres-exporter/log/config] action create (up to date)
      * ruby_block[verify_chown_persisted_on_postgres-exporter] action nothing (skipped due to action :nothing)
      * link[/var/log/gitlab/postgres-exporter/config] action create (up to date)
      * template[/opt/gitlab/sv/postgres-exporter/log/run] action create (up to date)
      * directory[/opt/gitlab/sv/postgres-exporter/env] action create (up to date)
      * ruby_block[Delete unmanaged env files for postgres-exporter service] action run (skipped due to only_if)
      * template[/opt/gitlab/sv/postgres-exporter/check] action create (skipped due to only_if)
      * template[/opt/gitlab/sv/postgres-exporter/finish] action create (skipped due to only_if)
      * directory[/opt/gitlab/sv/postgres-exporter/control] action create (up to date)
      * link[/opt/gitlab/init/postgres-exporter] action create (up to date)
      * file[/opt/gitlab/sv/postgres-exporter/down] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/service] action create (up to date)
      * link[/opt/gitlab/service/postgres-exporter] action create[2024-03-06T20:01:19+00:00] INFO: link[/opt/gitlab/service/postgres-exporter] created

        - create symlink at /opt/gitlab/service/postgres-exporter to /opt/gitlab/sv/postgres-exporter
      * ruby_block[wait for postgres-exporter service socket] action run[2024-03-06T20:01:23+00:00] INFO: ruby_block[wait for postgres-exporter service socket] called

        - execute the ruby block wait for postgres-exporter service socket
      * file[/var/log/gitlab/postgres-exporter/current] action touch (skipped due to only_if)
[2024-03-06T20:01:23+00:00] INFO: ruby_block[reload_log_service] called
      - execute the ruby block reload_log_service
[2024-03-06T20:01:23+00:00] INFO: template[/opt/gitlab/sv/postgres-exporter/log/run] sending run action to ruby_block[restart_log_service] (delayed)
    * ruby_block[restart_log_service] action run
      * ruby_block[restart_service] action nothing (skipped due to action :nothing)
      * ruby_block[restart_log_service] action nothing (skipped due to action :nothing)
      * ruby_block[reload_log_service] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/sv/postgres-exporter] action create (up to date)
      * template[/opt/gitlab/sv/postgres-exporter/run] action create (up to date)
      * directory[/opt/gitlab/sv/postgres-exporter/log] action create (up to date)
      * directory[/opt/gitlab/sv/postgres-exporter/log/main] action create (up to date)
      * template[/opt/gitlab/sv/postgres-exporter/log/config] action create (up to date)
      * ruby_block[verify_chown_persisted_on_postgres-exporter] action nothing (skipped due to action :nothing)
      * link[/var/log/gitlab/postgres-exporter/config] action create (up to date)
      * template[/opt/gitlab/sv/postgres-exporter/log/run] action create (up to date)
      * directory[/opt/gitlab/sv/postgres-exporter/env] action create (up to date)
      * ruby_block[Delete unmanaged env files for postgres-exporter service] action run (skipped due to only_if)
      * template[/opt/gitlab/sv/postgres-exporter/check] action create (skipped due to only_if)
      * template[/opt/gitlab/sv/postgres-exporter/finish] action create (skipped due to only_if)
      * directory[/opt/gitlab/sv/postgres-exporter/control] action create (up to date)
      * link[/opt/gitlab/init/postgres-exporter] action create (up to date)
      * file[/opt/gitlab/sv/postgres-exporter/down] action nothing (skipped due to action :nothing)
      * directory[/opt/gitlab/service] action create (up to date)
      * link[/opt/gitlab/service/postgres-exporter] action create (up to date)
      * ruby_block[wait for postgres-exporter service socket] action run (skipped due to not_if)
      * file[/var/log/gitlab/postgres-exporter/current] action touch (skipped due to only_if)
[2024-03-06T20:01:25+00:00] INFO: ruby_block[restart_log_service] called
      - execute the ruby block restart_log_service
    * directory[/opt/gitlab/service] action create (up to date)
    * link[/opt/gitlab/service/postgres-exporter] action create (up to date)
    * ruby_block[wait for postgres-exporter service socket] action run (skipped due to not_if)
    * file[/var/log/gitlab/postgres-exporter/current] action touch (skipped due to only_if)
  
  * template[/var/opt/gitlab/postgres-exporter/queries.yaml] action create[2024-03-06T20:01:25+00:00] INFO: template[/var/opt/gitlab/postgres-exporter/queries.yaml] created file /var/opt/gitlab/postgres-exporter/queries.yaml

    - create new file /var/opt/gitlab/postgres-exporter/queries.yaml[2024-03-06T20:01:25+00:00] INFO: template[/var/opt/gitlab/postgres-exporter/queries.yaml] updated file contents /var/opt/gitlab/postgres-exporter/queries.yaml

    - update content in file /var/opt/gitlab/postgres-exporter/queries.yaml from none to 7d7e14
    --- /var/opt/gitlab/postgres-exporter/queries.yaml  2024-03-06 20:01:25.126561389 +0000
    +++ /var/opt/gitlab/postgres-exporter/.chef-queries20240306-34-ywvkc6.yaml  2024-03-06 20:01:25.126561389 +0000
    @@ -1,404 +1,808 @@
    +pg_replication:
    +  query: "SELECT EXTRACT(EPOCH FROM (now() - pg_last_xact_replay_timestamp()))::INT as lag, CASE WHEN pg_is_in_recovery() THEN 1 ELSE 0 END as is_replica"
    +  metrics:
    +    - lag:
    +        usage: "GAUGE"
    +        description: "Replication lag behind master in seconds"
    +    - is_replica:
    +        usage: "GAUGE"
    +        description: "Indicates if this host is a slave"
    +
    +pg_postmaster:
    +  query: "SELECT pg_postmaster_start_time as start_time_seconds from pg_postmaster_start_time()"
    +  metrics:
    +    - start_time_seconds:
    +        usage: "GAUGE"
    +        description: "Time at which postmaster started"
    +
    +pg_total_relation_size:
    +  query: |
    +    SELECT relnamespace::regnamespace as schemaname,
    +           relname as relname,
    +           pg_total_relation_size(oid) bytes
    +      FROM pg_class
    +     WHERE relkind = 'r';
    +  metrics:
    +    - schemaname:
    +        usage: "LABEL"
    +        description: "Name of the schema that this table is in"
    +    - relname:
    +        usage: "LABEL"
    +        description: "Name of this table"
    +    - bytes:
    +        usage: "GAUGE"
    +        description: "total disk space usage for the specified table and associated indexes"
    +
    +pg_blocked:
    +  query: |
    +    SELECT
    +      count(blocked.transactionid) AS queries,
    +      '__transaction__' AS table
    +    FROM pg_catalog.pg_locks blocked
    +    WHERE NOT blocked.granted AND locktype = 'transactionid'
    +    GROUP BY locktype
    +    UNION
    +    SELECT
    +      count(blocked.relation) AS queries,
    +      blocked.relation::regclass::text AS table
    +    FROM pg_catalog.pg_locks blocked
    +    WHERE NOT blocked.granted AND locktype != 'transactionid'
    +    GROUP BY relation
    +  metrics:
    +    - queries:
    +        usage: "GAUGE"
    +        description: "The current number of blocked queries"
    +    - table:
    +        usage: "LABEL"
    +        description: "The table on which a query is blocked"
    +
    +pg_oldest_blocked:
    +  query: |
    +    SELECT coalesce(extract('epoch' from max(clock_timestamp() - state_change)), 0) age_seconds
    +      FROM pg_stat_activity
    +     WHERE wait_event_type = 'Lock'
    +       AND state='active'
    +  metrics:
    +    - age_seconds:
    +        usage: "GAUGE"
    +        description: "Largest number of seconds any transaction is currently waiting on a lock"
    +
    +pg_slow:
    +  query: |
    +    SELECT COUNT(*) AS queries
    +    FROM pg_stat_activity
    +    WHERE state = 'active' AND (now() - query_start) > '1 seconds'::interval
    +  metrics:
    +    - queries:
    +        usage: "GAUGE"
    +        description: "Current number of slow queries"
    +
    +pg_long_running_transactions:
    +  query: |
    +    SELECT COUNT(*) as transactions,
    +    coalesce(MAX(EXTRACT(EPOCH FROM (clock_timestamp() - xact_start))), 0) AS age_in_seconds
    +    FROM pg_stat_activity
    +    WHERE state is distinct from 'idle' AND (now() - xact_start) > '1 minutes'::interval AND query not like 'autovacuum:%'
    +  metrics:
    +    - transactions:
    +        usage: "GAUGE"
    +        description: "Current number of long running transactions"
    +    - age_in_seconds:
    +        usage: "GAUGE"
    +        description: "The current maximum transaction age in seconds"
    +
    +pg_stuck_idle_in_transaction:
    +  query: |
    +    SELECT COUNT(*) AS queries
    +    FROM pg_stat_activity
    +    WHERE state = 'idle in transaction' AND (now() - query_start) > '10 minutes'::interval
    +  metrics:
    +    - queries:
    +        usage: "GAUGE"
    +        description: "Current number of queries that are stuck being idle in transactions"
    +
    +# All xid and lsn metrics here are reported mod 2^52 to ensure they
    +# fit within a float for Prometheus :( Really annoying that counters
    +# aren't stored in a 64-bit integer. Note that for queries that report
    +# floats this only works because postgres_exporter does know to set
    +# extra_float_digits (which it sets to 2). So they don't print in
    +# exponential notation and precision is maintained up to 2^53-1.
    +
    +pg_vacuum:
    +  query: |
    +    SELECT
    +      COUNT(*) AS queries,
    +      MAX(EXTRACT(EPOCH FROM (clock_timestamp() - query_start))) AS age_in_seconds
    +    FROM pg_catalog.pg_stat_activity
    +    WHERE state = 'active' AND trim(query) ~* '\AVACUUM (?!ANALYZE)'
    +  metrics:
    +    - queries:
    +        usage: "GAUGE"
    +        description: "The current number of VACUUM queries"
    +    - age_in_seconds:
    +        usage: "GAUGE"
    +        description: "The current maximum VACUUM query age in seconds"
    +
    +pg_vacuum_analyze:
    +  query: |
    +    SELECT
    +      COUNT(*) AS queries,
    +      MAX(EXTRACT(EPOCH FROM (clock_timestamp() - query_start))) AS age_in_seconds
    +    FROM pg_catalog.pg_stat_activity
    +    WHERE state = 'active' AND trim(query) ~* '\AVACUUM ANALYZE'
    +  metrics:
    +    - queries:
    +        usage: "GAUGE"
    +        description: "The current number of VACUUM ANALYZE queries"
    +    - age_in_seconds:
    +        usage: "GAUGE"
    +        description: "The current maximum VACUUM ANALYZE query age in seconds"
    +
    +pg_stuck_idle_in_transaction:
    +  query: |
    +    SELECT COUNT(*) AS queries
    +    FROM pg_stat_activity
    +    WHERE state = 'idle in transaction' AND (now() - query_start) > '10 minutes'::interval
    +  metrics:
    +    - queries:
    +        usage: "GAUGE"
    +        description: "Current number of queries that are stuck being idle in transactions"
    +
    +pg_vacuum_queue:
    +  #master: true 
    +  # Until postgres_exporter is upgraded. See 
    +  # https://gitlab.com/gitlab-org/omnibus-gitlab/issues/4887
    +  query: |
    +    with table_opts_vs_statistic as (
    +      select
    +        pg_class.oid,
    +        pg_class.relname,
    +        coalesce(nspname, 'public') as schemaname,
    +        pg_class.relpages,
    +        pg_class.reltuples,
    +        case
    +          when array_to_string(reloptions, '') like '%autovacuum_vacuum_threshold%' then regexp_replace(array_to_string(reloptions, ''), '.*autovacuum_vacuum_threshold=([0-9.]+).*', E'\\1')::int8
    +          else current_setting('autovacuum_vacuum_threshold')::int8
    +        end as autovacuum_vacuum_threshold,
    +        case
    +          when array_to_string(reloptions, '') like '%autovacuum_vacuum_scale_factor%' then regexp_replace(array_to_string(reloptions, ''), '.*autovacuum_vacuum_scale_factor=([0-9.]+).*', E'\\1')::numeric
    +          else current_setting('autovacuum_vacuum_scale_factor')::numeric
    +        end as autovacuum_vacuum_scale_factor,
    +        case when array_to_string(reloptions, '') ~ 'autovacuum_enabled=(false|off)' then false else true end as autovacuum_enabled,
    +        n_dead_tup,
    +        last_autovacuum,
    +        last_vacuum
    +      from pg_class
    +      join pg_namespace ns on relnamespace = ns.oid 
    +      join pg_stat_all_tables psat  on psat.relid  = pg_class.oid
    +      where relkind in ('r','m') 
    +    ), p as (
    +      select pgspv.*,a.query,a.wait_event_type,a.wait_event,a.query_start
    +      from pg_stat_progress_vacuum pgspv
    +      left join pg_stat_activity a using (pid)
    +    ) 
    +    select
    +      table_opts_vs_statistic.schemaname as schemaname,
    +      table_opts_vs_statistic.relname as relname,
    +      round((100 * table_opts_vs_statistic.n_dead_tup::numeric / nullif(table_opts_vs_statistic.reltuples, 0))::numeric, 2) as dead_tup_pct,
    +      table_opts_vs_statistic.reltuples::numeric as reltuples,
    +      table_opts_vs_statistic.n_dead_tup,
    +      (relpages::bigint*8*1024) AS table_size_bytes,
    +      'V. Threshold:' || table_opts_vs_statistic.autovacuum_vacuum_threshold
    +        || ', V. Scale Factor: ' || (table_opts_vs_statistic.autovacuum_vacuum_scale_factor)::numeric *100 ||' %'
    +        || case when not autovacuum_enabled then ', DISABLED' else ', enabled' end as "effective_settings",
    +      case
    +        when last_autovacuum > coalesce(last_vacuum, '0001-01-01') then last_autovacuum::timestamp(0)
    +        when last_vacuum is not null then last_vacuum::timestamp(0)
    +        else null
    +      end as "last_vacuumed",
    +      case
    +        when last_autovacuum > coalesce(last_vacuum, '0001-01-01') then 'auto'
    +        when last_vacuum is not null then 'manual'
    +        else null
    +      end as "type",
    +      coalesce(p.phase, 'in queue') as status,
    +      p.pid as pid,
    +      coalesce  (p.query,'')as  action,
    +      case when p.pid is null then null else coalesce(wait_event_type ||'.'|| wait_event, 'f') end as waiting,
    +      round(100.0 * p.heap_blks_scanned / nullif(p.heap_blks_total, 0), 1) AS scanned_pct,
    +      round(100.0 * p.heap_blks_vacuumed / nullif(p.heap_blks_total, 0), 1) AS vacuumed_pct,
    +      extract ('epoch' from  now()-query_start) elapsed_time
    +    from 
    +    table_opts_vs_statistic
    +    full outer join p on p.relid = table_opts_vs_statistic.oid and p.datname = current_database()
    +    where
    +      table_opts_vs_statistic.relpages >= 8
    +      and  autovacuum_vacuum_threshold + (autovacuum_vacuum_scale_factor::numeric * table_opts_vs_statistic.reltuples) < table_opts_vs_statistic.n_dead_tup
    +  metrics:
    +    - schemaname:
    +        usage: "LABEL"
    +        description: "Table Schema"
    +    - relname:
    +        usage: "LABEL"
    +        description: "Table name"
    +    - dead_tup_pct:
    +        usage: "GAUGE"
    +        description: "Estimated dead tuples percent"
    +    - reltuples:
    +        usage: "GAUGE"
    +        description: "Number of tuples in table"
    +    - n_dead_tup:
    +        usage: "GAUGE"
    +        description: "Estimated number of dead tuples"
    +    - table_size_bytes:
    +        usage: "GAUGE"
    +        description: "Estimated table size"
    +    - effective_settings:
    +        usage: "LABEL"
    +        description: "Autovacuums settings"
    +    - last_vacuumed:
    +        usage: "GAUGE"
    +        description: "Last time at which this table was vacuumed"
    +    - type:
    +        usage: "LABEL"
    +        description: "Last vacuum type"
    +    - status:
    +        usage: "LABEL"
    +        description: "Vacuum actual status"
    +    - pid:
    +        usage: "GAUGE"
    +        description: "Vacuum process id"
    +    - action:
    +        usage: "LABEL"
    +        description: "Type of vacuum executed"
    +    - waiting:
    +        usage: "LABEL"
    +        description: "Vacuum queue status"
    +    - scanned_pct:
    +        usage: "GAUGE"
    +        description: "Estimated rows scanned percent"
    +    - vacuumed_pct:
    +        usage: "GAUGE"
    +        description: "Estimated vacuumed rows percent"
    +    - elapsed_time:
    +        usage: "GAUGE"
    +        description: "Elapsed time vacuuming (in seconds)"
    +
    +#
    +# This query extracts marginalia comments from pg_stat_activity and provides a sampled summary of the type of
    +# endpoints that are actively making calls
    +#
    +pg_stat_activity_marginalia_sampler:
    +  query: >
    +    SELECT
    +      usename AS usename,
    +      a.matches[1] AS application,
    +      a.matches[2] AS endpoint,
    +      a.matches[3] AS command,
    +      a.wait_event AS wait_event,
    +      a.state AS state,
    +      a.wait_event_type AS wait_event_type,
    +      COUNT(*) active_count,
    +     MAX(coalesce(age_in_seconds, 0)) AS max_tx_age_in_seconds
    +    FROM (
    +      SELECT
    +        usename,
    +        regexp_matches(query, '^\s*(?:\/\*(?:application:(\w+),?)?(?:correlation_id:\w+,?)?(?:jid:\w+,?)?(?:endpoint_id:([\w/\-\.:\#\s]+),?)?.*?\*\/)?\s*(\w+)') AS matches,
    +        state,
    +        wait_event,
    +        wait_event_type,
    +        EXTRACT(EPOCH FROM (clock_timestamp() - xact_start)) AS age_in_seconds
    +      FROM
    +        pg_stat_activity
    +      ) a
    +    GROUP BY usename, application, endpoint, command, state, wait_event, wait_event_type
    +    ORDER BY active_count DESC
    +  metrics:
    +    - usename:
    +        usage: LABEL
    +        description: The user running the command
    +    - application:
    +        usage: LABEL
    +        description: Name of the application as presented in marginalia comment
    +    - endpoint:
    +        usage: LABEL
    +        description: Name of the web endpoint or sidekiq job as presented in marginalia comment
    +    - command:
    +        usage: LABEL
    +        description: The first word for the running command
    +    - wait_event:
    +        usage: LABEL
    +        description: Wait event  of the activity as presented by pg_stat_activity.wait_event
    +    - state:
    +        usage: LABEL
    +        description: State of the activity as presented by pg_stat_activity.state
    +    - wait_event_type:
    +        usage: LABEL
    +        description: Wait event type of the activity as presented by pg_stat_activity.wait_event_type
    +    - active_count:
    +        usage: GAUGE
    +        description: Number of active queries at time of sample
    +    - max_tx_age_in_seconds:
    +        usage: GAUGE
    +        description: Number of active queries at time of sample
    +
    +# This records long running autovacuum processes. The reason we limit to
    +# long-running processes is to avoid cardinality problems in prometheus. Since
    +# we're only concerned about long running processes we limit the output only to
    +# those that take longer than 5 minutes.
    +pg_stat_activity_autovacuum:
    +  query: >
    +    SELECT
    +      SPLIT_PART(query, '.', 2) AS relname,
    +      EXTRACT(EPOCH FROM (clock_timestamp() - xact_start)) AS age_in_seconds
    +    FROM
    +      pg_stat_activity
    +    WHERE
    +      query like 'autovacuum:%'
    +    AND
    +      EXTRACT(EPOCH FROM (clock_timestamp() - xact_start)) > 300
    +  metrics:
    +    - relname:
    +        usage: LABEL
    +        description: The table being vacuumed
    +    - age_in_seconds:
    +        usage: GAUGE
    +        description: The age of the vacuum process in seconds
    +
    +# Keep track of the number of the total number of autovacuum workers
    +# currently active
    +pg_stat_activity_autovacuum_active:
    +  query: >
    +    SELECT v.phase,
    +           CASE
    +             when a.query ~ '^autovacuum.*to prevent wraparound' then 'wraparound'
    +             when a.query ~* '^vacuum' then 'user'
    +             when a.pid is null then null
    +             ELSE 'regular'
    +           END as mode,
    +           count(1) as workers_count
    +      FROM pg_stat_progress_vacuum v
    +      LEFT JOIN pg_stat_activity a using (pid)
    +     GROUP BY 1,2
    +  metrics:
    +    - phase:
    +        usage: LABEL
    +        description: Vacuum phase
    +    - mode:
    +        usage: LABEL
    +        description: Vacuum mode
    +    - workers_count:
    +        usage: GAUGE
    +        description: The number of active autovacuum workers in this state
    +
    +#
    +# This query extracts marginalia metadata from pg_stat_activity and provides a sampled summary about the long running transactions.
    +#
    +pg_long_running_transactions_marginalia:
    +  query: >
    +    SELECT
    +      activity.matches[1] AS application,
    +      activity.matches[2] AS endpoint,
    +      MAX(age_in_seconds) AS max_age_in_seconds
    +    FROM (
    +      SELECT
    +        regexp_matches(query, '^\s*(?:\/\*(?:application:(\w+),?)?(?:correlation_id:\w+,?)?(?:jid:\w+,?)?(?:endpoint_id:([\w/\-\.:\#\s]+),?)?.*?\*\/)?\s*(\w+)') AS matches,
    +        EXTRACT(EPOCH FROM (clock_timestamp() - xact_start)) AS age_in_seconds
    +      FROM
    +        pg_stat_activity
    +      WHERE state <> 'idle'
    +        AND (clock_timestamp() - xact_start) > '30 seconds'::interval
    +        AND query NOT LIKE 'autovacuum:%'
    +      ) activity
    +    GROUP BY application, endpoint
    +    ORDER BY max_age_in_seconds DESC
    +  metrics:
    +    - application:
    +        usage: LABEL
    +        description: Name of the application as presented in marginalia comment
    +    - endpoint:
    +        usage: LABEL
    +        description: Name of the web endpoint or sidekiq job as presented in marginalia comment
    +    - max_age_in_seconds:
    +        usage: GAUGE
    +        description: The current maximum transaction age in seconds[2024-03-06T20:01:25+00:00] INFO: template[/var/opt/gitlab/postgres-exporter/queries.yaml] owner changed to 996
[2024-03-06T20:01:25+00:00] INFO: template[/var/opt/gitlab/postgres-exporter/queries.yaml] mode changed to 644

    - change mode from '' to '0644'
    - change owner from '' to 'gitlab-psql'
[2024-03-06T20:01:25+00:00] INFO: template[/var/opt/gitlab/postgres-exporter/queries.yaml] not queuing delayed action restart on runit_service[postgres-exporter] (delayed), as it's already been queued
  * execute[/opt/gitlab/bin/gitlab-ctl start postgres-exporter] action run
    [execute] ok: run: postgres-exporter: (pid 1125) 2s
[2024-03-06T20:01:25+00:00] INFO: execute[/opt/gitlab/bin/gitlab-ctl start postgres-exporter] ran successfully
    - execute /opt/gitlab/bin/gitlab-ctl start postgres-exporter
  * consul_service[postgres-exporter] action delete
    * file[/var/opt/gitlab/consul/config.d/postgres-exporter-service.json] action delete (up to date)
     (up to date)
Recipe: monitoring::grafana_disable
  * service[grafana] action nothing (skipped due to action :nothing)
  * runit_service[grafana] action disable
    * ruby_block[disable grafana] action run (skipped due to only_if)
     (up to date)
Recipe: gitlab::database_reindexing_disable
  * crond_job[database-reindexing] action delete
    * file[/var/opt/gitlab/crond/database-reindexing] action delete (up to date)
     (up to date)
[2024-03-06T20:01:25+00:00] INFO: templatesymlink[Create a gitlab.yml and create a symlink to Rails root] sending run action to execute[clear the gitlab-rails cache] (delayed)
Recipe: gitlab::gitlab-rails
  * execute[clear the gitlab-rails cache] action run[2024-03-06T20:01:46+00:00] INFO: execute[clear the gitlab-rails cache] ran successfully

    - execute /opt/gitlab/bin/gitlab-rake cache:clear
[2024-03-06T20:01:46+00:00] INFO: version_file[Create version file for Gitaly] sending hup action to runit_service[gitaly] (delayed)
Recipe: gitaly::enable
  * runit_service[gitaly] action hup[2024-03-06T20:01:46+00:00] INFO: runit_service[gitaly] signalled (HUP)
[2024-03-06T20:01:47+00:00] INFO: runit_service[gitaly] sent hup

    - send hup to runit_service[gitaly]
[2024-03-06T20:01:47+00:00] INFO: version_file[Create version file for Gitlab KAS] sending restart action to runit_service[gitlab-kas] (delayed)
Recipe: gitlab-kas::enable
  * runit_service[gitlab-kas] action restart (up to date)
[2024-03-06T20:01:57+00:00] INFO: directory[/var/opt/gitlab/gitlab-workhorse/sockets] sending restart action to runit_service[gitlab-workhorse] (delayed)
Recipe: gitlab::gitlab-workhorse
  * runit_service[gitlab-workhorse] action restart (up to date)
[2024-03-06T20:01:57+00:00] INFO: env_dir[/opt/gitlab/etc/gitlab-exporter/env] sending restart action to runit_service[gitlab-exporter] (delayed)
Recipe: monitoring::gitlab-exporter
  * runit_service[gitlab-exporter] action restart (up to date)
[2024-03-06T20:01:58+00:00] INFO: env_dir[/opt/gitlab/etc/redis-exporter/env] sending restart action to runit_service[redis-exporter] (delayed)
Recipe: monitoring::redis-exporter
  * runit_service[redis-exporter] action restart (up to date)
[2024-03-06T20:01:59+00:00] INFO: env_dir[/opt/gitlab/etc/prometheus/env] sending restart action to runit_service[prometheus] (delayed)
Recipe: monitoring::prometheus
  * runit_service[prometheus] action restart (up to date)
[2024-03-06T20:01:59+00:00] INFO: file[Prometheus config] sending run action to execute[reload prometheus] (delayed)
  * execute[reload prometheus] action run[2024-03-06T20:01:59+00:00] INFO: execute[reload prometheus] ran successfully

    - execute /opt/gitlab/bin/gitlab-ctl hup prometheus
[2024-03-06T20:01:59+00:00] INFO: env_dir[/opt/gitlab/etc/alertmanager/env] sending restart action to runit_service[alertmanager] (delayed)
Recipe: monitoring::alertmanager
  * runit_service[alertmanager] action restart (up to date)
[2024-03-06T20:02:00+00:00] INFO: env_dir[/opt/gitlab/etc/postgres-exporter/env] sending restart action to runit_service[postgres-exporter] (delayed)
Recipe: monitoring::postgres-exporter
  * runit_service[postgres-exporter] action restart (up to date)
[2024-03-06T20:02:00+00:00] INFO: Cinc Client Run complete in 166.98780836 seconds

Running handlers:
[2024-03-06T20:02:00+00:00] INFO: Running report handlers
Running handlers complete
[2024-03-06T20:02:00+00:00] INFO: Report handlers complete
Infra Phase complete, 512/1484 resources updated in 02 minutes 47 seconds

Notes:
Default admin account has been configured with following details:

root:GVr{5g~aM/3@7wY^FSW-92

NOTE: Because these credentials might be present in your log files in plain text, it is highly recommended to reset the password following https://docs.gitlab.com/ee/security/reset_user_password.html#reset-your-root-password.

gitlab Reconfigured!
Checking for an omnibus managed postgresql: OK
Checking if postgresql['version'] is set: OK
Checking if we already upgraded: OK
The latest version 13.8 is already running, nothing to do
==> /var/log/gitlab/postgresql/current <==
2024-03-06_20:00:06.91258              pg_get_expr(d.adbin, d.adrelid), a.attnotnull, a.atttypid, a.atttypmod,
2024-03-06_20:00:06.91258              c.collname, col_description(a.attrelid, a.attnum) AS comment
2024-03-06_20:00:06.91258         FROM pg_attribute a
2024-03-06_20:00:06.91258         LEFT JOIN pg_attrdef d ON a.attrelid = d.adrelid AND a.attnum = d.adnum
2024-03-06_20:00:06.91259         LEFT JOIN pg_type t ON a.atttypid = t.oid
2024-03-06_20:00:06.91259         LEFT JOIN pg_collation c ON a.attcollation = c.oid AND a.attcollation <> t.typcollation
2024-03-06_20:00:06.91259        WHERE a.attrelid = '"features"'::regclass
2024-03-06_20:00:06.91259          AND a.attnum > 0 AND NOT a.attisdropped
2024-03-06_20:00:06.91259        ORDER BY a.attnum
2024-03-06_20:00:06.91259 

==> /var/log/gitlab/puma/puma_stdout.log <==
=== puma startup: 2024-03-06 20:01:03 +0000 ===
{"timestamp":"2024-03-06T20:01:03.612Z","pid":790,"message":"! Promoting existing objects to old generation..."}
{"timestamp":"2024-03-06T20:01:03.727Z","pid":790,"message":"! Compacting..."}
Note: GC compacting is currently disabled. Refer to `config/initializers_before_autoloader/003_gc_compact.rb` for details.
{"timestamp":"2024-03-06T20:01:03.727Z","pid":790,"message":"! Friendly fork preparation complete."}
{"timestamp":"2024-03-06T20:01:04.074Z","pid":790,"message":"- Worker 0 (PID: 947) booted in 0.34s, phase: 0"}
{"timestamp":"2024-03-06T20:01:04.092Z","pid":790,"message":"- Worker 1 (PID: 949) booted in 0.34s, phase: 0"}
{"timestamp":"2024-03-06T20:01:04.116Z","pid":790,"message":"- Worker 2 (PID: 951) booted in 0.36s, phase: 0"}
{"timestamp":"2024-03-06T20:01:04.119Z","pid":790,"message":"- Worker 3 (PID: 953) booted in 0.36s, phase: 0"}

==> /var/log/gitlab/puma/current <==
2024-03-06_20:00:35.68085 {"timestamp":"2024-03-06T20:00:35.680Z","pid":790,"message":"*   Master PID: 790"}
2024-03-06_20:00:35.68085 {"timestamp":"2024-03-06T20:00:35.680Z","pid":790,"message":"*      Workers: 4"}
2024-03-06_20:00:35.68086 {"timestamp":"2024-03-06T20:00:35.680Z","pid":790,"message":"*     Restarts: (✔) hot (✖) phased"}
2024-03-06_20:00:35.68086 {"timestamp":"2024-03-06T20:00:35.680Z","pid":790,"message":"* Preloading application"}
2024-03-06_20:01:03.60648 {"timestamp":"2024-03-06T20:01:03.605Z","pid":790,"message":"* Listening on unix:///var/opt/gitlab/gitlab-rails/sockets/gitlab.socket"}
2024-03-06_20:01:03.60655 {"timestamp":"2024-03-06T20:01:03.605Z","pid":790,"message":"* Listening on http://127.0.0.1:8080"}
2024-03-06_20:01:03.60655 {"timestamp":"2024-03-06T20:01:03.605Z","pid":790,"message":"! WARNING: Detected 2 Thread(s) started in app boot:"}
2024-03-06_20:01:03.60655 {"timestamp":"2024-03-06T20:01:03.605Z","pid":790,"message":"! #\u003cThread:0x00007faafdcf0968 /opt/gitlab/embedded/lib/ruby/gems/3.0.0/gems/rack-timeout-0.6.3/lib/rack/timeout/support/scheduler.rb:73 sleep\u003e - /opt/gitlab/embedded/lib/ruby/gems/3.0.0/gems/rack-timeout-0.6.3/lib/rack/timeout/support/scheduler.rb:91:in `sleep'"}
2024-03-06_20:01:03.60655 {"timestamp":"2024-03-06T20:01:03.605Z","pid":790,"message":"! #\u003cThread:0x00007faafe2d0ae0 /opt/gitlab/embedded/lib/ruby/gems/3.0.0/gems/sentry-ruby-5.8.0/lib/sentry/session_flusher.rb:81 sleep\u003e - /opt/gitlab/embedded/lib/ruby/gems/3.0.0/gems/sentry-ruby-5.8.0/lib/sentry/session_flusher.rb:83:in `sleep'"}
2024-03-06_20:01:03.60655 {"timestamp":"2024-03-06T20:01:03.606Z","pid":790,"message":"Use Ctrl-C to stop"}

==> /var/log/gitlab/puma/puma_stderr.log <==
=== puma startup: 2024-03-06 20:01:03 +0000 ===

==> /var/log/gitlab/gitlab-exporter/current <==
2024-03-06_20:01:55.35049 - -> /ruby
2024-03-06_20:01:57.71054 == Sinatra has ended his set (crowd applauds)
2024-03-06_20:01:57.71072 [2024-03-06 20:01:57] INFO  going to shutdown ...
2024-03-06_20:01:58.16459 [2024-03-06 20:01:58] INFO  WEBrick::HTTPServer#start done.
2024-03-06_20:01:58.67259 [2024-03-06 20:01:58] INFO  WEBrick 1.8.1
2024-03-06_20:01:58.67261 [2024-03-06 20:01:58] INFO  ruby 3.0.6 (2023-03-30) [x86_64-linux]
2024-03-06_20:01:58.67518 == Sinatra (v2.2.3) has taken the stage on 9168 for development with backup from WEBrick
2024-03-06_20:01:58.67519 [2024-03-06 20:01:58] INFO  WEBrick::HTTPServer#start: pid=1230 port=9168
2024-03-06_20:01:59.09823 127.0.0.1 - - [06/Mar/2024:20:01:58 UTC] "GET /database HTTP/1.1" 200 0
2024-03-06_20:01:59.09832 - -> /database

==> /var/log/gitlab/gitlab-rails/application_json.log <==
{"severity":"DEBUG","time":"2024-03-06T20:01:43.563Z","message":"Switched database connection","connection_name":"main"}
{"severity":"DEBUG","time":"2024-03-06T20:01:43.563Z","message":"Switched database connection","connection_name":"ci"}
{"severity":"INFO","time":"2024-03-06T20:01:43.567Z","message":"Checking state of dynamic postgres partitions","table_name":"incident_management_pending_alert_escalations","connection_name":"ci"}
{"severity":"DEBUG","time":"2024-03-06T20:01:43.587Z","message":"Switched database connection","connection_name":"main"}
{"severity":"DEBUG","time":"2024-03-06T20:01:43.587Z","message":"Switched database connection","connection_name":"ci"}
{"severity":"INFO","time":"2024-03-06T20:01:43.591Z","message":"Checking state of dynamic postgres partitions","table_name":"incident_management_pending_issue_escalations","connection_name":"ci"}
{"severity":"DEBUG","time":"2024-03-06T20:01:43.611Z","message":"Switched database connection","connection_name":"main"}
{"severity":"DEBUG","time":"2024-03-06T20:01:43.612Z","message":"Switched database connection","connection_name":"ci"}
{"severity":"INFO","time":"2024-03-06T20:01:43.615Z","message":"Checking state of dynamic postgres partitions","table_name":"verification_codes","connection_name":"ci"}
{"severity":"INFO","time":"2024-03-06T20:01:43.636Z","message":"Finished sync of dynamic postgres partitions"}

==> /var/log/gitlab/gitlab-rails/gitlab-rails-db-migrate-2024-03-06-19-59-56.log <==
OK

== Seed from /opt/gitlab/embedded/service/gitlab-rails/db/fixtures/production/010_settings.rb
Saved CI JWT signing key

== Seed from /opt/gitlab/embedded/service/gitlab-rails/db/fixtures/production/020_create_work_item_hierarchy_restrictions.rb

OK

== Seed from /opt/gitlab/embedded/service/gitlab-rails/db/fixtures/production/999_common_metrics.rb

==> /var/log/gitlab/gitlab-rails/grpc.log <==
# Logfile created on 2024-03-06 20:00:06 +0000 by logger.rb/v1.4.3

==> /var/log/gitlab/gitlab-rails/sidekiq_client.log <==
# Logfile created on 2024-03-06 20:00:06 +0000 by logger.rb/v1.4.3

==> /var/log/gitlab/gitlab-rails/service_measurement.log <==
# Logfile created on 2024-03-06 20:00:06 +0000 by logger.rb/v1.4.3

==> /var/log/gitlab/gitlab-rails/database_load_balancing.log <==
{"severity":"DEBUG","time":"2024-03-06T20:01:04.079Z","correlation_id":null,"event":"setup","model":"ActiveRecord::Base","start_service_discovery":true}
{"severity":"DEBUG","time":"2024-03-06T20:01:04.081Z","correlation_id":null,"event":"setup","model":"Ci::ApplicationRecord","start_service_discovery":true}
{"severity":"DEBUG","time":"2024-03-06T20:01:04.113Z","correlation_id":null,"event":"setup","model":"ActiveRecord::Base","start_service_discovery":true}
{"severity":"DEBUG","time":"2024-03-06T20:01:04.114Z","correlation_id":null,"event":"setup","model":"Ci::ApplicationRecord","start_service_discovery":true}
{"severity":"DEBUG","time":"2024-03-06T20:01:04.115Z","correlation_id":null,"event":"setup","model":"ActiveRecord::Base","start_service_discovery":true}
{"severity":"DEBUG","time":"2024-03-06T20:01:04.117Z","correlation_id":null,"event":"setup","model":"Ci::ApplicationRecord","start_service_discovery":true}
{"severity":"DEBUG","time":"2024-03-06T20:01:43.075Z","correlation_id":null,"event":"setup","model":"ActiveRecord::Base","start_service_discovery":false}
{"severity":"DEBUG","time":"2024-03-06T20:01:43.076Z","correlation_id":null,"event":"setup","model":"ActiveRecord::Base","start_service_discovery":true}
{"severity":"DEBUG","time":"2024-03-06T20:01:43.077Z","correlation_id":null,"event":"setup","model":"Ci::ApplicationRecord","start_service_discovery":false}
{"severity":"DEBUG","time":"2024-03-06T20:01:43.077Z","correlation_id":null,"event":"setup","model":"Ci::ApplicationRecord","start_service_discovery":true}

==> /var/log/gitlab/gitlab-rails/production_json.log <==
# Logfile created on 2024-03-06 20:00:06 +0000 by logger.rb/v1.4.3
{"method":"GET","path":"/","format":"html","controller":"RootController","action":"index","status":302,"location":"http://example.org/users/sign_in","time":"2024-03-06T20:01:03.600Z","params":[],"correlation_id":"58a35ef0-f4d0-4aec-af9a-1851e7fd5e4a","meta.caller_id":"RootController#index","meta.feature_category":"projects","meta.client_id":"ip/","request_urgency":"low","target_duration_s":5,"redis_calls":16,"redis_duration_s":0.005947,"redis_read_bytes":16,"redis_write_bytes":2696,"redis_feature_flag_calls":16,"redis_feature_flag_duration_s":0.005947,"redis_feature_flag_read_bytes":16,"redis_feature_flag_write_bytes":2696,"db_count":8,"db_write_count":0,"db_cached_count":0,"db_replica_count":0,"db_primary_count":8,"db_main_count":8,"db_ci_count":0,"db_main_replica_count":0,"db_ci_replica_count":0,"db_replica_cached_count":0,"db_primary_cached_count":0,"db_main_cached_count":0,"db_ci_cached_count":0,"db_main_replica_cached_count":0,"db_ci_replica_cached_count":0,"db_replica_wal_count":0,"db_primary_wal_count":0,"db_main_wal_count":0,"db_ci_wal_count":0,"db_main_replica_wal_count":0,"db_ci_replica_wal_count":0,"db_replica_wal_cached_count":0,"db_primary_wal_cached_count":0,"db_main_wal_cached_count":0,"db_ci_wal_cached_count":0,"db_main_replica_wal_cached_count":0,"db_ci_replica_wal_cached_count":0,"db_replica_duration_s":0.0,"db_primary_duration_s":0.005,"db_main_duration_s":0.005,"db_ci_duration_s":0.0,"db_main_replica_duration_s":0.0,"db_ci_replica_duration_s":0.0,"cpu_s":0.044509,"mem_objects":27347,"mem_bytes":3039624,"mem_mallocs":9939,"mem_total_bytes":4133504,"pid":790,"worker_id":"puma_master","rate_limiting_gates":[],"db_duration_s":0.00188,"view_duration_s":0.0,"duration_s":0.02605}
{"method":"GET","path":"/help","format":"*/*","controller":"HelpController","action":"index","status":200,"time":"2024-03-06T20:01:09.077Z","params":[],"correlation_id":"01HRANNZCGSEKA24AE6V74R4JY","meta.caller_id":"HelpController#index","meta.remote_ip":"127.0.0.1","meta.feature_category":"not_owned","meta.client_id":"ip/127.0.0.1","remote_ip":"127.0.0.1","ua":"curl/8.0.1-DEV","queue_duration_s":0.025215,"request_urgency":"default","target_duration_s":1,"redis_calls":15,"redis_duration_s":0.008898,"redis_read_bytes":14,"redis_write_bytes":2534,"redis_cache_calls":9,"redis_cache_duration_s":0.004769,"redis_cache_read_bytes":8,"redis_cache_write_bytes":1528,"redis_feature_flag_calls":6,"redis_feature_flag_duration_s":0.004129,"redis_feature_flag_read_bytes":6,"redis_feature_flag_write_bytes":1006,"db_count":15,"db_write_count":0,"db_cached_count":6,"db_replica_count":0,"db_primary_count":15,"db_main_count":15,"db_ci_count":0,"db_main_replica_count":0,"db_ci_replica_count":0,"db_replica_cached_count":0,"db_primary_cached_count":6,"db_main_cached_count":6,"db_ci_cached_count":0,"db_main_replica_cached_count":0,"db_ci_replica_cached_count":0,"db_replica_wal_count":0,"db_primary_wal_count":0,"db_main_wal_count":0,"db_ci_wal_count":0,"db_main_replica_wal_count":0,"db_ci_replica_wal_count":0,"db_replica_wal_cached_count":0,"db_primary_wal_cached_count":0,"db_main_wal_cached_count":0,"db_ci_wal_cached_count":0,"db_main_replica_wal_cached_count":0,"db_ci_replica_wal_cached_count":0,"db_replica_duration_s":0.0,"db_primary_duration_s":0.009,"db_main_duration_s":0.009,"db_ci_duration_s":0.0,"db_main_replica_duration_s":0.0,"db_ci_replica_duration_s":0.0,"cpu_s":0.496286,"mem_objects":576873,"mem_bytes":69577560,"mem_mallocs":279753,"mem_total_bytes":92652480,"pid":953,"worker_id":"puma_3","rate_limiting_gates":[],"db_duration_s":0.02803,"view_duration_s":0.5054,"duration_s":0.54441}
{"method":"GET","path":"/-/metrics","format":"html","controller":"MetricsController","action":"index","status":200,"time":"2024-03-06T20:01:27.937Z","params":[],"redis_calls":2,"redis_duration_s":0.000459,"redis_read_bytes":2,"redis_write_bytes":315,"redis_feature_flag_calls":2,"redis_feature_flag_duration_s":0.000459,"redis_feature_flag_read_bytes":2,"redis_feature_flag_write_bytes":315,"db_count":1,"db_write_count":0,"db_cached_count":0,"db_replica_count":0,"db_primary_count":1,"db_main_count":1,"db_ci_count":0,"db_main_replica_count":0,"db_ci_replica_count":0,"db_replica_cached_count":0,"db_primary_cached_count":0,"db_main_cached_count":0,"db_ci_cached_count":0,"db_main_replica_cached_count":0,"db_ci_replica_cached_count":0,"db_replica_wal_count":0,"db_primary_wal_count":0,"db_main_wal_count":0,"db_ci_wal_count":0,"db_main_replica_wal_count":0,"db_ci_replica_wal_count":0,"db_replica_wal_cached_count":0,"db_primary_wal_cached_count":0,"db_main_wal_cached_count":0,"db_ci_wal_cached_count":0,"db_main_replica_wal_cached_count":0,"db_ci_replica_wal_cached_count":0,"db_replica_duration_s":0.0,"db_primary_duration_s":0.001,"db_main_duration_s":0.001,"db_ci_duration_s":0.0,"db_main_replica_duration_s":0.0,"db_ci_replica_duration_s":0.0,"cpu_s":0.066906,"mem_objects":6086,"mem_bytes":1864184,"mem_mallocs":9672,"mem_total_bytes":2107624,"pid":953,"worker_id":"puma_3","rate_limiting_gates":[],"correlation_id":"fdaf0420-142d-4c05-81ac-9a26960b04b7","db_duration_s":0.00056,"view_duration_s":0.00566,"duration_s":0.05952}
{"method":"GET","path":"/-/metrics","format":"html","controller":"MetricsController","action":"index","status":200,"time":"2024-03-06T20:01:42.942Z","params":[],"redis_calls":2,"redis_duration_s":0.004066,"redis_read_bytes":405,"redis_write_bytes":126,"redis_feature_flag_calls":2,"redis_feature_flag_duration_s":0.004066,"redis_feature_flag_read_bytes":405,"redis_feature_flag_write_bytes":126,"db_count":0,"db_write_count":0,"db_cached_count":0,"db_replica_count":0,"db_primary_count":0,"db_main_count":0,"db_ci_count":0,"db_main_replica_count":0,"db_ci_replica_count":0,"db_replica_cached_count":0,"db_primary_cached_count":0,"db_main_cached_count":0,"db_ci_cached_count":0,"db_main_replica_cached_count":0,"db_ci_replica_cached_count":0,"db_replica_wal_count":0,"db_primary_wal_count":0,"db_main_wal_count":0,"db_ci_wal_count":0,"db_main_replica_wal_count":0,"db_ci_replica_wal_count":0,"db_replica_wal_cached_count":0,"db_primary_wal_cached_count":0,"db_main_wal_cached_count":0,"db_ci_wal_cached_count":0,"db_main_replica_wal_cached_count":0,"db_ci_replica_wal_cached_count":0,"db_replica_duration_s":0.0,"db_primary_duration_s":0.0,"db_main_duration_s":0.0,"db_ci_duration_s":0.0,"db_main_replica_duration_s":0.0,"db_ci_replica_duration_s":0.0,"cpu_s":0.060628,"mem_objects":8454,"mem_bytes":2110392,"mem_mallocs":10809,"mem_total_bytes":2448552,"pid":949,"worker_id":"puma_1","rate_limiting_gates":[],"correlation_id":"3f19e2a4-4c39-4162-929f-a9aaff807ad6","db_duration_s":0.0,"view_duration_s":0.00767,"duration_s":0.04869}

==> /var/log/gitlab/gitlab-rails/api_json.log <==
# Logfile created on 2024-03-07 08:16:06 +0000 by logger.rb/v1.4.3
{"time":"2024-03-07T08:17:51.814Z","severity":"INFO","duration_s":0.02768,"db_duration_s":0.0,"view_duration_s":0.02768,"status":200,"method":"GET","path":"/api/v4/geo/proxy","params":[],"host":"localhost","remote_ip":"127.0.0.1","ua":"Go-http-client/1.1","route":"/api/:version/geo/proxy","db_count":0,"db_write_count":0,"db_cached_count":0,"db_replica_count":0,"db_primary_count":0,"db_main_count":0,"db_ci_count":0,"db_main_replica_count":0,"db_ci_replica_count":0,"db_replica_cached_count":0,"db_primary_cached_count":0,"db_main_cached_count":0,"db_ci_cached_count":0,"db_main_replica_cached_count":0,"db_ci_replica_cached_count":0,"db_replica_wal_count":0,"db_primary_wal_count":0,"db_main_wal_count":0,"db_ci_wal_count":0,"db_main_replica_wal_count":0,"db_ci_replica_wal_count":0,"db_replica_wal_cached_count":0,"db_primary_wal_cached_count":0,"db_main_wal_cached_count":0,"db_ci_wal_cached_count":0,"db_main_replica_wal_cached_count":0,"db_ci_replica_wal_cached_count":0,"db_replica_duration_s":0.0,"db_primary_duration_s":0.0,"db_main_duration_s":0.0,"db_ci_duration_s":0.0,"db_main_replica_duration_s":0.0,"db_ci_replica_duration_s":0.0,"cpu_s":0.060018,"mem_objects":11697,"mem_bytes":3672800,"mem_mallocs":7106,"mem_total_bytes":4140680,"pid":1295,"worker_id":"puma_1","rate_limiting_gates":[],"correlation_id":"7d6ea33c-4229-4359-b5e8-a51e9c491c7c","meta.caller_id":"GET /api/:version/geo/proxy","meta.remote_ip":"127.0.0.1","meta.feature_category":"geo_replication","meta.client_id":"ip/127.0.0.1","request_urgency":"low","target_duration_s":5}
{"time":"2024-03-07T08:18:37.206Z","severity":"INFO","duration_s":0.00147,"db_duration_s":0.0,"view_duration_s":0.00147,"status":200,"method":"GET","path":"/api/v4/geo/proxy","params":[],"host":"localhost","remote_ip":"127.0.0.1","ua":"Go-http-client/1.1","route":"/api/:version/geo/proxy","db_count":1,"db_write_count":0,"db_cached_count":0,"db_replica_count":0,"db_primary_count":1,"db_main_count":1,"db_ci_count":0,"db_main_replica_count":0,"db_ci_replica_count":0,"db_replica_cached_count":0,"db_primary_cached_count":0,"db_main_cached_count":0,"db_ci_cached_count":0,"db_main_replica_cached_count":0,"db_ci_replica_cached_count":0,"db_replica_wal_count":0,"db_primary_wal_count":0,"db_main_wal_count":0,"db_ci_wal_count":0,"db_main_replica_wal_count":0,"db_ci_replica_wal_count":0,"db_replica_wal_cached_count":0,"db_primary_wal_cached_count":0,"db_main_wal_cached_count":0,"db_ci_wal_cached_count":0,"db_main_replica_wal_cached_count":0,"db_ci_replica_wal_cached_count":0,"db_replica_duration_s":0.0,"db_primary_duration_s":0.007,"db_main_duration_s":0.007,"db_ci_duration_s":0.0,"db_main_replica_duration_s":0.0,"db_ci_replica_duration_s":0.0,"cpu_s":0.021313,"mem_objects":7795,"mem_bytes":930115,"mem_mallocs":2708,"mem_total_bytes":1241915,"pid":1295,"worker_id":"puma_1","rate_limiting_gates":[],"correlation_id":"d2c40cc6-d65c-43d7-9199-e83545141595","meta.caller_id":"GET /api/:version/geo/proxy","meta.remote_ip":"127.0.0.1","meta.feature_category":"geo_replication","meta.client_id":"ip/127.0.0.1","request_urgency":"low","target_duration_s":5}

==> /var/log/gitlab/gitlab-rails/auth.log <==
# Logfile created on 2024-03-07 08:16:04 +0000 by logger.rb/v1.4.3
{"severity":"INFO","time":"2024-03-07T08:16:04.817Z","gitlab_throttle_user_allowlist":[]}
{"severity":"INFO","time":"2024-03-07T08:16:48.128Z","gitlab_throttle_user_allowlist":[]}
{"severity":"INFO","time":"2024-03-07T08:17:15.241Z","gitlab_throttle_user_allowlist":[]}
{"severity":"INFO","time":"2024-03-07T08:17:25.533Z","gitlab_throttle_user_allowlist":[]}
{"severity":"INFO","time":"2024-03-07T08:18:20.065Z","gitlab_throttle_user_allowlist":[]}

==> /var/log/gitlab/gitlab-rails/production.log <==
Creating scope :in_pipelines. Overwriting existing method Ci::Build.in_pipelines.
Creating scope :without_statuses. Overwriting existing method Ci::Pipeline.without_statuses.
Creating scope :of_projects. Overwriting existing method MergeRequest.of_projects.
Creating scope :join_project. Overwriting existing method MergeRequest.join_project.
Creating scope :references_project. Overwriting existing method MergeRequest.references_project.
Creating scope :system. Overwriting existing method Note.system.
Creating scope :order_created_desc. Overwriting existing method Packages::Package.order_created_desc.
Creating scope :order_name_desc. Overwriting existing method Packages::Package.order_name_desc.
Creating scope :auth. Overwriting existing method Key.auth.
Creating scope :signing. Overwriting existing method Key.signing.

==> /var/log/gitlab/gitlabbootlog <==
{"severity":"DEBUG","time":"2024-03-06T20:01:43.076Z","correlation_id":null,"event":"setup","model":"ActiveRecord::Base","start_service_discovery":true}
{"severity":"DEBUG","time":"2024-03-06T20:01:43.077Z","correlation_id":null,"event":"setup","model":"Ci::ApplicationRecord","start_service_discovery":false}
{"severity":"DEBUG","time":"2024-03-06T20:01:43.077Z","correlation_id":null,"event":"setup","model":"Ci::ApplicationRecord","start_service_discovery":true}

==> /var/log/gitlab/gitlab-rails/production_json.log <==
# Logfile created on 2024-03-06 20:00:06 +0000 by logger.rb/v1.4.3
{"method":"GET","path":"/","format":"html","controller":"RootController","action":"index","status":302,"location":"http://example.org/users/sign_in","time":"2024-03-06T20:01:03.600Z","params":[],"correlation_id":"58a35ef0-f4d0-4aec-af9a-1851e7fd5e4a","meta.caller_id":"RootController#index","meta.feature_category":"projects","meta.client_id":"ip/","request_urgency":"low","target_duration_s":5,"redis_calls":16,"redis_duration_s":0.005947,"redis_read_bytes":16,"redis_write_bytes":2696,"redis_feature_flag_calls":16,"redis_feature_flag_duration_s":0.005947,"redis_feature_flag_read_bytes":16,"redis_feature_flag_write_bytes":2696,"db_count":8,"db_write_count":0,"db_cached_count":0,"db_replica_count":0,"db_primary_count":8,"db_main_count":8,"db_ci_count":0,"db_main_replica_count":0,"db_ci_replica_count":0,"db_replica_cached_count":0,"db_primary_cached_count":0,"db_main_cached_count":0,"db_ci_cached_count":0,"db_main_replica_cached_count":0,"db_ci_replica_cached_count":0,"db_replica_wal_count":0,"db_primary_wal_count":0,"db_main_wal_count":0,"db_ci_wal_count":0,"db_main_replica_wal_count":0,"db_ci_replica_wal_count":0,"db_replica_wal_cached_count":0,"db_primary_wal_cached_count":0,"db_main_wal_cached_count":0,"db_ci_wal_cached_count":0,"db_main_replica_wal_cached_count":0,"db_ci_replica_wal_cached_count":0,"db_replica_duration_s":0.0,"db_primary_duration_s":0.005,"db_main_duration_s":0.005,"db_ci_duration_s":0.0,"db_main_replica_duration_s":0.0,"db_ci_replica_duration_s":0.0,"cpu_s":0.044509,"mem_objects":27347,"mem_bytes":3039624,"mem_mallocs":9939,"mem_total_bytes":4133504,"pid":790,"worker_id":"puma_master","rate_limiting_gates":[],"db_duration_s":0.00188,"view_duration_s":0.0,"duration_s":0.02605}
{"method":"GET","path":"/help","format":"*/*","controller":"HelpController","action":"index","status":200,"time":"2024-03-06T20:01:09.077Z","params":[],"correlation_id":"01HRANNZCGSEKA24AE6V74R4JY","meta.caller_id":"HelpController#index","meta.remote_ip":"127.0.0.1","meta.feature_category":"not_owned","meta.client_id":"ip/127.0.0.1","remote_ip":"127.0.0.1","ua":"curl/8.0.1-DEV","queue_duration_s":0.025215,"request_urgency":"default","target_duration_s":1,"redis_calls":15,"redis_duration_s":0.008898,"redis_read_bytes":14,"redis_write_bytes":2534,"redis_cache_calls":9,"redis_cache_duration_s":0.004769,"redis_cache_read_bytes":8,"redis_cache_write_bytes":1528,"redis_feature_flag_calls":6,"redis_feature_flag_duration_s":0.004129,"redis_feature_flag_read_bytes":6,"redis_feature_flag_write_bytes":1006,"db_count":15,"db_write_count":0,"db_cached_count":6,"db_replica_count":0,"db_primary_count":15,"db_main_count":15,"db_ci_count":0,"db_main_replica_count":0,"db_ci_replica_count":0,"db_replica_cached_count":0,"db_primary_cached_count":6,"db_main_cached_count":6,"db_ci_cached_count":0,"db_main_replica_cached_count":0,"db_ci_replica_cached_count":0,"db_replica_wal_count":0,"db_primary_wal_count":0,"db_main_wal_count":0,"db_ci_wal_count":0,"db_main_replica_wal_count":0,"db_ci_replica_wal_count":0,"db_replica_wal_cached_count":0,"db_primary_wal_cached_count":0,"db_main_wal_cached_count":0,"db_ci_wal_cached_count":0,"db_main_replica_wal_cached_count":0,"db_ci_replica_wal_cached_count":0,"db_replica_duration_s":0.0,"db_primary_duration_s":0.009,"db_main_duration_s":0.009,"db_ci_duration_s":0.0,"db_main_replica_duration_s":0.0,"db_ci_replica_duration_s":0.0,"cpu_s":0.496286,"mem_objects":576873,"mem_bytes":69577560,"mem_mallocs":279753,"mem_total_bytes":92652480,"pid":953,"worker_id":"puma_3","rate_limiting_gates":[],"db_duration_s":0.02803,"view_duration_s":0.5054,"duration_s":0.54441}

==> /var/log/gitlab/gitlab-rails/production_json.log <==
{"method":"GET","path":"/-/metrics","format":"html","controller":"MetricsController","action":"index","status":200,"time":"2024-03-09T13:24:32.617Z","params":[],"db_count":0,"db_write_count":0,"db_cached_count":0,"db_replica_count":0,"db_primary_count":0,"db_main_count":0,"db_ci_count":0,"db_main_replica_count":0,"db_ci_replica_count":0,"db_replica_cached_count":0,"db_primary_cached_count":0,"db_main_cached_count":0,"db_ci_cached_count":0,"db_main_replica_cached_count":0,"db_ci_replica_cached_count":0,"db_replica_wal_count":0,"db_primary_wal_count":0,"db_main_wal_count":0,"db_ci_wal_count":0,"db_main_replica_wal_count":0,"db_ci_replica_wal_count":0,"db_replica_wal_cached_count":0,"db_primary_wal_cached_count":0,"db_main_wal_cached_count":0,"db_ci_wal_cached_count":0,"db_main_replica_wal_cached_count":0,"db_ci_replica_wal_cached_count":0,"db_replica_duration_s":0.0,"db_primary_duration_s":0.0,"db_main_duration_s":0.0,"db_ci_duration_s":0.0,"db_main_replica_duration_s":0.0,"db_ci_replica_duration_s":0.0,"cpu_s":0.0395,"mem_objects":2317,"mem_bytes":1693352,"mem_mallocs":8222,"mem_total_bytes":1786032,"pid":1456,"worker_id":"puma_1","rate_limiting_gates":[],"correlation_id":"c4c991f4-b79d-4010-bc7b-21ef05e425d5","db_duration_s":0.0,"view_duration_s":0.00049,"duration_s":0.03607}


{"severity":"INFO","time":"2024-03-09T13:24:03.579Z","retry":0,"queue":"default","version":0,"queue_namespace":"cronjob","args":[],"class":"Metrics::GlobalMetricsUpdateWorker","jid":"5856a1ba208fb3656b5718b3","created_at":"2024-03-09T13:24:03.551Z","meta.caller_id":"Cronjob","correlation_id":"1679f6fd1b93c750ac01b1bf897f9a10","meta.root_caller_id":"Cronjob","meta.feature_category":"metrics","worker_data_consistency":"sticky","wal_locations":{},"wal_location_source":"primary","idempotency_key":"resque:gitlab:duplicate:default:0ef60401f7cd15675ace9e5ac4456efd82434f42e048584516e1e7a85b24e5ba","size_limiter":"validated","enqueued_at":"2024-03-09T13:24:03.552Z","job_size_bytes":2,"pid":980,"message":"Metrics::GlobalMetricsUpdateWorker JID-5856a1ba208fb3656b5718b3: done: 0.022344 sec","job_status":"done","scheduling_latency_s":0.004485,"redis_calls":4,"redis_duration_s":0.006024,"redis_read_bytes":4,"redis_write_bytes":494,"redis_queues_calls":2,"redis_queues_duration_s":0.002463,"redis_queues_read_bytes":2,"redis_queues_write_bytes":186,"redis_shared_state_calls":2,"redis_shared_state_duration_s":0.003561,"redis_shared_state_read_bytes":2,"redis_shared_state_write_bytes":308,"db_count":0,"db_write_count":0,"db_cached_count":0,"db_replica_count":0,"db_primary_count":0,"db_main_count":0,"db_ci_count":0,"db_main_replica_count":0,"db_ci_replica_count":0,"db_replica_cached_count":0,"db_primary_cached_count":0,"db_main_cached_count":0,"db_ci_cached_count":0,"db_main_replica_cached_count":0,"db_ci_replica_cached_count":0,"db_replica_wal_count":0,"db_primary_wal_count":0,"db_main_wal_count":0,"db_ci_wal_count":0,"db_main_replica_wal_count":0,"db_ci_replica_wal_count":0,"db_replica_wal_cached_count":0,"db_primary_wal_cached_count":0,"db_main_wal_cached_count":0,"db_ci_wal_cached_count":0,"db_main_replica_wal_cached_count":0,"db_ci_replica_wal_cached_count":0,"db_replica_duration_s":0.0,"db_primary_duration_s":0.0,"db_main_duration_s":0.0,"db_ci_duration_s":0.0,"db_main_replica_duration_s":0.0,"db_ci_replica_duration_s":0.0,"cpu_s":0.004796,"mem_objects":2918,"mem_bytes":460632,"mem_mallocs":1061,"mem_total_bytes":577352,"worker_id":"sidekiq_0","rate_limiting_gates":[],"duration_s":0.022344,"completed_at":"2024-03-09T13:24:03.579Z","load_balancing_strategy":"primary_no_wal","db_duration_s":0.0}
{"severity":"INFO","time":"2024-03-09T13:24:03.606Z","retry":0,"queue":"default","version":0,"queue_namespace":"cronjob","args":[],"class":"LooseForeignKeys::CleanupWorker","jid":"26570a424958ac6fd80ff4cb","created_at":"2024-03-09T13:24:03.566Z","meta.caller_id":"Cronjob","correlation_id":"dfd89e8a205d63c3cfd2ebc26e7bf7f1","meta.root_caller_id":"Cronjob","meta.feature_category":"cell","worker_data_consistency":"always","idempotency_key":"resque:gitlab:duplicate:default:2180384c8554b410820afa81ad3479301139c7627524f882c6bca44488742df9","size_limiter":"validated","enqueued_at":"2024-03-09T13:24:03.570Z","job_size_bytes":2,"pid":980,"message":"LooseForeignKeys::CleanupWorker JID-26570a424958ac6fd80ff4cb: done: 0.034937 sec","job_status":"done","scheduling_latency_s":0.001038,"redis_calls":4,"redis_duration_s":0.004606,"redis_read_bytes":4,"redis_write_bytes":487,"redis_queues_calls":2,"redis_queues_duration_s":0.002893,"redis_queues_read_bytes":2,"redis_queues_write_bytes":186,"redis_shared_state_calls":2,"redis_shared_state_duration_s":0.001713,"redis_shared_state_read_bytes":2,"redis_shared_state_write_bytes":301,"db_count":12,"db_write_count":0,"db_cached_count":0,"db_replica_count":0,"db_primary_count":12,"db_main_count":12,"db_ci_count":0,"db_main_replica_count":0,"db_ci_replica_count":0,"db_replica_cached_count":0,"db_primary_cached_count":0,"db_main_cached_count":0,"db_ci_cached_count":0,"db_main_replica_cached_count":0,"db_ci_replica_cached_count":0,"db_replica_wal_count":0,"db_primary_wal_count":0,"db_main_wal_count":0,"db_ci_wal_count":0,"db_main_replica_wal_count":0,"db_ci_replica_wal_count":0,"db_replica_wal_cached_count":0,"db_primary_wal_cached_count":0,"db_main_wal_cached_count":0,"db_ci_wal_cached_count":0,"db_main_replica_wal_cached_count":0,"db_ci_replica_wal_cached_count":0,"db_replica_duration_s":0.0,"db_primary_duration_s":0.006,"db_main_duration_s":0.006,"db_ci_duration_s":0.0,"db_main_replica_duration_s":0.0,"db_ci_replica_duration_s":0.0,"cpu_s":0.017462,"mem_objects":8559,"mem_bytes":527304,"mem_mallocs":4800,"mem_total_bytes":869664,"worker_id":"sidekiq_0","rate_limiting_gates":[],"extra.loose_foreign_keys_cleanup_worker.stats":{"over_limit":false,"delete_count_by_table":{},"update_count_by_table":{},"delete_count":0,"update_count":0,"connection":"main"},"duration_s":0.034937,"completed_at":"2024-03-09T13:24:03.606Z","load_balancing_strategy":"primary","db_duration_s":0.011503}